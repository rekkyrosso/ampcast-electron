(globalThis.webpackChunkampcast=globalThis.webpackChunkampcast||[]).push([[336],{4556:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var n,r=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(n=0;n<r.length;++n)if(r[n].test(e))return r[n].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(n=0;n<i.length;++n)if(/^[^#\&\?]{11}$/.test(i[n]))return i[n]}}return null}},1104:(e,t,n)=>{var r=n(6512);e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===r||"object"!=typeof r.versions||!r.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},8352:(e,t,n)=>{"use strict";var r=n(7104);t.C=r.createRoot,r.hydrateRoot},3728:(e,t,n)=>{"use strict";var r=n(1504),i=n(8352),a=n(7928),s=n.n(a),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(r))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(r,""),t()})),i.addEventListener("error",(()=>n(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const n=[],r=[...e];for(;r.length;)n.push(r.splice(0,t));return n}function d(e,t){const n="function"==typeof t?t:e=>e[t];return e.reduce(((e,t)=>{const r=n(t);return e[r]||(e[r]=[]),e[r].push(t),e}),{})}function m(e,t){const n=[],r=[];for(const i of e)t(i)?n.push(i):r.push(i);return[n,r]}function h(e){return[...new Set(e)]}function p(e,t){return e.filter(((e,n,r)=>n===r.findIndex((n=>e[t]===n[t]))))}function f(e){let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t);t--;const r=e[t];e[t]=e[n],e[n]=r}return e}function y(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function v(e){return y(e).slice(0,7)}function b(e){return new Date(Math.floor(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function g(e){e.preventDefault()}function w(e){e.stopPropagation()}function E(e){e.preventDefault(),e.stopPropagation()}function k(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function x(e,t={}){return h(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>(void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r]),n)),{})}function S(e,t,n){const r=e.filter(t,n);return 0===r.length?e.slice():r}function T(e,t,n=.9){return Math.max(s()(e,t,.99),s()(t,e,.99))>=n}function P(e=""){const t=document.createElement("p"),n=String(null!=e?e:"").trim().split(/[\n\r]+/);return null==n?void 0:n.map((e=>(t.innerHTML=e,t.textContent))).join("\n")}function A(e){return new Promise((t=>setTimeout(t,e)))}var I=n(8368),C=n(1104),M=n.n(C);const O=(0,I.IT)(),$=(null==O?void 0:O.name)||"unknown",N=/^edge/.test($)?"Microsoft Edge":$.replace(/^\w/,(e=>e.toUpperCase())),z=(null==O?void 0:O.version)||"0",j=(null==O?void 0:O.os)||"unknown",L="Mac OS"===j?"metaKey":"ctrlKey",D="Mac OS"===j?"⌘":"Ctrl",R={name:$,displayName:N,version:z,os:j,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test(j),ctrlKey:L,ctrlKeyStr:D,isElectron:M()()};const F=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function _(e){return Object.keys(e).reduce(((t,n)=>(void 0===e[n]||F.includes(n)||(t[n]=e[n]),t)),{})}function B(e){return/m[uú][sz](i|ie)[ckq]/i.test(e)}const V="Mac OS"===R.os||"iOS"===R.os?"fairplay":"widevine";let U="";const H={widevine:"com.widevine.alpha",fairplay:"com.apple.fairplay",playready:"com.microsoft.playready"};function q(e,t){return new Promise((n=>{const r=document.createElement(e),i=e=>()=>{r.removeAttribute("src"),clearTimeout(o),n(e)},a=i(!1),s=i(!0),o=setTimeout(s,1e3);try{r.muted=!0,r.crossOrigin="anonymous",r.onerror=a,r.oncanplay=s,r.onplaying=s,r.ontimeupdate=s,r.setAttribute("src",t),r.play().then(void 0,a)}catch(e){a()}}))}class Y{constructor(e="",t=!1,n=window.console){const r=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(Y.only)&&n.log(...t)};this.log=(...e)=>a(`##${r}`,...e),this.warn=(...e)=>a(`###${r}`,...e),this.error=t=>{e.startsWith(Y.only)&&(a(`####${r} ERROR`),n.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=r=>new Y(i(e,r),t,n),this.rx=t=>new Y(i(e,t),!0,n),this.only=()=>this}}Y.only="";const K=Y,W=new Map,G={get length(){return W.size},clear(){W.clear()},key(e){var t;return null!==(t=[...W.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=W.get(String(e)))&&void 0!==t?t:null},setItem(e,t){W.set(String(e),String(t))},removeItem(e){W.delete(String(e))}},J=G,Q=new K("LiteStorage");class X{constructor(e,t="local"){const n=`${t}-${e}`;if(X.ids.includes(n))throw Error(`Duplicate storageId: ${n}`);switch(X.ids.push(n),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=J}}getBoolean(e,t=!1){var n;const r=null!==(n=this.getItem(e))&&void 0!==n?n:t;return!!r&&"false"!==r}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const n=this.getItem(e);try{return n?JSON.parse(n):t}catch(e){Q.error(e)}return t}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){Q.error(e)}}getNumber(e,t=0){var n;const r=Number(null!==(n=this.getItem(e))&&void 0!==n?n:t);return isNaN(r)?t:r}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var n;return String(null!==(n=this.getItem(e))&&void 0!==n?n:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}hasItem(e){return null!==this.getItem(e)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let n=0;n<this.storage.length;n++){const r=this.storage.key(n);r.startsWith(e)&&t.push(r)}t.forEach((e=>this.storage.removeItem(e)))}}X.ids=[];const Z=X;var ee=function(e,t){return ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ee(e,t)};function te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ne(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function re(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ie(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s}function ae(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function se(e){return this instanceof se?(this.v=e,this):new se(e)}function oe(e){return"function"==typeof e}function le(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ce=le((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ue(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var de=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=re(a),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(oe(l))try{l()}catch(e){i=e instanceof ce?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=re(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{pe(m)}catch(e){i=null!=i?i:[],e instanceof ce?i=ae(ae([],ie(i)),ie(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new ce(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)pe(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ue(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&ue(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),me=de.EMPTY;function he(e){return e instanceof de||e&&"closed"in e&&oe(e.remove)&&oe(e.add)&&oe(e.unsubscribe)}function pe(e){oe(e)?e():e.unsubscribe()}var fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ye={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=ye.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,ae([e,t],ie(n))):setTimeout.apply(void 0,ae([e,t],ie(n)))},clearTimeout:function(e){var t=ye.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ve(e){ye.setTimeout((function(){var t=fe.onUnhandledError;if(!t)throw e;t(e)}))}function be(){}var ge=we("C",void 0,void 0);function we(e,t,n){return{kind:e,value:t,error:n}}var Ee=null;function ke(e){if(fe.useDeprecatedSynchronousErrorHandling){var t=!Ee;if(t&&(Ee={errorThrown:!1,error:null}),e(),t){var n=Ee,r=n.errorThrown,i=n.error;if(Ee=null,r)throw i}}else e()}var xe=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,he(t)&&t.add(n)):n.destination=Me,n}return te(t,e),t.create=function(e,t,n){return new Ae(e,t,n)},t.prototype.next=function(e){this.isStopped?Ce(function(e){return we("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ce(function(e){return we("E",void 0,e)}(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ce(ge,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(de),Se=Function.prototype.bind;function Te(e,t){return Se.call(e,t)}var Pe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ie(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ie(e)}else Ie(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ie(e)}},e}(),Ae=function(e){function t(t,n,r){var i,a,s=e.call(this)||this;return oe(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&fe.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&Te(t.next,a),error:t.error&&Te(t.error,a),complete:t.complete&&Te(t.complete,a)}):i=t,s.destination=new Pe(i),s}return te(t,e),t}(xe);function Ie(e){var t;fe.useDeprecatedSynchronousErrorHandling?(t=e,fe.useDeprecatedSynchronousErrorHandling&&Ee&&(Ee.errorThrown=!0,Ee.error=t)):ve(e)}function Ce(e,t){var n=fe.onStoppedNotification;n&&ye.setTimeout((function(){return n(e,t)}))}var Me={closed:!0,next:be,error:function(e){throw e},complete:be},Oe="function"==typeof Symbol&&Symbol.observable||"@@observable";function $e(e){return e}var Ne=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=function(e){return e&&e instanceof xe||function(e){return e&&oe(e.next)&&oe(e.error)&&oe(e.complete)}(e)&&he(e)}(e)?e:new Ae(e,t,n);return ke((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=ze(t))((function(t,r){var i=new Ae({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Oe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?$e:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=ze(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function ze(e){var t;return null!==(t=null!=e?e:fe.Promise)&&void 0!==t?t:Promise}var je=le((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Le=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return te(t,e),t.prototype.lift=function(e){var t=new De(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new je},t.prototype.next=function(e){var t=this;ke((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=re(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;ke((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ke((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers;return r||i?me:(this.currentObservers=null,a.push(e),new de((function(){t.currentObservers=null,ue(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Ne;return e.source=this,e},t.create=function(e,t){return new De(e,t)},t}(Ne),De=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return te(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:me},t}(Le),Re=le((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Fe(e,t){var n="object"==typeof t;return new Promise((function(r,i){var a=new Ae({next:function(e){r(e),a.unsubscribe()},error:i,complete:function(){n?r(t.defaultValue):i(new Re)}});e.subscribe(a)}))}function _e(e){return function(t){if(function(e){return oe(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Be(e,t,n,r,i){return new Ve(e,t,n,r,i)}var Ve=function(e){function t(t,n,r,i,a,s){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=s,o._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return te(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(xe);function Ue(e,t){return _e((function(n,r){var i=0;n.subscribe(Be(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function He(e,t){return _e((function(n,r){var i=0;n.subscribe(Be(r,(function(n){r.next(e.call(t,n,i++))})))}))}var qe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ye(e){return oe(null==e?void 0:e.then)}function Ke(e){return oe(e[Oe])}function We(e){return Symbol.asyncIterator&&oe(null==e?void 0:e[Symbol.asyncIterator])}function Ge(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Je="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Qe(e){return oe(null==e?void 0:e[Je])}function Xe(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||o(e,t)}))})}function o(e,t){try{(n=i[e](t)).value instanceof se?Promise.resolve(n.value.v).then(l,c):u(a[0][2],n)}catch(e){u(a[0][3],e)}var n}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function(){var t,n,r;return ne(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,se(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,se(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,se(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Ze(e){return oe(null==e?void 0:e.getReader)}function et(e){if(e instanceof Ne)return e;if(null!=e){if(Ke(e))return i=e,new Ne((function(e){var t=i[Oe]();if(oe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(qe(e))return t=e,new Ne((function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()}));if(Ye(e))return r=e,new Ne((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ve)}));if(We(e))return tt(e);if(Qe(e))return n=e,new Ne((function(e){var t,r;try{for(var i=re(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()}));if(Ze(e))return tt(Xe(e))}var t,n,r,i;throw Ge(e)}function tt(e){return new Ne((function(t){(function(e,t){var n,r,i,a,s,o,l,c;return s=this,o=void 0,c=function(){var s,o;return ne(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=re(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(s,o||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function nt(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var a=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(a),!i)return a}function rt(e,t,n){return void 0===n&&(n=1/0),oe(t)?rt((function(n,r){return He((function(e,i){return t(n,e,r,i)}))(et(e(n,r)))}),n):("number"==typeof t&&(n=t),_e((function(t,r){return function(e,t,n,r,i,a,s,o){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<r?p(e):l.push(e)},p=function(e){c++;var i=!1;et(n(e,u++)).subscribe(Be(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),p(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(Be(t,h,(function(){d=!0,m()}))),function(){}}(t,r,e,n)})))}const it=new Z("electron"),at={get port(){let e=it.getString("port");return e||(e=location.port,it.getString("port",e),e)},set port(e){it.setString("port",e)}},st=(0,r.memo)((function(){return r.createElement("svg",{className:"svg-defs",width:"0",height:"0"},r.createElement("defs",null,r.createElement("linearGradient",{id:"apple-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"36",y1:"2.2858",x2:"36",y2:"72.455",gradientTransform:"matrix(1 0 0 -1 0 74.0068)"},r.createElement("stop",{offset:"0",style:{stopColor:"#fa233b"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#fb5c74"}})),r.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},r.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))))}));function ot({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),r.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),r.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"calendar":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"}));case"shuffle":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z"}));case"info":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},r.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},r.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return r.createElement("svg",{className:t,viewBox:"0 0 64 64"},r.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"genre":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"m12 2-5.5 9h11z"}),r.createElement("circle",{stroke:"none",cx:"17.5",cy:"17.5",r:"4.5"}),r.createElement("path",{stroke:"none",d:"M3 13.5h8v8H3z"}));case"star":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),r.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return r.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M4 8h5v5h-5v-5z"}),r.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),r.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"http":case"https":case"globe":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"network":return r.createElement("svg",{className:t,viewBox:"0 0 640 512"},r.createElement("path",{d:"M256 64H384v64H256V64zM240 0c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48h48v32H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96v32H80c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H240c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H192V288H448v32H400c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H560c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H512V288h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V192h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48H240zM96 448V384H224v64H96zm320-64H544v64H416V384z"}));case"data":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{d:"M19.88 18.47c.44-.7.7-1.51.7-2.39 0-2.49-2.01-4.5-4.5-4.5s-4.5 2.01-4.5 4.5 2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21.58 23 23 21.58l-3.12-3.11zm-3.8.11c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zm-.36-8.5c-.74.02-1.45.18-2.1.45l-.55-.83-3.8 6.18-3.01-3.52-3.63 5.81L1 17l5-8 3 3.5L13 6l2.72 4.08zm2.59.5c-.64-.28-1.33-.45-2.05-.49L21.38 2 23 3.18l-4.69 7.4z"}));case"visualizer":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),r.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},r.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},r.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},r.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return r.createElement("svg",{className:t,viewBox:"0 0 384 512"},r.createElement("path",{stroke:"none",d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),r.createElement("rect",{x:"177",y:"220",width:"40",height:"210",stroke:"none"}),r.createElement("rect",{x:"87",y:"310",width:"210",height:"40",stroke:"none"}));case"playlist":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},r.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return r.createElement("svg",{className:t,viewBox:"0 0 73 73"},r.createElement("rect",{className:"icon-apple-inner",x:"10",y:"10",width:"53",height:"53"}),r.createElement("path",{className:"icon-apple-outer",fillRule:"evenodd",clipRule:"evenodd",stroke:"none",d:"M72,19.94c0-0.72-0.01-1.45-0.03-2.17c-0.04-1.58-0.14-3.17-0.42-4.73c-0.28-1.58-0.75-3.06-1.48-4.5\r\n\t\t\tc-0.72-1.41-1.66-2.71-2.78-3.83c-1.12-1.12-2.42-2.06-3.83-2.78c-1.44-0.73-2.91-1.2-4.49-1.48c-1.56-0.28-3.15-0.37-4.73-0.42\r\n\t\t\tC53.51,0.02,52.78,0.01,52.06,0c-0.86,0-1.72,0-2.58,0H22.52c-0.86,0-1.72,0-2.58,0c-0.72,0-1.45,0.01-2.17,0.03\r\n\t\t\tc-1.58,0.04-3.17,0.14-4.73,0.42C11.46,0.74,9.98,1.2,8.55,1.94C7.13,2.66,5.84,3.6,4.72,4.72S2.65,7.13,1.93,8.55\r\n\t\t\tc-0.73,1.44-1.2,2.91-1.48,4.5c-0.28,1.56-0.37,3.15-0.42,4.73C0.02,18.5,0.01,19.22,0,19.94c0,0.86,0,1.72,0,2.58v26.95\r\n\t\t\tc0,0.86,0,1.72,0,2.58c0,0.72,0.01,1.45,0.03,2.17c0.04,1.58,0.14,3.17,0.42,4.73c0.28,1.58,0.75,3.06,1.48,4.5\r\n\t\t\tc0.72,1.41,1.66,2.71,2.78,3.83s2.42,2.06,3.83,2.78c1.44,0.73,2.91,1.2,4.49,1.48c1.56,0.28,3.15,0.37,4.73,0.42\r\n\t\t\tc0.72,0.02,1.45,0.03,2.17,0.03c0.86,0.01,1.72,0,2.58,0h26.95c0.86,0,1.72,0,2.58,0c0.72,0,1.45-0.01,2.17-0.03\r\n\t\t\tc1.58-0.04,3.17-0.14,4.73-0.42c1.58-0.28,3.06-0.75,4.49-1.48c1.41-0.72,2.71-1.66,3.83-2.78c1.12-1.12,2.06-2.41,2.78-3.83\r\n\t\t\tc0.73-1.44,1.2-2.91,1.48-4.5c0.28-1.56,0.37-3.15,0.42-4.73c0.02-0.72,0.03-1.45,0.03-2.17c0.01-0.86,0-1.72,0-2.58V22.52\r\n\t\t\tC72,21.66,72,20.8,72,19.94z M52.71,46.85c0,0.91-0.01,1.74-0.2,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.73-2.5,0.91c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.68-2.6-1.32\r\n\t\t\tc-1.03-0.95-1.68-2.23-1.82-3.56c-0.16-1.57,0.36-3.24,1.53-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.43-0.52,0.43-1.16,0.43-1.78V24.32c0-1.21-0.54-1.54-1.7-1.32\r\n\t\t\tc-0.83,0.16-18.62,3.75-18.62,3.75c-1,0.24-1.36,0.57-1.36,1.82v23.23c0,0.91-0.05,1.74-0.24,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.74-2.5,0.92c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.69-2.6-1.33\r\n\t\t\tc-1.03-0.95-1.63-2.23-1.78-3.56c-0.16-1.57,0.31-3.24,1.49-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.42-0.52,0.47-1.13,0.47-1.75c0-4.92,0-26.78,0-26.78\r\n\t\t\tc0-0.36,0.03-0.6,0.05-0.72c0.09-0.56,0.31-1.05,0.72-1.39c0.34-0.28,0.78-0.48,1.33-0.6l0.01,0L49,11.33\r\n\t\t\tc0.19-0.04,1.73-0.31,1.91-0.33c1.16-0.1,1.81,0.66,1.81,1.89L52.71,46.85L52.71,46.85z"}));case"emby":return r.createElement("svg",{className:t,viewBox:"0 0 48 48"},r.createElement("path",{className:"icon-emby-outer",stroke:"none",d:"m9.104 12.415 2.482 2.482L0 26.484l12.414 12.414 2.483-2.483 11.586 11.586L39.725 34.76l-2.483-2.483L48 21.518 35.587 9.104l-2.483 2.483L21.517 0z"}),r.createElement("path",{className:"icon-emby-inner",stroke:"none",d:"M18.45 32.929v-18.1l15.86 9.05-7.93 4.525z"}));case"plex":return r.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},r.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),r.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"plex-tidal":case"tidal":return r.createElement("svg",{className:t,viewBox:"0 0 560 560"},r.createElement("path",{className:"icon-tidal-inner",d:"M373.331 186.32l-93.324 93.332-93.337-93.341L280.007 93l93.332 93.309L466.67 93 560 186.318l-93.33 93.341-93.339-93.339zm.01 186.669l-93.334 93.34-93.337-93.34 93.337-93.337 93.334 93.337zm-186.67-186.67l-93.338 93.34L0 186.32 93.333 93l93.337 93.318z",fillRule:"nonzero"}));case"jellyfin":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),r.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return r.createElement("svg",{className:t,viewBox:"0 0 168 168"},r.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return r.createElement("svg",{className:t,viewBox:"0 0 455 455"},r.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),r.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return r.createElement("svg",{className:t,viewBox:"0 0 27 30"},r.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),r.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"navidrome":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 10.449C120.275 10.449 10.449 120.276 10.449 256c0 135.725 109.826 245.551 245.551 245.551S501.551 391.725 501.551 256C501.551 120.276 391.725 10.449 256 10.449z"}),r.createElement("path",{fill:"#fff",d:"M256 168.229c-48.515.0-87.771 39.257-87.771 87.771s39.257 87.771 87.771 87.771 87.771-39.257 87.771-87.771S304.515 168.229 256 168.229z"}),r.createElement("path",{fill:"black",d:"M437.061 74.94C388.735 26.615 324.434.0 256 0S123.265 26.615 74.939 74.94.0 187.566.0 256s26.614 132.735 74.939 181.061S187.566 512 256 512s132.735-26.614 181.061-74.939S512 324.434 512 256 485.386 123.266 437.061 74.94zM256 491.102C126.365 491.102 20.898 385.635 20.898 256S126.365 20.898 256 20.898 491.102 126.365 491.102 256 385.635 491.102 256 491.102z"}),r.createElement("path",{fill:"black",d:"M354.22 256c0-54.158-44.061-98.22-98.22-98.22s-98.22 44.062-98.22 98.22 44.062 98.22 98.22 98.22 98.22-44.061 98.22-98.22zm-175.542.0c0-42.636 34.686-77.322 77.322-77.322s77.322 34.686 77.322 77.322S298.636 333.322 256 333.322 178.678 298.636 178.678 256z"}),r.createElement("path",{fill:"black",d:"M285.257 256c0-16.132-13.124-29.257-29.257-29.257S226.743 239.868 226.743 256s13.125 29.257 29.257 29.257S285.257 272.133 285.257 256zm-37.616.0c0-4.609 3.75-8.359 8.359-8.359 4.609.0 8.359 3.75 8.359 8.359.0 4.609-3.75 8.359-8.359 8.359C251.391 264.359 247.641 260.609 247.641 256z"}),r.createElement("path",{fill:"black",d:"M256 391.837c-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c41.897.0 81.265-16.294 110.853-45.883 29.587-29.587 45.881-68.955 45.881-110.852.0-5.771-4.678-10.449-10.449-10.449s-10.449 4.678-10.449 10.449C391.837 330.9 330.9 391.837 256 391.837z"}),r.createElement("path",{fill:"black",d:"M449.306 245.551c-5.771.0-10.449 4.678-10.449 10.449.0 1.481-.018 2.958-.052 4.43-.136 5.769 4.43 10.557 10.199 10.692.085.002.168.003.252.003 5.656.0 10.307-4.517 10.442-10.202.039-1.637.059-3.279.059-4.925C459.755 250.229 455.077 245.551 449.306 245.551z"}),r.createElement("path",{fill:"black",d:"M447.55 284.239c-5.656-1.145-11.168 2.52-12.308 8.178-17.107 84.854-92.489 146.44-179.242 146.44-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c47.353.0 93.467-16.573 129.847-46.668 35.9-29.697 60.717-71.084 69.881-116.54C456.868 290.891 453.207 285.38 447.55 284.239z"}),r.createElement("path",{fill:"black",d:"M256 120.163c5.771.0 10.449-4.678 10.449-10.449S261.771 99.265 256 99.265c-41.897.0-81.265 16.294-110.853 45.883C115.559 174.735 99.265 214.103 99.265 256c0 5.771 4.678 10.449 10.449 10.449s10.449-4.678 10.449-10.449c0-74.9 60.937-135.837 135.837-135.837z"}),r.createElement("path",{fill:"black",d:"M62.996 240.876c-5.759-.14-10.557 4.43-10.692 10.199-.039 1.637-.059 3.279-.059 4.925.0 5.771 4.678 10.449 10.449 10.449S73.143 261.771 73.143 256c0-1.481.018-2.958.052-4.43C73.331 245.8 68.765 241.013 62.996 240.876z"}),r.createElement("path",{fill:"black",d:"M256 73.143c5.771.0 10.449-4.678 10.449-10.449S261.771 52.245 256 52.245c-47.353.0-93.467 16.573-129.847 46.668-35.9 29.697-60.717 71.084-69.881 116.54-1.14 5.657 2.521 11.168 8.178 12.308.697.141 1.392.208 2.076.208 4.872.0 9.232-3.426 10.232-8.386C93.864 134.729 169.247 73.143 256 73.143z"}));case"subsonic":return r.createElement("svg",{className:t,viewBox:"0 0 700 700",transform:"scale(1.125) translate(0 -1)"},r.createElement("path",{d:"M202 108.1c-7 1.1-8.5 1.6-12.3 4.1-2.7 1.7-3.6 3.1-3.9 5.7-.5 3.8-.1 54.1.6 75.1.2 7.4.5 19.3.6 26.4l.2 12.8-5.8 6-5.9 5.9.2 26.8.2 26.8-20.7 10-20.7 10-5-1.9c-8.5-3.4-21.9-6.6-30.1-7.3-4.4-.4-8.2-.9-8.5-1.1-1.4-.8-1.8 2.8-1.9 16.7-.2 15.1-.2 15.7-1.4 22.9-1.1 5.9-19.2 61.8-21.1 64.6-.7 1.1-4 3.1-7.2 4.3-14.4 5.6-18.6 7.5-21.3 10.1-1.9 1.8-2.8 3.4-2.4 4.4.3.9 5.2 4.2 10.8 7.3 15.6 8.7 17.2 10.2 19.7 18.6 5.3 18.1 9.5 26.3 18.9 37.2 3.3 3.8 6 7.2 6 7.5-.1.3-4 5.5-8.8 11.7-12.8 16.4-17.5 26.8-15.8 35.5 2.9 15.5 33.8 17.4 61.6 3.8 3-1.5 8.6-4.4 12.3-6.5 8.2-4.5 10.7-4.5 26.7.9 15.8 5.2 42 13 55.5 16.5 12.7 3.3 48 11.6 53.3 12.6 1.8.3 7.6 1.4 12.9 2.4 5.4 1.1 11.8 2.2 14.3 2.6 2.5.3 5.2.8 6 1 .8.3 4.7.9 8.5 1.5 3.9.5 7.9 1.1 9 1.4 2.2.4 12.8 1.8 16 2.1 1.1.1 4.7.5 8 .9s8 .9 10.5 1.2c2.5.2 6.5.6 9 .8 26.9 3 67.6 3.5 94.5 1.1 5.6-.5 7.7-.8 18-1.9 33.3-3.9 71.6-15.5 96.4-29.3 29.7-16.4 55.6-43.4 71.2-74 5.5-11 10.6-25.6 11.4-33.3.2-1.4.6-5.1 1-8.3l.8-5.7-9.9.5c-15.4.8-22.7 1.6-30.4 3-8.1 1.5-18.5 3.9-28 6.5-18.5 4.9-45.6 11.8-48.6 12.4-25.6 4.6-31 5.4-49.9 7.1-33.9 3-91.7 2.2-110.2-1.6-5.7-1.1-7.1-2.8-2.5-3 1.5 0 6.3-.2 10.7-.4 4.4-.2 19.3-.6 33-1 13.8-.3 26.8-.7 29-.9 2.2-.2 8-.7 12.9-1.1 4.9-.4 9.7-.8 10.6-1 .9-.2 4.1-.6 7.1-1 25.9-3.2 56.5-10.2 86.5-19.9 27.8-8.9 29.5-9.4 42.4-12 11.9-2.4 28.3-2.8 42.9-1.1l6.4.7-.7-3.3c-5.5-26.1-11.7-40.2-24.9-56.6-8.1-10.2-23-25.1-33.7-33.6-7.6-6.1-24.8-17.9-40.6-27.7-3.6-2.2-6.3-4.8-7.5-7.2-2.9-5.6-4.6-6.1-18.1-5.5-6.5.4-12.2.8-12.6 1.1-.4.2-3.9.7-7.9 1-4 .4-7.8.8-8.5 1.1-.7.2-3.1.6-5.3.9-9.3 1.2-39 5.7-46.5 7.1-1.4.2-5 .7-8 1.1-3 .3-6.6.7-8 .9-12.7 1.8-124.9 2.7-145 1.2-4.1-.3-8.6-.6-10-.6-4.3-.2-.8-1.9 5-2.6 3-.3 7.3-.8 9.5-1 2.2-.2 8.1-.7 13-1 5-.4 11.5-.8 14.5-1 3-.2 10.2-.7 16-1 5.8-.3 12.6-.8 15.2-1 2.5-.2 9-.6 14.5-1 5.4-.3 11.4-.8 13.3-.9 2-.2 7.6-.7 12.5-1.1 4.9-.4 9.6-.8 10.4-1 .9-.1 4.3-.6 7.6-.9 8.5-1 11.9-1.5 21.5-3.3 4.7-.8 9.6-1.7 10.9-2 1.4-.2 2.8-.6 3.1-.8.4-.2 2.1-.7 3.9-1 3.5-.6 17.4-5.2 25.6-8.4l5-1.9-.3-15.4c-.2-8.4-.5-15.4-.7-15.6-.1-.2-4-1.2-8.6-2.3-4.6-1.1-9.1-2.2-9.9-2.4-28.8-7-45.7-10.2-53-9.9-6.2.1-11.3.9-32.1 4.9-.9.2-4 .6-6.9 1-2.9.4-6.2.9-7.4 1.1-12.1 2.3-54.6 2.2-66.8-.1-1.3-.3-4.5-.9-7.3-1.4-6-1.1-10.1-2.6-10.9-4-1.2-1.9-1.3-1.9 28.4-3.6 4.7-.3 11.9-.7 16-1 4.1-.3 11.8-.7 17-1 9.9-.6 17.6-1.2 24.5-2 2.2-.3 6-.7 8.5-.9 6.9-.8 14.4-2.4 18.1-3.9l3.3-1.3-4.8-3.6c-5.2-4-13-6.9-24.6-9.2-7-1.4-9.5-1.7-22.5-3.2-24.4-2.8-62.6-1.6-81.7 2.6-10.8 2.3-15.4 4.7-22.9 11.6-3.2 3-6.5 5.4-7.3 5.4-1 0-1.7-3-2.6-11.3-.7-6.1-1.4-12.3-1.5-13.7-.2-1.4-.6-6.1-.9-10.5-.4-4.4-.8-9.6-1.1-11.5-.2-1.9-.7-6.7-1-10.5-.8-10.5-2.1-24.4-3.1-32.5-2.1-18.3-2.6-19.4-9.6-21.4-7.1-2-10.5-2.3-15.8-1.5zm-82.2 305.3c6.5 4 7.5 42.2 1.5 54.3-2.7 5.4-4.5 6.1-8.1 3.2-6.2-5-6.6-6.7-6.8-26.2-.2-21.4.4-25.1 5.1-29.4 3.3-3.2 5.5-3.7 8.3-1.9zm75.2 3.1c7.6 3.9 12.1 14.6 12.5 29.5.6 19.9-4.7 34.4-13.7 37.9-2.1.8-3.5.5-7-1.2-8.2-4.2-12.1-13.8-12.2-30.7-.1-13.6 1.2-20.2 5.8-27.9 2.3-4.1 3.2-5 6.6-7.4 3-2.1 4.3-2.1 8-.2zm106.7 1.7c14 7 21.7 24.1 20.9 46.8-.3 8.1-1 12.3-3 18.4-4.9 14.4-11.3 20.8-22 22-10.9 1.3-20.2-7.4-25.9-24.4-7.9-23.4.8-54.6 17.5-62.9 5.4-2.6 7-2.6 12.5.1z"}));case"youtube":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},r.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),r.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"github":return r.createElement("svg",{className:t,viewBox:"0 0 98 96"},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z",stroke:"none"}));case"lookup-pending":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},r.createElement("title",null,"Lookup scheduled"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},r.createElement("title",null,"Searching…"),r.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},r.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},r.createElement("title",null,"Not found"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"apple-logo":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{fillRule:"nonzero",d:"M11.624 7.222c-.876 0-2.232-.996-3.66-.96-1.884.024-3.612 1.092-4.584 2.784-1.956 3.396-.504 8.412 1.404 11.172.936 1.344 2.04 2.856 3.504 2.808 1.404-.06 1.932-.912 3.636-.912 1.692 0 2.172.912 3.66.876 1.512-.024 2.472-1.368 3.396-2.724 1.068-1.56 1.512-3.072 1.536-3.156-.036-.012-2.94-1.128-2.976-4.488-.024-2.808 2.292-4.152 2.4-4.212-1.32-1.932-3.348-2.148-4.056-2.196-1.848-.144-3.396 1.008-4.26 1.008zm3.12-2.832c.78-.936 1.296-2.244 1.152-3.54-1.116.048-2.46.744-3.264 1.68-.72.828-1.344 2.16-1.176 3.432 1.236.096 2.508-.636 3.288-1.572z"}));case"error":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"11"}),r.createElement("circle",{cx:"12",cy:"12",r:"6",stroke:"none",fill:"white"}),r.createElement("path",{stroke:"none",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))}}function lt(){return r.createElement("h1",{className:"app-title"},r.createElement("span",{className:"app-name"},r.createElement(ot,{className:"app-icon",name:"ampcast"}),r.createElement("span",{className:"app-text"},"ampcast"))," ",r.createElement("span",{className:"app-version"},"0.9.5"))}var ct=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return te(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Le);function ut(e,t,n){var r=oe(e)||t||n?{next:e,error:t,complete:n}:e;return r?_e((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(Be(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):$e}function dt(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");const n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function mt(e){return Math.min(1,Math.max(0,e))}function ht(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function pt(e){return Number(e)<=1?100*Number(e)+"%":e}function ft(e){return 1===e.length?"0"+e:String(e)}function yt(e,t,n){e=dt(e,255),t=dt(t,255),n=dt(n,255);const r=Math.max(e,t,n),i=Math.min(e,t,n);let a=0,s=0;const o=(r+i)/2;if(r===i)s=0,a=0;else{const l=r-i;switch(s=o>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{h:a,s,l:o}}function vt(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function bt(e,t,n){e=dt(e,255),t=dt(t,255),n=dt(n,255);const r=Math.max(e,t,n),i=Math.min(e,t,n);let a=0;const s=r,o=r-i,l=0===r?0:o/r;if(r===i)a=0;else{switch(r){case e:a=(t-n)/o+(t<n?6:0);break;case t:a=(n-e)/o+2;break;case n:a=(e-t)/o+4}a/=6}return{h:a,s:l,v:s}}function gt(e,t,n,r){const i=[ft(Math.round(e).toString(16)),ft(Math.round(t).toString(16)),ft(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function wt(e){return Et(e)/255}function Et(e){return parseInt(e,16)}const kt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};const xt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",St="[\\s|\\(]+("+xt+")[,|\\s]+("+xt+")[,|\\s]+("+xt+")\\s*\\)?",Tt="[\\s|\\(]+("+xt+")[,|\\s]+("+xt+")[,|\\s]+("+xt+")[,|\\s]+("+xt+")\\s*\\)?",Pt={CSS_UNIT:new RegExp(xt),rgb:new RegExp("rgb"+St),rgba:new RegExp("rgba"+Tt),hsl:new RegExp("hsl"+St),hsla:new RegExp("hsla"+Tt),hsv:new RegExp("hsv"+St),hsva:new RegExp("hsva"+Tt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function At(e){return Boolean(Pt.CSS_UNIT.exec(String(e)))}class It{constructor(e="",t={}){if(e instanceof It)return e;"number"==typeof e&&(e=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(e)),this.originalInput=e;const n=function(e){let t={r:0,g:0,b:0},n=1,r=null,i=null,a=null,s=!1,o=!1;var l,c,u;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;let t=!1;if(kt[e])e=kt[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};let n=Pt.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=Pt.rgba.exec(e),n?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Pt.hsl.exec(e),n?{h:n[1],s:n[2],l:n[3]}:(n=Pt.hsla.exec(e),n?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Pt.hsv.exec(e),n?{h:n[1],s:n[2],v:n[3]}:(n=Pt.hsva.exec(e),n?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Pt.hex8.exec(e),n?{r:Et(n[1]),g:Et(n[2]),b:Et(n[3]),a:wt(n[4]),format:t?"name":"hex8"}:(n=Pt.hex6.exec(e),n?{r:Et(n[1]),g:Et(n[2]),b:Et(n[3]),format:t?"name":"hex"}:(n=Pt.hex4.exec(e),n?{r:Et(n[1]+n[1]),g:Et(n[2]+n[2]),b:Et(n[3]+n[3]),a:wt(n[4]+n[4]),format:t?"name":"hex8"}:(n=Pt.hex3.exec(e),!!n&&{r:Et(n[1]+n[1]),g:Et(n[2]+n[2]),b:Et(n[3]+n[3]),format:t?"name":"hex"})))))))))}(e)),"object"==typeof e&&(At(e.r)&&At(e.g)&&At(e.b)?(l=e.r,c=e.g,u=e.b,t={r:255*dt(l,255),g:255*dt(c,255),b:255*dt(u,255)},s=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):At(e.h)&&At(e.s)&&At(e.v)?(r=pt(e.s),i=pt(e.v),t=function(e,t,n){e=6*dt(e,360),t=dt(t,100),n=dt(n,100);const r=Math.floor(e),i=e-r,a=n*(1-t),s=n*(1-i*t),o=n*(1-(1-i)*t),l=r%6;return{r:255*[n,s,a,a,o,n][l],g:255*[o,n,n,s,a,a][l],b:255*[a,a,o,n,n,s][l]}}(e.h,r,i),s=!0,o="hsv"):At(e.h)&&At(e.s)&&At(e.l)&&(r=pt(e.s),a=pt(e.l),t=function(e,t,n){let r,i,a;if(e=dt(e,360),t=dt(t,100),n=dt(n,100),0===t)i=n,a=n,r=n;else{const s=n<.5?n*(1+t):n+t-n*t,o=2*n-s;r=vt(o,s,e+1/3),i=vt(o,s,e),a=vt(o,s,e-1/3)}return{r:255*r,g:255*i,b:255*a}}(e.h,r,a),s=!0,o="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=ht(n),{ok:s,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}(e);this.originalInput=e,this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a,this.roundA=Math.round(100*this.a)/100,this.format=t.format??n.format,this.gradientType=t.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=n.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3}getLuminance(){const e=this.toRgb();let t,n,r;const i=e.r/255,a=e.g/255,s=e.b/255;return t=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),n=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),r=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),.2126*t+.7152*n+.0722*r}getAlpha(){return this.a}setAlpha(e){return this.a=ht(e),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:e}=this.toHsl();return 0===e}toHsv(){const e=bt(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}}toHsvString(){const e=bt(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1===this.a?`hsv(${t}, ${n}%, ${r}%)`:`hsva(${t}, ${n}%, ${r}%, ${this.roundA})`}toHsl(){const e=yt(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}}toHslString(){const e=yt(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1===this.a?`hsl(${t}, ${n}%, ${r}%)`:`hsla(${t}, ${n}%, ${r}%, ${this.roundA})`}toHex(e=!1){return gt(this.r,this.g,this.b,e)}toHexString(e=!1){return"#"+this.toHex(e)}toHex8(e=!1){return function(e,t,n,r,i){const a=[ft(Math.round(e).toString(16)),ft(Math.round(t).toString(16)),ft(Math.round(n).toString(16)),ft((s=r,Math.round(255*parseFloat(s)).toString(16)))];var s;return i&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))&&a[3].startsWith(a[3].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}(this.r,this.g,this.b,this.a,e)}toHex8String(e=!1){return"#"+this.toHex8(e)}toHexShortString(e=!1){return 1===this.a?this.toHexString(e):this.toHex8String(e)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?`rgb(${e}, ${t}, ${n})`:`rgba(${e}, ${t}, ${n}, ${this.roundA})`}toPercentageRgb(){const e=e=>`${Math.round(100*dt(e,255))}%`;return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}}toPercentageRgbString(){const e=e=>Math.round(100*dt(e,255));return 1===this.a?`rgb(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%)`:`rgba(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%, ${this.roundA})`}toName(){if(0===this.a)return"transparent";if(this.a<1)return!1;const e="#"+gt(this.r,this.g,this.b,!1);for(const[t,n]of Object.entries(kt))if(e===n)return t;return!1}toString(e){const t=Boolean(e);e=e??this.format;let n=!1;const r=this.a<1&&this.a>=0;return t||!r||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new It(this.toString())}lighten(e=10){const t=this.toHsl();return t.l+=e/100,t.l=mt(t.l),new It(t)}brighten(e=10){const t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(-e/100*255))),t.g=Math.max(0,Math.min(255,t.g-Math.round(-e/100*255))),t.b=Math.max(0,Math.min(255,t.b-Math.round(-e/100*255))),new It(t)}darken(e=10){const t=this.toHsl();return t.l-=e/100,t.l=mt(t.l),new It(t)}tint(e=10){return this.mix("white",e)}shade(e=10){return this.mix("black",e)}desaturate(e=10){const t=this.toHsl();return t.s-=e/100,t.s=mt(t.s),new It(t)}saturate(e=10){const t=this.toHsl();return t.s+=e/100,t.s=mt(t.s),new It(t)}greyscale(){return this.desaturate(100)}spin(e){const t=this.toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,new It(t)}mix(e,t=50){const n=this.toRgb(),r=new It(e).toRgb(),i=t/100,a={r:(r.r-n.r)*i+n.r,g:(r.g-n.g)*i+n.g,b:(r.b-n.b)*i+n.b,a:(r.a-n.a)*i+n.a};return new It(a)}analogous(e=6,t=30){const n=this.toHsl(),r=360/t,i=[this];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,i.push(new It(n));return i}complement(){const e=this.toHsl();return e.h=(e.h+180)%360,new It(e)}monochromatic(e=6){const t=this.toHsv(),{h:n}=t,{s:r}=t;let{v:i}=t;const a=[],s=1/e;for(;e--;)a.push(new It({h:n,s:r,v:i})),i=(i+s)%1;return a}splitcomplement(){const e=this.toHsl(),{h:t}=e;return[this,new It({h:(t+72)%360,s:e.s,l:e.l}),new It({h:(t+216)%360,s:e.s,l:e.l})]}onBackground(e){const t=this.toRgb(),n=new It(e).toRgb(),r=t.a+n.a*(1-t.a);return new It({r:(t.r*t.a+n.r*n.a*(1-t.a))/r,g:(t.g*t.a+n.g*n.a*(1-t.a))/r,b:(t.b*t.a+n.b*n.a*(1-t.a))/r,a:r})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(e){const t=this.toHsl(),{h:n}=t,r=[this],i=360/e;for(let a=1;a<e;a++)r.push(new It({h:(n+a*i)%360,s:t.s,l:t.l}));return r}equals(e){return this.toRgbString()===new It(e).toRgbString()}}const Ct=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),Mt=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),Ot=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),$t=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),Nt=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),zt=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),jt=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),Lt=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),Dt=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),Rt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),Ft=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),_t=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),Bt=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),Vt=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),Ut={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},Ht=Object.assign(Object.assign({},Ut),Ot),qt=[Ht,Ct,Mt,Nt,zt,jt,Lt,Dt,Rt,Ft,_t,Bt,Vt,$t];var Yt=n(6872),Kt=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Wt=new K("themeStore");class Gt extends Yt.cp{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(qt.map((e=>[e.name,e]))),this.themes$=new ct([]),this.version(1).stores({themes:"&name"}),(0,Yt.k7)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return Kt(this,void 0,void 0,(function*(){try{Wt.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){Wt.error(e)}}))}remove(e){return Kt(this,void 0,void 0,(function*(){try{Wt.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){Wt.error(e)}}))}rename(e,t){return Kt(this,void 0,void 0,(function*(){try{const n=yield this.themes.get(e);if(!n)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},n),{name:t,userTheme:!0}))}catch(e){Wt.error(e)}}))}}const Jt=new Gt,Qt=new K("theme"),Xt=R.isElectron,Zt=window.ampcastElectron,en=new class{constructor(){this.defaultFontSize=17.2,this.storage=new Z("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new ct(Ht),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe(ut((()=>this.applyAppStyles()))).subscribe(Qt)}observe(){return this.theme$.pipe(Ue((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new It(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new It(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new It(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new It(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new It(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?Jt.getUserTheme(this.name):Jt.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new It(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new It(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley(),Xt&&(null==Zt||Zt.setFontSize(e))}get frameColor(){return this.current.frameColor}set frameColor(e){if(this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor,Xt)null==Zt||Zt.setFrameColor(e);else{let t=document.head.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.setAttribute("name","theme-color"),document.head.append(t)),t.setAttribute("content",e)}}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor,Xt&&(null==Zt||Zt.setFrameTextColor(e))}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new It(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new It(this.backgroundColor).isDark()}get isLight(){return new It(this.backgroundColor).isLight()}get isButtonDark(){return new It(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new It(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new It(this.frameColor).isDark()}get isFrameLight(){return new It(this.frameColor).isLight()}get isFrameTextDark(){return new It(this.frameTextColor).isDark()}get isFrameTextLight(){return new It(this.frameTextColor).isLight()}get isMediaButtonLight(){return new It(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new It(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new It(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new It(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new It(this.selectedBackgroundColor).isLight()}get isTextDark(){return new It(this.textColor).isDark()}get isTextLight(){return new It(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new It(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){this.applyingUpdate=!0;const t=Object.assign(Object.assign(Object.assign({},Ut),{userTheme:void 0}),e);this.frameColor=t.frameColor,this.frameTextColor=t.frameTextColor,Object.assign(this,t),this.applyingUpdate=!1,this.theme$.next(this.current),Xt&&(null==Zt||Zt.setTheme(this.current))}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",Ht);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},n={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((n=>n in e&&typeof e[n]===t[n]))&&Object.keys(e).every((r=>r in t||typeof e[r]===n[r]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,n){const r=this.toDashName(e);let i=t||n;if(i){"string"==typeof i&&(i=new It(i));const n=i.toHsl();this.setProperty(`${r}-h`,String(n.h)),this.setProperty(`${r}-s`,100*n.s+"%"),this.setProperty(`${r}-l`,100*n.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${r}-h`,null),this.setProperty(`${r}-s`,null),this.setProperty(`${r}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new It(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),n=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",n),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,n){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${n}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:n}){return t=Math.min(Math.max(t,0),1),n=Math.min(Math.max(n,0),1),new It({h:e,s:t,l:n}).toHexString()}};function tn(e,t,n="content-box"){const i=(0,r.useRef)(t);(0,r.useEffect)((()=>{i.current=t}),[t]),(0,r.useEffect)((()=>{const t=e.current;if(t){const r=new ResizeObserver((t=>{const r=e.current;if(r){const e=t.find((e=>e.target===r));if(e){const[{inlineSize:t=0,blockSize:r=0}={}]="border-box"===n?e.borderBoxSize:e.contentBoxSize;i.current({width:t,height:r})}}}));return r.observe(t,{box:n}),()=>r.disconnect()}}),[e,n])}const nn=document.createElement("div");function rn(){const e=(0,r.useRef)(nn),[t,n]=(0,r.useState)(0);return(0,r.useEffect)((()=>{nn.parentElement||(document.body.append(nn),n(an()))}),[]),tn(e,(()=>n(an()))),t}function an(){return parseFloat(getComputedStyle(nn).fontSize)||en.defaultFontSize}function sn({vertical:e,primary:t,size:n,children:i}){const a={};return t||(e?a.height=`${n}px`:a.width=`${n}px`),r.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}nn.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n    z-index: -1;\n";const on=new Z("layout"),ln={get:(e,t=0)=>on.getNumber(e,t),set(e,t){on.setNumber(e,t)}};function cn(e,t){switch(t.type){case"setContainerSize":{const n=Math.max(t.containerSize,0);if(n!==e.containerSize){const{primaryMinSize:t,secondaryMinSize:r,secondaryPaneSize:i,splitterSize:a}=e;return Object.assign(Object.assign({},e),{containerSize:n,secondaryPaneSize:un(t,r,i,a,n)})}return e}case"setSecondaryPaneSize":{const{primaryMinSize:n,secondaryMinSize:r,splitterSize:i,containerSize:a}=e,s=un(n,r,Math.max(t.secondaryPaneSize,0),i,a);return s!==e.secondaryPaneSize?Object.assign(Object.assign({},e),{secondaryPaneSize:s}):e}case"setMinSizes":{const n=Math.max(t.primaryMinSize,0),r=Math.max(t.secondaryMinSize,0),i=Math.max(t.splitterSize,0);return n!==e.primaryMinSize||r!==e.secondaryMinSize||i!==e.splitterSize?Object.assign(Object.assign({},e),{primaryMinSize:n,secondaryMinSize:r,splitterSize:i,secondaryPaneSize:un(n,r,e.secondaryPaneSize,i,e.containerSize)}):e}default:return e}}function un(e,t,n,r,i){if(i>0){const a=i-r-n;if(a<e)return Math.max(n-(e-a),0);if(n<t)return Math.min(i-r-e,t)}return n}const dn={primaryMinSize:0,secondaryMinSize:0,secondaryPaneSize:0,splitterSize:0,containerSize:0};function mn({id:e,arrange:t="columns",primaryIndex:n=0,children:i}){const a=(0,r.useRef)(null),{secondaryPaneSize:s,setContainerSize:o,setSecondaryPaneSize:l,setMinSizes:c}=function(e){const t=(0,r.useMemo)((()=>Object.assign(Object.assign({},dn),{secondaryPaneSize:e?ln.get(e):0})),[e]),[{secondaryPaneSize:n},i]=(0,r.useReducer)(cn,t);(0,r.useEffect)((()=>{e&&n&&ln.set(e,n)}),[e,n]);const a=(0,r.useCallback)((e=>i({type:"setContainerSize",containerSize:e})),[]),s=(0,r.useCallback)((e=>i({type:"setSecondaryPaneSize",secondaryPaneSize:e})),[]),o=(0,r.useCallback)(((e,t,n)=>i({type:"setMinSizes",primaryMinSize:e,secondaryMinSize:t,splitterSize:n})),[]);return{secondaryPaneSize:n,setContainerSize:a,setSecondaryPaneSize:s,setMinSizes:o}}(e),[u,d]=(0,r.useState)(-1),[m,h]=(0,r.useState)(0),p=-1!==u,f=rn(),y="rows"===t;(0,r.useEffect)((()=>{var e;if(f>0){let t=0,n=0,r=0;const i=a.current,s=y?"minHeight":"minWidth",o=i.querySelector(":scope > .layout-pane-primary");o&&(t=parseInt(getComputedStyle(o)[s],10)||0);const l=i.querySelector(":scope > .layout-pane-secondary");if(l){l.style[s]="",n=parseInt(getComputedStyle(l)[s],10)||0,l.style[s]="unset";const t=y?"offsetHeight":"offsetWidth",a=i.querySelector(":scope > .layout-splitter");r=null!==(e=null==a?void 0:a[t])&&void 0!==e?e:4}c(t,n,r)}}),[y,f,c]);const v=(0,r.useCallback)((e=>{if(0===e.button){const t=y?e.screenY:e.screenX;d(t),h(s),e.preventDefault()}}),[y,s]),b=(0,r.useCallback)((e=>{const t=(y?e.screenY:e.screenX)-u;l(0===n?m-t:m+t)}),[y,n,u,m,l]),g=(0,r.useCallback)((()=>{d(-1),h(0)}),[]);return(0,r.useEffect)((()=>{if(p)return document.documentElement.style.cursor=y?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",g),document.addEventListener("mousemove",b),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",g),document.removeEventListener("mousemove",b)}}),[y,p,b,g]),tn(a,(({width:e,height:t})=>{o(y?t:e)})),r.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},r.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===n,a=i?0:s,o=[];return 1===t&&o.push(r.createElement("div",{className:"layout-splitter "+(p?"active":""),role:"separator",onMouseDown:v,key:"splitter"})),o.push(r.createElement(sn,{vertical:y,primary:i,size:a,key:t},e)),o})))}var hn=n(4472);const pn={left:0,top:0},fn=(0,r.forwardRef)((function(e,t){var{title:n,className:i="",children:a,onClose:s}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["title","className","children","onClose"]);const l=(0,r.useRef)(null),[c,u]=(0,r.useState)(pn),[d,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(pn);(0,r.useImperativeHandle)(t,(()=>({close:e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.open)&&l.current.close(e)}}))),(0,r.useEffect)((()=>{const e=l.current;hn.c.registerDialog(e),e.showModal()}),[]);const f=(0,r.useCallback)((()=>{l.current.close()}),[]),y=(0,r.useCallback)((()=>{s(l.current.returnValue)}),[s]),v=(0,r.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l.current.close())}),[]),b=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),g=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),E=(0,r.useCallback)((e=>{p({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),k=(0,r.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),p(pn),m(null)}),[c,d]);return(0,r.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",k),document.addEventListener("mousemove",E),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",E)}}),[d,E,k]),r.createElement("dialog",Object.assign({},o,{className:`dialog ${i}`,onClose:y,onKeyDown:v,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),r.createElement("header",{className:"dialog-head",onMouseDown:g},r.createElement("h2",null,n),r.createElement("div",{className:"dialog-close",role:"button",onClick:f,onMouseDown:w,"aria-label":"Close"},r.createElement(ot,{name:"close"}))),r.createElement("div",{className:"dialog-body",onClick:b},a))}));var yn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function vn(e,t=!1){return yn(this,void 0,void 0,(function*(){return new Promise(((n,a)=>{const s=document.createElement("div"),o=(0,i.C)(s);try{const i=e=>{o.unmount(),s.remove(),n(e)};document.getElementById(document.fullscreenElement?"fullscreen-popup":t?"system":"popup").append(s),o.render(r.createElement(e,{onClose:i}))}catch(e){o.unmount(),s.remove(),a(e)}}))}))}var bn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},gn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function wn({title:e,message:t,system:n=!1}){return bn(this,void 0,void 0,(function*(){"string"==typeof t&&(t=r.createElement("p",null,t)),yield vn((n=>r.createElement(En,Object.assign({},n,{title:e,message:t}))),n)}))}function En(e){var{message:t,title:n="Message"}=e,i=gn(e,["message","title"]);return r.createElement(fn,Object.assign({},i,{className:"alert-dialog",title:n}),r.createElement("form",{method:"dialog"},r.createElement("div",{className:"alert-message"},t),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"OK"))))}function kn({value:e="",disabled:t,submitText:n="Confirm",onCancel:i,onSubmit:a}){return r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{className:"dialog-button-cancel",type:"button",value:"#cancel",onClick:i},"Cancel"),r.createElement("button",{className:"dialog-button-submit",value:e,disabled:t,onClick:a},n))}var xn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Sn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Tn=new Z("confirm");function Pn({title:e,message:t,okLabel:n,storageId:i,system:a=!1}){return xn(this,void 0,void 0,(function*(){return!(!i||!Tn.getBoolean(i))||("string"==typeof t&&(t=r.createElement("p",null,t)),"confirmed"===(yield vn((a=>r.createElement(An,Object.assign({},a,{title:e,message:t,okLabel:n,storageId:i}))),a)))}))}function An(e){var{title:t="Confirm",message:n,okLabel:i="OK",storageId:a}=e,s=Sn(e,["title","message","okLabel","storageId"]);const o=(0,r.useId)(),l=(0,r.useRef)(null),c=(0,r.useCallback)((()=>{a&&l.current.checked&&Tn.setBoolean(a,!0)}),[a]);return r.createElement(fn,Object.assign({},s,{className:"confirm-dialog",title:t}),r.createElement("form",{method:"dialog",onSubmit:c},r.createElement("div",{className:"confirm-message"},n),r.createElement(kn,{value:"confirmed",submitText:i}),a?r.createElement("footer",{className:"confirm-dialog-storage"},r.createElement("input",{id:o,type:"checkbox",ref:l}),r.createElement("label",{htmlFor:o},"Don't show this message again.")):null))}function In({icon:e,text:t,className:n="",showConnectivity:i}){return r.createElement("span",{className:`media-source-label ${n}`},r.createElement(ot,{name:e,className:i?"show-connectivity":""}),r.createElement("span",{className:"text"},t))}var Cn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Mn(e,t){return Cn(this,void 0,void 0,(function*(){yield wn({title:r.createElement(In,{icon:"error",text:"Error"}),message:e,system:t})}))}var On=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},$n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Nn(e){var{system:t=!1}=e,n=$n(e,["system"]);return On(this,void 0,void 0,(function*(){return vn((e=>r.createElement(zn,Object.assign({},e,n))),t)}))}function zn(e){var{title:t="Input",type:n="text",placeholder:i="",label:a,suggestedValue:s="",okLabel:o="OK"}=e,l=$n(e,["title","type","placeholder","label","suggestedValue","okLabel"]);const c=(0,r.useId)(),[u,d]=(0,r.useState)(s),m=(0,r.useCallback)((e=>{d(e.target.value)}),[]);return r.createElement(fn,Object.assign({},l,{className:"prompt-dialog",title:t}),r.createElement("form",{method:"dialog"},r.createElement("p",null,a?r.createElement("label",{htmlFor:c},a,": "):null,r.createElement("input",{type:n,id:c,defaultValue:s,placeholder:i,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:m})),r.createElement(kn,{value:u,submitText:o})))}var jn=function(e){function t(t,n){return e.call(this)||this}return te(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(de),Ln={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Ln.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,ae([e,t],ie(n))):setInterval.apply(void 0,ae([e,t],ie(n)))},clearInterval:function(e){var t=Ln.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Dn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return te(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Ln.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Ln.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ue(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(jn),Rn={now:function(){return(Rn.delegate||Date).now()},delegate:void 0},Fn=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Rn.now,e}(),_n=function(e){function t(t,n){void 0===n&&(n=Fn.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return te(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Fn),Bn=new _n(Dn),Vn=Bn;function Un(e){return e&&oe(e.schedule)}function Hn(e,t,n){void 0===e&&(e=0),void 0===n&&(n=Vn);var r=-1;return null!=t&&(Un(t)?n=t:r=t),new Ne((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function qn(e,t){return void 0===e&&(e=0),void 0===t&&(t=Bn),e<0&&(e=0),Hn(e,e,t)}function Yn({children:e}){return r.createElement(r.Fragment,null,e)}var Kn=Array.isArray;function Wn(e){return He((function(t){return function(e,t){return Kn(t)?e.apply(void 0,ae([],ie(t))):e(t)}(e,t)}))}var Gn=["addListener","removeListener"],Jn=["addEventListener","removeEventListener"],Qn=["on","off"];function Xn(e,t,n,r){if(oe(n)&&(r=n,n=void 0),r)return Xn(e,t,n).pipe(Wn(r));var i=ie(function(e){return oe(e.addEventListener)&&oe(e.removeEventListener)}(e)?Jn.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return oe(e.addListener)&&oe(e.removeListener)}(e)?Gn.map(Zn(e,t)):function(e){return oe(e.on)&&oe(e.off)}(e)?Qn.map(Zn(e,t)):[],2),a=i[0],s=i[1];if(!a&&qe(e))return rt((function(e){return Xn(e,t,n)}))(et(e));if(!a)throw new TypeError("Invalid event target");return new Ne((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return a(t),function(){return s(t)}}))}function Zn(e,t){return function(n){return function(r){return e[n](t,r)}}}function er(e){return void 0===e&&(e=1/0),rt($e,e)}function tr(e){return e[e.length-1]}function nr(e){return oe(tr(e))?e.pop():void 0}function rr(e){return Un(tr(e))?e.pop():void 0}function ir(e,t){return void 0===t&&(t=0),_e((function(n,r){n.subscribe(Be(r,(function(n){return nt(r,e,(function(){return r.next(n)}),t)}),(function(){return nt(r,e,(function(){return r.complete()}),t)}),(function(n){return nt(r,e,(function(){return r.error(n)}),t)})))}))}function ar(e,t){return void 0===t&&(t=0),_e((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function sr(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ne((function(n){nt(n,t,(function(){var r=e[Symbol.asyncIterator]();nt(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function or(e,t){return t?function(e,t){if(null!=e){if(Ke(e))return function(e,t){return et(e).pipe(ar(t),ir(t))}(e,t);if(qe(e))return function(e,t){return new Ne((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(Ye(e))return function(e,t){return et(e).pipe(ar(t),ir(t))}(e,t);if(We(e))return sr(e,t);if(Qe(e))return function(e,t){return new Ne((function(n){var r;return nt(n,t,(function(){r=e[Je](),nt(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return oe(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Ze(e))return function(e,t){return sr(Xe(e),t)}(e,t)}throw Ge(e)}(e,t):et(e)}function lr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return er(1)(or(e,rr(e)))}function cr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rr(e);return _e((function(t,r){(n?lr(e,t,n):lr(e,t)).subscribe(r)}))}var ur=new Ne((function(e){return e.complete()}));function dr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rr(e),r=function(e,t){return"number"==typeof tr(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?et(i[0]):er(r)(or(i,n)):ur}function mr(e,t){return _e((function(n,r){var i=null,a=0,s=!1,o=function(){return s&&!i&&r.complete()};n.subscribe(Be(r,(function(n){null==i||i.unsubscribe();var s=0,l=a++;et(e(n,l)).subscribe(i=Be(r,(function(e){return r.next(t?t(n,e,l,s++):e)}),(function(){i=null,o()})))}),(function(){s=!0,o()})))}))}function hr(e){return _e((function(t,n){et(e).subscribe(Be(n,(function(){return n.complete()}),be)),!n.closed&&t.subscribe(n)}))}function pr(e,t){switch(t.type){case"resize":{const n=Math.max(t.clientSize,0),r=Math.max(t.scrollSize,n);if(n!==e.clientSize||r!==e.scrollSize){const t=r-n,i=fr(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:n,scrollSize:r})}return e}case"scrollBy":{const n=fr(e.position+t.amount,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}case"scrollTo":{const n=fr(t.position,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}default:return e}}function fr(e,t){return Math.min(Math.max(e,0),t)}const yr={position:0,max:0,clientSize:0,scrollSize:0};const vr=(0,r.memo)((function(e){var{scrollableId:t,orientation:n,scrollAmount:i,onChange:a,onResize:s,scrollbarRef:o}=e,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,r.useRef)(null),u=(0,r.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:p,resize:f,scrollBy:y,scrollTo:v}=function(){const[{position:e,max:t,clientSize:n,scrollSize:i},a]=(0,r.useReducer)(pr,yr),s=(0,r.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),o=(0,r.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:n,scrollSize:i,scrollTo:o,scrollBy:(0,r.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:s}}(),[b,g]=(0,r.useState)(0),[w,k]=(0,r.useState)(0),[x,S]=(0,r.useState)(0),[T,P]=(0,r.useState)(-1),[A,I]=(0,r.useState)(0),C=-1!==T,M="vertical"===n,O=Math.ceil(d/m*(w-x));(0,r.useEffect)((()=>{o.current={scrollBy:y,scrollTo:v}}),[o,y,v]),(0,r.useEffect)((()=>f(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,f]),(0,r.useEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,r.useEffect)((()=>null==s?void 0:s(b)),[b,s]),tn(c,(({width:e,height:t})=>{k(M?t:e),g(M?e:t)}),"border-box"),tn(u,(({width:e,height:t})=>{S(M?t:e)}),"border-box");const $=(0,r.useCallback)(((e,t)=>{const n=()=>o.current.scrollBy(t),r=t=>t.target===e,i=Xn(document,"mouseup"),a=dr(Xn(e,"mouseover").pipe(He(r),cr(!0)),Xn(e,"mouseout").pipe(Ue(r),He((()=>!1)))).pipe(mr(((e,t)=>e?Hn(0===t?400:0,40):ur)),hr(i)).subscribe(n);return n(),()=>a.unsubscribe()}),[o]),N=(0,r.useCallback)((e=>{if(0===e.button)return $(e.target,-i)}),[i,$]),z=(0,r.useCallback)((e=>{if(0===e.button)return $(e.target,i)}),[i,$]),j=(0,r.useCallback)((e=>{if(0===e.button){const t=M?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return $(e.target,t<O?-h:h)}}),[M,h,O,$]),L=(0,r.useCallback)((e=>{e.stopPropagation(),0===e.button&&(P(M?e.screenY:e.screenX),I(O))}),[M,O]),D=(0,r.useCallback)((e=>{const t=M?e.screenY:e.screenX;v((A+(t-T))*m/(w-x))}),[M,T,A,m,x,w,v]),R=(0,r.useCallback)((()=>{P(-1),I(0)}),[]);return(0,r.useEffect)((()=>{if(C)return document.body.classList.add("dragging"),document.addEventListener("mouseup",R),document.addEventListener("mousemove",D),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",R),document.removeEventListener("mousemove",D)}}),[C,D,R]),r.createElement("div",{className:`scrollbar scrollbar-${n}`,role:"scrollbar","aria-controls":t,"aria-orientation":n,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:E,onMouseDown:E},r.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:N},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:M?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),r.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},r.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[M?"height":"width"]:w*(p?h/p:0)+"px",transform:`translate${M?"Y":"X"}(${O}px)`},ref:u})),r.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:M?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function br({children:e,scrollWidth:t=0,scrollHeight:n=0,scrollAmount:i=10,droppable:a,onResize:s,onScroll:o,scrollableRef:l}){const c=(0,r.useId)(),u=(0,r.useRef)(null),d=(0,r.useRef)(null),h=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(0,r.useRef)(null),y=(0,r.useRef)(null),[v,b]=(0,r.useState)(0),[g,w]=(0,r.useState)(0),[E,k]=(0,r.useState)(0),[x,S]=(0,r.useState)(0),[T,P]=(0,r.useState)(0),[A,I]=(0,r.useState)(t),[C,M]=(0,r.useState)(n),[O,$]=(0,r.useState)(0),[N,z]=(0,r.useState)(0),[j,L]=(0,r.useState)(!1),[D,R]=(0,r.useState)(!1),[F,_]=(0,r.useState)(0),B=Math.max(O-(D?g:0),0),V=Math.max(N-(j?v:0),0),[U,H]=(0,r.useState)(!0);(0,r.useEffect)((()=>{if(j||D){const e=setTimeout((()=>H(!1)),50);return()=>clearTimeout(e)}}),[j,D]),(0,r.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&f.current.scrollTo(e),void 0!==t&&y.current.scrollTo(t)}})}),[l]),(0,r.useEffect)((()=>{L(!(!A||!B)&&A-B>1)}),[A,B]),(0,r.useEffect)((()=>{R(!(!C||!V)&&C-V>1)}),[C,V]),(0,r.useEffect)((()=>{var e;I(0===t?(null===(e=d.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,r.useEffect)((()=>{var e;M(0===n?(null===(e=d.current)||void 0===e?void 0:e.scrollHeight)||0:n)}),[n]);const q=(0,r.useCallback)((()=>{const e=u.current;$(e.clientWidth),z(e.clientHeight),k(e.getBoundingClientRect().top)}),[]),Y=(0,r.useCallback)((()=>{var e;const r=d.current,i=p.current;0===t&&I(r.scrollWidth),0===n&&M(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:o}=r,{scrollWidth:l,scrollHeight:c}=i;null==s||s({clientWidth:a,clientHeight:o,scrollWidth:l,scrollHeight:c})}),[t,n,s]);tn(u,q),tn(d,Y),tn(p,Y),(0,r.useEffect)((()=>{null==o||o({left:x,top:T})}),[x,T,o]);const K=(0,r.useCallback)((e=>{y.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),W=(0,r.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>N?_(i):t<i&&_(-i)}),[E,N,i]);(0,r.useEffect)((()=>{if(F){const e=()=>y.current.scrollBy(F),t=qn(100).subscribe(e);return()=>t.unsubscribe()}}),[F]);const G=(0,r.useCallback)((()=>_(0)),[]),[J,Q]=m(r.Children.toArray(e),(e=>(null==e?void 0:e.type)===Yn));return r.createElement("div",{className:`scrollable ${j?"overflow-x":""} ${D?"overflow-y":""} ${U?"scrollbars-hidden":""}`,id:c,onWheel:K,ref:u},r.createElement("div",{className:"scrollable-content",onDragOver:a?W:void 0,onDragLeave:a?G:void 0,onDragEnd:a?G:void 0,onDrop:a?G:void 0,style:{right:D?`${g}px`:"0",bottom:j?`${v}px`:"0",transform:`translateX(-${x}px)`},ref:d},(null==J?void 0:J.length)?r.createElement("div",{className:"scrollable-head",ref:h},J):null,r.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},r.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${T}px)`},ref:p},Q))),r.createElement(vr,{scrollableId:c,orientation:"horizontal",clientSize:B,scrollSize:A,scrollAmount:i,onChange:S,onResize:b,scrollbarRef:f}),r.createElement(vr,{scrollableId:c,orientation:"vertical",clientSize:V,scrollSize:C,scrollAmount:i,onChange:P,onResize:w,scrollbarRef:y}))}function gr(e){return _e((function(t,n){var r=!1,i=null,a=null,s=function(){if(null==a||a.unsubscribe(),a=null,r){r=!1;var e=i;i=null,n.next(e)}};t.subscribe(Be(n,(function(t){null==a||a.unsubscribe(),r=!0,i=t,a=Be(n,s,be),et(e(t)).subscribe(a)}),(function(){s(),n.complete()}),void 0,(function(){i=a=null})))}))}function wr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return or(e,rr(e))}function Er(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const n=t=>!e||e.includes(t.code),r=(e,t)=>Xn(document,e,{capture:!0}).pipe(Ue(n),He((()=>t))),a=dr(r("keydown",!0),r("keyup",!1)).pipe(gr((e=>e?wr(0):Hn(t)))).subscribe(i);return()=>a.unsubscribe()}),[e,t]),n}function kr(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e}),[e]),t.current}function xr(e){return{storeExpandedState:(0,r.useCallback)(((t,n)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!n))}),[e]),retrieveExpandedState:(0,r.useCallback)(((t,n=!1)=>{if(e){const r=localStorage.getItem(`${e}/${t}`);return"string"==typeof r?"true"===r:n}return n}),[e]),storeSelectedNodeId:(0,r.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,r.useCallback)((()=>e&&localStorage.getItem(`${e}/selectedId`)||""),[e])}}function Sr(e,t){return e.reduce(((e,n)=>(t(n.id,n.startExpanded)&&e.push(n.id),n.children?e.concat(Sr(n.children,t)):e)),[])}function Tr(e,t){return(0,r.useMemo)((()=>Pr(e,t)),[e,t])}function Pr(e,t){return e.reduce(((e,n)=>(e.push(n.id),n.children&&t.includes(n.id)?e.concat(Pr(n.children,t)):e)),[])}var Ar=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Ir({id:e,label:t,children:n=[],selectedId:i,expandedIds:a,level:s,rowHeight:o,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),p=0!==n.length,f=e===i,y=`${p?"expandable":""} ${h?"expanded":""} ${f?"selected":""} ${0===n.length?"empty":""}`,v=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),b=(0,r.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),g=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&Nr(n,i)&&(null==d||d(e))}),[e,i,h,n,d,m]);return r.createElement("li",{className:`tree-view-node ${y}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":f?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":s,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:b},r.createElement("span",{className:"tree-view-row "+(f?"selected-text":""),onDoubleClick:p?g:void 0,style:{height:`${o}px`}},p?r.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:v,onClick:w},h?r.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):r.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&r.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:v},r.createElement("circle",{cx:"12",cy:"12",r:"4"})),r.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&r.createElement("ul",{className:"tree-view-node-children",role:"group"},n.map(((e,t)=>{var{id:l}=e,c=Ar(e,["id"]);return r.createElement(Ir,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:s+1,rowHeight:o,nodeIndex:t,setSize:n.length,onSelect:d,onToggle:m,key:l}))}))))}var Cr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Mr=24,Or=["ArrowUp","ArrowDown"];function $r({roots:e,className:t="",storageId:n,onContextMenu:i,onDelete:a,onEnter:s,onInfo:o,onSelect:l,treeViewRef:c}){const u=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,r.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:p}=xr(n),[f,y]=(0,r.useState)(""),{expandedIds:v,toggle:b}=function(e,t){const{storeExpandedState:n,retrieveExpandedState:i}=xr(t),[a,s]=(0,r.useState)((()=>Sr(e,i)));(0,r.useEffect)((()=>{s(Sr(e,i))}),[e,i]);const o=(0,r.useCallback)(((e,t)=>{const r=a.includes(e);r!==t&&(s(r?a.filter((t=>t!==e)):a.concat(e)),n(e,!r))}),[a,n]);return{expandedIds:a,toggle:o}}(e,n),g=Tr(e,v),w=g.indexOf(f),E=kr(w)||0,k=g[E-1],[x,S]=(0,r.useState)(0),[T,P]=(0,r.useState)(Mr),[A,I]=(0,r.useState)(0),C=Math.floor(x/T)-1,M=g.length,O=zr(e,f),$=Er(Or),N=-1===w,z=$&&!(0===w||w===M-1),[j,L]=(0,r.useState)((()=>O)),D=(0,r.useCallback)((()=>u.current.focus()),[]);(0,r.useEffect)((()=>{c&&(c.current={focus:D})}),[c,D]),(0,r.useEffect)((()=>{var t;if(N){const n=jr(e,k);y(n||(null===(t=e[0])||void 0===t?void 0:t.id)||"")}}),[e,N,k]),(0,r.useEffect)((()=>{if(!f&&e.length>0){const t=p();Nr(e,t)?y(t):y(e[0].id)}}),[e,f,p]),(0,r.useEffect)((()=>{null==l||l(j)}),[j,l]),(0,r.useEffect)((()=>{f&&h(f)}),[f,h]),(0,r.useEffect)((()=>{z||L(O)}),[O,z]);const F=(0,r.useCallback)((e=>{e.preventDefault(),null==i||i(O,e.pageX,e.pageY)}),[O,i]),_=(0,r.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==s||s(O);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(O);break;case"KeyI":e.stopPropagation(),!e[R.ctrlKey]||e.shiftKey||e.repeat||null==o||o(O);break;case"ArrowLeft":e.stopPropagation(),e.repeat||b(f,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||b(f,!0);break;default:{const t=function(e,t,n){switch(e){case"ArrowUp":return t[t.indexOf(n)-1]||n;case"ArrowDown":return t[t.indexOf(n)+1]||n;case"Home":return t[0]||n;case"End":return t[t.length-1]||n;default:return""}}(e.key,g,f);if(t&&(e.preventDefault(),t!==f)){e.stopPropagation();const n=d.current,r=Math.floor(A/T),i=g.indexOf(t);if(i>=r+C-1){const e=M*T,t=M-C-1,r=Math.min(M-1,i+1)-C,a=r===t?e:r*T;n.scrollTo({top:a})}else if(i<=r){const e=Math.max(0,i-1)*T;n.scrollTo({top:e})}y(t)}}}}),[g,f,O,T,C,M,A,a,s,o,b]),B=(0,r.useCallback)((({clientHeight:e})=>S(e)),[]),V=(0,r.useCallback)((({top:e})=>I(e)),[]);return tn(m,(({height:e})=>P(e)),"border-box"),r.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:F,onKeyDown:_,ref:u},r.createElement(br,{scrollAmount:T,onResize:B,onScroll:V,scrollableRef:d},r.createElement("ul",{role:"tree"},e.map(((t,n)=>{var{id:i}=t,a=Cr(t,["id"]);return r.createElement(Ir,Object.assign({},a,{id:i,selectedId:f,expandedIds:v,level:1,rowHeight:T,nodeIndex:n,setSize:e.length,emptyMarker:!0,onSelect:y,onToggle:b,key:i}))}))),r.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*T}px)`},ref:m})))}function Nr(e,t){for(const n of e){if(n.id===t)return!0;if(n.children&&Nr(n.children,t))return!0}return!1}function zr(e,t){return e.reduce(((e,n)=>{if(void 0===e)if(n.id===t)e=n.value;else if(n.children)return zr(n.children,t);return e}),void 0)}function jr(e,t){return e.reduce(((e,n)=>!e&&n.children?n.children.find((e=>e.id===t))?n.id:jr(n.children,t):e),"")}var Lr;!function(e){e[e.PublicMedia=0]="PublicMedia",e[e.PersonalMedia=1]="PersonalMedia",e[e.DataService=2]="DataService"}(Lr||(Lr={}));const Dr=Lr;function Rr(e){return _e((function(t,n){var r=!1,i=0;t.subscribe(Be(n,(function(t){return(r||(r=!e(t,i++)))&&n.next(t)})))}))}var Fr;!function(e){e[e.Direct=0]="Direct",e[e.HLS=1]="HLS",e[e.DASH=2]="DASH",e[e.IFrame=3]="IFrame"}(Fr||(Fr={}));const _r=Fr;var Br=Array.isArray,Vr=Object.getPrototypeOf,Ur=Object.prototype,Hr=Object.keys;function qr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rr(e),r=nr(e),i=function(e){if(1===e.length){var t=e[0];if(Br(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Vr(r)===Ur){var n=Hr(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}(e),a=i.args,s=i.keys;if(0===a.length)return or([],n);var o=new Ne(function(e,t,n){return void 0===n&&(n=$e),function(r){Yr(t,(function(){for(var i=e.length,a=new Array(i),s=i,o=i,l=function(i){Yr(t,(function(){var l=or(e[i],t),c=!1;l.subscribe(Be(r,(function(e){a[i]=e,c||(c=!0,o--),o||r.next(n(a.slice()))}),(function(){--s||r.complete()})))}),r)},c=0;c<i;c++)l(c)}),r)}}(a,n,s?function(e){return function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}(s,e)}:$e));return r?o.pipe(Wn(r)):o}function Yr(e,t,n){e?nt(n,e,t):t()}function Kr(e,t){return void 0===t&&(t=$e),e=null!=e?e:Wr,_e((function(n,r){var i,a=!0;n.subscribe(Be(r,(function(n){var s=t(n);!a&&e(i,s)||(a=!1,i=s,r.next(n))})))}))}function Wr(e,t){return e===t}function Gr(e,t){return oe(t)?rt(e,t,1):rt(e,1)}function Jr(e){return _e((function(t,n){var r,i=null,a=!1;i=t.subscribe(Be(n,void 0,void 0,(function(s){r=et(e(s,Jr(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0}))),a&&(i.unsubscribe(),i=null,r.subscribe(n))}))}const Qr=new Le;function Xr(e){const t=e?Array.isArray(e)?e:[e]:[];t.length>0&&Qr.next(t)}function Zr(){return Qr}var ei=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class ti extends Yt.cp{constructor(){super("ampcast/pending-actions"),this.inLibraryChanges$=new ct([]),this.ratingChanges$=new ct([]),this.lock$=new ct(null),this.logger=new K("actionsStore"),this.version(2).stores({inLibraryChanges:"&src",ratingChanges:"&src"}),(0,Yt.k7)((()=>this.inLibraryChanges.toArray())).subscribe(this.inLibraryChanges$),(0,Yt.k7)((()=>this.ratingChanges.toArray())).subscribe(this.ratingChanges$)}registerServices(e){for(const t of e)this.registerService(t)}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}getInLibrary(e,t){const n=this.getInLibraryChangedItem(e);return n?n.inLibrary:t}getRating(e,t){const n=this.getRatingChangedItem(e);return n?n.rating:t}rate(e,t){return ei(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=tf(r);if(!i)throw Error(`Service not found '${r}'`);if(!i.rate)throw Error(`rate() not supported by ${r}`);if(this.isLocked(e))yield this.ratingChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{rating:t})));else{const n=this.getRatingChangedItem(e);n&&(yield this.ratingChanges.delete(n.src)),yield i.rate(e,t)}Xr({match:t=>i.compareForRating(t,e),values:{rating:t}})}))}store(e,t){return ei(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=tf(r);if(!i)throw Error(`Service not found '${r}'`);if(!i.store)throw Error(`store() not supported by ${r}`);{const n=this.getInLibraryChangedItem(e);n&&(yield this.inLibraryChanges.delete(n.src)),this.isLocked(e)?n||(yield this.inLibraryChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{inLibrary:t})))):yield i.store(e,t),Xr({match:t=>i.compareForRating(t,e),values:{inLibrary:t}})}}))}observeInLibraryChanges(e){return this.observeUpdates(e,this.inLibraryChanges$)}observeRatingChanges(e){return this.observeUpdates(e,this.ratingChanges$)}observeUpdates(e,t){return qr([t,this.lock$]).pipe(Ue((([e])=>e.length>0)),He((([t])=>t.filter((t=>t.src.startsWith(`${e.id}:`)&&!this.isLocked(t))))),Kr(((e,t)=>{const n=e.map((e=>e.src)).sort(),r=t.map((e=>e.src)).sort();return String(n)===String(r)})))}bulkRate(e,t,n,r=10){return ei(this,void 0,void 0,(function*(){const i=t=>ei(this,void 0,void 0,(function*(){const r=t.map((e=>e.src));yield this.ratingChanges.bulkDelete(r),Xr({match:n=>t.some((t=>e.compareForRating(n,t))),values:{rating:n}})}));if(e.bulkRate)yield e.bulkRate(t,n),i(t);else{const a=u(t,r);for(const t of a)yield Promise.all(t.map((t=>e.rate(t,n)))),i(t)}}))}bulkStore(e,t,n,r=10){return ei(this,void 0,void 0,(function*(){const i=t=>ei(this,void 0,void 0,(function*(){const r=t.map((e=>e.src));yield this.inLibraryChanges.bulkDelete(r),Xr({match:n=>t.some((t=>e.compareForRating(n,t))),values:{inLibrary:n}})}));if(e.bulkStore)yield e.bulkStore(t,n),i(t);else{const a=u(t,r);for(const t of a)yield Promise.all(t.map((t=>e.store(t,n)))),i(t)}}))}createStorableMediaObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"])}return e}getInLibraryChangedItem(e){const t=nf(e);if(null==t?void 0:t.store)return this.inLibraryChanges$.getValue().find((n=>t.compareForRating(n,e)))}getRatingChangedItem(e){const t=nf(e);if(null==t?void 0:t.rate)return this.ratingChanges$.getValue().find((n=>t.compareForRating(n,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[n]=e.src.split(":");return t.serviceId===n&&t.itemType===e.itemType}return!1}registerService(e,t){if(e.rate){const n=this.logger.id(`${e.id}/rating`);this.observeRatingChanges(e).pipe(Ue((e=>e.length>0)),He((e=>d(e,(e=>e.rating)))),rt((e=>Object.keys(e).map((t=>({items:e[t],rating:Number(t)}))))),Gr((({items:n,rating:r})=>this.bulkRate(e,n,r,t))),Jr((e=>(n.error(e),[])))).subscribe(n)}if(e.store){const n=this.logger.id(`${e.id}/inLibrary`);this.observeInLibraryChanges(e).pipe(Ue((e=>e.length>0)),He((e=>d(e,(e=>String(!!e.inLibrary))))),rt((e=>Object.keys(e).map((t=>({items:e[t],inLibrary:"false"!==t}))))),Gr((({items:n,inLibrary:r})=>this.bulkStore(e,n,r,t))),Jr((e=>(n.error(e),[])))).subscribe(n)}}}const ni=new ti;var ri;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue",e.AddToPlaylist="add-to-playlist",e.AddToNewPlaylist="add-to-new-playlist",e.AddToRecentPlaylist1="add-to-recent-playlist-1",e.AddToRecentPlaylist2="add-to-recent-playlist-2",e.AddToRecentPlaylist3="add-to-recent-playlist-3",e.AddToRecentPlaylist4="add-to-recent-playlist-4"}(ri||(ri={}));const ii=ri;var ai;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(ai||(ai={}));const si=ai;var oi;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(oi||(oi={}));const li=oi,ci=/^en(-us)?$/i.test(navigator.language);function ui(e){return e&&!ci?e.replaceAll(/(F)avorite(s?)/gi,"$1avourite$2"):e}class di extends Error{constructor(){super(),Object.setPrototypeOf(this,di.prototype)}}class mi extends di{constructor(){super(...arguments),this.message="No music library found."}}class hi extends di{constructor(){super(...arguments),this.message="No music video library found."}}class pi extends di{constructor(){super(...arguments),this.message="No TIDAL subscription found."}}class fi extends di{constructor(){super(...arguments),this.message=ui("No favorites playlist found.")}}var yi=Array.isArray;function vi(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 1===(t=1===(e=t).length&&yi(e[0])?e[0]:e).length?et(t[0]):new Ne(function(e){return function(t){for(var n=[],r=function(r){n.push(et(e[r]).subscribe(Be(t,(function(e){if(n){for(var i=0;i<n.length;i++)i!==r&&n[i].unsubscribe();n=null}t.next(e)}))))},i=0;n&&!t.closed&&i<e.length;i++)r(i)}}(t))}function bi(e,{timeout:t=5e3,keepAlive:n=!1}={}){return new Promise(((r,i)=>{const a=e.observeItems(),s=vi(e.observeError().pipe(He((e=>e instanceof Error?e:Error(String((null==e?void 0:e.message)||"unknown"))))),Hn(t).pipe(He((()=>Error("timeout")))));vi(a,s).subscribe((t=>{n||e.disconnect(),t instanceof Error?i(t):r(t)})),e.fetchAt(0)}))}var gi=new Ne(be);class wi{constructor(e=[]){this.items$=new ct([]),this.maxSize=void 0,this.items$.next(e)}observeItems(){return this.items$}observeSize(){return this.items$.pipe(He((e=>e.length)))}observeError(){return gi}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()}))}get items(){return this.items$.getValue()}}const Ei="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE3MDM5NTczMDcsImV4cCI6MTcxOTUwOTMwNywiaXNzIjoiODM4Nk5ERlhMQiJ9.UJjNLqpKbxC5Jr81w1JPSSZbBNdVjVvvd3LNcaGwJQpuy8U_R5EMcwGy0Z6nDu9IzfwYa9uGPT5ooB4qcKE5Kw".toString(),ki="41bd731be5b78200d2bbaea2312b917b".toString(),xi="78aa93b641329f00e68cf1542356b8fc".toString(),Si="".toString(),Ti="".toString(),Pi="".toString(),Ai=new Z("apple"),Ii={get connectedAt(){return Ai.getNumber("connectedAt")},set connectedAt(e){Ai.setNumber("connectedAt",e)},get favoriteSongsId(){return Ai.getString("favoriteSongsId")},set favoriteSongsId(e){Ai.setString("favoriteSongsId",e)},get useMusicKitBeta(){return Ai.getBoolean("useMusicKitBeta",!0)},set useMusicKitBeta(e){Ai.setBoolean("useMusicKitBeta",e)}};var Ci=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class Mi{constructor(e){this.MusicKit=e,this.isWrapper=!0}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return Ci(this,void 0,void 0,(function*(){if(!this.instance){const t=this.MusicKit.configure(e);this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}})}return this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}}),e;throw Error("Not configured")}formatArtworkURL(e,t,n){return this.MusicKit.formatArtworkURL(e,t,n)}music(e,t,n){return Ci(this,void 0,void 0,(function*(){const r=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",r.storefrontId);const i=(null==n?void 0:n.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{Authorization:`Bearer ${r.developerToken}`,"Music-User-Token":r.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok){const e=new Error(String(a.status));throw e.data=a,e}return{data:yield a.json()}}))}}var Oi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const $i=new K("appleAuth"),Ni=new ct(!1);function zi(){return!!Ii.connectedAt}function ji(){return Ni.getValue()}function Li(){return Ni.pipe(Kr())}function Di(){return Oi(this,void 0,void 0,(function*(){$i.log("disconnect");try{const e=yield _i();try{e.isPlaying&&e.stop(),e.queue.isEmpty||(yield e.setQueue({}))}catch(e){$i.error(e)}try{yield e.unauthorize()}catch(e){$i.error(e)}}catch(e){}Ii.connectedAt=0,Ii.favoriteSongsId="",Ni.next(!1)}))}function Ri(){return Oi(this,void 0,void 0,(function*(){throw $i.log("refreshToken"),yield Di(),Error("Access token refresh is not supported.")}))}const Fi=new Promise(((e,t)=>{document.addEventListener("musickitloaded",(()=>Oi(void 0,void 0,void 0,(function*(){$i.log("Loaded MusicKit version",MusicKit.version),MusicKit.version.startsWith("1")&&!MusicKit.isWrapper&&(window.MusicKit=new Mi(MusicKit));try{const t=yield MusicKit.configure({developerToken:Ei,app:{name:"ampcast",build:"0.9.5"},sourceType:8,suppressErrorDialog:!0});t.addEventListener(MusicKit.Events.authorizationStatusDidChange,(()=>Oi(void 0,void 0,void 0,(function*(){const e=t.isAuthorized;if(e)try{yield Bi(t)}catch(e){$i.error(e)}Ni.next(e)})))),e(t)}catch(e){t(e)}}))))}));function _i(){return Oi(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${Ii.useMusicKitBeta?3:1}/musickit.js`).then((()=>Fi.then(e,t)),t)}))}))}function Bi(e){return Oi(this,void 0,void 0,(function*(){if(!Ii.favoriteSongsId){const{data:{data:t=[]}}=yield e.api.music("/v1/me/library/playlists",{"extend[library-playlists]":"tags","fields[library-playlists]":"tags"}),n=t.find((e=>{var t,n;return null===(n=null===(t=e.attributes)||void 0===t?void 0:t.tags)||void 0===n?void 0:n.includes("favorited")}));n&&(Ii.favoriteSongsId=n.id)}}))}function Vi(e){return e<=0?function(){return ur}:_e((function(t,n){var r=0;t.subscribe(Be(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}Li().pipe(Rr((e=>!e))).subscribe((e=>Ii.connectedAt=e?Date.now():0)),Oi(void 0,void 0,void 0,(function*(){try{if(zi()){const e=yield _i();e.isAuthorized&&(yield Bi(e),Ni.next(!0))}}catch(e){$i.error(e)}}));var Ui;const Hi=[],qi=new K("AbstractPager");Ui=new WeakMap;const Yi=class{constructor(e={}){this.config=e,this.additions$=new ct(Hi),this.error$=new ct(Hi),this.items$=new ct(Hi),this.fetches$=new ct({index:0,length:0}),this.size$=new ct(-1),this.srcs=new Set,Ui.set(this,!1)}get maxSize(){return this.config.maxSize}observeAdditions(){return this.additions$.pipe(Rr((e=>e===Hi)))}observeError(){return this.error$.pipe(Rr((e=>e===Hi)))}observeItems(){return this.items$.pipe(Rr((e=>e===Hi)))}observeSize(){return this.size$.pipe(Rr((e=>-1===e)),Kr())}disconnect(){this.disconnected||(function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,Ui,!0,"f"),this.subscriptions&&this.subscriptions.unsubscribe(),this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.additions$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){this.disconnected?qi.warn("disconnected"):(t||(t=50),this.connected||this.connect(),this.fetches$.next({index:e,length:t}))}get connected(){return!!this.subscriptions}get disconnected(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,Ui,"f")}get error(){const e=this.error$.getValue();return e===Hi?void 0:e}set error(e){this.error$.next(e)}get items(){return this.items$.getValue()}set items(e){const t=[];this.items$.next(e.map((e=>{if(!this.srcs.has(e.src)){this.srcs.add(e.src);const n=ni.getInLibrary(e,e.inLibrary),r=ni.getRating(e,e.rating);e.inLibrary===n&&e.rating===r||(e=Object.assign(Object.assign({},e),{inLibrary:n,rating:r})),t.push(e)}return e}))),t.length>0&&this.additions$.next(t)}get size(){const e=this.size$.getValue();return-1===e?void 0:e}set size(e){this.size$.next(e)}observeComplete(){return qr([this.observeItems(),this.observeSize()]).pipe(Ue((([e,t])=>e.reduce((e=>e+1),0)===t)),He((([e])=>e)),Vi(1))}observeFetches(){return this.fetches$}connect(){this.disconnected||this.connected||(this.subscriptions=new de,this.config.lookup||(this.subscribeTo(this.observeAdditions().pipe(ut((e=>this.addMultiDisc(e)))),qi),this.subscribeTo(this.observeAdditions().pipe(ut((e=>this.addTrackCount(e)))),qi),this.subscribeTo(Zr().pipe(ut((e=>this.applyChanges(e)))),qi)))}subscribeTo(e,t){this.subscriptions.add(e.subscribe(t))}applyChanges(e){let t=!1;const n=this.items.map((n=>{for(const{match:r,values:i}of e)if(r(n))return t=!0,Object.assign(Object.assign({},n),i);return n}));t&&this.items$.next(n)}addMultiDisc(e){e.forEach((e=>{e.itemType===si.Album&&void 0===e.multiDisc&&this.subscribeTo(e.pager.observeItems().pipe(Vi(1),ut((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r],i=h(t.map((e=>e.disc)).filter(l)),a=i.length>1||i[0]>1;e[r]=Object.assign(Object.assign({},n),{multiDisc:a}),this.items$.next(e)}}))),qi)}))}addTrackCount(e){e.forEach((e=>{e.itemType===si.Playlist&&!e.trackCount&&e.pager&&this.subscribeTo(e.pager.observeSize().pipe(Vi(1),ut((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r];e[r]=Object.assign(Object.assign({},n),{trackCount:t}),this.items$.next(e)}}))),qi)}))}},Ki=new K("SequentialPager");class Wi extends Yi{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new ct(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeShouldFetch().pipe(cr(void 0),ut((()=>this.fetching$.next(!0))),Gr((()=>this.fetchNext(this.config.pageSize))),ut((e=>this.addPage(e))),Jr((e=>(Ki.error(e),this.error=e,wr(void 0)))),ut((()=>this.fetching$.next(!1))),hr(this.observeComplete()),Vi(100)),Ki))}observeShouldFetch(){const e=qr([this.observeFetches(),this.observeItems()]).pipe(He((([{index:e,length:t},n])=>e+t+1>=n.length)),Ue((e=>e)),He((()=>{})),Vi(1));return this.fetching$.pipe(mr((t=>t?ur:e)))}addPage(e){var t,n;const r=(e.items||[]).filter(l),i=p(this.items.concat(r),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);let a=e.atEnd||i.length===this.maxSize||this.emptyCount>=this.maxEmptyCount;const s=this.config.pageSize;a||void 0!==e.atEnd||void 0!==e.total||void 0===s||(a=e.items.length<s);const o=a?i.length:e.total;void 0!==o&&(this.size=Math.min(o,null!==(n=this.maxSize)&&void 0!==n?n:1/0)),this.items=i}}class Gi extends Yi{constructor(e){super(),this.fetch=e}fetchAt(){this.disconnected||this.connected||(this.connect(),this.fetch().then((e=>{this.size=e.length,this.items=e})).catch((e=>this.error=e)))}}const Ji=new K("WrappedPager");class Qi{constructor(e,t,n){this.headerPager=e,this.bodyPager=t,this.footerPager=n,this.fetches$=new ct({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){var e,t;return qr([(null===(e=this.headerPager)||void 0===e?void 0:e.observeItems())||wr([]),this.bodyPager.observeItems(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeItems())||wr([]),this.observeComplete()]).pipe(He((([e,t,n,r])=>e.concat(r?t.concat(n):t))))}observeSize(){var e;return qr([this.observeHeaderSize(),this.bodyPager.observeSize(),(null===(e=this.footerPager)||void 0===e?void 0:e.observeSize())||wr(0),this.observeComplete()]).pipe(He((([e,t,n,r])=>e+t+(r?n:0))))}observeError(){return this.bodyPager.observeError()}disconnect(){var e,t,n;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),null===(t=this.headerPager)||void 0===t||t.disconnect(),this.bodyPager.disconnect(),null===(n=this.footerPager)||void 0===n||n.disconnect())}fetchAt(e,t){this.disconnected?Ji.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){this.subscriptions||(this.subscriptions=new de,this.headerPager&&this.subscriptions.add(this.observeFetches().pipe(Vi(1),ut((({index:e,length:t})=>this.headerPager.fetchAt(e,t)))).subscribe(Ji)),this.subscriptions.add(qr([this.observeHeaderSize(),this.observeFetches()]).pipe(ut((([e,t])=>this.bodyPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(Ji)),this.footerPager&&this.subscriptions.add(this.observeComplete().pipe(ut((()=>this.footerPager.fetchAt(0)))).subscribe(Ji)))}observeComplete(){return qr([this.bodyPager.observeItems(),this.bodyPager.observeSize()]).pipe(He((([e,t])=>e.reduce((e=>e+1),0)===t)),cr(!1),Kr())}observeFetches(){return this.fetches$.pipe(Ue((e=>e.length>0)))}observeHeaderSize(){var e;return(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize().pipe(cr(0),He((e=>e||0)),Kr()))||wr(0)}}var Xi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Zi=new K("pinStore"),ea=[];class ta extends Yt.cp{constructor(){super("ampcast/pins"),this.pins$=new ct(ea),this.lockedPin$=new ct(null),this.version(2).stores({pins:"&src"}),(0,Yt.k7)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return Xi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Zi.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"]);return Object.assign(Object.assign({},n),{isPinned:!0})}))),Xr(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){Zi.error(e)}}))}unpin(e){return Xi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Zi.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),Xr(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){Zi.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return qr([this.pins$,this.lockedPin$]).pipe(Ue((([e])=>e!==ea)),He((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),n=this.lockedPin$.getValue();return n&&!t.find((e=>e.src===n.src))&&t.push(n),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const na=new ta;var ra=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ia=new K("MusicKitPager");class aa{static defaultToPage(e){var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===n?void 0:n.tracks)||e,a=i.data||[],s=i.next;return{items:a,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:s}}constructor(e,t,n,r,i=aa.defaultToPage){this.options=n,this.parent=r,this.nextPageUrl=void 0,this.pager=new Wi((n=>ra(this,void 0,void 0,(function*(){const r=yield this.fetchNext(this.nextPageUrl||e,n?t?Object.assign(Object.assign({},t),{limit:n}):{limit:n}:t),a=i(r.data),s=this.createItems(a.items),o=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:s,total:o,atEnd:l}}))),n)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new de,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.subscriptions.add(this.pager.observeAdditions().pipe(rt((e=>ka(e,!0,this.parent)))).subscribe(ia)))}fetchNext(e,t){var n;return ra(this,void 0,void 0,(function*(){const r=MusicKit.getInstance();try{return yield r.api.music(e,t)}catch(i){const a=null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.status;if(401===a||403===a)return yield Ri(),r.api.music(e,t);throw i}}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,n;const r=MusicKit.getInstance(),i=this.createFromLibrary(e),a=(null===(t=i.description)||void 0===t?void 0:t.standard)||(null===(n=i.description)||void 0===n?void 0:n.short),s=`apple:${e.type}:${e.id}`,o=this.getCatalogId(e),l=e.type.startsWith("library-")||void 0,c={src:s,itemType:si.Playlist,externalUrl:l?`https://music.apple.com/${r.storefrontId}/library/playlist/${e.id}`:i.url,title:i.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(i),owner:i.curatorName?{name:i.curatorName}:void 0,modifiedAt:Math.floor(new Date(i.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!i.playParams||void 0,isPinned:na.isPinned(s),inLibrary:l,apple:{catalogId:o}};return c.pager=new aa(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,c),c}createMediaArtist(e){var t,n;const r=this.createFromLibrary(e),i=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),a=this.getCatalogId(e);return{itemType:si.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:r.url||void 0,title:r.name,description:i?P(i):void 0,thumbnails:this.createThumbnails(r),genres:this.getGenres(r),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createMediaAlbum(e){var t,n;const r=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),s=this.getCatalogId(e),o={itemType:si.Album,src:i,externalUrl:r.url||void 0,title:r.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(r),artist:r.artistName,trackCount:r.trackCount,genres:this.getGenres(r),year:new Date(r.releaseDate).getFullYear()||0,unplayable:!r.playParams||void 0,inLibrary:e.type.startsWith("library-")||void 0,apple:{catalogId:s}};return o.pager=new aa(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,o),o}createMediaItem(e){var t,n,r,i,a;const s=this.createFromLibrary(e),{id:o,kind:l}=s.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${o}`,u=(null===(t=s.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=s.editorialNotes)||void 0===n?void 0:n.short),d=e.type.startsWith("library-"),m=(null===(r=this.parent)||void 0===r?void 0:r.itemType)===si.Playlist,h=this.getCatalogId(e);let p=s.url||void 0;return!p&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===si.Album&&this.parent.externalUrl&&(p=`${this.parent.externalUrl}?i=${h}`),{itemType:si.Media,mediaType:"musicVideo"===l?li.Video:li.Audio,playbackType:_r.HLS,src:c,externalUrl:p,title:s.name,description:u?P(u):void 0,thumbnails:this.createThumbnails(s),artists:[s.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===si.Album?this.parent.artist:void 0,album:s.albumName,duration:s.durationInMillis/1e3,genres:this.getGenres(s),disc:s.discNumber,track:s.trackNumber,year:new Date(s.releaseDate).getFullYear()||void 0,isrc:s.isrc,unplayable:!s.playParams||void 0,playedAt:0,inLibrary:d&&!m||void 0,apple:{catalogId:h}}}getCatalogId(e){var t,n,r;if(e.type.startsWith("library-")){let i=null===(n=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===n?void 0:n["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(r=this.getCatalog(e))||void 0===r?void 0:r.id),i||""}return e.id}createFromLibrary(e){var t;return x(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,n,r;return null===(r=null===(n=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===n?void 0:n.data)||void 0===r?void 0:r[0]}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new aa(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const n=this.createArtistTopTracks(e);let r;if(ga()){const t=this.createArtistVideos(e);r=new Gi((()=>ra(this,void 0,void 0,(function*(){try{return 0===(yield bi(t.pager,{keepAlive:!0})).length?[n]:[n,t]}catch(e){return ia.error(e),[n]}}))))}else r=new wi([n]);return new Qi(r,t)}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:si.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createArtistVideos(e){const t=this.createFromLibrary(e);return{itemType:si.Album,src:`apple:videos:${e.id}`,title:"Music Videos",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createVideosPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createTopTracksPager(e){return this.createArtistViewPager(e,"top-songs")}createVideosPager(e){return this.createArtistViewPager(e,"top-music-videos")}createArtistViewPager(e,t){return new aa(e.href,{[`limit[artists:${t}]`]:30,views:t},{maxSize:100},void 0,(e=>{var n,r,i;const a=(null===(r=null===(n=e.data[0])||void 0===n?void 0:n.views)||void 0===r?void 0:r[t])||e,s=a.data||[],o=a.next;return{items:s,total:null===(i=a.meta)||void 0===i?void 0:i.total,nextPageUrl:o}}))}}var sa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const oa={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},la={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:si.Playlist,search:()=>new aa("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:n})=>{const r=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:r,total:null==n?void 0:n.total,nextPageUrl:t}}))},ca={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,layout:oa,search:()=>new aa("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},ua={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:si.Media,lockActionsStore:!0,layout:oa,defaultHidden:!0,search:()=>new aa("/v1/me/library/songs",{"include[library-songs]":"catalog"})},da={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:si.Album,lockActionsStore:!0,search:()=>new aa("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog",sort:"-dateAdded"})},ma={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:si.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new aa("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},ha={id:"apple/playlists",title:"My Playlists",icon:"tick",itemType:si.Playlist,lockActionsStore:!0,search:()=>new aa("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog",sort:"-dateAdded"})},pa={id:"apple/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search:()=>new aa("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog","filter[featured]":"suggested"})},fa={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:si.Media,mediaType:li.Video,lockActionsStore:!0,layout:oa,defaultHidden:!0,search:()=>new aa("/v1/me/library/music-videos")},ya={id:"apple/favorite-songs",get title(){return ui("Favorite Songs")},icon:"star",itemType:si.Media,layout:oa,defaultHidden:!0,search(){const e=Ii.favoriteSongsId;if(!e)throw new fi;return new aa(`/v1/me/library/playlists/${e}/tracks`,{"include[library-songs]":"catalog"},void 0,{src:`apple:library-playlists:${e}`,itemType:si.Playlist})}},va={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",serviceType:Dr.PublicMedia,primaryMediaType:li.Audio,defaultHidden:!0,internetRequired:!0,roots:[wa(si.Media,{title:"Songs",layout:oa}),wa(si.Album,{title:"Albums"}),wa(si.Artist,{title:"Artists"}),wa(si.Playlist,{title:"Playlists"}),wa(si.Media,{title:"Videos",layout:oa,mediaType:li.Video},{types:"music-videos"},{maxSize:250})],sources:[ua,da,ma,ha,fa,ya,ca,la],icons:{[ii.AddToLibrary]:"plus",[ii.RemoveFromLibrary]:"tick-fill"},labels:{[ii.AddToLibrary]:"Add to Apple Music Library",[ii.RemoveFromLibrary]:"Saved to Apple Music Library"},editablePlaylists:pa,addToPlaylist:function(e,t){return sa(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,,r]=e.src.split(":"),i=t.map((e=>{const[,t,n]=e.src.split(":");return{id:n,type:t}}));return n.api.music(`/v1/me/library/playlists/${r}/tracks`,void 0,{fetchOptions:{method:"POST",body:JSON.stringify({data:i})}})}))},canRate:()=>!1,canStore:function(e){switch(e.itemType){case si.Media:case si.Playlist:return!0;case si.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:n,items:r=[]}={}){return sa(this,void 0,void 0,(function*(){const i=MusicKit.getInstance(),a={name:e,description:t,isPublic:n},s={tracks:{data:r.map((e=>{const[,t,n]=e.src.split(":");return{id:n,type:t}}))}},o=yield i.api.music("/v1/me/library/playlists",void 0,{fetchOptions:{method:"POST",body:JSON.stringify({attributes:a,relationships:s})}});return{src:`apple:${o.type}:${o.id}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,n]=e.src.split(":"),r=t.startsWith("library-");return new aa(`${r?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${n}`,r?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return sa(this,void 0,void 0,(function*(){if(e.itemType===si.Album&&e.synthetic)return e;let n=e;if(!e.externalUrl){const[,r,i]=e.src.split(":"),a=r.startsWith("library-"),s=new aa(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${r.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${r.replace("library-","")}]`]:"relationships"},{lookup:!0}),o=yield bi(s,{timeout:2e3});n=x(e,o[0]),n.description=(null===(t=o[0])||void 0===t?void 0:t.description)||e.description}return n.inLibrary=ni.getInLibrary(n,n.inLibrary),void 0===n.inLibrary&&ka([n]),n}))},getPlaybackType:function(){return sa(this,void 0,void 0,(function*(){return _r.HLS}))},lookup:function(e,t,n=10,r){return sa(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=Ea(si.Media,`${e} ${t}`,void 0,{pageSize:n,maxSize:n,lookup:!0});return(yield bi(i,{timeout:r})).filter((e=>!e.unplayable))}))},lookupByISRC:function(e,t,n){return sa(this,void 0,void 0,(function*(){if(0===e.length)return[];const r=new aa("/v1/catalog/{{storefrontId}}/songs",{"filter[isrc]":e.slice(0,25).join(",")},{pageSize:t,maxSize:t,lookup:!0});return(yield bi(r,{timeout:n})).filter((e=>!e.unplayable))}))},store:function(e,t){var n;return sa(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),s=null===(n=e.apple)||void 0===n?void 0:n.catalogId,o="/v1/me/library";if(t){const e=`ids[${a}]`;return r.api.music(o,{[e]:s},{fetchOptions:{method:"POST"}})}return r.api.music(`${o}/${a}/${s}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:Li,isConnected:zi,isLoggedIn:ji,login:function(){return Oi(this,void 0,void 0,(function*(){if(!ji()){$i.log("connect");try{const e=MusicKit.getInstance();yield e.authorize()}catch(e){$i.error(e)}}}))},logout:Di},ba=va;function ga(){var e;return null===(e=window.MusicKit)||void 0===e?void 0:e.version.startsWith("3")}function wa(e,t,n,r){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Ea(e,t,n,r)})}function Ea(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{term:t});if(!i.types){switch(e){case si.Media:i.types="songs";break;case si.Album:i.types="albums";break;case si.Artist:i.types="artists";break;case si.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new aa("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},r),void 0,(e=>{var t;const n=e.results[a]||{data:[]},r=n.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:n.data,total:i,nextPageUrl:r}}))}return new wi}function ka(e,t=!1,n){return sa(this,void 0,void 0,(function*(){const r=e[0];if(!r||!va.canStore(r,t))return;const i=(null==n?void 0:n.itemType)===si.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,s]=r.src.split(":");s=s.replace("library-","");const o=MusicKit.getInstance(),{data:{resources:l}}=yield o.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${s}]`]:"inLibrary","format[resources]":"map",[`ids[${s}]`]:a,"omit[resource]":"autos"}),c=l[s];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));Xr(a.map((e=>({match:t=>{var n;return(null===(n=t.apple)||void 0===n?void 0:n.catalogId)===e},values:{inLibrary:!!u.get(e)}}))))}))}var xa;!function(e){e[e.Folders=6]="Folders",e[e.ByDecade=7]="ByDecade",e[e.ByGenre=8]="ByGenre"}(xa||(xa={}));const Sa=xa;var Ta=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Pa=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Aa(e){var{service:t,settings:n,userName:i="",login:a}=e,s=Pa(e,["service","settings","userName","login"]);const o=t.id,[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(""),m=(0,r.useRef)(null),h=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(0,r.useRef)(null),y=r.createElement(In,{icon:t.icon,text:`Log in to ${t.name}`}),v=(0,r.useCallback)((()=>Ta(this,void 0,void 0,(function*(){try{const e=h.current.value.replace(/\/+$/,""),t=p.current.value,r=f.current.value;if(n.host=e,c(!0),d("Connecting..."),"https:"===location.protocol&&!e.startsWith("https:"))throw Error("https required");const i=yield a(e,t,r);m.current.close(i)}catch(e){console.error(e),c(!1),e instanceof TypeError?d("Host not found"):d(e.message||e.statusText||"Error")}}))),[n,a]),b=(0,r.useCallback)((e=>{e.preventDefault(),v()}),[v]);return r.createElement(fn,Object.assign({},s,{className:`login-dialog login-dialog-${t.id}`,title:y,ref:m}),r.createElement("form",{id:`${o}-login`,method:"dialog",onSubmit:b},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${o}-host`},"Host:"),r.createElement("input",{type:"url",id:`${o}-host`,name:`${o}-host`,autoFocus:!n.host,defaultValue:n.host,placeholder:"https://",required:!0,ref:h})),r.createElement("p",null,r.createElement("label",{htmlFor:`${o}-username`},"User:"),r.createElement("input",{type:"text",id:`${o}-username`,name:`${o}-username`,autoFocus:!!n.host,defaultValue:i,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",required:!0,ref:p})),r.createElement("p",null,r.createElement("label",{htmlFor:`${o}-password`},"Password:"),r.createElement("input",{type:"password",id:`${o}-password`,name:`${o}-password`,ref:f,required:!0}))),r.createElement("p",{className:"message "+(l?"":"error")},u),r.createElement(kn,{submitText:"Login"})))}let Ia=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[e]];return t};class Ca{constructor(e){this.storage=new Z(e),this.session=new Z(`${e}/session`,"session"),this.libraryId$=new ct(this.storage.getString("libraryId"))}get audioLibraries(){return this.libraries.filter((e=>"musicvideos"!==e.type))}get device(){return"PC"}get deviceId(){let e=this.storage.getString("deviceId");return e||(e=Ia(),this.storage.setString("deviceId",e)),e}get host(){return this.storage.getString("host")}set host(e){this.storage.setString("host",e)}get isLocal(){return this.storage.getBoolean("isLocal")}set isLocal(e){this.storage.setBoolean("isLocal",e)}get libraryId(){return this.storage.getString("libraryId")}set libraryId(e){this.storage.setString("libraryId",e),this.libraryId$.next(e)}observeLibraryId(){return this.libraryId$.pipe(Kr())}get libraries(){return this.storage.getJson("libraries")||[]}set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>"music"===e.type&&B(e.title)))||e.find((e=>"music"===e.type))||e.find((e=>"audiobooks"===e.type));this.storage.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""}get serverId(){return this.storage.getString("serverId")}set serverId(e){this.storage.setString("serverId",e)}get sessionId(){let e=this.session.getString("id");return e||(e=String(Math.floor(1e7*Math.random())),this.session.setString("id",e)),e}get token(){return this.storage.getString("token")}set token(e){this.storage.setString("token",e)}get userId(){return this.storage.getString("userId")}set userId(e){this.storage.setString("userId",e)}get videoLibraryId(){var e;return null===(e=this.libraries.find((e=>"musicvideos"===e.type)))||void 0===e?void 0:e.id}clear(){this.storage.removeItem("serverId"),this.storage.removeItem("userId"),this.storage.removeItem("token")}}const Ma=new Ca("emby");var Oa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},$a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Na(e=xs,t=Ma){return Oa(this,void 0,void 0,(function*(){return vn((n=>r.createElement(za,Object.assign({},n,{service:e,settings:t}))),!0)}))}function za(e){var{service:t,settings:n}=e,i=$a(e,["service","settings"]);const a=(0,r.useCallback)(((e,t,r)=>Oa(this,void 0,void 0,(function*(){const{device:i,deviceId:a}=n,s=`MediaBrowser Client="ampcast", Version="0.9.5", Device="${i}", DeviceId="${a}"`,o=yield fetch(`${e}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":s},body:JSON.stringify({Username:t,Pw:r})});if(!o.ok)throw o;const l=yield o.json(),c=l.ServerId,u=l.User.Id,d=l.AccessToken;return JSON.stringify({serverId:c,userId:u,token:d})}))),[n]);return r.createElement(Aa,Object.assign({},i,{service:t,settings:n,login:a}))}var ja=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function La(e,t,n){return ja(this,void 0,void 0,(function*(){return(yield Fa(e,t,{method:"GET"},n)).json()}))}function Da(e,t,n=Ma){return ja(this,void 0,void 0,(function*(){const r={UserId:n.userId,ParentId:n.libraryId,IncludeItemTypes:"Audio",SortBy:"SortName",Recursive:!0,Limit:500,StartIndex:0,EnableImages:!1,EnableUserData:!1,EnableTotalRecordCount:!1};switch(t){case si.Album:r.IncludeItemTypes="MusicAlbum";break;case si.Artist:r.IncludeItemTypes="AlbumArtist"}return((yield La(e,r,n)).Items||[]).map((({Id:e,Name:t})=>({id:e||t,title:t})))}))}function Ra(e,t={},n=Ma){return ja(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return Fa(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:r},n)}))}function Fa(e,t,n,r=Ma){return ja(this,void 0,void 0,(function*(){const{host:i,device:a,deviceId:s,token:o}=r;if(!o)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),n.headers=Object.assign(Object.assign({},n.headers),{Accept:"application/json","X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.9.5", Device="${a}", DeviceId="${s}", Token="${o}"`});const l=yield fetch(`${i}/${e}`,n);if(!l.ok)throw l;return l}))}function _a(e,t=Ma){const{host:n,userId:r,token:i,deviceId:a,sessionId:s}=t;if(n&&r&&i&&a){const[,t,o,l]=e.src.split(":"),c=`${s}-${o}`;return"video"===t?e.playbackType===_r.Direct?`${n}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:r,DeviceId:a,api_key:i,PlaySessionId:c})}`:`${n}/Videos/${o}/master.m3u8?${new URLSearchParams({MediaSourceId:l||o,DeviceId:a,api_key:i,TranscodeReasons:"ContainerNotSupported",VideoCodec:"h264,h265,hevc",AudioCodec:"mp3,aac",PlaySessionId:c})}`:`${n}/Audio/${o}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"aac",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",UserId:r,api_key:i,DeviceId:a,EnableRedirection:"true",StartTimeTicks:"0",PlaySessionId:c})}`}throw Error("Not logged in")}const Ba={addToPlaylist:function(e,t,n=Ma){return ja(this,void 0,void 0,(function*(){const r=n.userId,i=t.join(",");yield Fa(`Playlists/${e}/Items`,{Ids:i,UserId:r},{method:"POST"},n)}))},createPlaylist:function(e,t,n,r=Ma){return ja(this,void 0,void 0,(function*(){const i=r.userId,a=n.join(","),s=yield Ra("Playlists",{Name:e,Ids:a,UserId:i},r),{Id:o}=yield s.json(),l=`Items/${o}`,c=yield La(`Users/${i}/${l}`,void 0,r);return yield Ra(l,Object.assign(Object.assign({},c),{Overview:t}),r),c}))},delete:function(e,t,n){return ja(this,void 0,void 0,(function*(){yield Fa(e,t,{method:"DELETE"},n)}))},get:La,getFilters:function(e,t,n){return ja(this,void 0,void 0,(function*(){return e===Sa.ByDecade?function(e,t){return ja(this,void 0,void 0,(function*(){const n=(new Date).getFullYear(),r=(yield Da("Years",e,t)).map((e=>Number(e.title))).filter((e=>e>500&&e<=n)),i=d(r,(e=>10*Math.floor(e/10)));return Object.keys(i).sort().reverse().map((e=>({id:i[e].join(","),title:`${e}s`})))}))}(t,n):function(e,t){return ja(this,void 0,void 0,(function*(){return Da("Genres",e,t)}))}(t,n)}))},getEndpointInfo:function(e=Ma){return ja(this,void 0,void 0,(function*(){return yield La("System/Endpoint",void 0,e)}))},getMusicLibraries:function(e=Ma){var t;return ja(this,void 0,void 0,(function*(){const n=yield La(`Users/${e.userId}/Views`,void 0,e);return((null===(t=n.Items)||void 0===t?void 0:t.filter((e=>/^(audiobooks|music|musicvideos)$/.test(e.CollectionType))))||[]).map((({Id:e,Name:t,CollectionType:n})=>({id:e,title:t,type:n})))}))},post:Ra,getPlayableUrl:_a,getPlaybackType:function(e,t=Ma){return ja(this,void 0,void 0,(function*(){try{if(e.mediaType===li.Video){const{host:r,userId:i,token:a,deviceId:s}=t,[,,o,l]=e.src.split(":"),c=`${r}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:i,DeviceId:s,api_key:a})}`;return(yield(n=c,q("video",n)))?_r.Direct:_r.HLS}{const n=_a(e,t),r=(yield function(e){return o(this,void 0,void 0,(function*(){return(yield fetch(e,{method:"HEAD"})).headers.get("Content-Type")||""}))}(n)).toLowerCase();return"application/x-mpegurl"===r||"application/vnd.apple.mpegurl"===r?_r.HLS:_r.Direct}}catch(e){return _r.Direct}var n}))}},Va=Ba;var Ua=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ha=new K("embyAuth"),qa=new ct(""),Ya=new ct(!1);function Ka(){return Ya.getValue()}function Wa(e){Ma.token=e,qa.next(e)}function Ga(e,t,n){void 0===t&&(t=Bn);var r=Hn(e,t);return function(e,t){return _e((function(e,n){var i=null!=t?t:{},a=i.leading,s=void 0===a||a,o=i.trailing,l=void 0!==o&&o,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(y(),m&&n.complete())},p=function(){d=null,m&&n.complete()},f=function(e){return d=et(r).subscribe(Be(n,h,p))},y=function(){if(c){c=!1;var e=u;u=null,n.next(e),!m&&f()}};e.subscribe(Be(n,(function(e){c=!0,u=e,(!d||d.closed)&&(s?y():f())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&n.complete()})))}))}(0,n)}qa.pipe(Kr()).pipe(Ue((e=>""!==e)),rt((()=>function(){return Ua(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([Va.getEndpointInfo(),Va.getMusicLibraries()]);return Ma.isLocal=!!e.IsLocal,Ma.libraries=t,!0}catch(e){return 401===e.status?Ma.token="":Ha.error(e),qa.next(""),!1}}))}()))).subscribe(Ya),qa.next(Ma.token);var Ja;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(Ja||(Ja={}));const Qa=new K("OffsetPager");class Xa extends Yi{constructor(e,t){super(t),this.fetch=e,this.fetchStates={}}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeFetches().pipe(Ga(200,void 0,{leading:!1,trailing:!0}),Ue((({index:e,length:t})=>t>0&&this.isInRange(e))),He((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),rt((e=>e)),rt((e=>this.fetchPage(e))),Jr((e=>(Qa.error(e),this.error=e,wr(void 0)))),hr(this.observeComplete())),Qa))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,n=void 0,i=function*(){if(this.fetchStates[e]!==Ja.Fulfilled&&this.fetchStates[e]!==Ja.Pending){this.fetchStates[e]=Ja.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=Ja.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=Ja.Rejected,t}}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}insertPage(e,t){var n;const r=this.items.slice(),i=Math.min(t.total,null!==(n=this.maxSize)&&void 0!==n?n:1/0),a=Math.ceil(i/this.pageSize),s=(e-1)*this.pageSize;if(t.items.forEach(((e,t)=>r[t+s]=e)),r.length=i,t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=Ja.Fulfilled;this.size=i,this.items=r}getPageNumbersFromIndex(e,t){const n=this.size||0,r=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-r,0),a=Math.min(e+r+t-1,0===n?this.maxSize?this.maxSize-1:1/0:n-1),s=this.getPageNumberFromIndex(i),o=this.getPageNumberFromIndex(a);if(s===o)return[s];{const e=[];for(let t=s;t<=o;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){const t=this.size||0;return 0===t?e>=0:e>=0&&e<t}}class Za{constructor(e,t={},n,r){this.path=e,this.params=t,this.parent=r,this.pageSize=Math.min((null==n?void 0:n.maxSize)||1/0,(null==n?void 0:n.pageSize)||(Ma.isLocal?Za.maxPageSize:200)),this.pager=new Xa((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,n,r,i,a,s;return r=this,i=void 0,s=function*(){const r=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,ParentIndexNumber,Path,ProductionYear,Overview,PresentationUniqueKey,ProviderIds,,UserDataPlayCount,UserDataLastPlayedDate",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield Va.get(this.path,r);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(n=i.Items)||void 0===n?void 0:n.length)}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,n,r;return{itemType:si.Artist,src:`emby:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",description:e.Overview||void 0,playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,thumbnails:this.createThumbnails(e),artist_mbid:null===(r=e.ProviderIds)||void 0===r?void 0:r.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,n,r,i;return{itemType:si.Album,src:`emby:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,pager:this.createAlbumTracksPager(e)}}createMediaPlaylist(e){var t,n,r;const i=`emby:playlist:${e.Id}`;return{src:i,itemType:si.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:na.isPinned(i)}}createMediaFolder(e){var t;const n=this.getFileName(e.Path||"")||e.Name||"[unknown]",r={itemType:si.Folder,src:`emby:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}createMediaItem(e){var t,n,r,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:si.Media,mediaType:l?li.Video:li.Audio,src:`emby:${l?"video":"audio"}:${e.Id}:${e.PresentationUniqueKey||""}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(n=e.UserData)||void 0===n?void 0:n.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const n=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return n?[this.createThumbnail(n,240),this.createThumbnail(n,360),this.createThumbnail(n,480),this.createThumbnail(n,800)]:void 0}createThumbnail(e,t,n=t){return{url:`${Ma.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new wi([t]),r=new Za(`Users/${Ma.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending"});return new Qi(void 0,r,n)}createArtistAllTracks(e){return{itemType:si.Album,src:`emby:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Za(`Users/${Ma.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"SortName",SortOrder:"Ascending"})}createAlbumTracksPager(e){return new Za(`Users/${Ma.userId}/Items`,{ParentId:e.Id,SortBy:"ParentIndexNumber,IndexNumber",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new Za(`Playlists/${e.Id}/Items`,{UserId:Ma.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new Za(`Users/${Ma.userId}/Items`,{ParentId:n,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new wi([e]);return new Qi(t,r)}return r}getExternalUrl(e){return`${Ma.host}/web/index.html#!/item?id=${e.Id}&serverId=${Ma.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}Za.minPageSize=10,Za.maxPageSize=1e3;const es=Za;var ts=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ns="emby",rs="AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName",is={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},as={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre","PlayCount"]},ss={id:"emby/liked-songs",title:"My Songs",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>As({ParentId:Is(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},os={id:"emby/liked-albums",title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search:()=>As({ParentId:Is(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},ls={id:"emby/liked-artists",title:"My Artists",icon:"heart",itemType:si.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new es("Artists/AlbumArtists",{ParentId:Is(),isFavorite:!0,UserId:Ma.userId})},cs={id:"emby/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>As({ParentId:Is(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},us={id:"emby/most-played",title:"Most Played",icon:"most-played",itemType:si.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>As({ParentId:Is(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ds={id:"emby/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,layout:is,secondaryLayout:as,search:()=>As({ParentId:Is(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},ms={id:"emby/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search:()=>As({ParentId:Is(),IncludeItemTypes:"Playlist"})},hs={id:"emby/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:si.Media,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?As({ParentId:Is(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:rs}):new wi},ps={id:"emby/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:si.Album,viewType:Sa.ByGenre,search:e=>e?As({ParentId:Is(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new wi},fs={id:"emby/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:si.Artist,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?new es("Artists/AlbumArtists",{ParentId:Is(),GenreIds:e.id,UserId:Ma.userId}):new wi},ys={id:"emby/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:si.Media,viewType:Sa.ByDecade,defaultHidden:!0,search:e=>e?As({ParentId:Is(),Years:e.id,IncludeItemTypes:"Audio",SortBy:rs}):new wi},vs={id:"emby/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:si.Album,viewType:Sa.ByDecade,search:e=>e?As({ParentId:Is(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new wi},bs={id:"emby/random-tracks",title:"Random Songs",icon:"shuffle",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>As({ParentId:Is(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},gs={id:"emby/random-albums",title:"Random Albums",icon:"shuffle",itemType:si.Album,search:()=>As({ParentId:Is(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},ws={id:"emby/videos",title:"Music Videos",icon:"video",itemType:si.Media,mediaType:li.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Ma.videoLibraryId;if(!t)throw new hi;return As({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},Es={id:"emby/folders",title:"Folders",icon:"folder",itemType:si.Folder,viewType:Sa.Folders,search(){const e={itemType:si.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Gi((()=>ts(this,void 0,void 0,(function*(){return Ma.libraries.map((({id:t,title:n})=>{const r={itemType:si.Folder,src:`emby:folder:${t}`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new wi([i]),s=new es(`Users/${Ma.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},void 0,r);return r.pager=new Qi(a,s),r}))})))),e.pager}},ks={id:ns,icon:ns,name:"Emby",url:"https://emby.media/",serviceType:Dr.PersonalMedia,defaultHidden:!0,roots:[Ts(si.Media,{title:"Songs"}),Ts(si.Album,{title:"Albums"}),Ts(si.Artist,{title:"Artists"}),Ts(si.Playlist,{title:"Playlists",layout:is,secondaryLayout:as})],sources:[ss,os,ls,us,cs,ds,hs,ps,fs,ys,vs,bs,gs,ws,Es],labels:{[ii.AddToLibrary]:ui("Add to Emby Favorites"),[ii.RemoveFromLibrary]:ui("Remove from Emby Favorites")},editablePlaylists:ms,get audioLibraries(){return Ma.audioLibraries},get libraryId(){return Ma.libraryId},set libraryId(e){Ma.libraryId=e},get libraries(){return Ma.libraries},set libraries(e){Ma.libraries=e},observeLibraryId:()=>Ma.observeLibraryId(),addToPlaylist:function(e,t){return ts(this,void 0,void 0,(function*(){const n=Cs(e);return Va.addToPlaylist(n,t.map(Cs))}))},canRate:()=>!1,canStore:Ss,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:n=[]}={}){return ts(this,void 0,void 0,(function*(){return{src:`emby:playlist:${(yield Va.createPlaylist(e,t,n.map(Cs))).Id}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>As({ids:Cs(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return ts(this,void 0,void 0,(function*(){return Va.getFilters(e,t)}))},getMetadata:function(e){return ts(this,void 0,void 0,(function*(){if(!Ss(e)||void 0!==e.inLibrary)return e;const t=ni.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const n=Cs(e),r=new es(`Users/${Ma.userId}/Items/${n}`,void 0,{pageSize:1,maxSize:1}),i=yield bi(r,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return Va.getPlayableUrl(e)},getPlaybackType:function(e){return ts(this,void 0,void 0,(function*(){return Va.getPlaybackType(e)}))},lookup:function(e,t,n=10,r){return ts(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return bi(Ps(si.Media,t,{Artists:e},i),{timeout:r})}))},store:function(e,t){return ts(this,void 0,void 0,(function*(){const n=Cs(e),r=`Users/${Ma.userId}/FavoriteItems/${n}`;t?yield Va.post(r):yield Va.delete(r)}))},observeIsLoggedIn:function(){return Ya.pipe(Kr())},isConnected:function(){return!!Ma.token},isLoggedIn:Ka,login:function(){return Ua(this,void 0,void 0,(function*(){if(!Ka()){Ha.log("connect");try{const e=yield Na();if(e){const{serverId:t,userId:n,token:r}=JSON.parse(e);Ma.serverId=t,Ma.userId=n,Wa(r)}}catch(e){Ha.error(e)}}}))},logout:function(){return Ua(this,void 0,void 0,(function*(){Ha.log("disconnect"),Ma.clear(),Wa(""),Ya.next(!1)}))}},xs=ks;function Ss(e){switch(e.itemType){case si.Album:return!e.synthetic;case si.Folder:return!1;default:return!0}}function Ts(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`emby/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Ps(e,t)})}function Ps(e,t,n,r){const i=Object.assign({ParentId:Is(),SortBy:"SortName",SearchTerm:t.trim()},n);if(e===si.Artist)return new es("Artists",Object.assign(Object.assign({},i),{UserId:Ma.userId}),r);switch(e){case si.Media:i.IncludeItemTypes="Audio",i.SortBy=rs;break;case si.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case si.Playlist:i.IncludeItemTypes="Playlist"}return As(i,r)}function As(e,t){return new es(`Users/${Ma.userId}/Items`,e,t)}function Is(){const e=Ma.libraryId;if(!e)throw new mi;return e}function Cs({src:e}){const[,,t]=e.split(":");return t}const Ms=new Ca("jellyfin");var Os=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const $s={addToPlaylist:function(e,t){return Os(this,void 0,void 0,(function*(){return Va.addToPlaylist(e,t,Ms)}))},createPlaylist:function(e,t,n){return Os(this,void 0,void 0,(function*(){return Va.createPlaylist(e,t,n,Ms)}))},delete:function(e,t){return Os(this,void 0,void 0,(function*(){return Va.delete(e,t,Ms)}))},get:function(e,t){return Os(this,void 0,void 0,(function*(){return Va.get(e,t,Ms)}))},getEndpointInfo:function(){return Os(this,void 0,void 0,(function*(){return Va.getEndpointInfo(Ms)}))},getFilters:function(e,t){return Os(this,void 0,void 0,(function*(){return Va.getFilters(e,t,Ms)}))},getMusicLibraries:function(){return Os(this,void 0,void 0,(function*(){return Va.getMusicLibraries(Ms)}))},post:function(e,t={}){return Os(this,void 0,void 0,(function*(){return Va.post(e,t,Ms)}))},getPlayableUrl:function(e){return Va.getPlayableUrl(e,Ms)},getPlaybackType:function(e){return Os(this,void 0,void 0,(function*(){return Va.getPlaybackType(e,Ms)}))}};var Ns=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const zs=new K("jellyfinAuth"),js=new ct(""),Ls=new ct(!1);function Ds(){return Ls.getValue()}function Rs(e){Ms.token=e,js.next(e)}js.pipe(Kr()).pipe(Ue((e=>""!==e)),rt((()=>function(){return Ns(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([$s.getEndpointInfo(),$s.getMusicLibraries()]);return Ms.isLocal=!!e.IsLocal,Ms.libraries=t,!0}catch(e){return 401===e.status?Ms.token="":zs.error(e),js.next(""),!1}}))}()))).subscribe(Ls),js.next(Ms.token);class Fs{constructor(e,t={},n,r){this.path=e,this.params=t,this.parent=r,this.pageSize=Math.min((null==n?void 0:n.maxSize)||1/0,(null==n?void 0:n.pageSize)||(Ms.isLocal?Fs.maxPageSize:200)),this.pager=new Xa((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,n,r,i,a,s;return r=this,i=void 0,s=function*(){const r=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,Path,ProviderIds",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield $s.get(this.path,r);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(n=i.Items)||void 0===n?void 0:n.length)}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,n,r;return{itemType:si.Artist,src:`jellyfin:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,artist_mbid:null===(r=e.ProviderIds)||void 0===r?void 0:r.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,n,r,i;return{itemType:si.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,n,r;const i=`jellyfin:playlist:${e.Id}`;return{src:i,itemType:si.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:na.isPinned(i)}}createMediaFolder(e){var t;const n=this.getFileName(e.Path||"")||e.Name||"[unknown]",r={itemType:si.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}createMediaItem(e){var t,n,r,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:si.Media,mediaType:l?li.Video:li.Audio,src:`jellyfin:${l?"video":"audio"}:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(n=e.UserData)||void 0===n?void 0:n.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const n=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return n?[this.createThumbnail(n,240),this.createThumbnail(n,360),this.createThumbnail(n,480),this.createThumbnail(n,800)]:void 0}createThumbnail(e,t,n=t){return{url:`${Ms.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createAlbumTracksPager(e){return new Fs(`Users/${Ms.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new wi([t]),r=new Fs(`Users/${Ms.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending"});return new Qi(void 0,r,n)}createArtistAllTracks(e){return{itemType:si.Album,src:`jellyfin:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Fs(`Users/${Ms.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"Name",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new Fs(`Playlists/${e.Id}/Items`,{UserId:Ms.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new Fs(`Users/${Ms.userId}/Items`,{ParentId:n,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new wi([e]);return new Qi(t,r)}return r}getExternalUrl(e){return`${Ms.host}/web/index.html#!/details?id=${e.Id}&serverId=${Ms.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}Fs.minPageSize=10,Fs.maxPageSize=1e3;const _s=Fs;var Bs=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Vs="jellyfin",Us={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},Hs={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},qs={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>ho({ParentId:po(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Ys={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search:()=>ho({ParentId:po(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},Ks={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:si.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new _s("Artists/AlbumArtists",{ParentId:po(),isFavorite:!0,UserId:Ms.userId})},Ws={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>ho({ParentId:po(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Gs={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:si.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>ho({ParentId:po(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Js={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,layout:Us,secondaryLayout:Hs,search:()=>ho({ParentId:po(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},Qs={id:"jellyfin/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search:()=>ho({ParentId:po(),IncludeItemTypes:"Playlist"})},Xs={id:"jellyfin/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:si.Media,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?ho({ParentId:po(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new wi},Zs={id:"jellyfin/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:si.Album,viewType:Sa.ByGenre,search:e=>e?ho({ParentId:po(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new wi},eo={id:"jellyfin/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:si.Artist,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?new _s("Artists/AlbumArtists",{ParentId:po(),GenreIds:e.id,UserId:Ms.userId}):new wi},to={id:"jellyfin/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:si.Media,viewType:Sa.ByDecade,defaultHidden:!0,search:e=>e?ho({ParentId:po(),Years:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new wi},no={id:"jellyfin/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:si.Album,viewType:Sa.ByDecade,search:e=>e?ho({ParentId:po(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new wi},ro={id:"jellyfin/random-tracks",title:"Random Songs",icon:"shuffle",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>ho({ParentId:po(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},io={id:"jellyfin/random-albums",title:"Random Albums",icon:"shuffle",itemType:si.Album,search:()=>ho({ParentId:po(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},ao={id:"jellyfin/videos",title:"Music Videos",icon:"video",itemType:si.Media,mediaType:li.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Ms.videoLibraryId;if(!t)throw new hi;return ho({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},so={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:si.Folder,viewType:Sa.Folders,search(){const e={itemType:si.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Gi((()=>Bs(this,void 0,void 0,(function*(){return Ms.libraries.map((({id:t,title:n})=>{const r={itemType:si.Folder,src:`jellyfin:folder:${t}`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new wi([i]),s=new _s(`Users/${Ms.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},void 0,r);return r.pager=new Qi(a,s),r}))})))),e.pager}},oo={id:Vs,icon:Vs,name:"Jellyfin",url:"https://jellyfin.org",serviceType:Dr.PersonalMedia,defaultHidden:!0,roots:[uo(si.Media,{title:"Songs"}),uo(si.Album,{title:"Albums"}),uo(si.Artist,{title:"Artists"}),uo(si.Playlist,{title:"Playlists",layout:Us,secondaryLayout:Hs})],sources:[qs,Ys,Ks,Gs,Ws,Js,Xs,Zs,eo,to,no,ro,io,ao,so],labels:{[ii.AddToLibrary]:ui("Add to Jellyfin Favorites"),[ii.RemoveFromLibrary]:ui("Remove from Jellyfin Favorites")},editablePlaylists:Qs,get audioLibraries(){return Ms.audioLibraries},get libraryId(){return Ms.libraryId},set libraryId(e){Ms.libraryId=e},get libraries(){return Ms.libraries},set libraries(e){Ms.libraries=e},observeLibraryId:()=>Ms.observeLibraryId(),addToPlaylist:function(e,t){return Bs(this,void 0,void 0,(function*(){const n=fo(e);return $s.addToPlaylist(n,t.map(fo))}))},canRate:()=>!1,canStore:co,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:n=[]}={}){return Bs(this,void 0,void 0,(function*(){return{src:`jellyfin:playlist:${(yield $s.createPlaylist(e,t,n.map(fo))).Id}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>ho({ids:fo(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return Bs(this,void 0,void 0,(function*(){return $s.getFilters(e,t)}))},getMetadata:function(e){return Bs(this,void 0,void 0,(function*(){if(!co(e)||void 0!==e.inLibrary)return e;const t=ni.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const n=fo(e),r=new _s(`Users/${Ms.userId}/Items/${n}`,void 0,{pageSize:1,maxSize:1}),i=yield bi(r,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return $s.getPlayableUrl(e)},getPlaybackType:function(e){return Bs(this,void 0,void 0,(function*(){return $s.getPlaybackType(e)}))},lookup:function(e,t,n=10,r){return Bs(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return bi(mo(si.Media,t,{Artists:e},i),{timeout:r})}))},store:function(e,t){return Bs(this,void 0,void 0,(function*(){const n=fo(e),r=`Users/${Ms.userId}/FavoriteItems/${n}`;t?yield $s.post(r):yield $s.delete(r)}))},observeIsLoggedIn:function(){return Ls.pipe(Kr())},isConnected:function(){return!!Ms.token},isLoggedIn:Ds,login:function(){return Ns(this,void 0,void 0,(function*(){if(!Ds()){zs.log("connect");try{const e=yield Na(lo,Ms);if(e){const{serverId:t,userId:n,token:r}=JSON.parse(e);Ms.serverId=t,Ms.userId=n,Rs(r)}}catch(e){zs.error(e)}}}))},logout:function(){return Ns(this,void 0,void 0,(function*(){zs.log("disconnect"),Ms.clear(),Rs(""),Ls.next(!1)}))}},lo=oo;function co(e){switch(e.itemType){case si.Album:return!e.synthetic;case si.Folder:return!1;default:return!0}}function uo(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>mo(e,t)})}function mo(e,t,n,r){const i=Object.assign({ParentId:po(),SortBy:"SortName",SearchTerm:t.trim()},n);if(e===si.Artist)return new _s("Artists",Object.assign(Object.assign({},i),{UserId:Ms.userId}),r);switch(e){case si.Media:i.IncludeItemTypes="Audio",i.SortBy="AlbumArtist,Album,SortName";break;case si.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case si.Playlist:i.IncludeItemTypes="Playlist"}return ho(i,r)}function ho(e,t){return new _s(`Users/${Ms.userId}/Items`,e,t)}function po(){const e=Ms.libraryId;if(!e)throw new mi;return e}function fo({src:e}){const[,,t]=e.split(":");return t}var yo=n(2752),vo=n.n(yo);const bo=new Z("lastfm"),go={get token(){return bo.getString("token")},set token(e){bo.setString("token",e)},get userId(){return bo.getString("userId")},set userId(e){bo.setString("userId",e)},get sessionKey(){return bo.getString("sessionKey")},set sessionKey(e){bo.setString("sessionKey",e)},get firstScrobbledAt(){return bo.getString("firstScrobbledAt")},set firstScrobbledAt(e){bo.setString("firstScrobbledAt",e)},get playCount(){return bo.getNumber("playCount")},set playCount(e){bo.setNumber("playCount",e)},clear(){bo.clear()}};var wo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Eo=new K("lastfmApi"),ko=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}getSignature(e){const t=Object.keys(e);let n="";return t.sort(),t.forEach((t=>n+=t+e[t])),n+=xi,vo()(n)}scrobble(e){return wo(this,void 0,void 0,(function*(){Eo.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const n=e[0],r=String(n.playedAt);yield this.post(Object.assign({method:t,timestamp:r},this.getScrobbleParams(n)))}else if(e.length>0){const n={};e.forEach(((e,t)=>{const r=this.getScrobbleParams(e);n[`timestamp[${t}]`]=String(e.playedAt),Object.keys(r).forEach((e=>{n[`${e}[${t}]`]=r[e]}))})),yield this.post(Object.assign({method:t},n))}}))}updateNowPlaying(e){return wo(this,void 0,void 0,(function*(){Eo.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){Eo.log('Failed to update "now playing":',{item:e}),Eo.error(t)}}))}getUserInfo(){return wo(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:go.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return wo(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:ki,format:"json"}))}`,n=yield fetch(t,{method:"GET"});if(!n.ok)throw n;return n.json()}))}post(e){return wo(this,void 0,void 0,(function*(){const t=go.token,n=go.sessionKey;e=Object.assign(Object.assign({},e),{api_key:ki,token:t,sk:n});const r=this.getSignature(e),i=`${new URLSearchParams(e)}&api_sig=${r}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.track_mbid&&(t.mbid=e.track_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,n=t){if(e){const r=e["#text"];if(r&&!r.endsWith(this.placeholderImage))return{url:r,width:t,height:n}}}},xo=ko;var So=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const To=new K("lastfmAuth"),Po=new ct(""),Ao=new ct("");function Io(){return Po.pipe(Kr())}function Co(){return""!==Po.getValue()}function Mo(){return Io().pipe(He((e=>""!==e)),Kr())}Io().pipe(Ue((e=>!!e)),rt((()=>function(){return So(this,void 0,void 0,(function*(){try{yield xo.getUserInfo()}catch(e){401===e.status?(go.clear(),Ao.next(""),Po.next("")):To.error(e)}}))}()))).subscribe(To),Ao.next(go.sessionKey),Po.next(go.token);class Oo{constructor(e,t,n,r){this.album=r,this.defaultConfig={pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),n),{page:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new Wi(((e=this.defaultConfig.pageSize)=>{return n=this,r=void 0,a=function*(){const n=this.pageNumber,r=yield xo.get(Object.assign(Object.assign({},s),{page:n,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:o,itemType:l}=t(r);return{items:this.createMediaObjects(l,i),total:a,atEnd:o}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case si.Artist:return t.map((e=>this.createMediaArtist(e)));case si.Album:return t.map((e=>this.createMediaAlbum(e)));case si.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,n,r,i,a,s;const o=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(si.Media,e)),{mediaType:li.Audio,src:o?`lastfm:listen:${o}`:`lastfm:track:${Ia()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(n=this.album)||void 0===n?void 0:n.name)||(null===(r=e.album)||void 0===r?void 0:r["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(s=e.album)||void 0===s?void 0:s.mbid),track_mbid:e.mbid,duration:Number(e.duration)||0,track:l&&Number(l)||void 0,inLibrary:"loved"in e?!!Number(e.loved):"user.getLovedTracks"===this.method||void 0,playedAt:o})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(si.Album,e)),{src:`lastfm:album:${Ia()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(si.Artist,e)),{src:`lastfm:artist:${Ia()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:si.Album,title:"Top Tracks",thumbnails:xo.createThumbnails(e.image),src:`lastfm:top-tracks:${Ia()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:xo.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new wi([t]),r=new Oo({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:si.Album}}),{maxSize:100,playCountName:"userplaycount"});return new Qi(n,r)}createAlbumPager(e){return new Oo({method:"album.getInfo",album:e.name,artist:e.artist.name,user:go.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,n=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:n,total:n.length,atEnd:!0,itemType:si.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new Oo({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:si.Media}}),{pageSize:10,maxSize:10})}}Oo.minPageSize=10,Oo.maxPageSize=200;const $o=Oo;class No extends $o{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:go.userId}),(({recenttracks:e})=>{var t,n;const r=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],s="true"===(null===(n=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===n?void 0:n.nowplaying),o=Number(r.page)||1,l=Number(r.totalPages)||1,c=1===l||o===l,u=Number(r.total)||void 0;return s&&a.shift(),{items:a,total:u,atEnd:c,itemType:si.Media}}),t)}}var zo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const jo={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Lo={id:"lastfm/history",title:"History",icon:"clock",itemType:si.Media,search:({startAt:e=0}={})=>new No(e?{to:e}:void 0)},Do={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,search:()=>new No},Ro={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new $o({method:"user.getLovedTracks",user:go.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},n=e.track,r=n?Array.isArray(n)?n:[n]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,s=1===a||i===a;return{items:r,total:Number(t.total)||void 0,atEnd:s,itemType:si.Media}}))},Fo={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",serviceType:Dr.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[Do],sources:[Vo("user.getTopTracks",{title:"Top Tracks",itemType:si.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),Vo("user.getTopAlbums",{title:"Top Albums",itemType:si.Album,layout:jo}),Vo("user.getTopArtists",{title:"Top Artists",itemType:si.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:jo}),Ro,Lo],labels:{[ii.AddToLibrary]:"Love on last.fm",[ii.RemoveFromLibrary]:"Unlove on last.fm"},canRate:()=>!1,canStore:function(e){var t;return e.itemType===si.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},compareForRating:function(e,t){var n,r,i;const[a]=e.src.split(":"),[s]=t.src.split(":");return a===s&&(e.itemType===si.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(n=e.artists)||void 0===n?void 0:n[0])&&Bo(e.title,t.title)&&Bo(null===(r=e.artists)||void 0===r?void 0:r[0],null===(i=t.artists)||void 0===i?void 0:i[0])))},getMetadata:function(e){return zo(this,void 0,void 0,(function*(){if(e.itemType!==si.Media||void 0!==e.inLibrary)return e;const t={method:"track.getInfo",user:go.userId};if(e.track_mbid)t.mbid=e.track_mbid;else{const{title:n,artists:r=[]}=e;if(t.artist=r[0],t.track=n,!t.artist)return e}const{track:n}=yield xo.get(t);if(!n||"error"in n)throw Error((null==n?void 0:n.message)||"Not found");{const t={},{album:r,wiki:i}=n;return r&&(t.album=r.title,t.albumArtist=r.artist,e.thumbnails||(t.thumbnails=xo.createThumbnails(r.image))),!e.description&&i&&(t.description=P(i.content||i.summary)),!e.year&&i&&(t.year=i.published&&new Date(i.published).getFullYear()||void 0),Object.assign(Object.assign(Object.assign({},e),t),{inLibrary:ni.getInLibrary(e,!!Number(n.userloved)),playCount:Number(n.userplaycount)||0,globalPlayCount:Number(n.playcount)||0})}}))},store:function(e,t){return zo(this,void 0,void 0,(function*(){if(e.itemType===si.Media){const{title:n,artists:r=[]}=e,i=r[0];n&&i&&(yield xo.post({method:t?"track.love":"track.unlove",track:n,artist:i}))}}))},observeIsLoggedIn:Mo,isConnected:function(){return!!go.token},isLoggedIn:Co,login:function(){return So(this,void 0,void 0,(function*(){if(!Co()){To.log("connect");try{const e=yield function(){return So(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/lastfm/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});e(n.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${ki}&cb=${r}`,"last.fm","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return So(this,void 0,void 0,(function*(){const t="auth.getSession",n={api_key:ki,token:e,method:t},r=xo.getSignature(n),i=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${ki}&token=${e}&api_sig=${r}&format=json`);if(!i.ok)throw i;const{session:a}=yield i.json();return go.userId=a.name,go.token=e,go.sessionKey=a.key,a.key}))}(e);Ao.next(t),Po.next(e)}catch(e){To.error(e)}}}))},logout:function(){return So(this,void 0,void 0,(function*(){To.log("disconnect"),go.clear(),Ao.next(""),Po.next("")}))}},_o=Fo;function Bo(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Vo(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:n="overall"}={})=>new $o({method:e,period:n,user:go.userId},(n=>{const[,r]=e.toLowerCase().split("."),i=n[r.slice(3)],a=i["@attr"],s=i[r.slice(6,-1)],o=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||o===l;return{items:s,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}var Uo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ho=new K("localdb/listens"),qo=[],Yo=new ct(qo);class Ko extends Yt.cp{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const Wo=new Ko;function Go(){return Yo.pipe(Ue((e=>e!==qo)))}function Jo(e,t,n){const r=Math.min(e/2,240);return t=Math.floor(t/1e3),(n=Math.floor(n/1e3))-t>r}function Qo(e){return Uo(this,void 0,void 0,(function*(){try{e.length>0&&(yield Wo.items.bulkPut(e))}catch(e){Ho.error(e)}}))}function Xo(e,t=30){return Math.round(e.playedAt/t)}function Zo(e,t,n=5){const r=t.playedAt,i=r-n,a=r+t.duration+n;for(const n of e){if(n.playedAt<i)return;if(n.playedAt>i&&n.playedAt<a&&nl(t,n,.5))return n}}function el(e,t){const n=tl();return function(e,t,n=5){const r=t.playedAt;if(r)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<r)return;const s=e[i],o=s.playedAt-n,l=s.playedAt+s.duration+n;if(r>o&&r<l&&nl(s,t,.75))return s}}(n,e,t)||ml(n,e)}function tl(){return Yo.getValue()}function nl(e,t,n){return T(e.title,t.title,n)}function rl(e){return Uo(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,n=Math.floor(Date.now()/1e3)-1209600,r=yield Wo.items.where(t).equals(0).toArray();yield Qo(r.filter((e=>e.playedAt<n)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}Uo(void 0,void 0,void 0,(function*(){try{yield rl("lastfm"),yield rl("listenbrainz")}catch(e){Ho.error(e)}(0,Yt.k7)((()=>Wo.items.orderBy("playedAt").reverse().toArray())).subscribe(Yo)}));const il=new Le,al=new Le,sl=new Le;var ol=n(1416),ll=n.n(ol);const cl=new Z("lookup"),ul={get preferPersonalMedia(){return cl.getBoolean("preferPersonalMedia")},set preferPersonalMedia(e){cl.setBoolean("preferPersonalMedia",e)}},dl=/\s*[\s[({](with\s|featuring\s|feat[\s.]+|ft[\s.]+).+$/i;function ml(e,t,n=[],r){const{artist:i,title:a}=Al(t);if(!i||!a)return;let s=hl(e,t,n);return ul.preferPersonalMedia&&(s=S(s,(e=>{const t=nf(e);return!!t&&of(t)}))),r&&(s=S(s,(e=>e.src.startsWith(`${r}:`)))),s[0]}function hl(e,t,n,r){let i=[];return n.length>0&&(i=e.filter((e=>e.isrc&&n.includes(e.isrc)))),i=0===i.length?e.filter((e=>fl(e,t))):S(i,(e=>fl(e,t))),0===i.length&&(i=e.filter((e=>pl(e,t,!0,!0)))),r||(0===i.length&&(i=e.filter((e=>pl(e,t,!0,!1)))),0===i.length&&(i=e.filter((e=>pl(e,t,!1,!1))))),i=S(i,(e=>wl(e,t))),i=S(i,(e=>wl(e,t)&&e.track===t.track)),i}function pl(e,t,n,r){return!(!function(e,t,n){const r=t.title;return!!r&&(!!Sl(r,e.title)||(n?bl(e,t,!0):!!gl(e,e.title,r)||(!!gl(e,El(e.title),El(r))||bl(e,t,!1))))}(e,t,n)||!yl(e,t,r))||!(r||n||!function(e,t){return!(!yl(e,t,!0)||!kl(e,t))||(!(!yl(e,t,!1)||!kl(e,t))||!!T(xl(e),xl(t)))}(e,t))}function fl(e,t){return!!(t.src===e.src||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid||t.track_mbid&&t.track_mbid===e.track_mbid)}function yl(e,t,n){var r;const i=null===(r=t.artists)||void 0===r?void 0:r[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const s=a[0];if(!s)return!1;if(Sl(i,s))return!0;if(n)return!1;if(Sl(Pl(i),Pl(s)))return!0;if(Sl(Il(i),Il(s)))return!0;const o=t.albumArtist;return!!(o&&Sl(Pl(o),Pl(s))||Sl(Il(i),e.albumArtist)||function(e,t){const n=vl(t.artists),r=vl(e.artists);return(r.length>1||n.length>1)&&n.filter((e=>r.find((t=>Sl(Pl(e),Pl(t)))))).length>0}(e,t)||function(e,t){var n,r;const i=Pl((null===(n=t.artists)||void 0===n?void 0:n[0])||""),a=Pl((null===(r=e.artists)||void 0===r?void 0:r[0])||""),[s,o]=i.length>a.length?[i,a]:[a,i];return!!(Tl(s,`(${o})`)||Tl(s,`[${o}]`)||Tl(s,`{${o}}`))}(e,t))}function vl(e){return e.join("|").split(/\s*[,;&|/x×]\s*/)}function bl(e,t,n){if(!wl(e,t))return!1;if(e.track!==t.track)return!1;const r=Pl(e.title),i=Pl(t.title);return n?Sl(r,i):!(!r.startsWith(i)&&!i.startsWith(r))||T(r,i,.75)}function gl(e,t,n){if(t=Pl(t),Sl(n=Pl(n),t))return!0;const[,...r]=e.artists||[];if(r.length>0){const e=r.length>1?` & ${r.pop()}`:"";if(Sl(n,`${t} (feat. ${r.join(", ")}${e})`))return!0}return!(!dl.test(n)||!Sl(Il(n),t))||!(!dl.test(e.title)||!Sl(n,Il(t)))}function wl(e,t){return!(!e.album||!t.album)&&(!(!t.release_mbid||t.release_mbid!==e.release_mbid)||Sl(Pl(t.album),Pl(e.album)))}function El(e){return(e=(e=e.replace(/\s*\((19|20)\d\d(\sDigital)?\sRemaster\)$/gi,"")).replace(/\s*\((Album|Single)(\s+Version)?\)$/gi,"")).replace(/\s*-\s*(Album|Single)(\s+Version)?$/gi,"")}function kl(e,t){return T(Pl(t.title,!0).toLowerCase(),Pl(e.title,!0).toLowerCase())}function xl(e){const{artist:t,title:n}=Al(e);return`${Pl(t,!0)}-${Pl(n,!0)}`.toLowerCase()}function Sl(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Tl(e,t=""){const n=e.length-t.length;for(let r=0;r<=n;r++)if(Sl(e.substring(r,r+t.length),t))return!0;return!1}function Pl(e,t){let n=ll()(e).replace(/\s\s+/g," ").trim();return t&&(n=n.replace(/[^\w\s]/g,"")),n}function Al(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function Il(e){return e.replace(dl,"")}var Cl,Ml=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Ol=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const $l=new K("lookup");class Nl{constructor(e){this.item=e,this.controller=new AbortController,Cl.set(this,void 0),Nl.current&&Nl.current.cancel(),Nl.current=this}get cancelled(){return this.signal.aborted}get promise(){return Ol(this,Cl,"f")}cancel(){this.controller.abort("Cancelled")}find(){return Ml(this,void 0,void 0,(function*(){const e=this.item;let t;!function(e){il.next({lookupItem:e})}(e);try{(function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)})(this,Cl,this.findItem(e),"f"),t=yield Ol(this,Cl,"f"),t&&([Nl.lastFoundServiceId]=t.src.split(":"))}catch(e){this.cancelled||$l.error(e)}return!t&&this.cancelled?function(e){sl.next({lookupItem:e})}(e):function(e,t){al.next({lookupItem:e,foundItem:t?x(t,e):void 0})}(e,t),Nl.current===this&&(Nl.current=null),t}))}get signal(){return this.controller.signal}findItem(e){return Ml(this,void 0,void 0,(function*(){const t=el(e);if(t&&Wp(t))return t;const{link:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["link"]),i=n&&rf(n)?Object.assign(Object.assign({},r),n):void 0;if(i&&Wp(i))return i;let a=[],s=[];const{artist:o,title:l}=Al(e);if(o&&l){s=yield this.getISRCs(e);const t=nf(n);if(t&&(a=yield this.serviceLookup(t,e,s),0===a.length&&("plex"===t.id||"tidal"===t.id))){const t=tf("plex-tidal");t&&(a=yield this.serviceLookup(t,e,s))}0===a.length&&s.length>0&&(a=yield this.lookupByISRC(s)),0===a.length&&(a=yield this.multiServiceLookup(e,s,t))}return ml(a,e,s,Nl.lastFoundServiceId)||t||i}))}serviceLookup(e,t,n,r){return Ml(this,void 0,void 0,(function*(){this.throwIfCancelled();try{if(e.lookup&&e.isLoggedIn()){const{artist:i,title:a}=Al(t),s=e=>String(e).replace(/[([{}].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," ");return hl(yield e.lookup(s(t.albumArtist||Il(i)),s(Il(a)),10,2e3),t,n,r)}}catch(e){$l.error(e)}return[]}))}multiServiceLookup(e,t,n){return Ml(this,void 0,void 0,(function*(){this.throwIfCancelled();const r=Jp().filter((e=>e!==n&&e.isLoggedIn()));return 0===r.length?[]:(yield Promise.all([...r.map((n=>this.serviceLookup(n,e,t)))])).flat()}))}lookupByISRC(e){return Ml(this,void 0,void 0,(function*(){this.throwIfCancelled();const t=this.getISRCServices();return 0===t.length?[]:(yield Promise.all([...t.map((t=>t.lookupByISRC(e,10,2e3)))])).flat()}))}getISRCs(e){return Ml(this,void 0,void 0,(function*(){if(e.isrc)return[e.isrc];if(this.getISRCServices().length>0)try{return yield Gl.getISRCs(e,this.signal)}catch(e){$l.error(e)}return[]}))}getISRCServices(){return Jp().filter((e=>!!e.lookupByISRC&&e.isLoggedIn()))}throwIfCancelled(){if(this.cancelled)throw Error(this.signal.reason)}}Cl=new WeakMap,Nl.current=null,Nl.lastFoundServiceId="";class zl extends Gi{constructor(e){super((()=>{return t=this,n=void 0,i=function*(){const t=yield Gl.get(`release/${e}`,{inc:"recordings+artist-credits+isrcs"}),{media:[{tracks:n=[]}={}]=[]}=t;return n.map((e=>Kl(t,e)))},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}))}}const jl={CD:1,SACD:2,MiniDisc:3,DAT:4,"Digital Media":5,DCC:6,HDCD:7,"USB Flash Drive":8,slotMusic:9,UMD:10,"CD-R":11,"8cm CD":12,"Blu-spec CD":13,"SHM-CD":14,HQCD:15,"Hybrid SACD":16,"CD+G":17,"8cm CD+G":18,"Enhanced CD":19,"Data CD":20,"DTS CD":21,Playbutton:22,"Music Card":23,VinylDisc:24,'3.5" Floppy Disk':25,"SHM-SACD":26,CED:27,"Copy Control CD":28,"SD Card":29,"Hybrid SACD (CD layer)":30,"Hybrid SACD (SACD layer)":31,PlayTape:32,HiPac:33,"Floppy Disk":34,"Zip Disk":35,"VinylDisc (CD side)":36};var Ll=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Dl="https://musicbrainz.org/ws/2",Rl=new class{constructor(e=1e3,t=1/0){this.period=e,this.maxRequests=t,this.requests=[],this.currentRequest$=new Le,this.lastFetchTime=0,this.timerId=void 0}get size(){return this.requests.length}fetch(e){return t=this,n=void 0,i=function*(){const t=Fe(this.currentRequest$.pipe(Ue((t=>t===e)),rt((e=>{var t;if(null===(t=e.signal)||void 0===t?void 0:t.aborted)throw Error(e.signal.reason);{this.lastFetchTime=Date.now();const t=[],{signal:n,timeout:r}=e;n&&t.push(n),r&&t.push(AbortSignal.timeout(r));const i=function(e){const t=new AbortController;for(const n of e){if(n.aborted)return t.abort(),n;n.addEventListener("abort",(()=>t.abort(n.reason)),{signal:t.signal})}return t.signal}(t);return fetch(new Request(e.url,Object.assign(Object.assign({},e),{signal:i})))}}))));return this.addRequest(e),t},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}addRequest(e){if(this.flush(),this.size>=this.maxRequests)throw Error("Too many requests");this.requests.push(e),this.startTimer()}startTimer(){if(!this.timerId){const e=Date.now()-this.lastFetchTime;if(e<this.period){const t=this.period-e;this.timerId=setTimeout((()=>{this.timerId=void 0,this.nextRequest()}),t)}else this.nextRequest()}}nextRequest(){this.flush();const e=this.requests.shift();e&&(this.currentRequest$.next(e),this.size>0&&this.startTimer())}flush(){const[e,t]=m(this.requests,(e=>{var t;return null===(t=e.signal)||void 0===t?void 0:t.aborted}));for(const t of e)this.currentRequest$.next(t);this.requests.length=0,this.requests.push(...t)}}(1200,5);function Fl(e,t,n){return Ll(this,void 0,void 0,(function*(){const r={signal:n,timeout:2e3},i=Array.isArray(e),a=(i?e:[e]).map(((e,t)=>({item:e,index:t}))),s=[],o=[],l=[],c=[],u=[];for(const e of a){const{recording_mbid:n,release_mbid:r,track_mbid:i,isrc:d}=e.item;n&&r&&i&&d?s.push(e):i?o.push(e):n&&r?l.push(e):t?s.push(e):n?l.push(e):d?u.push(e):r&&1===a.length?c.push(e):s.push(e)}const d=(yield Promise.all([Promise.resolve(s),_l(o,r),Bl(l,r),Ul(c,r),Vl(u,r)])).flat(),m=a.map((e=>d.find((t=>t.index===e.index)).item));return i?m:m[0]}))}function _l(e,t){return Ll(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:n=[]}=yield ql("/recording",{query:e.map((e=>`tid:${e.item.track_mbid}`)).join(" OR ")},t),r=Yl(n);return e.map((e=>{const{item:t,index:n}=e,i=t.track_mbid,a=r.filter((e=>e.track_mbid===i)),s=ml(a,t);if(s){const{artist_mbids:e,release_mbid:r,recording_mbid:a}=s,o=Hl({artist_mbids:e,release_mbid:r,recording_mbid:a},t,s);return Xr({match:e=>e.track_mbid===i,values:o}),{item:Object.assign(Object.assign({},t),o),index:n}}return e}))}))}function Bl(e,t){return Ll(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:n=[]}=yield ql("/recording",{query:e.map((e=>`rid:${e.item.recording_mbid}`)).join(" OR ")},t),r=Yl(n);return e.map((e=>{const{item:t,index:n}=e,i=t.recording_mbid,a=t.release_mbid;let s=r.filter((e=>e.recording_mbid===i));s=S(s,(e=>e.release_mbid===a));const o=ml(s,t);if(o){const{artist_mbids:e,release_mbid:r,track_mbid:a}=o,s=Hl({artist_mbids:e,release_mbid:r,track_mbid:a},t,o);return Xr({match:e=>e.recording_mbid===i,values:s}),{item:Object.assign(Object.assign({},t),s),index:n}}return e}))}))}function Vl(e,t){return Ll(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:n=[]}=yield ql("/recording",{query:e.map((e=>`isrc:${e.item.isrc}`)).join(" OR ")},t);return e.map((e=>{const{item:t,index:r}=e,i=t.isrc,a=ml(Yl(n.filter((e=>{var t;return null===(t=e.isrcs)||void 0===t?void 0:t.includes(i)}))),t);if(a){const{recording_mbid:e,artist_mbids:n,release_mbid:s,track_mbid:o}=a,l=Hl({recording_mbid:e,artist_mbids:n,release_mbid:s,track_mbid:o},t,a);return Xr({match:e=>e.isrc===i,values:l}),{item:Object.assign(Object.assign({},t),l),index:r}}return e}))}))}function Ul(e,t){return Ll(this,void 0,void 0,(function*(){if(1!==e.length)return e;const[n]=e,{item:r,index:i}=n,a=r.release_mbid,s=r.recording_mbid,o=r.src,l=new zl(a),c=yield bi(l,t),u=s?c.find((e=>e.recording_mbid===s)):ml(c,r);if(u){const{recording_mbid:e,artist_mbids:t,track_mbid:n}=u,s=Hl({recording_mbid:e,artist_mbids:t,track_mbid:n},r,u);return Xr({match:t=>t.release_mbid===a&&(e?t.recording_mbid===e:t.src===o),values:s}),[{item:Object.assign(Object.assign({},r),s),index:i}]}return e}))}function Hl(e,t,n){let{duration:r,track:i,year:a,isrc:s,albumArtist:o}=t;return r=r||n.duration,i=i||n.track,a=a||n.year,s=s||n.isrc,o=o||n.albumArtist,Object.assign(Object.assign({},e),{duration:r,track:i,year:a,isrc:s,albumArtist:o})}function ql(e,t={},n={}){return Ll(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`;const r=new Request(`${Dl}/${e}`,Object.assign(Object.assign({},n),{method:"GET",headers:{"User-Agent":"ampcast/0.9.5 ( rekkyrosso@gmail.com )"}})),i=yield Rl.fetch(r);if(!i.ok)throw i;return i.json()}))}function Yl(e){let t=[];for(const n of e){const e=n.releases||[];for(const r of e){const e=r.status||"",i=r.country||"",a=r.media||[];for(const s of a){const a=s.format||"",o=s.track||[];for(const s of o){s.recording=n;const o=Kl(r,s,{status:e,country:i,format:a});t.push(o)}}}}return t=S(t,(e=>"Official"===e.musicBrainz.status)),t.sort(((e,t)=>(jl[e.musicBrainz.format]||99)-(jl[t.musicBrainz.format]||99))),t}function Kl(e,t,n){var r;const i=t.recording,[a]=Wl(e)||[],s=Wl(i);return{itemType:si.Media,mediaType:li.Audio,src:`musicbrainz:track:${t.id}`,externalUrl:`https://musicbrainz.org/recording/${i.id}`,title:t.title,artists:null==s?void 0:s.map((e=>e.name)),album:e.title,albumArtist:null==a?void 0:a.name,duration:t.length/1e3||0,track:Number(t.number),recording_mbid:i.id,track_mbid:t.id,release_mbid:e.id,artist_mbids:null==s?void 0:s.map((e=>e.id)),isrc:null===(r=i.isrcs)||void 0===r?void 0:r[0],year:new Date(i["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,musicBrainz:n}}function Wl(e){var t;return null===(t=e["artist-credit"])||void 0===t?void 0:t.map((e=>e.artist))}const Gl={get:ql,getISRCs:function(e,t){return Ll(this,void 0,void 0,(function*(){const{recording_mbid:n,release_mbid:r,track_mbid:i}=e,a={signal:t,timeout:2e3};if(n){const{isrcs:e=[]}=yield ql(`/recording/${n}`,{inc:"isrcs"},a);return e}if(i){const{recordings:[{isrcs:e=[]}={}]}=yield ql("/recording",{query:`tid:${i}`},a);return e}if(r){const t=new zl(r),n=ml(yield bi(t,a),e);return(null==n?void 0:n.isrc)?[n.isrc]:[]}return[]}))},addMetadata:Fl},Jl=new Z("listenbrainz"),Ql={get token(){return Jl.getString("token")},set token(e){Jl.setString("token",e)},get userId(){return Jl.getString("userId")},set userId(e){Jl.setString("userId",e)},get firstScrobbledAt(){return Jl.getString("firstScrobbledAt")},set firstScrobbledAt(e){Jl.setString("firstScrobbledAt",e)},clear(){Jl.clear()}};var Xl=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Zl=new K("listenbrainzApi"),ec=new class{constructor(){this.apiHost="https://api.listenbrainz.org/1",this.webHost="https://musicbrainz.org",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}store(e,t){return Xl(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const n="feedback/recording-feedback",r={score:t?1:0};e.recording_msid&&(r.recording_msid=e.recording_msid),e.recording_mbid&&(r.recording_mbid=e.recording_mbid),yield this.post(n,r)}}))}addUserData(e){return Xl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getInLibrary(e);Xr(e.map(((e,n)=>({match:t=>bu(t,e),values:{inLibrary:t[n]}}))))}}))}addToPlaylist(e,t){return Xl(this,void 0,void 0,(function*(){t=(t=yield Fl(t,!1)).filter((e=>e.recording_mbid));const[,,n]=e.src.split(":");return this.post(`playlist/${n}/item/add`,{playlist:{track:t.map((e=>this.createTrack(e)))}})}))}createPlaylist(e,{description:t="",isPublic:n,items:r=[]}={}){return Xl(this,void 0,void 0,(function*(){const i=Ql.userId;return r=(r=yield Fl(r,!1)).filter((e=>e.recording_mbid)),this.post("playlist/create",{playlist:{extension:{"https://musicbrainz.org/doc/jspf#playlist":{creator:i,public:n}},creator:i,title:e,annotation:t,track:r.map((e=>this.createTrack(e)))}})}))}createTrack(e){var t,n;const r=this.webHost,i=e.recording_mbid,a=e.release_mbid||"";return{title:e.title,id:i,identifier:i?`${r}/recording/${i}`:"",creator:null===(t=e.artists)||void 0===t?void 0:t.join(" & "),trackNum:e.track,duration:e.duration,extension:{"https://musicbrainz.org/doc/jspf#track":{artist_identifiers:(null===(n=e.artist_mbids)||void 0===n?void 0:n.map((e=>`${r}/artist/${e}`)))||[],release_identifier:a?`${r}/release/${a}`:""}},album:e.album||""}}getInLibrary(e){return Xl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,n]=m(e,(e=>!!e.recording_mbid)),r=t.map((e=>e.recording_mbid)),i=n.map((e=>e.recording_msid)),a={};r.length>0&&(a.recording_mbids=r),i.length>0&&(a.recording_msids=i);const{feedback:s}=yield this.post(`feedback/user/${Ql.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=s.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return Xl(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${Ql.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return Xl(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${Ql.userId}/listen-count`);return e}))}getListens(e){return Xl(this,void 0,void 0,(function*(){return yield this.get(`user/${Ql.userId}/listens`,e)}))}scrobble(e){return Xl(this,void 0,void 0,(function*(){e.length>0&&(Zl.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return Xl(this,void 0,void 0,(function*(){Zl.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){Zl.log('Failed to update "now playing":',{item:e}),Zl.error(t)}}))}get(e,t,n){return Xl(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const r=yield this.fetch(e,{method:"GET"},n);if(!r.ok||204===r.status)throw r;return r.json()}))}post(e,t){return Xl(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return(yield this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n},!0)).json()}))}fetch(e,t,n=!1){return Xl(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),n&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${Ql.token}`})),e.startsWith("/")&&(e=e.slice(1));const r=yield window.fetch(`${this.apiHost}/${e}`,t);if(!r.ok)throw r;const i=r.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&Zl.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),r}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.9.5",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[n]=e.src.split(":");switch(n){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"tidal":case"plex-tidal":t.music_service="tidal.com";break;case"blob":case"file":t.music_service_name="Local file";break;default:{const e=tf(n);e&&(t.music_service_name=e.name)}}const r={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(r.release_name=e.album),r}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},tc=ec;var nc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function rc(e){var{href:t,className:n="",children:i=t}=e,a=nc(e,["href","className","children"]);return r.createElement("a",Object.assign({},a,{className:`external-link ${n}`,href:t,target:"_blank",rel:"noopener"}),r.createElement("span",{className:"external-link-text"},i),r.createElement(ot,{name:"link"}))}var ic=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ac(e){const t=yu.id,[n,i]=(0,r.useState)(!1),[a,s]=(0,r.useState)(""),o=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u="https://listenbrainz.org/profile/",d=r.createElement(In,{icon:yu.icon,text:`Log in to ${yu.name}`}),m=(0,r.useCallback)((()=>ic(this,void 0,void 0,(function*(){try{const e=l.current.value,t=c.current.value;Ql.userId=e,i(!0),s("Connecting…");const n=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!n.ok)throw n;const{valid:r,user_name:a}=yield n.json();if(!r)throw Error("Invalid token");if(a!==e)throw Error("Token not valid for this user");s(""),o.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e),s(e.message||e.statusText||"Error")}i(!1)}))),[]),h=(0,r.useCallback)((e=>{e.preventDefault(),m()}),[m]);return r.createElement(fn,Object.assign({},e,{className:"listenbrainz-login-dialog login-dialog",title:d,ref:o}),r.createElement("form",{id:`${t}-login`,method:"dialog",onSubmit:h},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-username`},"User:"),r.createElement("input",{type:"text",id:`${t}-username`,name:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:l})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-token`},"Token:"),r.createElement("input",{type:"password",id:`${t}-token`,name:`${t}-token`,required:!0,ref:c}))),r.createElement("p",{className:"message "+(n?"":"error")},a),r.createElement("p",{className:"listenbrainz-link service-link"},r.createElement(rc,{href:u},r.createElement(ot,{name:"listenbrainz"}),u)),r.createElement(kn,{submitText:"Login"})))}var sc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const oc=new K("listenbrainzAuth"),lc=new ct("");function cc(){return lc.pipe(Kr())}function uc(){return""!==lc.getValue()}function dc(){return cc().pipe(He((e=>""!==e)),Kr())}cc().pipe(Ue((e=>!!e)),rt((()=>function(){return sc(this,void 0,void 0,(function*(){try{yield tc.getListenCount()}catch(e){401===e.status?(Ql.clear(),lc.next("")):oc.error(e)}}))}()))).subscribe(oc),lc.next(Ql.token);var mc=n(4556),hc=n.n(mc);const pc="https://musicbrainz.org",fc=new Z("youtube"),yc={get apiKey(){return Ti||fc.getString("apiKey")},set apiKey(e){fc.setString("apiKey",e)},get clientId(){return Pi||fc.getString("clientId")},set clientId(e){fc.setString("clientId",e)},get connectedAt(){return fc.getNumber("connectedAt")},set connectedAt(e){fc.setNumber("connectedAt",e)},get enabled(){return fc.getBoolean("enabled")}};var vc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const bc=new K("youtubeAuth"),gc="https://www.googleapis.com/auth/youtube.readonly",wc=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],Ec=new ct(""),kc=new Le;function xc(){return!!yc.connectedAt}function Sc(){return""!==Pc()}function Tc(){return Ec.pipe(Kr()).pipe(He((e=>""!==e)),Kr())}function Pc(){return Ec.getValue()}function Ac(){return vc(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}function Ic(){return vc(this,void 0,void 0,(function*(){const e=yield Ac();return e.client?e.client:new Promise(((t,n)=>{e.load("client",{callback:()=>{const{apiKey:r,clientId:i}=yc,a={apiKey:r,clientId:i,discoveryDocs:wc,scope:gc};e.client.init(a).then((()=>t(e.client)),n)},onerror:n})}))}))}function Cc(){var e,t;return vc(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}Tc().pipe(Rr((e=>!e))).subscribe((e=>yc.connectedAt=e?Date.now():0)),Tc().pipe(Ue((e=>e)),Vi(1),rt((()=>Promise.all([Ac(),Ic()]))),ut((([e,t])=>{e.load("client:auth2",(()=>{e.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=t.getToken();Ec.next((null==e?void 0:e.access_token)||"")}else Ec.next("")}))}))}))).subscribe(bc),yc.enabled&&xc()&&or(Ic()).pipe(He((e=>e.getToken())),ut((e=>Ec.next((null==e?void 0:e.access_token)||""))),hr(kc)).subscribe(bc);var Mc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Oc=new K("youtubeCache");class $c extends Yt.cp{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return Mc(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){Oc.error(e)}}))}fetch(e){return Mc(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){Oc.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const Nc=new $c;var zc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},jc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Lc{constructor(e,t,n){this.defaultConfig={pageSize:Lc.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),n),this.pager=new Wi((()=>zc(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},n){return zc(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,n,r;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:si.Playlist,externalUrl:`${Fc}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),trackCount:null===(r=e.contentDetails)||void 0===r?void 0:r.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistItemsPager(e.id),isPinned:na.isPinned(i)}}createMediaItem(e){var t,n,r,i,a;return{itemType:si.Media,mediaType:li.Video,playbackType:_r.IFrame,src:`youtube:video:${e.id}`,externalUrl:qc(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(n=e.contentDetails)||void 0===n?void 0:n.duration),thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${Fc}/channel/${e}`}:void 0}createPlaylistItemsPager(e){return new Lc("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,n=0,r=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(n)+Number(r)||0}fetchPage(e,t){return zc(this,void 0,void 0,(function*(){const n=this.createCacheKey(e,t,this.pageNumber),r=yield this.getFromCache(n),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),r),{pageInfo:s,nextPageToken:o}=a,l=jc(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,n),u=null==s?void 0:s.totalResults,d=!o;return this.nextPageToken=o,this.pageNumber++,yield this.saveToCache(n,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return zc(this,void 0,void 0,(function*(){const n=`${t}/videos`,r=yield this.getFromCache(n),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Lc.videoFields}`},r);return yield this.saveToCache(n,i),i.items||[]}))}fetch(e,t,n){return zc(this,void 0,void 0,(function*(){const r=yield Ic(),i=(null==n?void 0:n.etag)?{"If-None-Match":n.etag}:void 0,{result:a,status:s,statusText:o}=yield r.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:i});if(a)return a;if(304===s&&n)return n;throw Error(o||`Error (${s})`)}))}getFromCache(e){return zc(this,void 0,void 0,(function*(){return Nc.fetch(e)}))}saveToCache(e,t){return zc(this,void 0,void 0,(function*(){this.config.noCache||(yield Nc.store(e,t))}))}createCacheKey(e,t,n){const{fields:r}=t,i=jc(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${n}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Lc.minPageSize=5,Lc.maxPageSize=50,Lc.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Lc.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const Dc=Lc;var Rc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Fc="https://www.youtube.com",_c={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},Bc={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:si.Media,mediaType:li.Video,lockActionsStore:!0,layout:_c,defaultHidden:!0,search:()=>new Dc("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:Dc.videoFields})},Vc={id:"youtube/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,mediaType:li.Video,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Owner","LastPlayed"]},search(){return new Gi((()=>Rc(this,void 0,void 0,(function*(){return p(tl().filter((e=>e.src.startsWith("youtube:"))),"src")}))))}},Uc={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,secondaryLayout:_c,search:()=>new Dc("/playlists",{mine:"true",part:"snippet,contentDetails",fields:Dc.playlistFields})};function Hc(e=""){if(e.startsWith("youtube:"))return e;const t=hc()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function qc(e){return`${Fc}/watch?v=${e}`}function Yc(e){return Rc(this,void 0,void 0,(function*(){const t=qc(e),n=yield fetch(`${Fc}/oembed?url=${t}&format=json`);if(!n.ok)switch(n.status){case 401:throw Error("Embedding prevented by channel owner");case 403:throw Error("Private video");case 404:throw Error("Video does not exist");default:throw Error(`${n.statusText} (${n.status})`)}const r=yield n.json();return{itemType:si.Media,mediaType:li.Video,playbackType:_r.IFrame,src:`youtube:video:${e}`,externalUrl:t,title:r.title,aspectRatio:r.width/r.height||16/9,duration:0,track:0,thumbnails:[{url:r.thumbnail_url,width:r.thumbnail_width,height:r.thumbnail_height}],owner:{name:r.author_name,url:r.author_url},playedAt:0}}))}const Kc={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",serviceType:Dr.PublicMedia,primaryMediaType:li.Video,get disabled(){return!yc.enabled},defaultHidden:!0,defaultNoScrobble:!0,internetRequired:!0,restrictedAccess:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"search",itemType:si.Media,mediaType:li.Video,layout:_c,searchable:!0,search:({q:e=""}={})=>e?new Dc("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:Dc.maxPageSize,noCache:!0}):new wi}],sources:[Bc,Vc,Uc],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},_c),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new Dc("/playlists",{id:t,part:"snippet,contentDetails",fields:Dc.playlistFields})}}},getPlaybackType:function(){return Rc(this,void 0,void 0,(function*(){return _r.IFrame}))},observeIsLoggedIn:Tc,isConnected:xc,isLoggedIn:Sc,login:function(){return vc(this,void 0,void 0,(function*(){if(!Sc()){bc.log("connect");try{const e=yield function(){return vc(this,void 0,void 0,(function*(){const e=google.accounts.oauth2;return new Promise(((t,n)=>{const r=e.initTokenClient({client_id:yc.clientId,scope:gc,prompt:"",callback:e=>{e.error?n(e.error_description):t(e.access_token)},error_callback:e=>{n(e.message)}});r.requestAccessToken()}))}))}();Ec.next(e)}catch(e){bc.error(e)}}}))},logout:function(){return vc(this,void 0,void 0,(function*(){bc.log("disconnect"),kc.next(void 0);try{const e=Pc();e&&(yield Cc()).revoke(e,(()=>Ec.next("")))}catch(e){}yc.connectedAt=0,Ec.next("")}))}},Wc=Kc;const Gc=new K("ListenBrainzHistoryPager");class Jc{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new ct(-1),this.nextPageParams=void 0,this.pager=new Wi(((t=50)=>{return n=this,r=void 0,a=function*(){try{const{payload:n}=yield tc.get(`user/${Ql.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),r=n.listens,i=this.createItems(r),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:r.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(Rr((e=>-1===e)),Kr())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new de,this.subscriptions.add(this.pager.observeAdditions().pipe(rt((e=>tc.addUserData(e)))).subscribe(Gc)),this.fetchListenCount&&this.subscriptions.add(or(tc.getListenCount()).pipe(ut((e=>this.size$.next(e)))).subscribe(Gc)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n,r;const i=e.track_metadata,a=i.additional_info,s=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,o=this.getPlayableSrc(a)||"";return{itemType:si.Media,mediaType:o.startsWith("youtube:")?li.Video:li.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:s?`${pc}/recording/${s}`:void 0,recording_mbid:s,recording_msid:e.recording_msid||void 0,release_mbid:null===(n=i.mbid_mapping)||void 0===n?void 0:n.release_mbid,artist_mbids:null===(r=i.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:e.listened_at,link:{src:o,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=hc()(e);if(t)return qc(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const n=e.origin_url;if(n){if(n.includes("apple.com"))return this.getAppleSrc(n);if(n.includes("spotify.com"))return this.getSpotifySrc(n);if(n.includes("tidal.com"))return"tidal:";if(/youtu\.?be/.test(n))return Hc(n)}const r=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i=Jp().map((e=>e.id));for(const e of i)if(r.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Jc.maxPageSize=100;const Qc=Jc;class Xc{constructor(){let e=0;this.pager=new Wi(((t=50)=>{return n=this,r=void 0,a=function*(){try{const n=yield tc.get(`feedback/user/${Ql.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const r=this.createItems(n.feedback),i=n.total_count;return{items:r,total:i,atEnd:n.offset+r.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e))).filter(l)}createItem(e){var t,n;const r=e.track_metadata;if(!r)return;const i=r.additional_info,a=e.recording_mbid;return{itemType:si.Media,mediaType:li.Audio,src:`listenbrainz:track:${Ia()}`,title:r.track_name,artists:r.artist_name?[r.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:r.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${pc}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=r.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(n=r.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:0,inLibrary:!0}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Xc.maxPageSize=100;const Zc=Xc;const eu=new K("ListenBrainzPlaylistItemsPager");class tu{constructor(e){let t=0;this.pager=new Wi(((n=100)=>{return r=this,i=void 0,s=function*(){const{playlist:r}=yield tc.get(`playlist/${e}`,{offset:t,count:n},!0);t+=n;const i=r.track.map((e=>this.createMediaItem(e)));return{items:i,total:i.length,atEnd:!0}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}));var r,i,a,s}),{pageSize:100})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new de,this.subscriptions.add(this.pager.observeAdditions().pipe(rt((e=>tc.addUserData(e)))).subscribe(eu)))}createMediaItem(e){var t,n,r;const i=e.identifier.split("/").pop(),a=null===(t=e.extension)||void 0===t?void 0:t["https://musicbrainz.org/doc/jspf#track"],s=null==a?void 0:a.additional_metadata;return{itemType:si.Media,mediaType:li.Audio,src:`listenbrainz:track:${i}`,externalUrl:e.identifier,title:e.title,artists:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_credit_name)):e.creator?[e.creator]:void 0,duration:0,recording_mbid:i,release_mbid:null===(n=null==a?void 0:a.additional_metadata)||void 0===n?void 0:n.caa_release_mbid,artist_mbids:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_mbid)):null===(r=null==a?void 0:a.artist_identifiers)||void 0===r?void 0:r.map((e=>e.split("/").pop())),playedAt:0}}}class nu{constructor(e){let t=0;this.pager=new Wi(((n=50)=>{return r=this,i=void 0,s=function*(){const r=yield tc.get(e,{offset:t,count:n},!0);t+=n;const i=this.createItems(r.playlists),a=r.playlist_count;return{items:i,total:a,atEnd:r.offset+i.length>=a}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}));var r,i,a,s}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((({playlist:e})=>this.createItem(e)))}createItem(e){const t=e.identifier.split("/").pop();return{itemType:si.Playlist,src:`listenbrainz:playlist:${t}`,title:e.title,description:this.getTextFromHtml(e.annotation),externalUrl:e.identifier,owner:{name:e.creator},pager:new tu(t)}}getTextFromHtml(e){if(/<\/?p>/i.test(e)){const t=document.createElement("div");return t.innerHTML=e||"",Array.from(t.querySelectorAll("p")).map((e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.replace(/\s+/g," "))||""})).join("\n")}return P(e)}}const ru=new K("ListenBrainzStatsPager");class iu{constructor(e,t){let n=0;this.pager=new Wi(((r=50)=>{return i=this,a=void 0,o=function*(){try{const i=yield tc.get(e,Object.assign(Object.assign({},t),{offset:n,count:r}));return n+=r,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function r(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,r)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new de,this.subscriptions.add(this.pager.observeAdditions().pipe(He((e=>e.filter((e=>e.itemType===si.Media)))),Ue((e=>e.length>0)),rt((e=>tc.addUserData(e)))).subscribe(ru)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,n=t.recordings.map((e=>this.createMediaItem(e))),r=t.total_recording_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isReleasesResponse(e)){const t=e.payload,n=t.releases.map((e=>this.createMediaAlbum(e))),r=t.total_release_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isArtistsResponse(e)){const t=e.payload,n=t.artists.map((e=>this.createMediaArtist(e))),r=t.total_artist_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}throw Error("Unknown response")}createMediaArtist(e){var t;const n=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:si.Artist,src:`listenbrainz:artist:${Ia()}`,externalUrl:n?`${pc}/artist/${n}`:void 0,title:e.artist_name,artist_mbid:n,playCount:e.listen_count,pager:new wi}}createMediaAlbum(e){const t=e.release_mbid||void 0,n={itemType:si.Album,src:`listenbrainz:album:${Ia()}`,externalUrl:t?`${pc}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},n),{pager:t?new zl(t):new wi})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:si.Media,mediaType:li.Audio,src:`listenbrainz:track:${Ia()}`,externalUrl:t?`${pc}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}var au=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const su={view:"details",fields:["Index","Artist","Title"]},ou={id:"listenbrainz/history",title:"History",icon:"clock",itemType:si.Media,search:({startAt:e=0}={})=>new Qc(e?{max_ts:e}:void 0)},lu={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,search:()=>new Qc},cu={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new Zc},uu={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:si.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new iu(`stats/user/${Ql.userId}/recordings`,e)},du={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:si.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new iu(`stats/user/${Ql.userId}/releases`,e)},mu={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:si.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:{view:"none"},search:e=>new iu(`stats/user/${Ql.userId}/artists`,e)},hu={id:"listenbrainz/playlists",title:"My Playlists",icon:"playlist",itemType:si.Playlist,secondaryLayout:su,defaultHidden:!0,search:()=>new nu(`user/${Ql.userId}/playlists`)},pu={id:"listenbrainz/recommendations",title:"Recommendations",icon:"playlist",itemType:si.Playlist,secondaryLayout:su,defaultHidden:!0,search:()=>new nu(`user/${Ql.userId}/playlists/createdfor`)},fu={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",serviceType:Dr.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[lu],sources:[uu,du,mu,cu,ou,hu,pu],labels:{[ii.AddToLibrary]:"Love on ListenBrainz",[ii.RemoveFromLibrary]:"Unlove on ListenBrainz"},editablePlaylists:hu,addToPlaylist:function(e,t){return au(this,void 0,void 0,(function*(){return tc.addToPlaylist(e,t)}))},canRate:()=>!1,canStore:vu,compareForRating:bu,createPlaylist:function(e,t={}){return au(this,void 0,void 0,(function*(){const{playlist_mbid:n}=yield tc.createPlaylist(e,t);return{src:`listenbrainz:playlist:${n}`,title:e,itemType:si.Playlist,pager:new wi}}))},store:function(e,t){return au(this,void 0,void 0,(function*(){vu(e)&&(yield tc.store(e,t))}))},observeIsLoggedIn:dc,isConnected:function(){return!!Ql.token},isLoggedIn:uc,login:function(){return sc(this,void 0,void 0,(function*(){if(!uc()){oc.log("connect");try{const e=yield function(){return ic(this,void 0,void 0,(function*(){return vn(ac,!0)}))}();if(e){const{userId:t,token:n}=JSON.parse(e);Ql.userId=t,Ql.token=n,lc.next(n)}}catch(e){oc.error(e)}}}))},logout:function(){return sc(this,void 0,void 0,(function*(){oc.log("disconnect"),Ql.clear(),lc.next("")}))}},yu=fu;function vu(e){return e.itemType===si.Media&&!(!e.recording_mbid&&!e.recording_msid)}function bu(e,t){const[n]=e.src.split(":"),[r]=t.src.split(":");return n===r&&e.itemType===si.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}const gu=new Z("subsonic"),wu=new ct(gu.getString("libraryId")),Eu={get audioLibraries(){return this.libraries},get host(){return gu.getString("host")},set host(e){gu.setString("host",e)},get credentials(){return gu.getString("credentials")},set credentials(e){gu.setString("credentials",e)},get libraryId(){return gu.getString("libraryId")},set libraryId(e){gu.setString("libraryId",e),wu.next(e)},observeLibraryId:()=>wu.pipe(Kr()),get libraries(){var e;const t=gu.getJson("libraries",[]);return""!==(null===(e=t[0])||void 0===e?void 0:e.id)&&t.splice(0,0,{id:"",title:"(all)"}),t},set libraries(e){gu.setJson("libraries",e),e.find((e=>e.id===this.libraryId))||(this.libraryId="")},get userName(){return gu.getString("userName")},set userName(e){gu.setString("userName",e)},clear(){gu.removeItem("userName"),gu.removeItem("credentials")}},ku=Eu;var xu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Su(e,t,{host:n,credentials:r}=ku){return xu(this,void 0,void 0,(function*(){if(!r)throw Error("No subsonic credentials");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1));const i=yield fetch(`${n}/rest/${e}${e.includes("?")?"&":"?"}${r}`,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return a}))}function Tu(e,t=ku){var n;return xu(this,void 0,void 0,(function*(){const r=yield Su("getAlbumList",t.libraryId?Object.assign(Object.assign({},e),{musicFolderId:t.libraryId}):e,t);return(null===(n=r.albumList.album)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))}function Pu(e=ku){return xu(this,void 0,void 0,(function*(){return(yield Su("getArtists",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).artists.index.map((e=>e.artist)).flat()}))}function Au(){return xu(this,void 0,void 0,(function*(){const e=[];let t=10*Math.floor((new Date).getFullYear()/10);for(;t>=1930;)e.push({id:String(t),title:`${t}s`}),t-=10;return e}))}function Iu(e,t){var n;return xu(this,void 0,void 0,(function*(){const r=yield Su("getGenres",void 0,t);return(null===(n=r.genres.genre)||void 0===n?void 0:n.map((({value:t,albumCount:n,songCount:r})=>{const i=e===si.Album?n:r;return{id:t,title:`${t} (${i})`,count:i}})).filter((e=>e.count>0)).sort(((e,t)=>e.count===t.count?e.title.localeCompare(t.title):t.count-e.count)))||[]}))}function Cu(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getMusicDirectory",{id:e},t)).directory}))}const Mu={addToPlaylist:function(e,t){return xu(this,void 0,void 0,(function*(){const n=u(t,300);for(const t of n){const n=new URLSearchParams({playlistId:e});t.forEach((e=>n.append("songIdToAdd",e))),yield Su(`updatePlaylist?${n}`)}}))},createPlaylist:function(e,t,n,r){return xu(this,void 0,void 0,(function*(){const{playlist:i}=yield Su("createPlaylist",{name:e}),a=u(r,300);for(const e of a){const r=new URLSearchParams({playlistId:i.id,comment:t,public:String(n)});e.forEach((e=>r.append("songIdToAdd",e))),yield Su(`updatePlaylist?${r}`)}return i}))},get:Su,getAlbum:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getAlbum",{id:e},t)).album}))},getAlbumInfo:function(e,t,n){return xu(this,void 0,void 0,(function*(){return(yield Su("getAlbumInfo"+(t?"":"2"),{id:e},n)).albumInfo}))},getAlbumTracks:function(e,t,n){return xu(this,void 0,void 0,(function*(){return t?(yield Su("getMusicDirectory",{id:e},n)).directory.child||[]:(yield Su("getAlbum",{id:e},n)).album.song||[]}))},getAlbumsByDecade:function(e,t,n,r){return xu(this,void 0,void 0,(function*(){const i=Number(e);return Tu({type:"byYear",fromYear:i+9,toYear:i,size:n,offset:t},r)}))},getAlbumsByGenre:function(e,t,n,r){return xu(this,void 0,void 0,(function*(){return Tu({type:"byGenre",genre:e,size:n,offset:t},r)}))},getArtist:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getArtist",{id:e},t)).artist}))},getArtists:Pu,getArtistAlbums:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getArtist",{id:e},t)).artist.album||[]}))},getArtistInfo:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getArtistInfo2",{id:e},t)).artistInfo2}))},getArtistTopTracks:function(e,t=50,n){return xu(this,void 0,void 0,(function*(){return(yield Su("getTopSongs",{artist:e,count:t},n)).topSongs.song||[]}))},getDecades:Au,getFilters:function(e,t,n){return xu(this,void 0,void 0,(function*(){return e===Sa.ByDecade?Au():Iu(t,n)}))},getGenres:Iu,getIndexes:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getIndexes",{musicFolderId:e},t)).indexes.index||[]}))},getLikedAlbums:function(e,t,n){return xu(this,void 0,void 0,(function*(){return Tu({type:"starred",size:t,offset:e},n)}))},getLikedArtists:function(e=ku){return xu(this,void 0,void 0,(function*(){return(yield Su("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.artist||[]}))},getLikedSongs:function(e=ku){return xu(this,void 0,void 0,(function*(){return(yield Su("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.song||[]}))},getMostPlayed:function(e,t,n){return xu(this,void 0,void 0,(function*(){return Tu({type:"frequent",size:t,offset:e},n)}))},getMusicDirectory:Cu,getMusicDirectoryItems:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Cu(e,t)).child.sort(((e,t)=>e.isDir===t.isDir?e.isDir?e.title.localeCompare(t.title):0:e.isDir?-1:1))}))},getMusicLibraries:function(e){var t;return xu(this,void 0,void 0,(function*(){const n=yield Su("getMusicFolders",void 0,e);return(null===(t=n.musicFolders.musicFolder)||void 0===t?void 0:t.sort(((e,t)=>e.name.localeCompare(t.name))).map((({id:e,name:t})=>({id:String(e),title:t}))))||[]}))},getPlayableUrl:function(e,{host:t,credentials:n}=ku){const[,,r]=e.split(":");return`${t}/rest/stream?id=${r}&${n}`},getPlaylist:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getPlaylist",{id:e},t)).playlist}))},getPlaylists:function(e){return xu(this,void 0,void 0,(function*(){return(yield Su("getPlaylists",void 0,e)).playlists.playlist||[]}))},getPlaylistItems:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getPlaylist",{id:e},t)).playlist.entry||[]}))},getRandomAlbums:function(e=100,t){return xu(this,void 0,void 0,(function*(){return Tu({type:"random",size:e,offset:0},t)}))},getRandomArtists:function(e=100,t){return xu(this,void 0,void 0,(function*(){return f(yield Pu(t)).slice(0,e)}))},getRandomSongs:function(e=100,t=ku){return xu(this,void 0,void 0,(function*(){return(yield Su("getRandomSongs",t.libraryId?{musicFolderId:t.libraryId,size:e}:{size:e},t)).randomSongs.song||[]}))},getRecentlyPlayed:function(e,t,n){return xu(this,void 0,void 0,(function*(){return Tu({type:"recent",size:t,offset:e},n)}))},getSong:function(e,t){return xu(this,void 0,void 0,(function*(){return(yield Su("getSong",{id:e},t)).song}))},getSongsByGenre:function(e,t,n,r=ku){return xu(this,void 0,void 0,(function*(){const i={genre:e,offset:t,count:n};return(yield Su("getSongsByGenre",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).songsByGenre.song||[]}))},getVideos:function(e){return xu(this,void 0,void 0,(function*(){return(yield Su("getVideos",void 0,e)).videos.video||[]}))},scrobble:function(e,t){return xu(this,void 0,void 0,(function*(){return Su("scrobble",e,t)}))},searchAlbums:function(e,t,n,r=ku){var i;return xu(this,void 0,void 0,(function*(){const a={query:e,albumCount:n,albumOffset:t,songCount:0,artistCount:0},s=yield Su("search2",r.libraryId?Object.assign(Object.assign({},a),{musicFolderId:r.libraryId}):a,r);return(null===(i=s.searchResult2.album)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))},searchArtists:function(e,t,n,r=ku){return xu(this,void 0,void 0,(function*(){const i={query:e,artistOffset:t,artistCount:n,songCount:0,albumCount:0};return(yield Su("search3",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).searchResult3.artist||[]}))},searchSongs:function(e,t,n,r=ku){return xu(this,void 0,void 0,(function*(){const i={query:e,songOffset:t,songCount:n,albumCount:0,artistCount:0};return(yield Su("search3",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).searchResult3.song||[]}))}},Ou=Mu,$u=new Z("navidrome"),Nu={get host(){return $u.getString("host")},set host(e){$u.setString("host",e)},get credentials(){return $u.getString("credentials")},set credentials(e){$u.setString("credentials",e)},get token(){return $u.getString("token")},set token(e){$u.setString("token",e)},get userId(){return $u.getString("userId")},set userId(e){$u.setString("userId",e)},clear(){$u.removeItem("token"),$u.removeItem("credentials"),$u.removeItem("userId")}};var zu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ju(e){const t=(0,r.useCallback)(((e,t,n)=>zu(this,void 0,void 0,(function*(){const r=yield fetch(`${e}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});if(!r.ok)throw r;const{token:i,subsonicSalt:a,subsonicToken:s,id:o}=yield r.json(),l=`u=${t}&s=${a}&t=${s}&v=1.16.1&c=ampcast&f=json`;return JSON.stringify({userId:o,token:i,credentials:l})}))),[]);return r.createElement(Aa,Object.assign({},e,{service:pd,settings:Nu,login:t}))}var Lu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Du(e,t){return Lu(this,void 0,void 0,(function*(){return(yield Fu(e,t,{method:"GET"})).json()}))}function Ru(e,t){return Lu(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return Fu(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:n})}))}function Fu(e,t,n){return Lu(this,void 0,void 0,(function*(){const{host:r,token:i}=Nu;if(!i)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),n.headers=Object.assign(Object.assign({},n.headers),{Accept:"application/json","x-nd-authorization":`Bearer ${i}`});const a=yield fetch(`${r}/api/${e}`,n);if(!a.ok)throw a;return a}))}const _u={addToPlaylist:function(e,t){return Lu(this,void 0,void 0,(function*(){yield Ru(`playlist/${e}/tracks`,{ids:t})}))},createPlaylist:function(e,t,n,r){return Lu(this,void 0,void 0,(function*(){const i=yield Ru("playlist",{name:e,comment:t,public:n}),a=yield i.json();return yield Ru(`playlist/${a.id}/tracks`,{ids:r}),a}))},get:Du,getFilters:function(e){return Lu(this,void 0,void 0,(function*(){return e===Sa.ByDecade?Ou.getDecades():function(){return Lu(this,void 0,void 0,(function*(){return(yield Du("genre",{_sort:"name"})).map((({id:e,name:t})=>({id:e,title:t})))}))}()}))},getPage:function(e,t){return Lu(this,void 0,void 0,(function*(){const n=yield Fu(e,t,{method:"GET",headers:{Accept:"application/json"}});let r=yield n.json(),i=0;return Array.isArray(r)?i=Number(n.headers.get("X-Total-Count"))||r.length:(r=[r],i=1),{items:r,total:i}}))},getPlayableUrl:function(e){return Ou.getPlayableUrl(e,Nu)}},Bu=_u;var Vu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Uu=new K("navidromeAuth"),Hu=new ct(""),qu=new ct(!1);function Yu(){return qu.getValue()}function Ku(e){Nu.token=e,Hu.next(e)}Hu.pipe(Kr()).pipe(Ue((e=>""!==e)),rt((()=>function(){return Vu(this,void 0,void 0,(function*(){try{return yield Bu.get("playlist",{_end:1}),!0}catch(e){return 401===e.status?Nu.clear():Uu.error(e),Hu.next(""),!1}}))}()))).subscribe(qu),Hu.next(Nu.token);class Wu{constructor(e,t,n,r){this.itemType=e,this.path=t,this.params=n,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new Xa((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=(e-1)*this.pageSize,n=t+this.pageSize,{items:r,total:i}=yield Bu.getPage(this.path,Object.assign(Object.assign({},this.params),{_start:t,_end:n}));return{items:r.map((e=>this.createMediaObject(e))),total:i}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createMediaObject(e){let t;switch(this.itemType){case si.Album:t=this.createMediaAlbum(e);break;case si.Artist:t=this.createMediaArtist(e);break;case si.Playlist:t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}createMediaItem(e){var t;const n=e.mediaFileId||e.id;return{itemType:si.Media,mediaType:li.Audio,src:`navidrome:audio:${n}`,externalUrl:this.getExternalUrl(`album/${e.albumId}`),title:e.title,addedAt:this.parseDate(e.createdAt),artists:[e.artist],albumArtist:e.albumArtist,album:e.album,duration:e.duration,track:e.trackNumber,disc:e.discNumber,inLibrary:e.starred,year:e.year,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),thumbnails:this.createThumbnails(e.albumId),recording_mbid:e.mbzTrackId,release_mbid:e.mbzAlbumId,track_mbid:e.mbzReleaseTrackId,artist_mbids:e.mbzArtistId?[e.mbzArtistId]:void 0}}createMediaAlbum(e){var t;const n=e.id;return{itemType:si.Album,src:`navidrome:album:${n}`,externalUrl:this.getExternalUrl(`album/${n}`),title:e.name,addedAt:this.parseDate(e.createdAt),artist:e.albumArtist,inLibrary:e.starred,year:e.minYear||e.maxYear,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:new Wu(si.Media,"song",{album_id:n,_sort:"album"}),thumbnails:this.createThumbnails(n),release_mbid:e.mbzAlbumId,artist_mbids:e.mbzAlbumArtistId?[e.mbzAlbumArtistId]:void 0}}createMediaArtist(e){var t;const n=e.id,r=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:si.Artist,src:`navidrome:artist:${n}`,externalUrl:this.getExternalUrl(`artist/${n}`),title:e.name,description:P(e.biography)||void 0,inLibrary:e.starred,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:this.createArtistAlbumsPager(e),thumbnails:r?this.createThumbnails(n):void 0,artist_mbid:e.mbzArtistId}}createMediaPlaylist(e){const t=e.id,n=`navidrome:playlist:${t}`;return{itemType:si.Playlist,src:n,externalUrl:this.getExternalUrl(`playlist/${t}`),title:e.name,description:P(e.comment),addedAt:this.parseDate(e.createdAt),duration:e.duration,trackCount:e.songCount,pager:new Wu(si.Media,`playlist/${t}/tracks`,{playlist_id:t}),thumbnails:this.createThumbnails(t),isPinned:na.isPinned(n),isOwn:e.ownerId===Nu.userId,owner:{name:e.ownerName}}}getExternalUrl(e){return`${Nu.host}/app/#/${e}/show`}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,n=t){const{host:r}=Nu;return{url:`${r}/rest/getCoverArt?id=${e}&size=${t}&{navidrome-credentials}`,width:t,height:n}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new wi([t]),r=new Wu(si.Album,"album",{album_artist_id:e.id,_sort:"minYear",_order:"DESC"});return new Qi(void 0,r,n)}createArtistAllTracks(e){const t=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:si.Album,src:`navidrome:all-tracks:${e.id}`,title:"All Songs",artist:e.name,thumbnails:t?this.createThumbnails(e.id):void 0,pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Wu(si.Media,"song",{artist:e.name,_sort:"title"})}}Wu.minPageSize=10,Wu.maxPageSize=500;const Gu=Wu;var Ju=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Qu="navidrome",Xu="order_album_artist_name,order_album_name,disc_number,track_number",Zu="order_album_artist_name,order_album_name",ed={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},td={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},nd={id:"navidrome/liked-songs",title:"My Songs",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>new Gu(si.Media,"song",{starred:!0,_sort:"starred_at",_order:"DESC"})},rd={id:"navidrome/liked-albums",title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search:()=>new Gu(si.Album,"album",{starred:!0,_sort:"starred_at",_order:"DESC"})},id={id:"navidrome/liked-artists",title:"My Artists",icon:"heart",itemType:si.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Gu(si.Artist,"artist",{starred:!0,_sort:"starred_at",_order:"DESC"})},ad={id:"navidrome/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Gu(si.Media,"song",{_sort:"play_date",_order:"DESC"})},sd={id:"navidrome/most-played",title:"Most Played",icon:"most-played",itemType:si.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>new Gu(si.Media,"song",{_sort:"play_count",_order:"DESC"})},od={id:"navidrome/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,layout:ed,secondaryLayout:td,search:()=>new Gu(si.Playlist,"playlist",{_sort:"name"})},ld={id:"navidrome/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:si.Media,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?new Gu(si.Media,"song",{genre_id:e.id,_sort:Xu}):new wi},cd={id:"navidrome/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:si.Album,viewType:Sa.ByGenre,search:e=>e?new Gu(si.Album,"album",{genre_id:e.id,_sort:Zu}):new wi},ud={id:"navidrome/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:si.Artist,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?new Gu(si.Artist,"artist",{genre_id:e.id,_sort:"name"}):new wi},dd={id:"navidrome/random-tracks",title:"Random Songs",icon:"shuffle",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Gu(si.Media,"song",{_sort:"random"},{maxSize:100})},md={id:"navidrome/random-albums",title:"Random Albums",icon:"shuffle",itemType:si.Album,search:()=>new Gu(si.Album,"album",{_sort:"random"},{maxSize:100})},hd={id:Qu,icon:Qu,name:"Navidrome",url:"https://www.navidrome.org/",serviceType:Dr.PersonalMedia,defaultHidden:!0,roots:[yd(si.Media,{title:"Songs"}),yd(si.Album,{title:"Albums"}),yd(si.Artist,{title:"Artists"}),yd(si.Playlist,{title:"Playlists",layout:ed,secondaryLayout:td})],sources:[nd,rd,id,ad,sd,od,ld,cd,ud,dd,md],labels:{[ii.AddToLibrary]:ui("Add to Navidrome Favorites"),[ii.RemoveFromLibrary]:ui("Remove from Navidrome Favorites")},editablePlaylists:od,addToPlaylist:function(e,t){return Ju(this,void 0,void 0,(function*(){const n=vd(e);return Bu.addToPlaylist(n,t.map(vd))}))},canRate:()=>!1,canStore:fd,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:n=!1,items:r=[]}={}){return Ju(this,void 0,void 0,(function*(){return{src:`navidrome:playlist:${(yield Bu.createPlaylist(e,t,n,r.map(vd))).id}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const t=vd(e);return new Gu(si.Playlist,`playlist/${t}`)}}},getFilters:function(e){return Ju(this,void 0,void 0,(function*(){return Bu.getFilters(e)}))},getMetadata:function(e){return Ju(this,void 0,void 0,(function*(){const t=e.itemType,n=vd(e);if(t===si.Album){if(e.synthetic)return e;if(void 0===e.description){const t=yield Ou.getAlbumInfo(n,!1,Nu);e=Object.assign(Object.assign({},e),{description:P(t.notes),release_mbid:t.musicBrainzId})}}else if(t===si.Artist&&void 0===e.description){const t=yield Ou.getArtistInfo(n,Nu);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!fd(e)||void 0!==e.inLibrary)return e;const r=ni.getInLibrary(e);if(void 0!==r)return Object.assign(Object.assign({},e),{inLibrary:r});const i=t===si.Artist?"artist":t===si.Album?"album":"song",a=new Gu(t,`${i}/${n}`,{pageSize:1,maxSize:1}),s=yield bi(a,{timeout:2e3});return x(e,s[0])}))},getPlayableUrl:function({src:e}){return Bu.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{navidrome-credentials}",Nu.credentials)},lookup:function(e,t,n=10,r){return Ju(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return bi(new Gu(si.Media,"song",{title:`${e} ${t}`,_sort:"order_artist_name,order_album_name,track_number"},i),{timeout:r})}))},store:function(e,t){return Ju(this,void 0,void 0,(function*(){const n=vd(e),r=t?"star":"unstar";switch(e.itemType){case si.Media:yield Ou.get(r,{id:n},Nu);break;case si.Album:yield Ou.get(r,{albumId:n},Nu);break;case si.Artist:yield Ou.get(r,{artistId:n},Nu)}}))},observeIsLoggedIn:function(){return qu.pipe(Kr())},isConnected:function(){return!!Nu.token},isLoggedIn:Yu,login:function(){return Vu(this,void 0,void 0,(function*(){if(!Yu()){Uu.log("connect");try{const e=yield function(){return zu(this,void 0,void 0,(function*(){return vn(ju,!0)}))}();if(e){const{userId:t,token:n,credentials:r}=JSON.parse(e);Nu.userId=t,Nu.credentials=r,Ku(n)}}catch(e){Uu.error(e)}}}))},logout:function(){return Vu(this,void 0,void 0,(function*(){Uu.log("disconnect"),Nu.clear(),Ku(""),qu.next(!1)}))}},pd=hd;function fd(e){switch(e.itemType){case si.Media:case si.Artist:return!0;case si.Album:return!e.synthetic;default:return!1}}function yd(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`navidrome/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){switch(t=t.trim(),e){case si.Media:return new Gu(e,"song",{title:t,_sort:Xu});case si.Album:return new Gu(e,"album",{name:t,_sort:Zu});case si.Artist:return new Gu(e,"artist",{name:t,_sort:"name"});case si.Playlist:return new Gu(e,"playlist",{q:t,_sort:"name"});default:return new wi}}})}function vd({src:e}){const[,,t]=e.split(":");return t}var bd;!function(e){e[e.Low=4]="Low",e[e.Normal=8]="Normal",e[e.High=12]="High",e[e.Lossless=16]="Lossless",e[e.Master=20]="Master"}(bd||(bd={}));const gd=bd,wd=new Z("plex"),Ed=new ct(wd.getString("libraryId")),kd={get audioLibraries(){return this.libraries},get clientId(){let e=wd.getString("clientId");return e||(e=Ia(),wd.setString("clientId",e)),e},get drm(){return wd.getString("drm","widevine")},set drm(e){wd.setString("drm",e)},get connection(){return wd.getJson("connection")},set connection(e){wd.setJson("connection",e)},get hasTidal(){return wd.getBoolean("hasTidal")},set hasTidal(e){wd.setBoolean("hasTidal",e)},get host(){const e=this.connection;return e?e.local&&"http:"===location.protocol?`http://${e.address}:${e.port}`:e.uri:""},get internetRequired(){var e;return!(null===(e=this.connection)||void 0===e?void 0:e.local)||"http:"!==location.protocol},get libraryId(){return wd.getString("libraryId")},set libraryId(e){wd.setString("libraryId",e),Ed.next(e)},observeLibraryId:()=>Ed.pipe(Kr()),get libraries(){return wd.getJson("libraries")||[]},set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>B(e.title)))||e[0];wd.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""},get server(){return wd.getJson("server")},set server(e){wd.setJson("server",e)},get serverId(){var e;return(null===(e=this.server)||void 0===e?void 0:e.clientIdentifier)||""},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get streamingQuality(){return wd.getNumber("streamingQuality",gd.High)},set streamingQuality(e){wd.setNumber("streamingQuality",e)},get userId(){return wd.getString("userId")},set userId(e){wd.setString("userId",e)},get userToken(){return wd.getString("userToken")},set userToken(e){wd.setString("userToken",e)},clear(){wd.removeItem("userId"),wd.removeItem("userToken"),wd.removeItem("server"),wd.removeItem("connection"),wd.removeItem("hasTidal")}};var xd;!function(e){e.Episode="4",e.Artist="artist",e.Album="album",e.Track="track",e.Clip="clip",e.Playlist="playlist"}(xd||(xd={}));const Sd=xd;var Td;!function(e){e.Episode="4",e.Artist="8",e.Album="9",e.Track="10",e.MusicVideo="12",e.Clip="14",e.Playlist="15"}(Td||(Td={}));const Pd=Td;var Ad=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Id=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Cd="https://plex.tv/api/v2",Md="https://music.provider.plex.tv",Od="https://discover.provider.plex.tv";function $d(e){var{headers:t,body:n}=e,r=Id(e,["headers","body"]);return Ad(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),n&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),n=JSON.stringify(n)),(yield Nd(Object.assign({headers:t,body:n},r))).json()}))}function Nd({host:e=kd.host,path:t,method:n="GET",params:r,headers:i,body:a,token:s,keepalive:o,timeout:l}){return Ad(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=r?`${t}?${new URLSearchParams(r)}`:t).startsWith("/")&&(t=t.slice(1)),s||(s=e===kd.host?kd.serverToken:kd.userToken);const c=e===kd.host?void 0:kd.drm,u={method:n,headers:Object.assign(Object.assign({},i),Fd(s,c)),body:a,keepalive:o};l&&(u.signal=AbortSignal.timeout(l));const d=yield fetch(`${e}/${t}`,u);if(!d.ok)throw d;return d}))}function zd(e){const t=e.map(Bd).join(",");return`server://${kd.serverId}/com.plexapp.plugins.library/library/metadata/${t}`}function jd(e){return`provider://tv.plex.provider.music/library/metadata/${e.map(Bd).join(",")}`}function Ld(e="all"){return`/library/sections/${Dd()}/${e}`}function Dd(){const e=kd.libraryId;if(!e)throw new mi;return e}function Rd(e,t=kd.host){return Ad(this,void 0,void 0,(function*(){if(0===e.length)return[];const{MediaContainer:{Metadata:n=[]}}=yield $d({host:t,path:`/library/metadata/${e.join(",")}`,headers:{"X-Plex-Container-Start":"0","X-Plex-Container-Size":String(e.length)}});return n}))}function Fd(e,t){const n={"X-Plex-Product":"ampcast","X-Plex-Version":"0.9.5","X-Plex-Platform":R.displayName,"X-Plex-Platform-Version":R.version,"X-Plex-Device":R.os,"X-Plex-Device-Name":R.displayName,"X-Plex-Client-Identifier":kd.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(n["X-Plex-Token"]=e),t&&(n["X-Plex-Drm"]=t),n}function _d(e){switch(e){case si.Album:return Pd.Album;case si.Artist:return Pd.Artist;case si.Playlist:return Pd.Playlist;default:return Pd.Track}}function Bd({src:e}){const[,,t]=e.split(":");return t}const Vd={addToPlaylist:function(e,t,n=kd.host){return Ad(this,void 0,void 0,(function*(){const r=Bd(e),[i,a]=m(t,(e=>e.src.startsWith("plex-tidal:"))),s=n===Md,o=`/playlists/${r}/items`;if(a.length>0&&!s){const e=zd(a);yield $d({host:n,method:"PUT",path:o,params:{uri:e}})}if(i.length>0){const e=jd(i);yield $d({host:n,method:"PUT",path:o,params:{uri:e}})}}))},createPlaylist:function(e,t,n,r=kd.host){return Ad(this,void 0,void 0,(function*(){const i=r===Md,[a,s]=m(n,(e=>e.src.startsWith("plex-tidal:"))),o=i?jd(a):zd(s),{MediaContainer:{Metadata:[l]=[]}}=yield $d({host:r,method:"POST",path:"/playlists",params:{type:"audio",title:e,uri:o,smart:0}});return t&&(yield Nd({host:r,method:"PUT",path:`/playlists/${l.ratingKey}`,params:{summary:t}})),!i&&a.length>0&&(yield $d({host:r,method:"PUT",path:`/playlists/${l.ratingKey}/items`,params:{uri:jd(a)}})),l}))},fetch:Nd,fetchJSON:$d,getAccount:function(e){return Ad(this,void 0,void 0,(function*(){const{MyPlex:t}=yield $d({path:"myplex/account",token:e});return t}))},getFilters:function(e,t){return Ad(this,void 0,void 0,(function*(){return e===Sa.ByDecade?function(){return Ad(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield $d({path:Ld("decade"),params:{type:Pd.Album}}),t=10*Math.floor((new Date).getFullYear()/10);return e.filter((({key:e})=>Number(e)>500&&Number(e)<=t)).map((({key:e,title:t})=>({id:e,title:t})))}))}():function(e){return Ad(this,void 0,void 0,(function*(){const t=_d(e),{MediaContainer:{Directory:n}}=yield $d({path:Ld("genre"),params:{type:t}});return n.map((({key:e,title:t})=>({id:e,title:t})))}))}(t)}))},getHeaders:Fd,getMetadata:Rd,getMusicLibraries:function(e=kd.host,t=kd.serverToken){return Ad(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:n}}=yield $d({host:e,path:"/library/sections",token:t});return n.filter((e=>"artist"===e.type)).map((({key:e,title:t})=>({id:e,title:t})))}))},getPlayableUrl:function(e){const{host:t,serverToken:n}=kd;if(t&&n){if(e.playbackType===_r.Direct){const[r]=e.srcs||[];if(!r)throw Error("No playable source");return`${t}${r}?X-Plex-Token=${n}`}{const[,r,i]=e.src.split(":");return`${t}/${"video"===r?"video":"music"}/:/transcode/universal/start.mpd?${new URLSearchParams(Object.assign(Object.assign({path:`/library/metadata/${i}`,hasMDE:"1",mediaIndex:"0",partIndex:"0",musicBitrate:"320",directStreamAudio:"1",mediaBufferSize:"12288",protocol:e.playbackType===_r.HLS?"hls":"dash",directPlay:"0"},Fd(n)),{"X-Plex-Client-Profile-Extra":"add-transcode-target(type=musicProfile&context=streaming&protocol=dash&container=mp4&audioCodec=aac)+add-transcode-target(type=musicProfile&context=streaming&protocol=hls&container=mpegts&audioCodec=aac,mp3)"}))}`}}throw Error("Not logged in")},getPlaybackType:function(e){return Ad(this,void 0,void 0,(function*(){try{const{host:t,serverToken:n}=kd,[r]=e.srcs||[],i=`${t}${r}?X-Plex-Token=${n}`;return(yield q(e.mediaType===li.Video?"video":"audio",i))?_r.Direct:_r.HLS}catch(e){return _r.Direct}}))},getServers:function(e=kd.serverToken){return Ad(this,void 0,void 0,(function*(){return m((yield $d({host:Cd,path:"/resources",params:{includeHttps:"1"},token:e})).filter((e=>"server"===e.provides)),(e=>e.owned)).flat()}))},search:function(e){var t=e.params,n=void 0===t?{}:t,{type:r}=n,i=Id(n,["type"]),a=Id(e,["params"]);return Ad(this,void 0,void 0,(function*(){let e=[];const t=a.host===Od;if(t){const{MediaContainer:{SearchResults:[{SearchResult:t=[]}]}}=yield $d(Object.assign(Object.assign({},a),{params:i}));e=t}else{const{MediaContainer:{SearchResult:t=[]}}=yield $d(Object.assign(Object.assign({},a),{params:i}));e=t}return Rd(e.map((e=>e.Metadata)).filter((e=>e.type===r)).map((e=>e.ratingKey)),t?Md:void 0)}))}},Ud=Vd;var Hd=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const qd=new K("plexAuth"),Yd=new ct(""),Kd=new ct(!1),Wd=new Le;let Gd;function Jd(){return Kd.getValue()}function Qd(){return Kd.pipe(Kr())}function Xd(){return Wd}function Zd(){return Hd(this,void 0,void 0,(function*(){if(!Jd()){qd.log("connect");try{Wd.next("");const{id:e,userToken:t,serverToken:n}=yield function(){return Hd(this,void 0,void 0,(function*(){const{id:e,serverToken:t}=yield function(){return Hd(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/plex/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});let r=10;const s=()=>Hd(this,void 0,void 0,(function*(){r--;try{const{authToken:n,id:i}=yield Ud.fetchJSON({host:Cd,path:`/pins/${Gd.id}`});n?e({id:i,serverToken:n}):r?setTimeout(s,200):(Wd.next("Timeout"),t("Timeout"))}catch(e){t(e)}}));s()}};window.addEventListener("message",a,!1);const s=`clientID=${kd.clientId}&code=${Gd.code}&forwardUrl=${encodeURIComponent(r)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${s}`,"Plex","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}();yield function(e){return Hd(this,void 0,void 0,(function*(){const{server:t,connection:n}=kd;if(t&&n){const e=n.local?"local":"public";if(Wd.next(`Trying existing ${e} connection…`),yield nm(t,n))return;kd.server=null,kd.connection=null}Wd.next(`Searching for ${n?"a new":"a"} connection…`);const r=yield Ud.getServers(e);if(0===r.length){const e="Could not find a Plex server";throw Wd.next(e),Error(e)}for(const e of r){const t=yield tm(e);if(t)return kd.server=e,void(kd.connection=t)}const i="Could not establish a connection";throw Wd.next(i),Error(i)}))}(t);try{const{authToken:n}=yield Ud.getAccount(t);return{id:e,serverToken:t,userToken:n}}catch(n){return{id:e,serverToken:t,userToken:""}}}))}();kd.userId=e,kd.userToken=t,Yd.next(n)}catch(e){qd.error(e)}}}))}function em(){return Hd(this,void 0,void 0,(function*(){qd.log("disconnect"),kd.clear(),Yd.next(""),Kd.next(!1)}))}function tm(e){return Hd(this,void 0,void 0,(function*(){const t=m(e.connections,(e=>e.local)).flat();for(const n of t)if(yield nm(e,n))return n;return null}))}function nm(e,t){return Hd(this,void 0,void 0,(function*(){const n=e.name,r=t.local?"local":"public";try{return yield Ud.fetch({host:t.uri,path:"/",method:"HEAD",token:e.accessToken,timeout:3e3}),Wd.next(`(${n}) ${r} connection successful`),!0}catch(e){Wd.next(`(${n}) ${r} connection failed`)}return!1}))}function rm(){return Hd(this,void 0,void 0,(function*(){try{const e=yield function(){return e=this,t=void 0,r=function*(){if(!U){const e=Object.entries(H),t={initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]};for(const[n,r]of e)try{yield navigator.requestMediaKeySystemAccess(r,[t]),U=n;break}catch(e){}U||(U=V)}return U},new((n=void 0)||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}();kd.drm=e}catch(e){qd.error(e)}}))}function im(){return Hd(this,void 0,void 0,(function*(){try{kd.userToken&&(yield Ud.fetchJSON({host:Md,path:"/playlists/all",params:{librarySectionID:"tidal"},headers:{"X-Plex-Container-Size":"1"}}),kd.hasTidal=!0)}catch(e){406===e.status?kd.hasTidal=!1:qd.error(e)}}))}Yd.pipe(Kr()).pipe(Ue((e=>!!e)),rt((()=>function(){return Hd(this,void 0,void 0,(function*(){try{const[e]=yield Promise.all([Ud.getMusicLibraries(),rm(),im()]);return kd.libraries=e,!0}catch(e){return 401===e.status?(kd.clear(),Yd.next(""),Wd.next("Connection failed"),!1):(qd.error(e),Wd.next("Connected with errors"),!0)}}))}()))).subscribe(Kd),Xd().pipe(Ue((e=>""!==e))).subscribe(qd.rx()),Yd.next(kd.serverToken);var am=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const sm=new K("PlexPager");class om{constructor(e,t,n){var r;this.request=e,this.options=t,this.parent=n,this.pageNumber=1,this.serviceId=(null==t?void 0:t.serviceId)||"plex";let i=null==t?void 0:t.pageSize;i||(i=this.isTidal?50:(null===(r=kd.connection)||void 0===r?void 0:r.local)?om.plexMaxPageSize:200),this.pageSize=Math.min((null==t?void 0:t.maxSize)||1/0,i);const a=Object.assign(Object.assign({},t),{pageSize:this.pageSize});this.pager=this.isTidal?new Wi((()=>this.fetchNext()),a):new Xa((e=>this.fetch(e)),a)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}get isTidal(){return"plex-tidal"===this.serviceId}get isSearch(){return this.request.path.endsWith("/search")}connect(){var e;this.subscriptions||(this.subscriptions=new de,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.isSearch||this.subscriptions.add(this.pager.observeAdditions().pipe(rt((e=>this.enhanceItems(e)))).subscribe(sm)))}enhanceItems(e){return am(this,void 0,void 0,(function*(){const[t,n]=m(e,(e=>e.src.startsWith("plex-tidal:"))),r=(e,t)=>am(this,void 0,void 0,(function*(){if((e=e.filter((e=>!(e.itemType===si.Media&&e.mediaType===li.Video)))).length>0){const n=t===Md,r=yield Ud.getMetadata(e.map((({src:e})=>{const[,,t]=e.split(":");return t})),t),i=n?[]:yield this.getPlexAlbums(r),a=r.map((e=>this.createMediaObject(e,i,!0)));Xr(a.map((e=>({match:t=>t.src===e.src,values:e}))))}}));yield Promise.all([r(n.filter((e=>[si.Media,si.Album].includes(e.itemType)))),r(t.filter((e=>[si.Media,si.Artist].includes(e.itemType))),Md)])}))}fetch(e){var t;return am(this,void 0,void 0,(function*(){const n=this.request.path;let r,i=[],a=0;if(this.isSearch)r=yield Ud.search(this.request),a=r.length;else{const t=this.request,{headers:n}=t,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["headers"]),s=yield Ud.fetchJSON(Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign({},n),{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)})})),{MediaContainer:{Metadata:o=[],size:l,totalSize:c}}=s;r=o,a=c||l}return(null===(t=this.options)||void 0===t?void 0:t.lookup)&&!this.isTidal&&(i=yield this.getPlexAlbums(r)),n.endsWith("/tidal/myMixes")&&(r=r.map(((e,t)=>"playlist"===e.type&&1===e.leafCount?Object.assign(Object.assign({},e),{leafCount:void 0,title:`My Mix ${t+1}`,summary:e.title}):e))),{items:r.map((e=>this.createMediaObject(e,i))),total:a}}))}fetchNext(){return am(this,void 0,void 0,(function*(){const e=yield this.fetch(this.pageNumber);return this.pageNumber++,e}))}createMediaObject(e,t,n){switch(e.type){case Sd.Clip:return this.createMediaItemFromVideo(e);case Sd.Album:return this.createMediaAlbum(e,n);case Sd.Artist:return this.createMediaArtist(e,n);case Sd.Playlist:return this.createMediaPlaylist(e,n);case Sd.Track:{const n=t.find((t=>t.ratingKey===e.parentRatingKey));return this.createMediaItemFromTrack(e,n)}default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e,t){var n;const[r]=e.Media||[],[i]=(null==r?void 0:r.Part)||[];let a=(e.title||"").trim();const s=!!a,o=s?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,l=this.getFileName(null==i?void 0:i.file)||"[Unknown]",c="com.tidal"===e.attribution;return a=c?this.fixTrackTitle(a):a||l.replace(/\.\w+/,""),{src:this.getSrc("audio",e),srcs:null===(n=e.Media)||void 0===n?void 0:n.map((({Part:[e]})=>e.key)),itemType:si.Media,mediaType:li.Audio,playbackType:c?_r.DASH:void 0,title:a,fileName:c?void 0:l,externalUrl:this.getExternalUrl(e),addedAt:e.addedAt,artists:s?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:o&&!e.originalTitle?e.grandparentTitle:void 0,album:o,duration:e.duration/1e3,track:o?e.index:void 0,disc:o&&e.index?e.parentIndex:void 0,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year||e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e)||(t?this.getGenres(t):void 0),thumbnails:this.createThumbnails((c?void 0:e.thumb)||e.parentThumb||e.grandparentThumb),release_mbid:t?this.getMbid(t):void 0,track_mbid:this.getMbid(e),unplayable:!i||void 0}}createMediaAlbum(e,t){const n={src:this.getSrc("album",e),itemType:si.Album,externalUrl:this.getExternalUrl(e),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb||e.parentThumb),release_mbid:this.getMbid(e)};return t||(n.pager=this.createPager({path:e.key})),n}createMediaArtist(e,t){var n;const r={src:this.getSrc("artist",e),itemType:si.Artist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,country:null===(n=e.Country)||void 0===n?void 0:n.map((e=>e.tag)).join(", "),addedAt:e.addedAt,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb),artist_mbid:this.getMbid(e)};return t||(r.pager=this.createArtistAlbumsPager(e)),r}createMediaItemFromVideo(e){var t;const[n]=e.Media||[],[r]=(null==n?void 0:n.Part)||[],i="com.tidal"===e.attribution;return{src:this.getSrc("video",e),srcs:null===(t=e.Media)||void 0===t?void 0:t.map((({Part:[e]})=>e.key)),itemType:si.Media,mediaType:li.Video,playbackType:i?_r.HLS:void 0,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(null==r?void 0:r.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e),inLibrary:this.getInLibrary(e),thumbnails:this.createThumbnails(e.thumb),unplayable:!r||void 0}}createMediaPlaylist(e,t){const n=this.getSrc("playlist",e),r={src:n,itemType:si.Playlist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,thumbnails:this.createThumbnails(e.thumb||e.composite),isPinned:na.isPinned(n)};return t||(r.pager=this.createPager({path:e.key})),r}createMediaFolder(e){var t;const n={itemType:si.Folder,src:`plex:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}getExternalUrl(e){var t,n;const r="com.tidal"===e.attribution,i="https://app.plex.tv/desktop/#!";let a="";if(r)a=`${i}/provider/tv.plex.provider.music`;else{const e=null===(t=kd.server)||void 0===t?void 0:t.clientIdentifier;a=e?`${i}/server/${e}`:""}let s="details",o=`/library/metadata/${e.ratingKey}`;switch(e.type){case Sd.Clip:if(r){const t=e.grandparentRatingKey;o=t?`/library/metadata/${t}`:""}else o=null===(n=e.art)||void 0===n?void 0:n.replace(/\/art\/\d+$/,"");break;case Sd.Playlist:o=`/playlists/${e.ratingKey}`,s="playlist";break;case Sd.Track:{const t=e.parentRatingKey;o=t?`/library/metadata/${t}`:"";break}}return a&&o?`${a}/${s}?key=${encodeURIComponent(o)}`:""}getFileName(e=""){return e.split(/[/\\]/).pop()}getGenres(e){var t;return null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag))}getInLibrary(e){return"com.tidal"===e.attribution?e.saved:void 0}getMbid(e){const t=e.Guid;if(t){const e=t.map((e=>e.id)).find((e=>e.startsWith("mbid://")));return null==e?void 0:e.replace("mbid://","")}}getPlexAlbums(e){return am(this,void 0,void 0,(function*(){const t=e.filter((e=>"track"===e.type&&"com.tidal"!==e.attribution)),n=h(t.map((e=>e.parentRatingKey)));return n.length>0?Ud.getMetadata(n):[]}))}getRating(e){return"number"==typeof e?Math.round((e||0)/2):void 0}getSrc(e,t){return`${"com.tidal"===t.attribution?"plex-tidal":"plex"}:${e}:${t.ratingKey}`}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,n=t){return{url:`${kd.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${n}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:n}}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=this.createPager({path:n},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new wi([e]);return new Qi(t,r)}return r}createArtistAlbumsPager(e){if("com.tidal"===e.attribution){const t=this.createPager({path:e.key}),n=this.createArtistTopTracks(e),r=this.createArtistVideos(e),i=new Gi((()=>am(this,void 0,void 0,(function*(){try{return 0===(yield bi(r.pager,{keepAlive:!0})).length?[n]:[n,r]}catch(e){return sm.error(e),[n]}}))));return new Qi(i,t)}{const t=this.createPager({path:Ld(),params:{"artist.id":e.ratingKey,type:Pd.Album,sort:"year:desc,originallyAvailableAt:desc,artist.titleSort:desc,album.titleSort,album.index"}}),n=this.createArtistVideos(e),r=new Gi((()=>am(this,void 0,void 0,(function*(){try{return 0===(yield bi(n.pager,{keepAlive:!0})).length?[]:[n]}catch(e){return sm.error(e),[]}})))),i=this.createArtistOtherTracks(e),a=new wi([i]);return new Qi(r,t,a)}}createArtistOtherTracks(e){return{itemType:si.Album,src:this.getSrc("other-tracks",e),title:"Other Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createOtherTracksPager(e),synthetic:!0}}createArtistTopTracks(e){return{itemType:si.Album,src:this.getSrc("top-tracks",e),title:"Top Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createTopTracksPager(e),synthetic:!0}}createArtistVideos(e){return{itemType:si.Album,src:this.getSrc("videos",e),title:"Music Videos",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createVideosPager(e),synthetic:!0}}createOtherTracksPager(e){return this.createPager({params:{originalTitle:e.title,type:Pd.Track}})}createTopTracksPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/popular`},{maxSize:20})}createVideosPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/extras`})}createPager(e,t,n){return new om(Object.assign(Object.assign(Object.assign(Object.assign({},this.request),{params:void 0}),e),{host:this.isTidal?Md:e.host}),Object.assign(Object.assign({},t),{serviceId:this.serviceId}),n)}fixTrackTitle(e){return e&&(e=(e=e.replace(/(\([^)]*\))\s*\1/g,"$1")).replace(/(\([^)]*\)\s*\[[^\]]*\]).*/g,"$1")),e}}om.minPageSize=10,om.plexMaxPageSize=1e3,om.tidalMaxPageSize=100;const lm=om;var cm=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const um={view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},dm={view:"details",fields:["AlbumTrack","Artist","Title","Duration","PlayCount","Rate"]},mm={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},hm={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]},pm={id:"plex/recently-added",title:"Recently Added",icon:"recently-added",itemType:si.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","AddedAt"]},search:()=>new lm({path:Ld(),params:{type:Pd.Track,"album.addedAt>>":"-6mon",sort:"album.addedAt:desc"}})},fm={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new lm({path:Ld(),params:{type:Pd.Track,"lastViewedAt>":"0",sort:"lastViewedAt:desc"}})},ym={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:si.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new lm({path:Ld(),params:{type:Pd.Track,"viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"}})},vm={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:si.Media,lockActionsStore:!0,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new lm({path:Ld(),params:{type:Pd.Track,"track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},bm={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:si.Album,lockActionsStore:!0,layout:um,secondaryLayout:dm,search:()=>new lm({path:Ld(),params:{type:Pd.Album,"album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},gm={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:si.Artist,lockActionsStore:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:dm,search:()=>new lm({path:Ld(),params:{type:Pd.Artist,"artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},wm={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,layout:mm,secondaryLayout:hm,search:()=>(Dd(),new lm({path:"/playlists/all",params:{type:Pd.Playlist,playlistType:"audio",sort:"addedAt:desc"}}))},Em={id:"plex/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search:()=>(Dd(),new lm({path:"/playlists/all",params:{type:Pd.Playlist,playlistType:"audio",readOnly:"0",smart:"0"}}))},km={id:"plex/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:si.Album,viewType:Sa.ByGenre,search:e=>e?new lm({path:Ld(),params:{genre:e.id,type:Pd.Album}}):new wi},xm={id:"plex/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:si.Artist,viewType:Sa.ByGenre,defaultHidden:!0,search:e=>e?new lm({path:Ld(),params:{genre:e.id,type:Pd.Artist}}):new wi},Sm={id:"plex/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:si.Album,viewType:Sa.ByDecade,search:e=>e?new lm({path:Ld(),params:{decade:e.id,type:Pd.Album}}):new wi},Tm={id:"plex/random-tracks",title:"Random Tracks",icon:"shuffle",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new lm({path:Ld(),params:{type:Pd.Track,sort:"random"}},{maxSize:100})},Pm={id:"plex/random-albums",title:"Random Albums",icon:"shuffle",itemType:si.Album,layout:um,secondaryLayout:dm,search:()=>new lm({path:Ld(),params:{type:Pd.Album,sort:"random"}},{maxSize:100})},Am={id:"plex/videos",title:"Music Videos",icon:"video",itemType:si.Media,mediaType:li.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search:({q:e=""}={})=>new lm({path:Ld("extras/all"),params:{title:e,type:Pd.Artist,extraType:Pd.Episode}})},Im={id:"plex/folders",title:"Folders",icon:"folder",itemType:si.Folder,viewType:Sa.Folders,search(){const e={itemType:si.Folder,src:"plex:folder:",title:"Folders",fileName:"",path:""};return e.pager=new Gi((()=>cm(this,void 0,void 0,(function*(){return kd.libraries.map((({id:t,title:n})=>{const r={itemType:si.Folder,src:`plex:folder:/library/sections/${t}/folder`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new wi([i]),s=new lm({path:`library/sections/${t}/folder`,params:{includeCollections:"1"}},void 0,r);return r.pager=new Qi(a,s),r}))})))),e.pager}},Cm={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",serviceType:Dr.PersonalMedia,defaultHidden:!0,get internetRequired(){return kd.internetRequired},roots:[$m(si.Media,{title:"Tracks",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]}}),$m(si.Album,{title:"Albums"}),$m(si.Artist,{title:"Artists"}),$m(si.Playlist,{title:"Playlists",layout:mm,secondaryLayout:hm})],sources:[vm,bm,gm,ym,pm,fm,wm,km,xm,Sm,Tm,Pm,Am,Im],editablePlaylists:Em,get audioLibraries(){return kd.audioLibraries},get libraryId(){return kd.libraryId},set libraryId(e){kd.libraryId=e},get libraries(){return kd.libraries},set libraries(e){kd.libraries=e},observeLibraryId:()=>kd.observeLibraryId(),addToPlaylist:function(e,t){return cm(this,void 0,void 0,(function*(){return Ud.addToPlaylist(e,t)}))},canRate:Om,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:n=[]}={}){return cm(this,void 0,void 0,(function*(){return{src:`plex:playlist:${(yield Ud.createPlaylist(e,t,n)).ratingKey}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,id:e.src,icon:"pin",isPin:!0,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},search:()=>new lm({path:`/playlists/${Nm(e)}`,params:{type:Pd.Playlist,playlistType:"audio"}})}},getFilters:function(e,t){return cm(this,void 0,void 0,(function*(){return Ud.getFilters(e,t)}))},getMetadata:function(e){return cm(this,void 0,void 0,(function*(){if(!Om(e)||void 0!==e.rating)return e;const t=ni.getRating(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const n=Nm(e),[r]=yield Ud.getMetadata([n]);return Object.assign(Object.assign({},e),{rating:Math.round((r.userRating||0)/2)})}))},getPlayableUrl:function(e){return Ud.getPlayableUrl(e)},getPlaybackType:function(e){return cm(this,void 0,void 0,(function*(){return Ud.getPlaybackType(e)}))},getThumbnailUrl:function(e){return e.replace("{plex-token}",kd.serverToken)},lookup:function(e,t,n=10,r){return cm(this,void 0,void 0,(function*(){return e&&t?bi(new lm({path:"/library/search",params:{query:`${e} ${t}`,searchTypes:"music",limit:50,type:Sd.Track}},{pageSize:n,maxSize:n,lookup:!0}),{timeout:r}):[]}))},rate:function(e,t){return cm(this,void 0,void 0,(function*(){yield Ud.fetch({path:"/:/rate",method:"PUT",params:{key:Nm(e),identifier:"com.plexapp.plugins.library",rating:2*t||-1}})}))},observeConnectionLogging:Xd,observeIsLoggedIn:Qd,isConnected:function(){return!!kd.server},isLoggedIn:Jd,login:Zd,logout:em},Mm=Cm;function Om(e,t){if(t||!e.src.startsWith("plex:"))return!1;switch(e.itemType){case si.Album:return!e.synthetic;case si.Artist:return!0;case si.Media:return e.mediaType===li.Audio;default:return!1}}function $m(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>function(e,t,n,r){Dd();const i=e===si.Playlist?"/playlists/all":Ld(),a=Object.assign({},void 0);return t&&(a.title=t.trim()),a.type=_d(e),e===si.Playlist&&(a.playlistType="audio"),new lm({path:i,params:a},void 0)}(e,t)})}function Nm({src:e}){const[,,t]=e.split(":");return t}const zm=new Z("services"),jm=zm.getJson("hidden",{}),Lm=new ct(jm),Dm=zm.getBoolean("allowAll");function Rm(e){return!function(e){var t;return null!==(t=Lm.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function Fm(e){const t=Lm.getValue(),n=Object.assign(Object.assign({},t),e);zm.setJson("hidden",n),Lm.next(n)}var _m=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Bm="plex-tidal",Vm={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Um={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Hm={id:`${Bm}/library-tracks`,title:"My Tracks",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:Vm,search:()=>ah(Pd.Track)},qm={id:`${Bm}/library-albums`,title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search:()=>ah(Pd.Album)},Ym={id:`${Bm}/library-artists`,title:"My Artists",icon:"heart",itemType:si.Artist,lockActionsStore:!0,search:()=>ah(Pd.Artist)},Km={id:`${Bm}/library-playlists`,title:"My Playlists",icon:"heart",itemType:si.Playlist,lockActionsStore:!0,layout:Um,search:()=>(ch(),oh("/playlists/all",{sort:"addedAt:desc"}))},Wm={id:`${Bm}/editable-playlists`,title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search:()=>oh("/playlists/all",{readOnly:"0",smart:"0"})},Gm={id:`${Bm}/library-videos`,title:"My Videos",icon:"heart",itemType:si.Media,mediaType:li.Video,defaultHidden:!0,layout:Vm,search:()=>ah(Pd.MusicVideo)},Jm={id:`${Bm}/my-mixes`,title:"Recommended",icon:"playlist",itemType:si.Playlist,layout:Um,search:()=>(ch(),oh("/hubs/sections/tidal/myMixes"))},Qm={id:`${Bm}/plex-picks`,title:"Plex Picks",icon:"album",itemType:si.Album,defaultHidden:!0,search:()=>oh("/hubs/sections/tidal/plexPicks")},Xm={id:`${Bm}/new-playlists`,title:"New Playlists",icon:"playlist",itemType:si.Playlist,defaultHidden:!0,layout:Um,search:()=>oh("/hubs/sections/tidal/newPlaylists")},Zm={id:Bm,name:"TIDAL",icon:Bm,url:"https://tidal.com/",serviceType:Dr.PublicMedia,primaryMediaType:li.Audio,authService:Mm,internetRequired:!0,defaultHidden:!0,roots:[ih(si.Media,{title:"Tracks",layout:Vm}),ih(si.Album,{title:"Albums"}),ih(si.Artist,{title:"Artists"})],sources:[Hm,qm,Ym,Km,Gm,Jm,Xm,Qm],icons:{[ii.AddToLibrary]:"heart",[ii.RemoveFromLibrary]:"heart-fill"},labels:{[ii.AddToLibrary]:"Add to My TIDAL",[ii.RemoveFromLibrary]:"Remove from My TIDAL"},editablePlaylists:Wm,addToPlaylist:function(e,t){return _m(this,void 0,void 0,(function*(){return Ud.addToPlaylist(e,t,Md)}))},canRate:()=>!1,canStore:nh,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:n=[]}={}){return _m(this,void 0,void 0,(function*(){return{src:`plex-tidal:playlist:${(yield Ud.createPlaylist(e,t,n,Md)).ratingKey}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search:()=>oh(`/playlists/${lh(e)}`,{type:Pd.Playlist,playlistType:"audio"})}},getDrmInfo:function(e){if((null==e?void 0:e.playbackType)===_r.DASH){const t=kd.drm,n="fairplay"===t,r={type:t,keySystem:n?"com.apple.fps.1_0":H[t],license:rh(e).replace(/\.(mpd|m3u8)/,"/license")};return n&&(r.certificate="https://resources.tidal.com/drm/fairplay/certificate"),r}},getMetadata:function(e){return _m(this,void 0,void 0,(function*(){if(!nh(e)||void 0!==e.inLibrary)return e;const t=ni.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const n=lh(e),[r]=yield Ud.getMetadata([n],Md);return Object.assign(Object.assign({},e),{inLibrary:r.saved})}))},getPlayableUrl:rh,getPlaybackType:function(e){return _m(this,void 0,void 0,(function*(){return e.mediaType===li.Video?_r.HLS:_r.DASH}))},getThumbnailUrl:function(e){return Mm.getThumbnailUrl(e)},lookup:function(e,t,n=10,r){return _m(this,void 0,void 0,(function*(){if(!kd.hasTidal||!e||!t)return[];e=e.replace(/\s*([,;&|/x×]|(\b(feat\.?|ft\.?|featuring|with)\s))\s*/gi," ").trim();const i=e=>_m(this,void 0,void 0,(function*(){return bi(sh(Sd.Track,e,n,{pageSize:n,maxSize:n,lookup:!0}),{timeout:r})}));let a=yield i(`${e} ${t}`);return 0===a.length&&(a=yield i(t)),a}))},store:function(e,t){return _m(this,void 0,void 0,(function*(){yield Ud.fetch({host:Md,path:"/actions/"+(t?"save":"unsave"),method:"PUT",params:{ratingKey:lh(e)}})}))},observeIsLoggedIn:function(){return qr([Mm.observeIsLoggedIn(),(e=Zm,Lm.pipe(He((()=>Rm(e))),Kr()))]).pipe(He((([e,t])=>e&&t)),Kr());var e},isConnected:function(){return Mm.isConnected()&&Rm(Zm)},isLoggedIn:th,login:Zd,logout:em},eh=Zm;function th(){return Mm.isLoggedIn()&&Rm(Zm)}function nh(e){switch(e.itemType){case si.Album:return!e.synthetic;case si.Artist:case si.Media:return!0;default:return!1}}function rh(e){const{userToken:t}=kd;if(t&&th()){const n=e.srcs||[];let r=n[0];switch(kd.streamingQuality){case gd.Lossless:r=n[0];break;case gd.High:r=n[1];break;case gd.Low:r=n[2]}if(r||(r=n[0]),!r)throw Error("No playable source");const i=Ud.getHeaders(t,kd.drm),a=new URLSearchParams(i);return`${Md}${r}?${a}`}throw Error("Not logged in")}function ih(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`${Bm}/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>(t=t.trim())?sh(function(e,t){switch(e){case si.Album:return Sd.Album;case si.Artist:return Sd.Artist;case si.Playlist:return Sd.Playlist;default:return void 0===li.Video?Sd.Clip:Sd.Track}}(e),t):new wi})}function ah(e){return ch(),oh("/library/sections/saved/all",{type:e})}function sh(e,t,n=100,r){return new lm({host:Od,path:"/library/search",params:{query:t,limit:n,type:e,searchTypes:"music"}},Object.assign(Object.assign({},r),{serviceId:Bm}))}function oh(e,t,n){return new lm({host:Md,path:e,params:t},Object.assign(Object.assign({},n),{serviceId:Bm}))}function lh({src:e}){const[,,t]=e.split(":");return t}function ch(){if(!kd.hasTidal)throw new pi}var uh=n(1984);const dh=new(n.n(uh)()),mh=new Z("spotify/auth"),hh=new Z("spotify/user","memory"),ph={get clientId(){return Si||mh.getString("clientId")},set clientId(e){mh.setString("clientId",e)},get codeVerifier(){return mh.getString("code_verifier")},set codeVerifier(e){mh.setString("code_verifier",e)},get market(){return hh.getString("market")},set market(e){hh.setString("market",e)},get token(){return mh.getJson("token")},set token(e){mh.setJson("token",e)},get userId(){return hh.getString("userId")},set userId(e){hh.setString("userId",e)},clear(){mh.removeItem("token"),hh.clear()}};var fh=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const yh=new K("spotifyAuth"),vh=location.hostname,bh=("localhost"===vh?`http://${vh}:${location.port}`:`https://${vh}`)+"/auth/spotify/callback/",gh="https://accounts.spotify.com";let wh;const Eh=new ct("");function kh(){return Eh.pipe(Kr())}function xh(){return!!ph.token}function Sh(){return""!==Eh.getValue()}function Th(){return fh(this,void 0,void 0,(function*(){yh.log("refreshToken");const e=ph.token,t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${gh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:ph.clientId,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw yield Ih(),e;const n=yield e.json();return yield Ph(n),n.access_token}throw yield Ih(),Error("No 'refresh_token'")}))}function Ph(e){return fh(this,void 0,void 0,(function*(){try{const{access_token:t}=e;ph.token=e,dh.setAccessToken(t),yield Ch(),Ah(t)}catch(e){yh.error(e),yield Ih()}}))}function Ah(e){Eh.next(e)}function Ih(){return fh(this,void 0,void 0,(function*(){ph.clear(),Eh.next(""),yield function(){return fh(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();ph.codeVerifier=e,wh=yield function(e){return fh(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}()}))}function Ch(){return fh(this,void 0,void 0,(function*(){if(!ph.userId){const e=yield dh.getMe();ph.userId=e.id,ph.market=e.country}}))}fh(void 0,void 0,void 0,(function*(){const e=ph.token;try{if(e){try{dh.setAccessToken(e.access_token),yield Ch(),xh()&&Ah(e.access_token)}catch(e){if(401!==e.status||!xh())throw e;yield Th()}return}}catch(e){yh.error(e)}yield Ih()}));var Mh=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Oh=new K("SpotifyPager");class $h{constructor(e,t,n){this.defaultConfig={pageSize:$h.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new Wi(((t=this.defaultConfig.pageSize)=>Mh(this,void 0,void 0,(function*(){var r;const i=(this.pageNumber-1)*t,a=()=>Mh(this,void 0,void 0,(function*(){const{items:r,total:a,next:s}=yield e(i,t);return this.pageNumber++,{items:r.map((e=>this.createMediaObject(e,n))),total:a,atEnd:!s}}));try{return yield a()}catch(e){if(401===e.status)return yield Th(),yield a();if(429===e.status){const t=Number(null===(r=e.headers)||void 0===r?void 0:r.get("Retry-After"));if(t&&t<=10)return yield A(1e3*t),yield a();throw e}throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new de,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(rt((e=>this.addUserData(e)))).subscribe(Oh)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:si.Media,mediaType:li.Audio,playbackType:_r.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable||void 0,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var n;return{itemType:si.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(n=e.tracks)||void 0===n?void 0:n.total,pager:this.createAlbumPager(e),inLibrary:t}}createMediaArtist(e){return{itemType:si.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createMediaPlaylist(e,t){const n=e.owner.id===ph.userId;return{itemType:si.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?P(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistItemsPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:na.isPinned(e.uri),isOwn:n,inLibrary:!n&&t}}createMediaItemFromTrack(e,t){var n,r,i,a,s;const o=/album|compilation/i.test((null===(n=e.album)||void 0===n?void 0:n.album_type)||"")?e.album:void 0;return{itemType:si.Media,mediaType:li.Audio,playbackType:_r.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(r=e.artists)||void 0===r?void 0:r.map((e=>e.name)),albumArtist:null==o?void 0:o.artists.map((e=>e.name)).join(", "),album:null==o?void 0:o.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:e.disc_number,track:e.track_number,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(s=e.album)||void 0===s?void 0:s.images,unplayable:!1===e.is_playable||void 0,inLibrary:t}}createArtistAlbumsPager(e){const t=this.getMarket(),n=this.createArtistTopTracks(e),r=new wi([n]),i=new $h(((n,r)=>Mh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield dh.getArtistAlbums(e.id,{offset:n,limit:r,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:s}}))));return new Qi(r,i)}createArtistTopTracks(e){return{itemType:si.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){const t=this.getMarket();return new $h(((n,r)=>Mh(this,void 0,void 0,(function*(){const{tracks:i}=yield dh.getArtistTopTracks(e.id,t,{offset:n,limit:r,market:t});return{items:i,next:""}}))),{pageSize:30,maxSize:100})}createAlbumPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.total_tracks)return new Gi((()=>Mh(this,void 0,void 0,(function*(){const t=n.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addUserData(t),t}))));{const t=this.getMarket();return new $h(((n,r)=>Mh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield dh.getAlbumTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:s}}))))}}createPlaylistItemsPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.tracks.total)return new Gi((()=>Mh(this,void 0,void 0,(function*(){const e=n.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addUserData(e),e}))));{const t=this.getMarket();return new $h(((n,r)=>Mh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield dh.getPlaylistTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:s}}))))}}getMarket(){return ph.market}addUserData(e){return Mh(this,void 0,void 0,(function*(){const t=e[0];if(t){const n=e.filter((e=>void 0===e.inLibrary&&Kh.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===n.length)return;let r=[];r=t.itemType===si.Album?yield dh.containsMySavedAlbums(n):yield dh.containsMySavedTracks(n),Xr(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:r[t]}}))))}}))}}$h.minPageSize=10,$h.maxPageSize=50;const Nh=$h;var zh=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const jh={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Lh={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},Dh={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:si.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new Nh(((e,t)=>zh(this,void 0,void 0,(function*(){const{items:e,total:n}=yield dh.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:n,next:void 0}}))),{maxSize:50,pageSize:50})}},Rh={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:si.Media,layout:jh,search(){return new Nh(((e,t)=>zh(this,void 0,void 0,(function*(){return dh.getMyTopTracks({offset:e,limit:t})}))))}},Fh={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:si.Artist,search(){return new Nh(((e,t)=>zh(this,void 0,void 0,(function*(){return dh.getMyTopArtists({offset:e,limit:t})}))))}},_h={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:jh,search(){const e=Xh();return new Nh(((t,n)=>zh(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield dh.getMySavedTracks({offset:t,limit:n,market:e});return{items:r.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},Bh={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search(){const e=Xh();return new Nh(((t,n)=>zh(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield dh.getMySavedAlbums({offset:t,limit:n,market:e});return{items:r.map((e=>e.album)),total:i,next:a}}))),{pageSize:20},!0)}},Vh={id:"spotify/playlists",title:"My Playlists",icon:"heart",itemType:si.Playlist,lockActionsStore:!0,secondaryLayout:Lh,search(){const e=Xh();return new Nh(((t,n)=>zh(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield dh.getUserPlaylists(ph.userId,{offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))),void 0,!0)}},Uh={id:"spotify/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:si.Playlist,search(){const e=Xh(),t=ph.userId;let n=0;return new Nh(((r,i)=>zh(this,void 0,void 0,(function*(){const{items:a,total:s,next:o}=yield dh.getUserPlaylists(t,{offset:r,limit:i,market:e}),[l,c]=m(a,(e=>e.owner.id===t));return n+=c.length,{items:l,total:s-n,next:o}}))),void 0,!0)}},Hh={id:"spotify/featured-playlists",title:"Recommended",icon:"playlist",itemType:si.Playlist,secondaryLayout:Lh,search(){const e=Xh();return new Nh(((t,n)=>zh(this,void 0,void 0,(function*(){const{playlists:{items:r,total:i,next:a}}=yield dh.getFeaturedPlaylists({offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))))}},qh={id:"spotify/new-albums",title:"New releases",icon:"album",itemType:si.Album,secondaryLayout:Lh,defaultHidden:!0,search(){const e=Xh();return new Nh(((t,n)=>zh(this,void 0,void 0,(function*(){const{albums:{items:r,total:i,next:a}}=yield dh.getNewReleases({offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))))}},Yh={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",serviceType:Dr.PublicMedia,primaryMediaType:li.Audio,defaultHidden:!0,internetRequired:!0,restrictedAccess:!0,editablePlaylists:Uh,roots:[Jh(si.Media,{title:"Songs",layout:jh}),Jh(si.Album,{title:"Albums"}),Jh(si.Artist,{title:"Artists"}),Jh(si.Playlist,{title:"Playlists",secondaryLayout:Lh})],sources:[_h,Bh,Vh,Dh,Rh,Fh,Hh,qh],icons:{[ii.AddToLibrary]:"heart",[ii.RemoveFromLibrary]:"heart-fill"},labels:{[ii.AddToLibrary]:"Add to Spotify Library",[ii.RemoveFromLibrary]:"Remove from Spotify Library"},addToPlaylist:function(e,t){return zh(this,void 0,void 0,(function*(){if(null==t?void 0:t.length){const[,,n]=e.src.split(":"),r=u(t,100);for(const e of r)yield dh.addTracksToPlaylist(n,e.map((e=>e.src)))}}))},canRate:()=>!1,canStore:Wh,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:n=!1,items:r}={}){return zh(this,void 0,void 0,(function*(){const i=ph.userId,a=yield dh.createPlaylist(i,{name:e,description:t,public:n});if(null==r?void 0:r.length){const e=u(r,100);for(const t of e)yield dh.addTracksToPlaylist(a.id,t.map((e=>e.src)))}return{src:a.uri,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),n=Xh();return new Nh((()=>zh(this,void 0,void 0,(function*(){return{items:[yield dh.getPlaylist(t,{market:n,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return zh(this,void 0,void 0,(function*(){if(!Wh(e)||void 0!==e.inLibrary)return e;const t=ni.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,n]=e.src.split(":");switch(e.itemType){case si.Album:{const[t]=yield dh.containsMySavedAlbums([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case si.Media:{const[t]=yield dh.containsMySavedTracks([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case si.Playlist:{const[t]=yield dh.areFollowingPlaylist(n,[ph.userId]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},getPlaybackType:function(){return zh(this,void 0,void 0,(function*(){return _r.IFrame}))},getTracksById:function(e){return zh(this,void 0,void 0,(function*(){const t=e.slice(0,50),n=Xh(),r=new Nh((()=>zh(this,void 0,void 0,(function*(){const{tracks:e}=yield dh.getTracks(t,{market:n});return{items:e,total:e.length}}))),{maxSize:50,pageSize:50},!0);return bi(r)}))},lookup:function(e,t,n=10,r){return zh(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," ");return bi(Qh(si.Media,`${i(e)} ${i(t)}`,{pageSize:n,maxSize:n,lookup:!0}),{timeout:r})}))},lookupByISRC:function(e,t,n){return zh(this,void 0,void 0,(function*(){if(0===e.length)return[];const r=Qh(si.Media,e.map((e=>`isrc:${e}`)).join("+"),{pageSize:t,maxSize:t,lookup:!0});return(yield bi(r,{timeout:n})).filter((e=>!e.unplayable))}))},store:function(e,t){return zh(this,void 0,void 0,(function*(){return Gh([e],t)}))},bulkStore:function(e,t){return zh(this,void 0,void 0,(function*(){const n=e[0];if(!n)return;let r=0;switch(n.itemType){case si.Media:r=500;break;case si.Album:r=200;break;case si.Playlist:r=10}if(0===r)return;const i=u(e,r);for(const e of i)yield Gh(e,t)}))},observeIsLoggedIn:function(){return kh().pipe(He((e=>""!==e)),Kr())},isConnected:xh,isLoggedIn:Sh,login:function(){return fh(this,void 0,void 0,(function*(){if(!Sh()){yh.log("connect");try{const e=yield function(){return fh(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let n=null;const r=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",r,!1),null==n||n.close(),n=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return fh(this,void 0,void 0,(function*(){const t=ph.codeVerifier,n=yield fetch(`${gh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:ph.clientId,grant_type:"authorization_code",code:e,redirect_uri:bh,code_verifier:t})});if(!n.ok)throw n;return yield n.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",r,!1);const i=new URLSearchParams({client_id:ph.clientId,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:bh,response_type:"code",code_challenge_method:"S256",code_challenge:wh});n=window.open(`${gh}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==n?void 0:n.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}();yield Ph(e)}catch(e){yh.error(e)}}}))},logout:function(){return fh(this,void 0,void 0,(function*(){yh.log("disconnect"),yield Ih()}))}},Kh=Yh;function Wh(e,t){switch(e.itemType){case si.Album:return!e.synthetic;case si.Media:return!0;case si.Playlist:return!e.isOwn&&!t;default:return!1}}function Gh(e,t){return zh(this,void 0,void 0,(function*(){const n=e[0];if(!n)return;const r=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>zh(this,void 0,void 0,(function*(){switch(n.itemType){case si.Album:t?yield Promise.all(u(r,20).map((e=>dh.addToMySavedAlbums(e)))):yield Promise.all(u(r,20).map((e=>dh.removeFromMySavedAlbums(e))));break;case si.Media:t?yield Promise.all(u(r,50).map((e=>dh.addToMySavedTracks(e)))):yield Promise.all(u(r,50).map((e=>dh.removeFromMySavedTracks(e))));break;case si.Playlist:t?yield Promise.all(r.map((e=>dh.followPlaylist(e)))):yield Promise.all(r.map((e=>dh.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield Th(),yield i()}}))}function Jh(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Qh(e,t)})}function Qh(e,t,n){return t?new Nh(function(e,t){const n=Xh();switch(e){case si.Media:return(e,r)=>zh(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:s}}=yield dh.searchTracks(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case si.Album:return(e,r)=>zh(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:s}}=yield dh.searchAlbums(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case si.Artist:return(e,r)=>zh(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:s}}=yield dh.searchArtists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case si.Playlist:return(e,r)=>zh(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:s}}=yield dh.searchPlaylists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));default:throw TypeError("Search not supported for this type of media")}}(e,t),Object.assign({maxSize:250},n)):new wi}function Xh(){return ph.market}function Zh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=nr(e);return _e((function(t,r){for(var i=e.length,a=new Array(i),s=e.map((function(){return!1})),o=!1,l=function(t){et(e[t]).subscribe(Be(r,(function(e){a[t]=e,o||s[t]||(s[t]=!0,(o=s.every($e))&&(s=null))}),be))},c=0;c<i;c++)l(c);t.subscribe(Be(r,(function(e){if(o){var t=ae([e],ie(a));r.next(n?n.apply(void 0,ae([],ie(t))):t)}})))}))}function ep(e){return Ue((function(t,n){return e<=n}))}function tp(e,t){return t?function(n){return lr(t.pipe(Vi(1),_e((function(e,t){e.subscribe(Be(t,be))}))),n.pipe(tp(e)))}:rt((function(t,n){return et(e(t,n)).pipe(Vi(1),function(e){return He((function(){return e}))}(t))}))}function np(e,t){void 0===t&&(t=Bn);var n=Hn(e,t);return tp((function(){return n}))}var rp,ip,ap,sp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},op=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},lp=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const cp=new K("SpotifyPlayer"),up="Spotify player not connected",dp=(e,t)=>e.paused===t.paused&&e.position===t.position;rp=new WeakMap,ip=new WeakMap,ap=new WeakMap;const mp=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new ct(!0),this.src$=new ct(""),this.currentTrackSrc$=new ct(""),this.error$=new Le,this.playerReady$=new ct(!1),this.playerStarted$=new ct(!1),this.state$=new ct(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,rp.set(this,!1),ip.set(this,!0),ap.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{cp.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(Ue((e=>""!==e)),rt((e=>this.connect(e))),ut((()=>this.playerReady$.next(!0))),Vi(1)).subscribe(cp)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe(rt((()=>this.player.activateElement()))).subscribe(cp),this.observeReady().pipe(rt((()=>this.safeVolume(this.muted?0:this.volume)))).subscribe(cp),this.observeReady().pipe(mr((()=>this.observeIsLoggedIn())),mr((e=>e?this.observePaused():ur)),mr((e=>e?ur:this.observeSrc())),Zh(this.observeAccessToken()),mr((([e,t])=>e&&e!==this.loadedSrc?wr(void 0).pipe(mr((()=>this.loadError?this.reconnect(t):wr(void 0))),rt((()=>this.addToQueue(e,t))),Jr((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),ur))),Vi(1)):ur))).subscribe(cp),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe(ut((e=>{var t,n;const r=null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri;r&&this.loadedSrc===this.src&&this.currentTrackSrc!==r&&this.currentTrackSrc$.next(r)}))).subscribe(cp),this.currentTrackSrc$.pipe(Ue((e=>!!e)),mr((()=>this.observeCurrentTrackState().pipe(ep(2),rt((e=>!e.paused&&this.paused?(cp.log("State mismatch: pausing..."),this.safePause()):e.paused&&!this.paused?(cp.log("State mismatch: resuming..."),this.safePlay()):wr(void 0))),Vi(1))))).subscribe(cp),this.observeIsLoggedIn().pipe(Rr((e=>e===this.isLoggedIn)),ut((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(up))}))).subscribe(cp),this.observeIsLoggedIn().pipe(Ue((e=>e)),Vi(1),rt((()=>c("https://sdk.scdn.co/spotify-player.js")))).subscribe(cp),this.observeError().subscribe(cp.error)}get autoplay(){return op(this,rp,"f")}set autoplay(e){op(this,rp,"f")!==e&&(lp(this,rp,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return op(this,ip,"f")}set muted(e){op(this,ip,"f")!==e&&(lp(this,ip,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return op(this,ap,"f")}set volume(e){op(this,ap,"f")!==e&&(lp(this,ap,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return dr(this.observeCurrentTrackState(),this.observePaused().pipe(mr((e=>e?this.getCurrentState():qn(250).pipe(rt((()=>this.getCurrentState()))))))).pipe(He((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc?e.position/1e3:0})),Kr())}observeDuration(){return this.observeCurrentTrackState().pipe(He((e=>e.duration/1e3)),Kr())}observeEnded(){return this.observePlaying().pipe(mr((()=>this.observeCurrentTrackState())),Kr(dp),Zh(this.observePaused()),He((([e,t])=>!t&&e.paused&&0===e.position)),Ue((e=>e)),He((()=>{})))}observeError(){return this.error$}observePlaying(){return this.currentTrackSrc$.pipe(mr((e=>e?this.observeCurrentTrackState().pipe(Kr(dp),Zh(this.observePaused()),He((([e,t])=>!t&&!e.paused)),Kr(),Ue((e=>e)),He((()=>{})),Vi(1)):ur)))}observeCurrentTrackState(){return this.observeState().pipe(Ue((e=>{var t,n;return(null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc})))}appendTo(){}load({src:e}){cp.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(up))}play(){var e;cp.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.isLoggedIn||this.error$.next(Error(up))}pause(){cp.log("pause"),this.paused$.next(!0),this.safePause()}stop(){cp.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return sp(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(He((e=>!!e)),Kr())}observePaused(){return this.paused$.pipe(Kr())}observeReady(){return qr([this.playerReady$,this.playerStarted$]).pipe(Ue((([e,t])=>e&&t)),He((()=>{})),Vi(1))}observeSrc(){return this.src$.pipe(Kr())}observeState(){return this.state$.pipe(Ue(l))}addToQueue(e,t,n=3){var r;return sp(this,void 0,void 0,(function*(){if(e!==this.src)return;if(!t)throw Error(up);const i=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!i.ok){if(n>0)switch(i.status){case 401:{const t=yield Th();return this.addToQueue(e,t,--n)}case 429:{const n=Number(null===(r=i.headers)||void 0===r?void 0:r.get("Retry-After"));if(n&&n<=5)return yield A(1e3*n),this.addToQueue(e,t,0);throw i}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--n)}throw i}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return sp(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{let r=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>sp(this,void 0,void 0,(function*(){r&&(e=yield Th()),r=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",n),i.addListener("authentication_error",n),i.addListener("account_error",n),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{cp.log("not_ready"),this.deviceId="",n("not_ready")})),i.addListener("ready",(({device_id:e})=>{cp.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return sp(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return sp(this,void 0,void 0,(function*(){return cp.log("reconnect"),Fe(or(this.disconnect()).pipe(np(1e3),rt((()=>this.connect(e))),np(3e3),He((()=>{}))))}))}safePause(){return sp(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){cp.error(e)}}))}safePlay(){return sp(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return sp(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){cp.error(e)}}))}safeVolume(e){var t;return sp(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){cp.error(e)}}))}}(kh());var hp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const pp=new K("SubsonicLoginDialog");function fp(e){const t=(0,r.useCallback)(((e,t,n)=>hp(this,void 0,void 0,(function*(){const r=n=>hp(this,void 0,void 0,(function*(){const r=new URLSearchParams(Object.assign(Object.assign({u:t},n),{c:"ampcast",f:"json"})).toString(),i=yield fetch(`${e}/rest/ping?${r}`);if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return JSON.stringify({userName:t,credentials:r})}));try{const e=Ia(12),t=vo()(n+e);return yield r({t,s:e,v:"1.13.0"})}catch(e){if(40===e.code)throw e;return pp.log("Login failed. Attempting legacy login...."),yield r({p:n,v:"1.12.0"})}}))),[]);return r.createElement(Aa,Object.assign({},e,{service:_p,settings:ku,userName:ku.userName,login:t}))}var yp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const vp=new K("subsonicAuth"),bp=new ct(""),gp=new ct(!1);function wp(){return gp.getValue()}function Ep(e){ku.credentials=e,bp.next(e)}bp.pipe(Kr()).pipe(Ue((e=>""!==e)),rt((()=>function(){return yp(this,void 0,void 0,(function*(){try{const e=yield Ou.getMusicLibraries();return ku.libraries=e,!0}catch(e){return 40===e.code?ku.credentials="":vp.error(e),bp.next(""),!1}}))}()))).subscribe(gp),bp.next(ku.credentials);var kp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class xp{constructor(e,t,n,r){this.parent=r,this.pageNumber=1,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new Wi((()=>kp(this,void 0,void 0,(function*(){const n=this.pageSize,r=(this.pageNumber-1)*n,{items:i,total:a,atEnd:s}=yield t(r,n);return this.pageNumber++,{items:i.map((t=>this.createMediaObject(e,t))),total:a,atEnd:s}}))),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e,t){let n;switch(e){case si.Album:n=this.createMediaAlbum(t);break;case si.Artist:n=this.createMediaArtist(t);break;case si.Playlist:n=this.createMediaPlaylist(t);break;case si.Folder:n=this.createFolderItem(t);break;default:n=this.createMediaItem(t)}return n}createMediaItem(e){return"video"===e.type?this.createMediaItemFromVideo(e):this.createMediaItemFromSong(e)}createFolderItem(e){return"type"in e?this.createMediaItem(e):this.createMediaFolder(e)}createMediaItemFromSong(e){return{itemType:si.Media,mediaType:li.Audio,playbackType:_r.Direct,src:`subsonic:audio:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,artists:[e.artist],album:e.album,duration:e.duration,track:e.track,disc:e.discNumber,year:e.year,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,thumbnails:this.createThumbnails(e.coverArt)}}createMediaItemFromVideo(e){return{itemType:si.Media,mediaType:li.Video,playbackType:_r.Direct,src:`subsonic:video:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,duration:e.duration,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,thumbnails:this.createThumbnails(e.id)}}createMediaAlbum(e){return{itemType:si.Album,src:`subsonic:album:${e.id}`,title:e.name,addedAt:this.parseDate(e.created),artist:e.artist,year:e.year,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,pager:this.createAlbumTracksPager(e),thumbnails:this.createThumbnails(e.coverArt),subsonic:{isDir:e.isDir}}}createMediaArtist(e){return{itemType:si.Artist,src:`subsonic:artist:${e.id}`,title:e.name,pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.coverArt),inLibrary:!!e.starred}}createMediaPlaylist(e){const t=`subsonic:playlist:${e.id}`;return{src:t,itemType:si.Playlist,title:e.name,description:e.comment,addedAt:this.parseDate(e.created),duration:e.duration,trackCount:e.songCount,pager:this.createPlaylistItemsPager(e),thumbnails:this.createThumbnails(e.coverArt),isPinned:na.isPinned(t),isOwn:e.owner===ku.userName,owner:{name:e.owner}}}createMediaFolder(e){var t;const n=e.title||"[unknown]",r={itemType:si.Folder,src:`subsonic:folder:${e.id}`,title:n,fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,n=t){return{url:`${ku.host}/rest/getCoverArt?id=${e}&size=${t}&{subsonic-credentials}`,width:t,height:n}}getFileName(e){return e.split(/[/\\]/).pop()}createAlbumTracksPager(e){return e.song?new wi(e.song.map((e=>this.createMediaObject(si.Media,e)))):new xp(si.Media,(()=>kp(this,void 0,void 0,(function*(){return{items:yield Ou.getAlbumTracks(e.id,e.isDir),atEnd:!0}}))))}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new wi([t]),r=e.album?new wi(e.album.map((e=>this.createMediaObject(si.Album,e)))):new xp(si.Album,(()=>kp(this,void 0,void 0,(function*(){return{items:yield Ou.getArtistAlbums(e.id),atEnd:!0}}))),void 0);return new Qi(n,r)}createArtistTopTracks(e){return{itemType:si.Album,src:`subsonic:top-tracks:${e.id}`,title:"Top Songs",artist:e.name,thumbnails:this.createThumbnails(e.coverArt),pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){return new xp(si.Media,(()=>kp(this,void 0,void 0,(function*(){return{items:yield Ou.getArtistTopTracks(e.name),atEnd:!0}}))))}createPlaylistItemsPager(e){return e.entry?new wi(e.entry.map((e=>this.createMediaObject(si.Media,e)))):new xp(si.Media,(()=>kp(this,void 0,void 0,(function*(){return{items:yield Ou.getPlaylistItems(e.id),atEnd:!0}}))))}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new xp(si.Folder,(()=>kp(this,void 0,void 0,(function*(){return{items:yield Ou.getMusicDirectoryItems(n),atEnd:!0}}))),{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===si.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new wi([e]);return new Qi(t,r)}return r}}xp.minPageSize=10,xp.maxPageSize=500;const Sp=xp;var Tp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Pp="subsonic",Ap={id:"subsonic/liked-songs",title:"My Songs",icon:"heart",itemType:si.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search(){return new Sp(si.Media,(()=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getLikedSongs(),atEnd:!0}}))))}},Ip={id:"subsonic/liked-albums",title:"My Albums",icon:"heart",itemType:si.Album,lockActionsStore:!0,search(){return new Sp(si.Album,((e,t)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getLikedAlbums(e,t)}}))))}},Cp={id:"subsonic/recently-played",title:"Recently Played",icon:"clock",itemType:si.Album,search(){return new Sp(si.Album,((e,t)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getRecentlyPlayed(e,t)}}))))}},Mp={id:"subsonic/most-played",title:"Most Played",icon:"most-played",itemType:si.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},secondaryLayout:{view:"details",fields:["Index","Title","Artist","Duration","PlayCount"]},search(){return new Sp(si.Album,((e,t)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getMostPlayed(e,t)}}))))}},Op={id:"subsonic/playlists",title:"Playlists",icon:"playlist",itemType:si.Playlist,layout:{view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},search(){return new Sp(si.Playlist,(()=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getPlaylists(),atEnd:!0}}))))}},$p={id:"subsonic/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:si.Media,viewType:Sa.ByGenre,defaultHidden:!0,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},search(e){return e?new Sp(si.Media,((t,n)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getSongsByGenre(e.id,t,n),total:e.count}})))):new wi}},Np={id:"subsonic/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:si.Album,viewType:Sa.ByGenre,search(e){return e?new Sp(si.Album,((t,n)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getAlbumsByGenre(e.id,t,n),total:e.count}})))):new wi}},zp={id:"subsonic/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:si.Album,viewType:Sa.ByDecade,search(e){return e?new Sp(si.Album,((t,n)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getAlbumsByDecade(e.id,t,n)}})))):new wi}},jp={id:"subsonic/random-tracks",title:"Random Songs",icon:"shuffle",itemType:si.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search(){return new Sp(si.Media,(()=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getRandomSongs(100),atEnd:!0}}))))}},Lp={id:"subsonic/random-albums",title:"Random Albums",icon:"shuffle",itemType:si.Album,search(){return new Sp(si.Album,(()=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getRandomAlbums(100),atEnd:!0}}))))}},Dp={id:"subsonic/videos",title:"Music Videos",icon:"video",itemType:si.Media,mediaType:li.Video,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Duration"]},search(){return new Sp(si.Media,(()=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.getVideos(),atEnd:!0}}))))}},Rp={id:"subsonic/folders",title:"Folders",icon:"folder",itemType:si.Folder,viewType:Sa.Folders,search(){const e={itemType:si.Folder,src:"",title:"Folders",fileName:"",path:""},t=(e,t)=>e.name.localeCompare(t.name);return e.pager=new Gi((()=>Tp(this,void 0,void 0,(function*(){return ku.libraries.filter((({id:e})=>!!e)).map((({id:n,title:r})=>{const i={itemType:si.Folder,src:`subsonic:folder:${n}`,title:r,fileName:r,path:`/${r}`},a=Object.assign(Object.assign({},e),{fileName:"../"}),s=new wi([a]),o=new Sp(si.Folder,(()=>Tp(this,void 0,void 0,(function*(){return{items:(yield Ou.getIndexes(n)).map((e=>e.artist.map((({id:e,name:t})=>({id:e,name:t,title:t}))))).flat().sort(t),atEnd:!0}}))),void 0,i);return i.pager=new Qi(s,o),i}))})))),e.pager}},Fp={id:Pp,icon:Pp,name:"Subsonic",url:"http://www.subsonic.org/",serviceType:Dr.PersonalMedia,defaultHidden:!0,roots:[Vp(si.Media,{title:"Songs"}),Vp(si.Album,{title:"Albums"}),Vp(si.Artist,{title:"Artists"})],sources:[Ap,Ip,Cp,Mp,Op,$p,Np,zp,jp,Lp,Dp,Rp],labels:{[ii.AddToLibrary]:"Like on Subsonic",[ii.RemoveFromLibrary]:"Unlike on Subsonic"},editablePlaylists:Op,get audioLibraries(){return ku.audioLibraries},get libraryId(){return ku.libraryId},set libraryId(e){ku.libraryId=e},get libraries(){return ku.libraries},set libraries(e){ku.libraries=e},observeLibraryId:()=>ku.observeLibraryId(),addToPlaylist:function(e,t){return Tp(this,void 0,void 0,(function*(){const n=Hp(e);return Ou.addToPlaylist(n,t.map(Hp))}))},canRate:()=>!1,canStore:Bp,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:n=!1,items:r=[]}={}){return Tp(this,void 0,void 0,(function*(){return{src:`subsonic:playlist:${(yield Ou.createPlaylist(e,t,n,r.map(Hp))).id}`,title:e,itemType:si.Playlist,pager:new wi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:si.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search(){const t=Hp(e);return new Sp(si.Playlist,(()=>Tp(this,void 0,void 0,(function*(){return{items:[yield Ou.getPlaylist(t)],atEnd:!0}}))))}}},getFilters:function(e,t){return Tp(this,void 0,void 0,(function*(){return Ou.getFilters(e,t)}))},getMetadata:function(e){var t;return Tp(this,void 0,void 0,(function*(){const n=e.itemType,r=Hp(e);if(n===si.Album){if(e.synthetic)return e;if(void 0===e.description){const n=yield Ou.getAlbumInfo(r,null===(t=e.subsonic)||void 0===t?void 0:t.isDir);e=Object.assign(Object.assign({},e),{description:P(n.notes),release_mbid:n.musicBrainzId})}}else if(n===si.Artist&&void 0===e.description){const t=yield Ou.getArtistInfo(r);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!Bp(e)||void 0!==e.inLibrary)return e;const i=ni.getInLibrary(e);if(void 0!==i)return Object.assign(Object.assign({},e),{inLibrary:i});if(n===si.Album){const t=yield Up(e),n=yield Ou.getMusicDirectory(t);return Object.assign(Object.assign({},e),{inLibrary:n.starred})}{const t=yield Ou.getSong(r);return Object.assign(Object.assign({},e),{inLibrary:t.starred})}}))},getPlayableUrl:function({src:e}){return Ou.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{subsonic-credentials}",ku.credentials)},lookup:function(e,t,n=10,r){return Tp(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return bi(new Sp(si.Media,((n,r)=>Tp(this,void 0,void 0,(function*(){return{items:yield Ou.searchSongs(`${e} ${t}`,n,r)}}))),i),{timeout:r})}))},store:function(e,t){return Tp(this,void 0,void 0,(function*(){const n=t?"star":"unstar";switch(e.itemType){case si.Media:{const[,,t]=e.src.split(":");yield Ou.get(n,{id:t});break}case si.Album:{const t=yield Up(e);yield Ou.get(n,{id:t});break}}}))},observeIsLoggedIn:function(){return gp.pipe(Kr())},isConnected:function(){return!!ku.credentials},isLoggedIn:wp,login:function(){return yp(this,void 0,void 0,(function*(){if(!wp()){vp.log("connect");try{const e=yield function(){return hp(this,void 0,void 0,(function*(){return vn(fp,!0)}))}();if(e){const{userName:t,credentials:n}=JSON.parse(e);ku.userName=t,Ep(n)}}catch(e){vp.error(e)}}}))},logout:function(){return yp(this,void 0,void 0,(function*(){vp.log("disconnect"),ku.clear(),Ep(""),gp.next(!1)}))}},_p=Fp;function Bp(e){switch(e.itemType){case si.Media:return!0;case si.Album:return!e.synthetic;default:return!1}}function Vp(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`subsonic/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){return(t=t.trim())?new Sp(e,((n,r)=>Tp(this,void 0,void 0,(function*(){switch(e){case si.Media:return{items:yield Ou.searchSongs(t,n,r)};case si.Album:return{items:yield Ou.searchAlbums(t,n,r)};case si.Artist:return{items:yield Ou.searchArtists(t,n,r)};default:throw TypeError("Search not supported for this type of media")}})))):new wi}})}function Up(e){var t;return Tp(this,void 0,void 0,(function*(){const n=Hp(e);if(null===(t=e.subsonic)||void 0===t?void 0:t.isDir)return n;const[{parent:r}]=yield Ou.getAlbumTracks(n);return r||""}))}function Hp({src:e}){const[,,t]=e.split(":");return t}const qp=new K("mediaServices");function Yp(){return[ba,Kh,xs,lo,pd,Mm,eh,_p,Wc,_o,yu]}function Kp(){return Yp().filter((e=>!e.disabled))}function Wp(e){if(af(e.src))return!0;const t=nf(e);return!!(null==t?void 0:t.isLoggedIn())}function Gp(){return Kp().filter(sf)}function Jp(){return Kp().filter((e=>!!e.lookup))}function Qp(){return Kp().filter(of)}function Xp(){return Yp().filter((e=>!sf(e)))}function Zp(){return Kp().filter(cf)}function ef(){return Gp().filter((e=>e.canScrobble))}function tf(e){return Yp().find((t=>t.id===e))}function nf({src:e}={}){const[t]=String(e).split(":");return tf(t)}function rf(e){return!!e&&lf(e.src)}function af(e){const[t]=String(e).split(":");return/^(blob|file|https?|youtube)$/.test(t)}function sf(e){return uf(e,Dr.DataService)}function of(e){return uf(e,Dr.PersonalMedia)}function lf(e){if(af(e))return!0;const[t,n,r]=String(e).split(":");return!!r&&!!n&&function(e){const t=tf(e);return!!t&&t.serviceType!==Dr.DataService}(t)}function cf(e){return uf(e,Dr.PublicMedia)}function uf(e,t){return function(e){return!!e&&"serviceType"in e}(e)&&e.serviceType===t}if(ni.registerServices(Kp()),!Dm||Wc.disabled){let e=!1;const t={};if(Wc.disabled&&Rm(Wc)&&(t[Wc.id]=!0,e=!0),!Dm){const n=Zp().filter(Rm);if(n.length>1){let r=n;if(kd.hasTidal||(r=S(r,(e=>e!==eh))),r.length>1&&(r=S(r,(e=>e.isConnected())),r.length>1)){const e=[ba,eh,Kh,Wc];for(;r.length>1&&e.length>0;){const t=e.pop();r=S(r,(e=>e!==t))}}const[i]=r;for(const e of n)e!==i&&(t[e.id]=!0,e.isConnected()&&!e.authService&&e.logout());e=!0}}e&&Fm(t)}function df({service:e,showConnectivity:t,showRestrictedAccess:n}){const i=e.authService||e,a=n&&cf(e)&&e.restrictedAccess;return r.createElement(In,{className:"media-service-label",icon:e.icon,text:e===i?`${e.name}${a?" *":""}`:r.createElement(r.Fragment,null,e.name," ",r.createElement("span",{className:`auth-service auth-service-${i.id} ${t?"show-connectivity":""}`,title:`via ${i.name}`},i.name)),showConnectivity:t})}or(Kp()).pipe(rt((e=>e.observeIsLoggedIn().pipe(Rr((e=>!e)),ut((t=>qp.log(`${e.id} ${t?"":"dis"}connected`))))))).subscribe(qp);var mf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function hf(e){var{id:t,item:n,index:i,selected:a}=e,s=mf(e,["id","item","index","selected"]);const o=(0,r.useCallback)((e=>{e.target.focus()}),[]);return r.createElement("button",Object.assign({},s,{className:"tab",type:"button",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`,onMouseDown:o}),n.tab)}function pf({id:e,item:t,index:n,hidden:i}){return r.createElement("div",{className:"tab-panel",id:`${e}-panel-${n}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${n}`},t.panel)}function ff({label:e,items:t,className:n=""}){const i=(0,r.useId)(),a=(0,r.useRef)(null),[s,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(0);(0,r.useEffect)((()=>{o(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,r.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),s.length-1);const n=s[t];n&&!n.disabled&&n.focus()}),[l,s]),d=(0,r.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return r.createElement("div",{className:`tab-list ${n}`},r.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>r.createElement("li",{role:"presentation",key:t},r.createElement(hf,{id:i,item:e,index:t,selected:t===l}))))),r.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>r.createElement(pf,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}const yf=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useId)(),n="https://github.com/rekkyrosso/ampcast-electron/releases",i="https://www.reddit.com/r/ampcast",a=(0,r.useCallback)((()=>{return t=this,n=void 0,a=function*(){var t;if(R.isElectron){const n=e.current.value;n!==location.port&&(yield Pn({title:"Change Port",message:r.createElement("p",null,"You will lose all of your current settings associated with this port number",r.createElement("br",null),"and the app will reload."),okLabel:"Continue",system:!0}))&&(at.port=n,null===(t=window.ampcastElectron)||void 0===t||t.setPort(Number(n)))}},new((i=void 0)||(i=Promise))((function(e,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,n||[])).next())}));var t,n,i,a}),[]);return r.createElement("form",{className:"app-settings-general",method:"dialog",onSubmit:a},r.createElement("fieldset",null,r.createElement("legend",null,"About"),r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-version`},"Version:"),r.createElement("output",{id:`${t}-version`},"0.9.5")))),R.isElectron?r.createElement("fieldset",null,r.createElement("legend",null,"Server"),r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-port`},"Port:"),r.createElement("input",{id:`${t}-port`,type:"number",defaultValue:location.port,min:80,max:49151,step:1,ref:e})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-web`},"Web:"),r.createElement("output",{id:`${t}-web`},r.createElement(rc,{href:location.origin},location.origin))))):r.createElement("fieldset",null,r.createElement("legend",null,"Download"),r.createElement("p",{className:"service-link"},r.createElement(rc,{href:n},n.slice(8)))),r.createElement("fieldset",null,r.createElement("legend",null,"Support"),r.createElement("p",{className:"service-link"},r.createElement(rc,{href:i},i.slice(8)))),r.createElement(kn,null))}),null)}];function vf(){return r.createElement(ff,{className:"app-settings",items:yf,label:"App Settings"})}function bf(e,t){const[n,i]=(0,r.useState)(t);return(0,r.useEffect)((()=>{const t=e().subscribe(i);return()=>t.unsubscribe()}),[e]),n}function gf(){return bf((0,r.useMemo)((()=>()=>dr(en.observe(),Jt.observeUserThemes()).pipe(He((()=>Object.assign({},en.current))))),[]),en.current)}function wf(){return bf((0,r.useMemo)((()=>()=>Jt.observeUserThemes()),[]),[])}var Ef=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function kf(e){var{icon:t,className:n=""}=e,i=Ef(e,["icon","className"]);return r.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${n}`,type:"button",onMouseDown:E,onMouseUp:w}),r.createElement(ot,{name:t}))}var xf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Sf(e){var{colorName:t,onChange:n}=e,i=xf(e,["colorName","onChange"]);const a=(0,r.useCallback)((e=>{const r=e.target.value;en[t]=r,null==n||n(r)}),[t,n]);return r.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function Tf({label:e,backgroundColorName:t,textColorName:n,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:s,nextSuggestion:o,trackingColor:l="frame"}){const c=gf(),u=i&&a,d=c[t],m=c[n],[h,p]=(0,r.useState)((()=>d||i||"")),[f,y]=(0,r.useState)((()=>m||a||"")),v=!d&&!m,b=(0,r.useCallback)((()=>{if(s&&o){const[e,r]=s;en[t]=e,en[n]=r,o()}}),[t,n,s,o]),g=(0,r.useCallback)((()=>{v?(en[t]=h,en[n]=f):(en[t]="",en[n]="")}),[v,t,n,h,f]),w=(0,r.useCallback)((()=>{const e=en[t],r=en[n];en[t]=r,en[n]=e}),[t,n]);return r.createElement("p",{className:"color-pair "+(v?"locked":"")},r.createElement("label",null,e,":"),r.createElement(Sf,{colorName:t,value:d||i,title:`${e} background color`,disabled:v,onChange:p}),r.createElement(kf,{icon:"swap",title:"Swap",onClick:w,disabled:v}),r.createElement(Sf,{colorName:n,value:m||a,title:`${e} text color`,disabled:v,onChange:y}),u?r.createElement(kf,{icon:v?"locked":"unlocked",title:v?"Allow editing":`Lock to ${l} color`,onClick:g}):null,s&&o?r.createElement("button",{className:"small",type:"button",onClick:b},"Suggest"):null)}function Pf(e,t){const n=new It(e),r=new It(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)}function Af(e,t,n={includeFallbackColors:!1,level:"AA",size:"small"}){let r=null,i=0;const{includeFallbackColors:a,level:s,size:o}=n;for(const n of t){const t=Pf(e,n);t>i&&(i=t,r=new It(n))}return function(e,t,n={level:"AA",size:"small"}){const r=Pf(e,t);switch((n.level??"AA")+(n.size??"small")){case"AAsmall":case"AAAlarge":return r>=4.5;case"AAlarge":return r>=3;case"AAAsmall":return r>=7;default:return!1}}(e,r,{level:s,size:o})||!a?r:(n.includeFallbackColors=!1,Af(e,["#fff","#000"],n))}let If=null,Cf="none";const Mf="text/ampcast-items",Of={get type(){return Mf},set:function(e,t,n){e.dataTransfer.setData(Mf,"#globalDrag"),e.dataTransfer.effectAllowed=n,If=t,Cf=n},unset:function(){If=null,Cf="none"},getData:function(e){return"#globalDrag"===e.dataTransfer.getData(Mf)?If:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData(Mf)?Cf:"none"}};function $f({style:e,title:t}){return r.createElement("div",{className:"list-view-cell",style:e},t)}function Nf({col:e,onResize:t}){const[n,i]=(0,r.useState)(-1),[a,s]=(0,r.useState)(0),o=-1!==n,{width:l,index:c}=e,u=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&(i(e.screenX),s(l))}),[l]);(0,r.useEffect)((()=>t(e.index,l)),[e.index,l,t]);const d=(0,r.useCallback)((e=>{t(c,Math.max(20,a+(e.screenX-n)))}),[n,a,c,t]),m=(0,r.useCallback)((()=>{i(-1),s(0)}),[]);return(0,r.useEffect)((()=>{if(o)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[o,d,m]),r.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+l-4+"px"}})}function zf({width:e,height:t,cols:n,sizeable:i,onColumnResize:a}){const s=(0,r.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return r.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},r.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},n.map((e=>r.createElement($f,Object.assign({},e,{key:e.index}))))," ",i&&n.map((e=>r.createElement(Nf,{col:e,onResize:s,key:e.index})))))}function jf({rowIndex:e,col:{className:t="",render:n,style:i},item:a}){return r.createElement("div",{className:`list-view-cell ${t}`,style:i},n(a,e))}function Lf({item:e,className:t,id:n,rowIndex:i,height:a,selected:s,cols:o,setSize:l,dragIndex:c}){const u=`${t} ${s?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return r.createElement("li",{role:"option",className:`list-view-row ${u}`,id:n,"aria-selected":s,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},o.map((t=>r.createElement(jf,{rowIndex:i,col:t,item:e,key:t.index}))))}function Df({listViewId:e,title:t,width:n,height:i,rowHeight:a,cols:s,items:o,itemKey:l,itemClassName:c,selectedId:u,selectedIds:d,scrollTop:m,overScan:h=2,draggable:p,dragIndex:f,multiple:y=!1}){const v=(0,r.useRef)(null),b=o.length,g=Math.floor(m/a),w=Math.floor(i/a),E=Math.max(0,g-h),k=Math.min(b,w+2*h),x=o.slice(E,E+k);return r.createElement("ol",{role:"listbox",className:"list-view-body",draggable:p,style:{width:n?`${n}px`:void 0},"aria-label":t,"aria-multiselectable":y,"aria-activedescendant":u,ref:v},x.map(((t,n)=>r.createElement(Lf,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+n,height:a,selected:!!t&&d.includes(t[l]),cols:s,item:t,setSize:b,dragIndex:f,key:t[l]}))))}const Rf=[],Ff=()=>"",_f=["ArrowUp","ArrowDown","PageUp","PageDown"];function Bf({items:e=[],itemKey:t,title:n,itemClassName:i=Ff,layout:a,className:s="",selectedIndex:o=-1,draggable:c,droppable:u,droppableTypes:d=[],multiple:m,reorderable:h,disabled:p,onClick:f,onDoubleClick:y,onContextMenu:v,onDrop:b,onDelete:g,onEnter:w,onInfo:E,onRowIndexChange:k,onScrollIndexChange:x,onPageSizeChange:S,onSelect:T,onMove:P,listViewRef:A}){const I=(0,r.useId)(),C=(0,r.useRef)(null),M=(0,r.useRef)(null),O=(0,r.useRef)(null),$=(0,r.useRef)(null),N=(0,r.useRef)(null),z="details"===a.view&&a.showTitles,j="details"===a.view&&a.sizeable,[L,D]=(0,r.useState)(-1),[F,_]=(0,r.useState)(0),[B,V]=(0,r.useState)(0),[U,H]=(0,r.useState)(0),[q,Y]=(0,r.useState)(0),[K,W]=function(e){const[t,n]=(0,r.useState)([]),i="details"===e.view&&e.sizeable;(0,r.useEffect)((()=>{const t="details"===e.view,r=t&&e.sizeable;n(e.cols.reduce(((e,n,i)=>{const a=e[i-1],s=a?a.left+a.width:0,{title:o="",className:l="",align:c="left",width:u=200}=n,d=r?{left:`${s}px`,width:`${u}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},n),{title:o,className:l,align:c,index:i,left:s,width:u,style:d})),e}),[]))}),[e]);const a=(0,r.useCallback)(((e,r)=>{i&&t[e].width!==r&&n(t.reduce(((t,n,i)=>{if(i>=e){const a=t[i-1],s=a?a.left+a.width:0,o=i===e?r:n.width,l={left:`${s}px`,width:`${o}px`,textAlign:n.align};t.push(Object.assign(Object.assign({},n),{left:s,width:o,style:l}))}else t.push(n);return t}),[]))}),[t,i]);return[t,a]}(a),G=(0,r.useMemo)((()=>K.reduce(((e,t)=>e+t.width),0)),[K]),J=q?Math.max(Math.floor(B/q),1)-(z?1:0):0,Q=e.length,{selectedItems:X,selectAll:Z,selectAt:ee,selectRange:te,toggleSelectionAt:ne}=function(e,t,n){const[i,a]=(0,r.useState)([]),s=kr(e);(0,r.useEffect)((()=>{if(e!==s){const s=e.filter((e=>i.some((n=>n[t]===e[t]))));if(o=s,(r=i).length!==o.length||!r.every(((e,t)=>o[t]===e))){const t=e.length;if(t>0&&0===s.length)if(n<t){const t=e[n];a(t?[t]:[])}else{const n=e[t-1];a(n?[n]:[])}else a(s)}}var r,o}),[s,e,i,t,n]);const o=(0,r.useCallback)((()=>{a(e.filter(l))}),[e]),c=(0,r.useCallback)((t=>{const n=e[t];a(n?[n]:[])}),[e]),u=(0,r.useCallback)(((t,n)=>{const r=Math.min(t,n),i=Math.max(t,n),s=e.slice(r,i+1).filter(l);a(s)}),[e]),d=(0,r.useCallback)(((t,n)=>{const r=e[t],s=i.includes(r);s!==n&&a(s?i.filter((e=>e!==r)):e.filter((e=>i.includes(e)||e===r)))}),[e,i]);return{selectedItems:i,selectAll:o,selectAt:c,selectRange:u,toggleSelectionAt:d}}(e,t,L),re=X.length>0,ie=rn(),[ae,se]=(0,r.useState)(-1),[oe,le]=(0,r.useState)(-1),[ce,ue]=(0,r.useState)(-1),de=0===Q,me=-1!==ce,he=q?Math.floor(F/q):0,pe=Er(_f)&&!(0===L||L===Q-1),fe=kr(e),[ye,ve]=(0,r.useState)((()=>X)),[be,ge,we,Ee]=c||h?X:[],ke=e[L]?`${I}-${e[L][t]}`:"",xe=(0,r.useMemo)((()=>X.map((e=>e[t]))),[X,t]),Se=(0,r.useCallback)((()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.focus()}),[]),Te=(0,r.useCallback)((e=>{const t=O.current,n=Math.floor(F/q);if(e>=n+J-1){const n=(Q+(z?1:0))*q,r=Q-J-1,i=Math.min(Q-1,e+1)-J,a=i===r?n:i*q;t.scrollTo({top:a})}else if(e<=n){const n=Math.max(0,e-1)*q;t.scrollTo({top:n})}}),[F,q,J,z,Q]),Pe=(0,r.useCallback)((e=>{Te(e),ee(e),D(e)}),[Te,ee]);(0,r.useEffect)((()=>{C.current={focus:Se,scrollIntoView:Pe,scrollTo:Te,selectAll:Z,selectAt:ee},A&&(A.current=Object.assign(A.current||{},C.current))}),[A,Se,Pe,Te,Z,ee]),(0,r.useEffect)((()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView(o)}),[o]),(0,r.useEffect)((()=>null==k?void 0:k(L)),[L,k]),(0,r.useEffect)((()=>null==x?void 0:x(he)),[he,x]),(0,r.useEffect)((()=>null==S?void 0:S(J)),[J,S]),(0,r.useEffect)((()=>null==T?void 0:T(ye)),[ye,T]),(0,r.useEffect)((()=>D(Math.min(Q-1,L))),[Q,L]),(0,r.useEffect)((()=>{if(fe&&e.length!==fe.length){const n=fe[L];if(n){const r=e.findIndex((e=>e&&e[t]===n[t]));-1!==r&&D(r)}}}),[e,fe,L,t]),(0,r.useEffect)((()=>{pe||ve(X)}),[X,pe]),(0,r.useEffect)((()=>{de&&D(-1)}),[de]),(0,r.useEffect)((()=>{!m&&X.length>1&&ee(L)}),[m,L,X,ee]);const Ae=(0,r.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==w||w(X,t[R.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==g||g(X);break;case"KeyI":if(t[R.ctrlKey]&&!t.shiftKey){t.preventDefault(),t.stopPropagation(),t.repeat||null==E||E(X);break}break;case"KeyA":t[R.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||Z());break;case"ShiftLeft":case"ShiftRight":t.repeat||se(L);break;case"Space":t.preventDefault(),t.repeat||(t[R.ctrlKey]?(t.stopPropagation(),ne(L)):X.includes(e[L])||(t.stopPropagation(),ne(L,!0)));break;default:{const n=e.length,r=function(e,t,n,r){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=n-1;break;case"PageDown":t+=n-1;break;case"Home":t=0;break;case"End":t=r-1;break;default:return-1}return Math.min(Math.max(t,0),r-1)}(t.key,L,J,n);-1!==r&&(t.preventDefault(),r!==L&&(t.stopPropagation(),Te(r),D(r)),m&&t.shiftKey&&-1!==ae?te(ae,r):t[R.ctrlKey]||ee(r))}}}),[L,e,J,w,g,E,Te,Z,ee,te,ne,X,m,ae]),Ie=(0,r.useCallback)((e=>{const t=Vf(e);-1!==t&&(D(t),m&&e.shiftKey?-1===ae?te(t,L):te(ae,t):m&&e[R.ctrlKey]?ne(t):function(e){const t=Uf(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||ee(t))}),[ee,ne,te,L,ae,m]),Ce=(0,r.useCallback)((e=>{if(0===e.button){const t=Vf(e);-1!==t&&(!m||e[R.ctrlKey]||e.shiftKey||ee(t))}}),[ee,m]),Me=(0,r.useCallback)((e=>{"Shift"===e.key&&se(-1)}),[]),Oe=(0,r.useCallback)((({clientWidth:e,clientHeight:t})=>{H(e),V(t)}),[]),$e=(0,r.useCallback)((({top:e})=>{_(e)}),[]);tn($,(({height:e})=>Y(e)),"border-box"),(0,r.useEffect)((()=>{M.current.classList.toggle("thin",20*ie>U)}),[ie,U]);const Ne=(0,r.useCallback)((t=>{const n=Vf(t);-1!==n&&(t.preventDefault(),null==f||f(e[n],n))}),[e,f]),ze=(0,r.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(M.current,L);if(t){const n=t.getBoundingClientRect();null==v||v(X,Math.min(n.left+U,n.right),n.bottom,L,e.button)}}else null==v||v(X,e.pageX,e.pageY,Vf(e),e.button)}),[L,X,v,U]),je=(0,r.useCallback)((t=>{const n=Vf(t);-1!==n&&(t.preventDefault(),null==y||y(e[n],n))}),[e,y]);(0,r.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(M.current.querySelectorAll(".list-view-body:not(.list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let n=0;n<t.length;n++){const r=t[n].cloneNode(!0);r.removeAttribute("id"),r.removeAttribute("role"),r.style.transform=`translateY(${q*n}px)`,e.appendChild(r)}}),[be,ge,we,Ee,q]);const Le=(0,r.useCallback)((e=>{const t=e.dataTransfer;if(c||h){t.setDragImage(N.current,-16,-16);let n="none";n=c&&h?"copyMove":c?"copy":"move",Of.set(e,X,n),ue(L)}else t.effectAllowed="none"}),[c,h,X,L]),De=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(u||h){let n=Vf(e);-1===n&&(n=Q),me?h&&Hf(t,d)?(t.dropEffect="move",le(n)):(t.dropEffect="none",le(-1)):u&&Hf(t,d)?(t.dropEffect="copy",le(n)):(t.dropEffect="none",le(-1))}else me?t.dropEffect="copy":(t.dropEffect="none",le(-1))}),[Q,me,u,d,h]),Re=(0,r.useCallback)((e=>{if(u||h){let t=Vf(e);-1===t&&(t=Q);const n=Of.getEffect(e);if(!h||"move"!==n&&"copyMove"!==n){if(u){const n=function(e,t){const n=e.dataTransfer;switch(n.types[0]){case"Files":return Array.from(n.files).filter((e=>t.some((t=>Yf(t,e.type)))));case"text/ampcast-items":return Of.getData(e);default:return qf(n,t)}}(e,d);n&&(null==b||b(n,t))}}else{const e=ce<t?-1:0;null==P||P(X,t),D(t+e)}}le(-1),e.preventDefault(),e.stopPropagation()}),[Q,X,u,d,h,ce,b,P]),Fe=(0,r.useCallback)((()=>{Of.unset(),ue(-1)}),[]),_e=(0,r.useCallback)((e=>{const t=e.dataTransfer;"copyMove"===t.effectAllowed&&(t.dropEffect="copy"),le(-1)}),[]),Be=(0,r.useCallback)((()=>{m||re||ee(Math.max(L,0))}),[re,L,m,ee]);return r.createElement("div",{className:`list-view list-view-${a.view} ${s}`,tabIndex:p?void 0:de?-1:0,onClick:Ne,onContextMenu:ze,onDoubleClick:je,onDragStart:Le,onDragEnter:De,onDragOver:De,onDragLeave:_e,onDragEnd:Fe,onDrop:Re,onFocus:Be,onKeyDown:Ae,onKeyUp:Me,onMouseDown:Ie,onMouseUp:Ce,ref:M},r.createElement(br,{scrollWidth:j?G:void 0,scrollHeight:(Q+(u?1:0)+(z?1:0))*q,scrollAmount:q,droppable:u||h&&me,onResize:Oe,onScroll:$e,scrollableRef:O},z&&r.createElement(Yn,null,r.createElement(zf,{width:G,height:q,sizeable:j,cols:K,onColumnResize:W})),r.createElement(Df,{title:n,width:j?G:void 0,height:B,rowHeight:q,cols:K,items:e,itemKey:t,itemClassName:i,listViewId:I,selectedId:ke,selectedIds:p?Rf:xe,scrollTop:F,dragIndex:oe,draggable:!p&&(c||h),multiple:m}),r.createElement("div",{className:"list-view-cursor",style:{width:j?`${G}px`:void 0,transform:`translateY(${Math.max(L,0)*q}px)`},ref:$})),r.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function Vf(e){let t=0;const n=Uf(e);return n&&(t=Number(n.getAttribute("aria-posinset"))||0),t-1}function Uf(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function Hf(e,t){return null!==qf(e,t)}function qf(e,t){const n=[Of.type].concat(t),r=Array.from(e.items);for(const e of n)for(const t of r)if(Yf(e,t.type))return t;return null}function Yf(e,t){const[n,r]=e.split("/"),[i,a]=t.split("/");return n===i&&(r===a||"*"===r)}var Kf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wf(e){var{renderItem:t=String,className:n=""}=e,i=Kf(e,["renderItem","className"]);const a=(0,r.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return r.createElement(Bf,Object.assign({},i,{className:`list-box ${n}`,layout:a}))}var Gf=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Jf(e){return Gf(this,void 0,void 0,(function*(){return!Jt.getUserTheme(e)||Pn({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var Qf=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Xf(e){var{suggestedName:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["suggestedName"]);const i=(0,r.useId)(),a=(0,r.useMemo)((()=>e=>e.name),[]),[s,o]=(0,r.useState)(t),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u=wf(),d=(0,r.useCallback)((e=>{o(e.target.value)}),[]),m=(0,r.useCallback)((([e])=>{e&&(c.current.value=e.name,o(e.name))}),[]),h=(0,r.useCallback)((()=>Qf(this,void 0,void 0,(function*(){s&&(yield Jf(s))&&l.current.close(s)}))),[s]),p=(0,r.useCallback)((e=>Qf(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return r.createElement(fn,Object.assign({},n,{className:"save-theme-dialog",title:"Save Theme",onSubmit:p,ref:l}),r.createElement("form",{method:"dialog"},r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:i},"Name: "),r.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),r.createElement(Wf,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),r.createElement(kn,{value:s,submitText:"Save"})))}var Zf=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ey=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=gf(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useMemo)((()=>en.fontSize),[]),o=(0,r.useMemo)((()=>Jt.getDefaultThemes()),[]),l=wf(),c=!!t.userTheme;(0,r.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(en.fontSize)),()=>{en.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,r.useCallback)((()=>en.save()),[]),d=(0,r.useCallback)((()=>{const e=a.current.checked?Jt.getUserTheme(i.current.value):Jt.getDefaultTheme(n.current.value);e&&en.apply(e)}),[]),m=(0,r.useCallback)((e=>{en.fontSize=e.target.valueAsNumber}),[]);return r.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},r.createElement("fieldset",null,r.createElement("legend",null,"Theme"),r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),r.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),r.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:n},o.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))),r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),r.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),r.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))))),r.createElement("fieldset",null,r.createElement("legend",null,"Preferences"),r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"font-size"},r.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),r.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:s,onChange:m})))),r.createElement(kn,null))}),null)},{tab:"Theme Editor",panel:r.createElement((function(){const e=(0,r.useId)(),t=gf(),n=`${t.name}${en.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,s]=function(e){const[t,n]=(0,r.useState)([]),[i,a]=(0,r.useState)(-1);(0,r.useEffect)((()=>{const t=new It(e),r=h([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new It(e))),i=r.reverse().map((e=>[e.toHexString(),Af(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));n(f(i)),a(-1===i.length?-1:0)}),[e]);const s=(0,r.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],s]}(t.frameColor);(0,r.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(en.fontSize)),()=>{en.restore(),e.removeProperty("--font-size")}}),[]);const o=(0,r.useCallback)((()=>{en.save()}),[]),l=(0,r.useCallback)((()=>{!function(e){var t,n,i,a;t=this,n=void 0,a=function*(){const t=yield vn((t=>r.createElement(Xf,Object.assign({},t,{suggestedName:e}))),!0);t&&(en.name=t,en.userTheme=!0,yield Jt.save(en.current))},new((i=void 0)||(i=Promise))((function(e,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,n||[])).next())}))}(t.name)}),[t]),c=(0,r.useCallback)((e=>{en.spacing=e.target.valueAsNumber}),[]),u=(0,r.useCallback)((e=>{en.roundness=e.target.valueAsNumber}),[]),d=(0,r.useCallback)((e=>{en.flat=e.target.checked}),[]);return r.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:o},r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"theme-name"},r.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),r.createElement("input",{type:"text",id:`${e}-theme-name`,value:n,spellCheck:!1,readOnly:!0,tabIndex:-1}),r.createElement("button",{className:"small",type:"button",onClick:l},"Save as…")),r.createElement(Tf,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),r.createElement(Tf,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),r.createElement(Tf,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:s,key:`${i}/selection`}),r.createElement(Tf,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:en.defaultMediaButtonColor,defaultTextColor:en.defaultMediaButtonTextColor,key:`${i}/media-button`}),r.createElement(Tf,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:en.defaultButtonColor,defaultTextColor:en.defaultButtonTextColor,key:`${i}/button`}),r.createElement(Tf,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:en.defaultScrollbarColor,defaultTextColor:en.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),r.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),r.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),r.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),r.createElement(kn,null))}),null)},{tab:"My Themes",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useMemo)((()=>e=>e.name),[]),n=(0,r.useRef)(null),i=wf(),[a,s]=(0,r.useState)(""),[o,l]=(0,r.useState)([]),[c]=o;(0,r.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),s(""))}}),[i,a]);const u=(0,r.useCallback)((()=>Zf(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield Nn({title:"My Themes",label:"Name",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield Jf(t))&&(yield Jt.rename(e,t),s(t))}}))),[c]),d=(0,r.useCallback)((()=>Zf(this,void 0,void 0,(function*(){if(c){const e=c.name,t=Jt.getUserTheme(e);if(t){const{userTheme:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["userTheme"]);!function(e,t,n="text/json"){const r=document.createElement("a");r.href=window.URL.createObjectURL(new Blob([t],{type:n})),r.download=e,r.type=n,r.click()}(`${e}.json`,JSON.stringify(r,void 0,4))}}}))),[c]),m=(0,r.useCallback)((()=>Zf(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,n=void 0,i=function*(){return Pn({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e);t&&(yield Jt.remove(e),l([]))}}))),[c]),h=(0,r.useCallback)((()=>{n.current.click()}),[]),p=(0,r.useCallback)((e=>Zf(this,void 0,void 0,(function*(){var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(yield function(e){return t=this,n=void 0,i=function*(){try{const t=yield e.text(),n=JSON.parse(t);if(!en.validate(n))return void(yield Mn("Not a valid theme.",!0));let r=n.name,i=!1;for(;r&&!i;)r=yield Nn({title:"Import theme",suggestedValue:r,okLabel:"Import",system:!0}),r&&(i=yield Jf(r),i&&(yield Jt.save(Object.assign(Object.assign({},n),{name:r}))))}catch(e){console.error(e),yield Mn("Could not load theme.",!0)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(n),e.target.value="")}))),[]);return r.createElement("form",{className:"user-themes",method:"dialog"},r.createElement("h3",null,"My themes:"),r.createElement(Wf,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),r.createElement("p",{className:"user-themes-buttons"},r.createElement("button",{type:"button",onClick:u,disabled:!c},"Rename…"),r.createElement("button",{type:"button",onClick:d,disabled:!c},"Export…"),r.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),r.createElement("fieldset",{className:"user-themes-import"},r.createElement("legend",null,"Import themes"),r.createElement("p",null,r.createElement("input",{type:"file",accept:"text/json,.json",onChange:p,ref:n}),r.createElement("button",{type:"button",onClick:h},"Import…"))),r.createElement(kn,null))}),null)}];function ty(){return r.createElement(ff,{className:"appearance-settings",items:ey,label:"Appearance"})}function ny(){const e=(0,r.useRef)(null),t=(0,r.useId)(),n=(0,r.useCallback)((()=>{ul.preferPersonalMedia=e.current.checked}),[]);return r.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:n},r.createElement("input",{id:`${t}-lookup-preference`,type:"checkbox",defaultChecked:ul.preferPersonalMedia,ref:e}),r.createElement("label",{htmlFor:`${t}-lookup-preference`},"Prefer personal media"),r.createElement("div",{className:"note"},r.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),r.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from your preferred service is used. Otherwise your last played media service is used.")),r.createElement(kn,null))}function ry({services:e,multiSelect:t}){const n=(0,r.useId)(),i=t?"checkbox":"radio";return r.createElement("ul",{className:"media-service-list checkbox-list"},t?null:r.createElement("li",{className:"no-icon",key:"none"},r.createElement("input",{id:`${n}-none`,type:i,name:n,value:"",defaultChecked:!e.some(Rm)}),r.createElement("label",{htmlFor:`${n}-none`},"None")),e.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${n}-${e.id}`,type:i,name:t?void 0:n,value:e.id,defaultChecked:Rm(e)}),r.createElement("label",{htmlFor:`${n}-${e.id}`},r.createElement(df,{service:e,showRestrictedAccess:!0}))))))}var iy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ay=new K("confirmDisconnectServices");var sy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function oy({serviceType:e,services:t}){const n=(0,r.useRef)(null),i=e===Dr.PublicMedia,a=!i||Dm,[s,o]=(0,r.useState)((()=>!!i&&t.filter(Rm).some(ly))),l=(0,r.useCallback)((()=>sy(this,void 0,void 0,(function*(){const e=n.current.elements;let t=!1;for(const n of e){const e=n.value;e&&n.checked&&(t||(t=ly(tf(e))))}o(t)}))),[]),c=(0,r.useCallback)((()=>sy(this,void 0,void 0,(function*(){const e=n.current.elements,t={},i=[];for(const n of e){const e=n.value;if(e){const r=!n.checked;t[e]=r;const a=tf(e);a&&r&&i.push(a)}}(yield function(e){return iy(this,void 0,void 0,(function*(){let t=0===(e=e.filter((e=>e.isConnected()&&!function(e){return Kp().filter((t=>t.authService===e)).some(Rm)}(e)))).length;if(!t&&(t=yield Pn({message:r.createElement("div",{className:"confirm-disconnect-services"},r.createElement("p",null,"You will be disconnected from the following services:"),r.createElement("ul",null,e.map((e=>r.createElement("li",{key:e.id},r.createElement(df,{service:e})))))),okLabel:"Disconnect",system:!0}),t))try{yield Promise.all(e.filter((e=>!e.authService||!Rm(e.authService))).map((e=>e.logout())))}catch(e){ay.error(e)}return t}))}(i))&&Fm(t)}))),[]);return r.createElement("form",{method:"dialog",onSubmit:c},r.createElement("fieldset",{className:"media-services",onChange:i?l:void 0,ref:n},r.createElement("legend",null,"Enable"),r.createElement(ry,{services:t,multiSelect:a})),s?r.createElement("p",{className:"restricted-access"},"*Access is restricted."):null,r.createElement(kn,null))}function ly(e){return!!(null==e?void 0:e.restrictedAccess)}function cy({title:e,serviceType:t,services:n}){const i=(0,r.useMemo)((()=>{const e=[{tab:"General",panel:r.createElement(oy,{serviceType:t,services:n})}];return t===Dr.DataService&&e.push({tab:"Lookup",panel:r.createElement(ny,null)}),e}),[t,n]);return r.createElement(ff,{className:"media-services-settings",items:i,label:e})}var uy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function dy(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>uy(this,void 0,void 0,(function*(){const e=t.current.checked;Ii.useMusicKitBeta!==e&&(Ii.useMusicKitBeta=e,yield wn({title:"Reload required",message:"The app will now reload.",system:!0}),yield ba.logout(),location.reload())}))),[]);return r.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:n},r.createElement("fieldset",null,r.createElement("legend",null,"MusicKit*"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!Ii.useMusicKitBeta}),r.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:Ii.useMusicKitBeta,ref:t}),r.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),r.createElement("div",{className:"note"},r.createElement("p",null,"MusicKit beta enables playback of music videos."),r.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),r.createElement("p",null,"You will need to reload the page for changes to take effect. And you will need to log in again.")),r.createElement("p",null,r.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),r.createElement(kn,null))}var my=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function hy(e){return my(this,void 0,void 0,(function*(){const t=e.clientIdentifier;if(kd.serverId===t){const{connection:n,libraries:r}=kd;return{id:t,device:e,connection:n,libraries:r}}{const n=yield tm(e);let r=[];if(n)try{r=yield Ud.getMusicLibraries(n.uri,e.accessToken)}catch(e){console.error(e)}return{id:t,device:e,connection:n,libraries:r}}}))}function py(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=function(){const e=bf(Mm.observeIsLoggedIn,!1),[t,n]=(0,r.useState)((()=>{const{server:e,connection:t,libraries:n}=kd;return e?[{id:e.clientIdentifier,device:e,connection:t,libraries:n}]:[]}));return(0,r.useEffect)((()=>{if(e){const e=or(function(){return my(this,void 0,void 0,(function*(){const e=yield Ud.getServers();return Promise.all(e.map(hy))}))}()).subscribe(n);return()=>e.unsubscribe()}}),[e]),t}(),[a,s]=(0,r.useState)(null),[o,l]=(0,r.useState)([]),[c,u]=(0,r.useState)(kd.libraryId);(0,r.useEffect)((()=>{s(i.find((e=>e.id===kd.serverId))||i[0]||null)}),[i]),(0,r.useEffect)((()=>{l((null==a?void 0:a.libraries)||[])}),[a]);const d=(0,r.useCallback)((()=>{s(i.find((e=>e.id===t.current.value))||null)}),[i]),m=(0,r.useCallback)((()=>{u(n.current.value)}),[]),h=(0,r.useCallback)((()=>{a&&(kd.serverId!==a.id&&(kd.server=a.device,kd.connection=a.connection,kd.libraries=a.libraries,kd.libraryId===c&&(kd.libraryId="")),kd.libraryId=c)}),[a,c]);return r.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:h},r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-servers`},"Preferred Server:"),r.createElement("select",{id:`${e}-servers`,value:null==a?void 0:a.id,onChange:d,ref:t},i.map((({id:e,device:t,connection:n})=>r.createElement("option",{value:e,key:e},`${t.name}${n?"":" (offline)"}`))))),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-libraries`},"Preferred Library:"),r.createElement("select",{id:`${e}-libraries`,value:c,onChange:m,ref:n,key:null==a?void 0:a.id},o.map((({id:e,title:t})=>r.createElement("option",{value:e,key:e},t))))),r.createElement(kn,null))}function fy(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=kd.streamingQuality,i=(0,r.useCallback)((()=>{var e,n;kd.streamingQuality=null!==(n=null===(e=t.current["streaming-quality"])||void 0===e?void 0:e.value)&&void 0!==n?n:gd.Lossless}),[]);return r.createElement("form",{className:"plex-tidal-streaming-settings",method:"dialog",onSubmit:i,ref:t},r.createElement("fieldset",null,r.createElement("legend",null,"Quality"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-lossless`,value:gd.Lossless,defaultChecked:n===gd.Lossless}),r.createElement("label",{htmlFor:`${e}-lossless`},"Lossless")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-high`,value:gd.High,defaultChecked:n===gd.High}),r.createElement("label",{htmlFor:`${e}-high`},"High")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-low`,value:gd.Low,defaultChecked:n===gd.Low}),r.createElement("label",{htmlFor:`${e}-low`},"Low"))),r.createElement(kn,null))}var yy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function vy(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=!!Si,i="https://developer.spotify.com/dashboard/create",a=(0,r.useCallback)((()=>yy(this,void 0,void 0,(function*(){ph.clientId=t.current.value}))),[]);return r.createElement("form",{className:"spotify-credentials",method:"dialog",onSubmit:a},r.createElement("fieldset",null,r.createElement("legend",null,"Your App"),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),r.createElement("input",{type:"text",name:"spotify-client-id",id:`${e}-client-id`,defaultValue:ph.clientId,readOnly:n,ref:t}))),r.createElement("fieldset",null,r.createElement("legend",null,"Registration"),r.createElement("p",{className:"spotify-link service-link"},r.createElement(rc,{href:i},r.createElement(ot,{name:"spotify"}),i))),r.createElement("fieldset",{className:"spotify-credentials-requirements note"},r.createElement("legend",null,"Requirements"),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-callback`},"Redirect URI:"),r.createElement("input",{type:"text",id:`${e}-callback`,value:`${location.origin}/auth/spotify/callback/`,readOnly:!0})),r.createElement("p",null,"APIs used:"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),r.createElement("label",{htmlFor:`${e}-api1`},"Web API")),r.createElement("li",null,r.createElement("input",{type:"checkbox",id:`${e}-api2`,checked:!0,readOnly:!0}),r.createElement("label",{htmlFor:`${e}-api2`},"Web Playback SDK")))),r.createElement(kn,null))}var by=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function gy(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=!!Pi,a="https://console.cloud.google.com/apis/credentials",s=(0,r.useCallback)((()=>by(this,void 0,void 0,(function*(){yc.apiKey=t.current.value,yc.clientId=n.current.value}))),[]);return r.createElement("form",{className:"youtube-credentials",method:"dialog",onSubmit:s},r.createElement("fieldset",null,r.createElement("legend",null,"Your App"),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-api-key`},"API Key:"),r.createElement("input",{type:"text",name:"youtube-api-key",id:`${e}-api-key`,defaultValue:yc.apiKey,readOnly:i,ref:t})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),r.createElement("input",{type:"text",name:"youtube-client-id",id:`${e}-client-id`,defaultValue:yc.clientId,readOnly:i,ref:n}))),r.createElement("fieldset",null,r.createElement("legend",null,"Registration"),r.createElement("p",{className:"youtube-link service-link"},r.createElement(rc,{href:a},r.createElement(ot,{name:"youtube"}),a))),r.createElement("fieldset",{className:"youtube-credentials-requirements note"},r.createElement("legend",null,"Requirements"),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-origin`},"Authorized JavaScript origin:"),r.createElement("input",{type:"text",id:`${e}-origin`,value:location.origin,readOnly:!0})),r.createElement("p",null,"Selected APIs:"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),r.createElement("label",{htmlFor:`${e}-api1`},"YouTube Data API v3")))),r.createElement(kn,null))}var wy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Ey({service:e}){const t=e.authService||e,[n,i]=(0,r.useState)((()=>t.isConnected())),a=(0,r.useCallback)((()=>wy(this,void 0,void 0,(function*(){yield t.logout(),i(t.isConnected())}))),[t]);return r.createElement("p",null,r.createElement("button",{type:"button",className:"disconnect-button",onClick:a,disabled:!n},n?`Disconnect from ${t.name}…`:"Not connected"))}function ky({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useCallback)((()=>{const e=n.current.elements,t={};for(const n of e)t[n.value]=!n.checked;Fm(t)}),[]);return r.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:i},r.createElement(Ey,{service:e}),r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Display"),r.createElement("ul",{className:"checkbox-list"},e.sources.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:Rm(e)}),r.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),r.createElement(kn,null))}function xy({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=e.libraryId,a=function(e){const t=bf(e.observeIsLoggedIn,!1),[n,i]=(0,r.useState)((()=>e.audioLibraries||[]));return(0,r.useEffect)((()=>{if(t&&e.getLibraries){const t=or(e.getLibraries()).subscribe((t=>{e.libraries=t,i(e.audioLibraries||[])}));return()=>t.unsubscribe()}}),[e,t]),n}(e),s=(0,r.useCallback)((()=>{e.libraryId=n.current.value}),[e]);return r.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:s},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-libraries`},"Preferred Library:"),r.createElement("select",{id:`${t}-libraries`,defaultValue:i,ref:n},a.map((({id:e,title:t})=>r.createElement("option",{value:e,key:e},t))))),r.createElement(kn,null))}var Sy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Ty({service:e}){const t=(0,r.useMemo)((()=>e=>e.title),[]),[n,i]=(0,r.useState)((()=>na.getPinsForService(e.id))),[a,s]=(0,r.useState)([]),o=(0,r.useCallback)((()=>Sy(this,void 0,void 0,(function*(){const t=na.getPinsForService(e.id);yield na.unpin(t.filter((e=>-1===n.findIndex((t=>t.src===e.src)))))}))),[e,n]),l=(0,r.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),s([])}),[a]);return r.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:o},r.createElement("h3",null,"Pinned playlists:"),r.createElement(Wf,{title:"Pinned playlists",items:n,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:s}),r.createElement("p",{className:"pinned-settings-buttons"},r.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),r.createElement(kn,null))}const Py=new Z("scrobbling"),Ay=new ct(Py.getJson("noScrobble",{})),Iy=new ct(Py.getJson("options",{}));function Cy(e,t){var n;const r=Ay.getValue()[e.id];return!(null!==(n=null==r?void 0:r[t.id])&&void 0!==n?n:t.defaultNoScrobble)}function My(e,t){const n=Ay.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});Py.setJson("noScrobble",a),Ay.next(a)}function Oy(e){var t;return!!(null===(t=Iy.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function $y(e,t){const n=Iy.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});Py.setJson("options",a),Iy.next(a)}const Ny={canScrobble:Cy,setNoScrobble:My,canUpdateNowPlaying:Oy,updateOptions:$y};function zy({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useMemo)(Xp,[]),s=(0,r.useCallback)((()=>{const t=n.current.elements,r={};for(const e of t)r[e.value]=!e.checked;My(e,r);const a=i.current.elements,s={};for(const e of a)s[e.value]=e.checked;$y(e,s)}),[e]);return r.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:s},r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Scrobble"),r.createElement("ul",null,a.map((n=>r.createElement("li",{key:n.id},r.createElement("input",{id:`${t}-${n.id}`,type:"checkbox",value:n.id,defaultChecked:Cy(e,n),disabled:"youtube"===n.id}),r.createElement("label",{htmlFor:`${t}-${n.id}`},n.name)))))),r.createElement("fieldset",{ref:i},r.createElement("legend",null,"Options"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:Oy(e)}),r.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),r.createElement(kn,null))}function jy({service:e}){const t=(0,r.useMemo)((()=>{const t=[{tab:"General",panel:r.createElement(ky,{service:e})}];return"spotify"!==e.id||Si||t.push({tab:"Credentials",panel:r.createElement(vy,null)}),"youtube"!==e.id||Pi||t.push({tab:"Credentials",panel:r.createElement(gy,null)}),"libraryId"in e&&t.push({tab:"Library",panel:"plex"===e.id?r.createElement(py,null):r.createElement(xy,{service:e})}),e.serviceType===Dr.DataService&&e.canScrobble&&t.push({tab:"Scrobbling",panel:r.createElement(zy,{service:e})}),"plex-tidal"===e.id&&t.push({tab:"Streaming",panel:r.createElement(fy,null)}),e.createSourceFromPin&&t.push({tab:"Pinned",panel:r.createElement(Ty,{service:e})}),"apple"===e.id&&t.push({tab:"Beta",panel:r.createElement(dy,null)}),t}),[e]);return r.createElement(ff,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}const Ly=new Z("playlist"),Dy=new ct(Ly.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Ry={observe:function(){return Dy},get:function(){return Dy.getValue()},set:function(e){Ly.setJson("settings",e),Dy.next(e)}},Fy=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=(0,r.useMemo)((()=>Ry.get()),[]),n=bf(Ry.observe,t),i=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useRef)(null),o=(0,r.useRef)(null),l=(0,r.useCallback)((()=>{Ry.set(t)}),[t]),c=(0,r.useCallback)((()=>{Ry.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:s.current.checked,showSourceIcons:o.current.checked})}),[]);return r.createElement("form",{className:"playlist-settings-general",method:"dialog"},r.createElement("fieldset",null,r.createElement("legend",null,"Content"),r.createElement("p",null,r.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:n.allowDuplicates,onChange:c,ref:i}),r.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),r.createElement("fieldset",null,r.createElement("legend",null,"Display"),r.createElement("p",null,r.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:n.showLineNumbers,onChange:c,ref:a}),r.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:n.zeroPadLineNumbers,disabled:!n.showLineNumbers,onChange:c,ref:s}),r.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:n.showSourceIcons,onChange:c,ref:o}),r.createElement("label",{htmlFor:`${e}-source-icons`},"Show media service icons"))),r.createElement(kn,{onCancel:l}))}),null)}];function _y(){return r.createElement(ff,{className:"playlist-settings",items:Fy,label:"Playlist Settings"})}const By=new Z("visualizer/settings"),Vy={get ambientVideoEnabled(){return By.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(By.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&By.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&By.removeItem("lockedVisualizer")),Uy.next(this))},get ambientVideoSource(){return By.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(By.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&By.removeItem("lockedVisualizer"),Uy.next(this))},get ambientVideoBeats(){return By.getBoolean("ambientVideoBeats",!0)},set ambientVideoBeats(e){e!==this.ambientVideoBeats&&(By.setBoolean("ambientVideoBeats",e),Uy.next(this))},get useAmbientVideoSource(){return By.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(By.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&By.removeItem("lockedVisualizer"),Uy.next(this))},get coverArtAnimatedBackground(){return By.getBoolean("coverArtAnimatedBackground")},set coverArtAnimatedBackground(e){e!==this.coverArtAnimatedBackground&&(By.setBoolean("coverArtAnimatedBackground",e),Uy.next(this))},get coverArtBeats(){return By.getBoolean("coverArtBeats",!0)},set coverArtBeats(e){e!==this.coverArtBeats&&(By.setBoolean("coverArtBeats",e),Uy.next(this))},get fullscreenProgress(){return By.getBoolean("fullscreenProgress")},set fullscreenProgress(e){e!==this.fullscreenProgress&&(By.setBoolean("fullscreenProgress",e),Uy.next(this))},get lockedVisualizer(){return By.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:n}=e;By.setJson("lockedVisualizer",{providerId:t,name:n})}else By.removeItem("lockedVisualizer");Uy.next(this)},get provider(){return By.getString("provider")},set provider(e){var t;e!==this.provider&&(By.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&By.removeItem("lockedVisualizer"),Uy.next(this))}},Uy=new ct(Vy),Hy=Vy;function qy(){return Uy}function Yy(){return qy().pipe(He((e=>e.fullscreenProgress)),Kr())}var Ky;Ky=new WeakMap;const Wy=class{constructor(){Ky.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,Ky,"f")}set autoplay(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,Ky,e,"f")}observeCurrentTime(){return ur}observeDuration(){return ur}observeEnded(){return ur}observeError(){return ur}observePlaying(){return ur}seek(){}};var Gy,Jy,Qy=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Xy=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};Gy=new WeakMap,Jy=new WeakMap;const Zy=class{constructor(e,t){this.type=e,this.name=t,this.logger=new K(`HTML5Player/${this.type}/${this.name}`),this.element$=new ct(document.createElement(this.type)),this.error$=new Le,this.playing$=new Le,this.item=null,this.stopped=!0,this.autoplay=!1,Gy.set(this,!0),Jy.set(this,1);const n=this.element;n.hidden=!0,n.muted="video"===e,n.volume=1,n.autoplay=!1,n.className=`html5-${e} html5-${e}-${t}`,n.id=`ampcast-${e}-${t}`,n.crossOrigin="anonymous",this.element$.pipe(mr((e=>Xn(e,"error").pipe(He((()=>e.error)),Ue((e=>null!==e&&!("fatal"in e))))))).subscribe(this.error$),this.element$.pipe(mr((e=>Xn(e,"playing"))),He((()=>{}))).subscribe(this.playing$),this.error$.subscribe((e=>{this.stopped?this.logger.warn({err:e}):this.logger.error(e)}))}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return Qy(this,Gy,"f")}set muted(e){Xy(this,Gy,e,"f"),"video"===this.type&&(this.element.muted=e)}get volume(){return Qy(this,Jy,"f")}set volume(e){Xy(this,Jy,e,"f"),"video"===this.type&&(this.element.volume=e)}observeCurrentTime(){return this.element$.pipe(mr((e=>Xn(e,"timeupdate").pipe(cr(e),He((()=>e.currentTime)),He((e=>isFinite(e)?e:0))))))}observeDuration(){return this.element$.pipe(mr((e=>Xn(e,"durationchange").pipe(cr(e),He((()=>e.duration)),Ue((e=>isFinite(e)))))))}observeEnded(){return this.element$.pipe(mr((e=>Xn(e,"ended"))),He((()=>{})))}observeError(){return this.error$.pipe(Ue((()=>!this.stopped)))}observePlaying(){return this.playing$.pipe(Ue((()=>!this.stopped)))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.item=e,this.autoplay&&this.safePlay(e)}play(){this.logger.log("play"),this.safePlay(this.item)}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.stopped=!0,this.element.pause(),this.element.currentTime=0,this.element.removeAttribute("src")}seek(e){this.element.currentTime=e}resize(e,t){"video"===this.type&&(this.element.style.width=`${e}px`,this.element.style.height=`${t}px`)}get element(){return this.element$.getValue()}getMediaSrc(e){var t,n;if(e){const r=nf(e);return null!==(n=null===(t=null==r?void 0:r.getPlayableUrl)||void 0===t?void 0:t.call(r,e))&&void 0!==n?n:e.src}throw Error("No playable item")}safePlay(e){return t=this,n=void 0,i=function*(){this.stopped=!1;try{if(!e)throw Error("Player not loaded");const t=this.getMediaSrc(e);this.element.getAttribute("src")!==t&&this.element.setAttribute("src",t),yield this.element.play()}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}};var ev,tv,nv=n(2940),rv=n.n(nv),iv=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},av=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const sv=(e,t)=>e.width===t.width&&e.height===t.height,ov=16/9,lv={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,origin:location.origin,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var cv;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(cv||(cv={})),ev=new WeakMap,tv=new WeakMap;const uv=class{constructor(e){this.player=null,this.src$=new ct(""),this.size$=new ct({width:0,height:0}),this.error$=new Le,this.ready$=new Le,this.state$=new Le,this.videoId$=new ct(""),this.playerLoading=!1,ev.set(this,!0),tv.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=this.logger=new K(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",n.className="youtube-video-wrapper",r.id=this.targetId,n.append(r),t.append(n),this.observeReady().pipe(rt((()=>this.observeSrc())),Rr((e=>!e)),ut((e=>{const t=this.player,[,n,r,i="0"]=e.split(":"),a=Number(i)||0;if(r){if("playlist"===n){const e={list:r,listType:n,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(r,a):t.cueVideoById(r,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(rt((()=>this.observeVideoSize())),ut((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(Ue((e=>e===cv.ENDED&&this.loop)),ut((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(Ue((e=>e===cv.PLAYING)),ut((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(He((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),ut((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return iv(this,ev,"f")}set muted(e){iv(this,ev,"f")!==e&&(av(this,ev,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return iv(this,tv,"f")}set volume(e){iv(this,tv,"f")!==e&&(av(this,tv,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(mr((e=>{var t;return e===cv.PLAYING?Hn(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(He((()=>this.player.getCurrentTime())),hr(this.observeState())):wr((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(He((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),Ue((e=>0!==e)),Kr())}observeEnded(){return this.observeState().pipe(Ue((e=>e===cv.ENDED&&!this.loop)),He((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(Ue((e=>e===cv.PLAYING)),He((()=>{})))}observeVideoId(){return this.videoId$.pipe(Kr())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load({src:e}){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.playerLoading||this.error$.next(Error("YouTube player not loaded"))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(mr((e=>e?this.getAspectRatio(e):wr(ov))),Kr())}observeReady(){return this.ready$.pipe(Vi(1))}observeSize(){return this.size$.pipe(Kr(sv),Ue((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(Kr())}observeState(){return this.state$}observeVideoSize(){return qr([this.observeSize(),this.observeAspectRatio()]).pipe(He((([{width:e,height:t},n])=>{const r=Math.max(Math.round(e/n),t);return{width:Math.max(Math.round(r*n),e),height:r}})),Kr(sv))}createPlayer(){if(!this.player&&this.element.isConnected){this.playerLoading=!0;const e=rv()(this.targetId,{playerVars:lv,host:"https://www.youtube-nocookie.com"});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.playerLoading=!1,this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return or(Yc(e)).pipe(hr(Hn(3e3)),hr(this.observeVideoId().pipe(ep(1))),He((({aspectRatio:e})=>e||ov)),Jr((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),wr(ov)))))}getPlayerState(){return this.player?this.player.getPlayerState():cv.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return hc()(e)||""}};var dv,mv,hv,pv,fv,yv,vv,bv=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},gv=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};dv=new WeakMap,mv=new WeakMap,hv=new WeakMap,pv=new WeakMap,fv=new WeakMap,yv=new WeakMap,vv=new WeakMap;const wv=class{constructor(e,t,n,r){this.selectPlayer=t,this.loadPlayer=n,this.audio=r,this.element=document.createElement("div"),this.players=[],this.player$=new ct(null),this.error$=new Le,this.stopped=!0,dv.set(this,null),mv.set(this,!1),hv.set(this,!1),pv.set(this,!1),fv.set(this,1),yv.set(this,0),vv.set(this,0),this.element.className=e}get autoplay(){return bv(this,mv,"f")}set autoplay(e){gv(this,mv,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return bv(this,hv,"f")}set loop(e){gv(this,hv,e,"f"),this.players.forEach((t=>t.loop=e))}get muted(){return bv(this,pv,"f")}set muted(e){gv(this,pv,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e),this.audio&&(this.audio.volume=e?0:this.volume)}get volume(){return bv(this,fv,"f")}set volume(e){gv(this,fv,e,"f"),this.players.forEach((t=>t.volume=e)),this.audio&&(this.audio.volume=this.muted?0:e)}observeCurrentTime(){return this.observeCurrentPlayer().pipe(mr((e=>e?e.observeCurrentTime():wr(0))),Kr())}observeDuration(){return this.observeCurrentPlayer().pipe(mr((e=>e?e.observeDuration():ur)),Kr())}observeEnded(){return this.observeCurrentPlayer().pipe(mr((e=>e?e.observeEnded():ur)))}observeError(){return this.observeCurrentPlayer().pipe(mr((e=>e?dr(this.error$,e.observeError()):ur)),Ue((()=>!this.stopped)))}observePlaying(){return this.observeCurrentPlayer().pipe(mr((e=>e?e.observePlaying():ur)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,n=this.selectPlayer(e);if(this.player$.next(null),t&&t!==n&&(t.autoplay=!1,t.muted=!0,t.hidden=!0,t.stop()),this.autoplay&&(this.stopped=!1),this.loadError=null,!n||this.players.includes(n))if(this.player$.next(n),n)try{n.autoplay=this.autoplay,this.loadPlayer(n,e),n.muted=this.muted,n.hidden=this.hidden}catch(e){this.loadError=Error((null==e?void 0:e.message)||"Failed to load")}else this.loadError=Error("No player found");else this.loadError=Error("Player not registered")}play(){var e;this.stopped=!1,this.autoplay=!0,this.loadError?this.error$.next(this.loadError):null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.stopped=!0,this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){gv(this,yv,e,"f"),gv(this,vv,t,"f"),e*t>0&&this.players.forEach((n=>n.resize(e,t)))}registerPlayers(e){e.filter((e=>!this.players.includes(e))).forEach((e=>{e.muted=!0,e.hidden=!0,e.autoplay=this.autoplay,e.loop=this.loop,e.volume=this.volume,bv(this,yv,"f")*bv(this,vv,"f")>0&&e.resize(bv(this,yv,"f"),bv(this,vv,"f")),e.appendTo(this.element),this.players.push(e)}))}unregisterPlayers(e){const t=e.filter((e=>this.players.includes(e))),[n,r]=m(this.players,(e=>t.includes(e)));n.forEach((e=>e.stop())),this.players.length=0,this.players.push(...r)}get currentPlayer(){return this.player$.getValue()}get loadError(){return bv(this,dv,"f")}set loadError(e){gv(this,dv,e,"f"),e&&this.error$.next(e)}observeCurrentPlayer(){return this.player$.pipe(Kr())}};class Ev extends Wy{constructor({context:e,source:t},n){super(),this.name=n,this.logger=new K(`WaveformPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className=`visualizer visualizer-waveform visualizer-waveform-${n}`}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}var kv;kv=new WeakMap;const xv=class extends Ev{constructor(e){super(e,"beats"),kv.set(this,""),this.visualizer={providerId:"waveform",name:"beats",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i);r.getByteFrequencyData(a),e.clearRect(0,0,t,n),e.fillStyle=this.color,e.strokeStyle="rgba(0, 0, 0, .9)",e.lineWidth=document.fullscreenElement?2:1;const s=(t-48)/12,o=.0075*n,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const r=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*r,e.fillRect(u,n-c/2,s,c/2+4),e.strokeRect(u,n-c/2,s,c/2+4),u+=s+4}}}}}get color(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,kv,"f")||`rgba(255, 255, 255, ${document.fullscreenElement?.4:.6})`}set color(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,kv,e,"f")}load(){super.load(this.visualizer)}resize(e){const t=Math.min(Math.max(e/3,9*en.fontSize),360);super.resize(t,.225*t)}},Sv=new K("AmbientVideoPlayer");class Tv extends Wy{constructor(e){super(),this.storage=new Z("ambientVideoPlayer"),this.beatsPlayer=new xv(e),this.videoPlayer=this.createVideoPlayer(this.beatsPlayer),qy().pipe(He((e=>e.ambientVideoBeats)),Kr(),ut((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(Sv),qy().pipe(He((e=>e.ambientVideoSource)),Kr(),ep(1),ut((()=>this.storage.removeItem("user-progress")))).subscribe(Sv)}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!Hy.ambientVideoBeats}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.beatsPlayer.load()}play(){Sv.log("play"),this.videoPlayer.play(),Hy.ambientVideoBeats&&this.beatsPlayer.play()}pause(){Sv.log("pause"),this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){Sv.log("stop"),this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t),this.beatsPlayer.resize(e)}createVideoPlayer(e){const t=new Zy("video","ambient"),n=this.createYouTubePlayer(),r=new wv("ambient-video-player",(e=>e?e.src.startsWith("youtube:")?n:t:null),((e,t)=>{const n=t.src;if(n.startsWith("youtube:")){const[,,t]=n.split(":"),r=this.getProgressKey(),i=this.storage.getJson(r,{})[t]||("progress"===r?120:0);e.load({src:`${n}:${i}`})}else e.load({src:n})}));return r.loop=!0,r.volume=0,r.hidden=!0,r.registerPlayers([t,n,e]),r.unregisterPlayers([e]),r}createYouTubePlayer(){const e=new uv("ambient");return e.observeVideoId().pipe(mr((t=>t?e.observeCurrentTime().pipe(He(Math.round),Kr(),Ue((e=>e>0&&e%20==0)),Zh(e.observeDuration()),Ue((([,e])=>e>120)),ut((([e])=>{const n=this.getProgressKey(),r=this.storage.getJson(n,{});r[t]=e,this.storage.setJson(n,r)}))):ur))).subscribe(Sv),e}getProgressKey(){return Hy.useAmbientVideoSource&&Hy.ambientVideoSource?"user-progress":"progress"}}function Pv(e,t){return void 0===t&&(t=Bn),_e((function(n,r){var i=null,a=null,s=null,o=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function l(){var n=s+e,a=t.now();if(a<n)return i=this.schedule(void 0,n-a),void r.add(i);o()}n.subscribe(Be(r,(function(n){a=n,s=t.now(),i||(i=t.schedule(l,e),r.add(i))}),(function(){o(),r.complete()}),void 0,(function(){a=i=null})))}))}var Av=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};let Iv=0;class Cv extends uv{constructor(e){super("loader-"+Iv++),this.load({src:e})}loadPlaylist(){return Av(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return ur}loadDuration(){return Av(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const n=this.observeCued(),r=dr(this.observeError(),Hn(3e3).pipe(He((()=>Error("timeout")))));n.pipe(hr(r),Vi(1)).subscribe({next:e}),r.pipe(hr(n),Vi(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(Ue((e=>e===cv.CUED)),He((()=>{})),Vi(1))}}const Mv="\n9HI3UVKoesg rOSUaprXqiY etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw SDxtzBm5vD4\nA1m0SEqmmbE 9uZ8CCa0t4Y 35CTu7dWzo8 wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY QxE5VqaQ6oE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nQxS6PpMArMU IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\ntOWGsyt40t8 QLbPYQcUcgM xwf7EssFnXU -Pail6FITXc vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c VWHTlq5Fcr8 ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE OiRqM-4c14Y\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k fVRSSNkq3Bk\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\n9IENFNxy5i8 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 hg2FDCmqNkg tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM 3F4l-6GwkKM F399teRPBaY 2jw2eAIW8sU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk JFMT1tU17TM FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs fmsTHHtxAug l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc eXcbc2gmDsA rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E TX9U62sj5nM\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 KPV1hFJIXrg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bWG0rEB6gmc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\nvuLm2t58qIQ FDqQlAUDZyk R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU fd8spJiYS0k 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI MntPfBulD2o _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow 2FE1_YK5OPI pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE RKWLu6UHryQ\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI wjMf_bEfqIc hNC6-bxHJac\nJBm1ainuk-c PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg 8quqk2FPRgQ p7G1lkYIFTM RzE9pczkYU4 7TML_MTQdg4\nFGCIBbg0IYk oaQ8UXlKDiw 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\nD4mdWvVONyg eQIzdzSTH08 tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 sYYMBV68hmE 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY dY-bDp_3krs 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 OdsIYD9F6Og _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y fWnlQnposC4 pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY xR7RK3QGmfY\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo 5bwHtF7fR94 IXSTdSv-Jlo mf5E3FDZ6rY 7JsOhtl_zG4 vr5dCRHAgb0 Di9jRVy7WHk cVdfUy_VMTY\nLD_jcIQGl0Q ZXas8NdyLsE JptSD1Jdhyw --qCu9yL5H8 74wsGjTZzGg Wey4zHA4nPg VArhsYKbKzk t76IJmQKzKA\nl1RxmWxXQcM 7HagxwgIRcY gJgwJwg6Deg 1mD8V2trqcw i5ZbYQ1Nok4 YE3iWysmcBQ vdycBdIx-do UE-J2Dt8LNs\nx_dVi_PC_sc z3oaQlq9weg gvusDEF3eh4 0wb-OBF3LOo tKC1zBZf8NM Moz3NHnVXog s7v0c2nKKGE cV9kT-xcQZw\napwA8UQ_xeE 6BcYV3gqcFA TaWhAJGUK-w oHrnBcYW6U0 iXI8oo8KpMA 4Qdd8khODKc KVKtVyhCMQ8 6h3zxMYjAwI\njMaWecFnC_8 XS3p0GDnLF4 CCc2EYQchpE Oj0l4QlC-JE pENN3OPwydk 6q81M5Xd5X8 IqS4kWK6aV0 8OUQ7eCqt50\ngdAbs95GIm4 j800SVeiS5I bZIuALduxQU UyFoYkj8dAc q5hHF9Ofu3g UrKl1h8wWpg SNpXK6omAdQ 9D53rJslwak\n91q_XSSDCDE ufUfa_wS6cc O87EBwZaC_U J_Qs64FctiA yP64H8aLEE8 Ml_PEaEBKi0 SolQqtVQ7vA al7T6Y6CoUo\nnmm0zfspmos wUtgReo4pDM 7HDlompCs58 ZsMlXu09ghs iO_Me1wspYM jHyItjAKRdY F18YfQD3s28 RgzTvK84LHo\nDOVsgCZoFLI kBbaAJMJC_k iyhP3voUf_s Ek7MAukn5P0 RpKLilRfFNE 7eN7zRJdfkM kk7tTjPOzt4 ryuJGfYs5VE\nt4NKrOr9lAY IL3990sA0ZE fVoMdt5MZKg eKWntyoSuzc kN3VMkM79c0 B6WFz8Zb9Oo avSd8c-m3Wc M3u4Mus9y_g\nPd4H-TFjSkQ jMWKm-g5V3w ZR9YaU4EYjk nVcxbSw6o5k crgLdtAGgIQ D223br7vnpk HRIczsM6bIc\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));const Ov=new K("ambientvideo/visualizers");Ov.log(`default (total=${Mv.length})`);const $v=new ct([]);qy().pipe(Pv(1),He((e=>!!e.ambientVideoEnabled)),Kr(),mr((e=>e?qy().pipe(He((e=>!!e.useAmbientVideoSource)),Kr(),mr((e=>e?qy().pipe(He((e=>e.ambientVideoSource||"")),Kr(),mr((e=>e?function(e){return t=this,n=void 0,i=function*(){const t=Hc(e),[,n,r]=t.split(":");let i=[r];return"playlist"===n&&(i=yield function(e){return Av(this,void 0,void 0,(function*(){const t=new Cv(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e):wr([])))):wr(Mv)))):wr([]))),Jr((e=>(Ov.error(e),wr([]))))).subscribe($v);const Nv={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,get visualizers(){return $v.getValue()},observeVisualizers:function(){return $v},createPlayer(e){return this.player||(this.player=new Tv(e)),this.player}},zv=Nv;var jv,Lv,Dv=n(5864),Rv=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Fv=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};jv=new WeakMap,Lv=new WeakMap;const _v=class extends Wy{constructor({context:e,source:t},n){super(),this.name=n,this.logger=new K(`AmpShaderPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.animationFrameId=0,this.fragFrameColor=null,this.fragBackgroundColor=null,this.fragColor=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.startTime=performance.now(),this.currentVisualizer="",jv.set(this,""),Lv.set(this,""),this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader",this.outputGl=this.canvas.getContext("2d"),window.OffscreenCanvas?this.offscreenCanvas=new OffscreenCanvas(200,200):this.offscreenCanvas=document.createElement("canvas");const r=this.gl=this.offscreenCanvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1}),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.R8,512,2,0,r.RED,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);const a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);const s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),r.STATIC_DRAW)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.createShader(`#version 300 es\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n#ifdef GL_ES\r\nprecision highp float;\r\nprecision highp int;\r\nprecision mediump sampler3D;\r\n#endif\r\nuniform vec3 iFrameColor;\r\nuniform vec3 iBackgroundColor;\r\nuniform vec3 iColor;\r\nuniform float iTime;\r\nuniform float iChannelTime[4];\r\nuniform vec4 iDate;\r\nuniform vec2 iResolution;\r\nuniform sampler2D iChannel0;\r\nuniform sampler2D iChannel1;\r\nuniform sampler2D iChannel2;\r\nuniform sampler2D iChannel3;\r\nuniform float iSampleRate;\r\nuniform float iTimeDelta;\r\nuniform float iChannelResolution[4];\r\nvec3 iMouse = vec3(0., 0., 0.);\r\n#define iFrame (floor(iTime / 60))\r\n\n${e.shader}\nout vec4 as_FragColor;\r\nvoid main() {\r\n    vec4 color = vec4(1e20);\r\n    mainImage(color, gl_FragCoord.xy);\r\n    as_FragColor = color;\r\n}\r\n`)),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){const n=this.gl;if(e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,n.viewport(0,0,e,t),this.program){const r=n.getUniformLocation(this.program,"iResolution");n.uniform2f(r,e,t),this.renderFrame()}}get backgroundColor(){return Rv(this,jv,"f")||en.backgroundColor}set backgroundColor(e){Fv(this,jv,e,"f")}get color(){return Rv(this,Lv,"f")||en.textColor}set color(e){Fv(this,Lv,e,"f")}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get frameColor(){return en.frameColor}clear(){const{width:e,height:t}=this.canvas;this.outputGl.clearRect(0,0,e,t)}createShader(e){const t=this.gl;this.program&&(t.detachShader(this.program,this.vertexShader),t.detachShader(this.program,this.fragmentShader),t.deleteProgram(this.program),this.program=null,this.vertexShader=null,this.fragmentShader=null);const n=this.vertexShader=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,"#version 300 es\nin vec4 as_Position;void main(void){gl_Position=as_Position;}"),t.compileShader(n);const r=this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e),t.compileShader(r);const i=t.createProgram();if(t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw Error(`Link failed: ${t.getProgramInfoLog(i)}`);t.useProgram(i);const a=t.getAttribLocation(i,"as_Position");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.startTime=performance.now(),this.fragFrameColor=t.getUniformLocation(i,"iFrameColor"),this.fragBackgroundColor=t.getUniformLocation(i,"iBackgroundColor"),this.fragColor=t.getUniformLocation(i,"iColor"),this.fragTime=t.getUniformLocation(i,"iTime"),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),this.fragDate=t.getUniformLocation(i,"iDate");const s=t.getUniformLocation(i,"iResolution");t.uniform2f(s,this.canvas.width,this.canvas.height),this.program=i}render(){this.renderFrame(),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.program){const e=this.gl,t=this.analyser.frequencyBinCount,n=new Uint8Array(t),r=new Uint8Array(t);this.analyser.getByteFrequencyData(n),this.analyser.getByteTimeDomainData(r);const i=this.currentTime;e.uniform1f(this.fragTime,i),e.uniform1fv(this.fragChannelTime,new Float32Array([i,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform3f(this.fragFrameColor,...this.toRgb(this.frameColor)),e.uniform3f(this.fragBackgroundColor,...this.toRgb(this.backgroundColor)),e.uniform3f(this.fragColor,...this.toRgb(this.color)),e.texSubImage2D(e.TEXTURE_2D,0,0,0,512,1,e.RED,e.UNSIGNED_BYTE,n),e.texSubImage2D(e.TEXTURE_2D,0,0,1,512,1,e.RED,e.UNSIGNED_BYTE,r),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.outputGl.drawImage(this.offscreenCanvas,0,0)}}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}toRgb(e){const[t,n,r]=new Dv.c(e).srgb;return[t,n,r]}};const Bv=new ct([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield n.e(700).then(n.bind(n,8488));e&&Bv.next(e)},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const Vv={id:"ampshader",name:"ampshader",get visualizers(){return Bv.getValue()},observeVisualizers:function(){return Bv},createPlayer(e){return this.player||(this.player=new _v(e,"main")),this.player}},Uv=Vv;var Hv=n(6984);const qv=new K("AudioMotionPlayer");class Yv extends Wy{constructor({context:e,source:t}){super(),this.element=document.createElement("div"),this.currentVisualizer="",this.source=t,this.element.className="visualizer visualizer-audiomotion",this.element.hidden=!0,this.visualizer=new Hv.c(this.element,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1}),en.observe().pipe(ut((()=>this.registerGradients()))).subscribe(qv)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?(qv.log("disconnect"),this.visualizer.disconnectInput()):(qv.log("connect"),this.visualizer.connectInput(this.source)))}appendTo(e){e.append(this.element)}load(e){qv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.visualizer.setOptions(e.options)),this.autoplay&&this.visualizer.toggleAnalyzer(!0)}play(){qv.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){qv.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){qv.log("stop"),this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new It(en.isMediaButtonLight?en.mediaButtonColor:en.defaultMediaButtonColor),t=[new It(en.mediaButtonColor),new It(en.defaultMediaButtonColor),new It(en.frameColor),new It(en.frameTextColor),new It(en.backgroundColor),new It(en.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,n=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:en.black,colorStops:[n[0],{pos:.6,color:n[1]},n[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:en.black,colorStops:en.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:en.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}const Kv="audiomotion",Wv=[{providerId:Kv,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:Kv,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:Kv,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:Kv,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:Kv,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}],Gv={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",visualizers:Wv,observeVisualizers:()=>wr(Wv),createPlayer(e){return this.player||(this.player=new Yv(e)),this.player}},Jv=Gv;var Qv=n(9480),Xv=n.n(Qv);const Zv=new K("ButterchurnPlayer");class eb extends Wy{constructor({context:e,source:t}){super(),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.error$=new Le,this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.canvas.className="visualizer visualizer-butterchurn",this.canvas.hidden=!0,this.visualizer=Xv().createVisualizer(e,this.canvas,{width:400,height:200})}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(Zv.log("disconnect"),this.visualizer.disconnectAudio(this.source)):(Zv.log("connect"),this.visualizer.connectAudio(this.source),this.animationFrameId||this.render()))}observeError(){return this.error$}appendTo(e){e.append(this.canvas)}load(e){Zv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.visualizer.loadPreset(e.data,.5)),this.autoplay&&!this.animationFrameId&&this.render()}play(){Zv.log("play"),this.animationFrameId||this.render()}pause(){Zv.log("pause"),this.cancelAnimation()}stop(){Zv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const{width:e,height:t}=this.canvas;this.context2D.clearRect(0,0,e,t)}render(){if(this.animationFrameId)this.visualizer.render();else try{this.visualizer.render()}catch(e){Zv.error(e),this.error$.next(e)}this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}const tb=new ct([]);function nb(){return tb.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield n.e(332).then(n.t.bind(n,5148,23));if(t){tb.next(Object.keys(t).map((n=>({providerId:e,name:n,data:t[n]}))));const{default:r}=yield n.e(820).then(n.t.bind(n,8976,23));r&&tb.next(nb().concat(Object.keys(r).map((t=>({providerId:e,name:t,data:r[t]})))))}},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const rb={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",get visualizers(){return nb()},observeVisualizers:function(){return tb},createPlayer(e){return this.player||(this.player=new eb(e)),this.player}},ib=rb;class ab extends _v{constructor(e){super(e,"animated-background"),this.visualizer={providerId:"ampshader",name:"Foamy water by k_mouse",shader:"// https://www.shadertoy.com/view/llcXW7\r\n// Made by k-mouse (2016-11-23)\r\n// Modified from David Hoskins (2013-07-07) and joltz0r (2013-07-04)\r\n\r\n#define TAU 6.28318530718\r\n\r\n#define TILING_FACTOR 1.0\r\n#define MAX_ITER 24\r\n\r\nfloat waterHighlight(vec2 p, float time, float foaminess)\r\n{\r\n    vec2 i = vec2(p);\r\n\tfloat c = 0.0;\r\n    float foaminess_factor = mix(1.0, 6.0, foaminess);\r\n\tfloat inten = .005 * foaminess_factor;\r\n\r\n\tfor (int n = 0; n < MAX_ITER; n++)\r\n\t{\r\n\t\tfloat t = time * (1.0 - (3.5 / float(n+1)));\r\n\t\ti = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\r\n\t\tc += 1.0/length(vec2(p.x / (sin(i.x+t)),p.y / (cos(i.y+t))));\r\n\t}\r\n\tc = 0.2 + c / (inten * float(MAX_ITER));\r\n\tc = 1.17-pow(c, 1.4);\r\n    c = pow(abs(c), 8.0);\r\n\treturn c / sqrt(foaminess_factor);\r\n}\r\n\r\nfloat sampleMusic() {\r\n\treturn clamp(0.5 * (\r\n        texture( iChannel0, vec2( 0.15, 0.25 ) ).x +\r\n        texture( iChannel0, vec2( 0.30, 0.25 ) ).x\r\n    ), 0.15, 1.0);\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\r\n\tfloat time = iTime * 0.1+23.0;\r\n\tvec2 uv = fragCoord.xy / iResolution.xy;\r\n\tvec2 uv_square = vec2(uv.x * iResolution.x / iResolution.y, uv.y);\r\n    float dist_center = pow(1.2*length(uv - 0.5), 2.0);\r\n\r\n    float foaminess = smoothstep(0.4, 1.4, dist_center);\r\n    float clearness = 0.1 + 0.9*smoothstep(0.1, 0.5, dist_center);\r\n\r\n\tvec2 p = mod(uv_square*TAU*TILING_FACTOR, TAU)-250.0;\r\n\r\n    float c = waterHighlight(p, time, foaminess);\r\n\tvec3 color = vec3(c * sampleMusic());\r\n\r\n    color = clamp(iBackgroundColor - color, 0.0, 1.0);\r\n    color = mix(iBackgroundColor, color, -clearness);\r\n\r\n\tfragColor = vec4(color, 1.0);\r\n}\r\n",externalUrl:"https://www.shadertoy.com/view/llcXW7"}}load(){super.load(this.visualizer)}}var sb;const ob=new K("CovertArtPlayer");sb=new WeakMap;const lb=class extends Wy{constructor(e){super(),this.element=null,sb.set(this,!0),this.animatedBackground=new ab(e),this.beatsPlayer=new xv(e),qy().pipe(He((e=>e.coverArtAnimatedBackground)),Kr(),ut((e=>{this.animatedBackground.hidden=this.hidden||!e}))).subscribe(ob),qy().pipe(He((e=>e.coverArtBeats)),Kr(),ut((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(ob)}get autoplay(){return this.beatsPlayer.autoplay}set autoplay(e){this.animatedBackground.autoplay=e,this.beatsPlayer.autoplay=e}get backgroundColor(){return this.animatedBackground.backgroundColor}set backgroundColor(e){this.animatedBackground.backgroundColor=e}get beatsColor(){return this.beatsPlayer.color}set beatsColor(e){this.beatsPlayer.color=e}get hidden(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,sb,"f")}set hidden(e){(function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)})(this,sb,e,"f"),this.animatedBackground.hidden=e||!Hy.coverArtAnimatedBackground,this.beatsPlayer.hidden=e||!Hy.coverArtBeats,this.element&&(this.element.hidden=e)}appendTo(e){const t=e.querySelector(".beats-player");t&&(e.hidden=this.hidden,this.element=e,this.beatsPlayer.appendTo(t),this.animatedBackground.appendTo(e.querySelector(".animated-background")))}load(){this.animatedBackground.load(),this.beatsPlayer.load()}play(){ob.log("play"),Hy.coverArtAnimatedBackground&&this.animatedBackground.play(),Hy.coverArtBeats&&this.beatsPlayer.play()}pause(){ob.log("pause"),this.animatedBackground.pause(),this.beatsPlayer.pause()}stop(){ob.log("stop"),this.animatedBackground.stop(),this.beatsPlayer.stop()}resize(e,t){this.animatedBackground.resize(e,t),this.beatsPlayer.resize(e)}},cb=[{providerId:"coverart",name:""}],ub={id:"coverart",name:"Cover Art",visualizers:cb,observeVisualizers:()=>wr(cb),createPlayer(e){return this.player||(this.player=new lb(e)),this.player}},db=ub;function mb(e,t,n,r,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*n+(1+3*e+3*a-3*s)*r+s*i)/6}function hb(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],s=r>0?e[r-1]:2*i-a,o=r<t-1?e[r+2]:2*a-i;return mb((n-r/t)*t,s,i,a,o)}}function pb(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}const fb=Math.sqrt(50),yb=Math.sqrt(10),vb=Math.sqrt(2);function bb(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),s=a>=fb?10:a>=yb?5:a>=vb?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=n&&n<2?bb(e,t,2*n):[o,l,c]}function gb(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const r=t<e,[i,a,s]=r?bb(t,e,n):bb(e,t,n);if(!(a>=i))return[];const o=a-i+1,l=new Array(o);if(r)if(s<0)for(let e=0;e<o;++e)l[e]=(a-e)/-s;else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=(i+e)/-s;else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}var wb,Eb=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function kb(e){if(!(t=Eb.exec(e)))throw new Error("invalid format: "+e);var t;return new xb({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function xb(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Sb(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Tb(e,t){var n=Sb(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}kb.prototype=xb.prototype,xb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Pb={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Tb(100*e,t),r:Tb,s:function(e,t){var n=Sb(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(wb=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Sb(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ab(e){return e}var Ib,Cb,Mb=Array.prototype.map,Ob=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function $b(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Nb(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function zb(e){let t,n,r;function i(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=$b,n=(t,n)=>$b(e(t),n),r=(t,n)=>e(t)-n):(t=e===$b||e===Nb?e:jb,n=e,r=e),{left:i,center:function(e,t,n=0,a=e.length){const s=i(e,t,n,a-1);return s>n&&r(e[s-1],t)>-r(e[s],t)?s-1:s},right:function(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}}}function jb(){return 0}Ib=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Ab:(t=Mb.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?Ab:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Mb.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=kb(e)).fill,n=e.align,d=e.sign,m=e.symbol,h=e.zero,p=e.width,f=e.comma,y=e.precision,v=e.trim,b=e.type;"n"===b?(f=!0,b="g"):Pb[b]||(void 0===y&&(y=12),v=!0,b="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var g="$"===m?i:"#"===m&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===m?a:/[%p]/.test(b)?l:"",E=Pb[b],k=/[defgprs%]/.test(b);function x(e){var i,a,l,m=g,x=w;if("c"===b)x=E(e)+x,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),y),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,x=("s"===b?Ob[8+wb/3]:"")+x+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}f&&!h&&(e=r(e,1/0));var T=m.length+e.length+x.length,P=T<p?new Array(p-T+1).join(t):"";switch(f&&h&&(e=r(P+e,P.length?p-x.length:1/0),P=""),n){case"<":e=m+e+x+P;break;case"=":e=m+P+e+x;break;case"^":e=P.slice(0,T=P.length>>1)+m+e+x+P.slice(T);break;default:e=P+m+e+x}return o(e)}return y=void 0===y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),x.toString=function(){return e+""},x}return{format:d,formatPrefix:function(e,t){var n,r=d(((e=kb(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((n=t,((n=Sb(Math.abs(n)))?n[1]:NaN)/3)))),a=Math.pow(10,-i),s=Ob[8+i/3];return function(e){return r(a*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),Cb=Ib.format,Ib.formatPrefix;const Lb=zb($b),Db=Lb.right,Rb=(Lb.left,zb((function(e){return null===e?NaN:+e})).center,Db);function Fb(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function _b(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Bb(){}var Vb=.7,Ub=1/Vb,Hb="\\s*([+-]?\\d+)\\s*",qb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Kb=/^#([0-9a-f]{3,8})$/,Wb=new RegExp(`^rgb\\(${Hb},${Hb},${Hb}\\)$`),Gb=new RegExp(`^rgb\\(${Yb},${Yb},${Yb}\\)$`),Jb=new RegExp(`^rgba\\(${Hb},${Hb},${Hb},${qb}\\)$`),Qb=new RegExp(`^rgba\\(${Yb},${Yb},${Yb},${qb}\\)$`),Xb=new RegExp(`^hsl\\(${qb},${Yb},${Yb}\\)$`),Zb=new RegExp(`^hsla\\(${qb},${Yb},${Yb},${qb}\\)$`),eg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tg(){return this.rgb().formatHex()}function ng(){return this.rgb().formatRgb()}function rg(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Kb.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ig(t):3===n?new og(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ag(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ag(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Wb.exec(e))?new og(t[1],t[2],t[3],1):(t=Gb.exec(e))?new og(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Jb.exec(e))?ag(t[1],t[2],t[3],t[4]):(t=Qb.exec(e))?ag(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Xb.exec(e))?hg(t[1],t[2]/100,t[3]/100,1):(t=Zb.exec(e))?hg(t[1],t[2]/100,t[3]/100,t[4]):eg.hasOwnProperty(e)?ig(eg[e]):"transparent"===e?new og(NaN,NaN,NaN,0):null}function ig(e){return new og(e>>16&255,e>>8&255,255&e,1)}function ag(e,t,n,r){return r<=0&&(e=t=n=NaN),new og(e,t,n,r)}function sg(e,t,n,r){return 1===arguments.length?((i=e)instanceof Bb||(i=rg(i)),i?new og((i=i.rgb()).r,i.g,i.b,i.opacity):new og):new og(e,t,n,null==r?1:r);var i}function og(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function lg(){return`#${mg(this.r)}${mg(this.g)}${mg(this.b)}`}function cg(){const e=ug(this.opacity);return`${1===e?"rgb(":"rgba("}${dg(this.r)}, ${dg(this.g)}, ${dg(this.b)}${1===e?")":`, ${e})`}`}function ug(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function dg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function mg(e){return((e=dg(e))<16?"0":"")+e.toString(16)}function hg(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new fg(e,t,n,r)}function pg(e){if(e instanceof fg)return new fg(e.h,e.s,e.l,e.opacity);if(e instanceof Bb||(e=rg(e)),!e)return new fg;if(e instanceof fg)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(n-r)/o+6*(n<r):n===a?(r-t)/o+2:(t-n)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new fg(s,o,l,e.opacity)}function fg(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function yg(e){return(e=(e||0)%360)<0?e+360:e}function vg(e){return Math.max(0,Math.min(1,e||0))}function bg(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}Fb(Bb,rg,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:tg,formatHex:tg,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return pg(this).formatHsl()},formatRgb:ng,toString:ng}),Fb(og,sg,_b(Bb,{brighter(e){return e=null==e?Ub:Math.pow(Ub,e),new og(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Vb:Math.pow(Vb,e),new og(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new og(dg(this.r),dg(this.g),dg(this.b),ug(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:lg,formatHex:lg,formatHex8:function(){return`#${mg(this.r)}${mg(this.g)}${mg(this.b)}${mg(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:cg,toString:cg})),Fb(fg,(function(e,t,n,r){return 1===arguments.length?pg(e):new fg(e,t,n,null==r?1:r)}),_b(Bb,{brighter(e){return e=null==e?Ub:Math.pow(Ub,e),new fg(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Vb:Math.pow(Vb,e),new fg(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new og(bg(e>=240?e-240:e+120,i,r),bg(e,i,r),bg(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new fg(yg(this.h),vg(this.s),vg(this.l),ug(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ug(this.opacity);return`${1===e?"hsl(":"hsla("}${yg(this.h)}, ${100*vg(this.s)}%, ${100*vg(this.l)}%${1===e?")":`, ${e})`}`}}));const gg=e=>()=>e;function wg(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):gg(isNaN(e)?t:e)}const Eg=function e(t){var n=function(e){return 1==(e=+e)?wg:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):gg(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=sg(e)).r,(t=sg(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),s=wg(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function kg(e){return function(t){var n,r,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=sg(t[n]),a[n]=r.r||0,s[n]=r.g||0,o[n]=r.b||0;return a=e(a),s=e(s),o=e(o),r.opacity=1,function(e){return r.r=a(e),r.g=s(e),r.b=o(e),r+""}}}function xg(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),s=new Array(r);for(n=0;n<i;++n)a[n]=Og(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=a[n](e);return s}}function Sg(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Tg(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Pg(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Og(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}kg(hb),kg((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],s=e[(r+1)%t],o=e[(r+2)%t];return mb((n-r/t)*t,i,a,s,o)}}));var Ag=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ig=new RegExp(Ag.source,"g");function Cg(e,t){var n,r,i,a=Ag.lastIndex=Ig.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(n=Ag.exec(e))&&(r=Ig.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:Tg(n,r)})),a=Ig.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)o[(n=l[r]).i]=n.x(e);return o.join("")})}function Mg(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Og(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?gg(t):("number"===i?Tg:"string"===i?(n=rg(t))?(t=n,Eg):Cg:t instanceof rg?Eg:t instanceof Date?Sg:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?xg:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Pg:Tg:Mg))(e,t)}function $g(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Ng(e){return+e}var zg=[0,1];function jg(e){return e}function Lg(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Dg(e,t,n){var r=e[0],i=e[1],a=t[0],s=t[1];return i<r?(r=Lg(i,r),a=n(s,a)):(r=Lg(r,i),a=n(a,s)),function(e){return a(r(e))}}function Rg(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=Lg(e[s],e[s+1]),a[s]=n(t[s],t[s+1]);return function(t){var n=Rb(e,t,1,r)-1;return a[n](i[n](t))}}function Fg(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function _g(e){return Math.log(e)}function Bg(e){return Math.exp(e)}function Vg(e){return-Math.log(-e)}function Ug(e){return-Math.exp(-e)}function Hg(e){return isFinite(e)?+("1e"+e):e<0?0:e}function qg(e){return(t,n)=>-e(-t,n)}function Yg(){const e=function(e){const t=e(_g,Bg),n=t.domain;let r,i,a=10;function s(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?Hg:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),n()[0]<0?(r=qg(r),i=qg(i),e(Vg,Ug)):e(_g,Bg),t}return t.base=function(e){return arguments.length?(a=+e,s()):a},t.domain=function(e){return arguments.length?(n(e),s()):n()},t.ticks=e=>{const t=n();let s=t[0],o=t[t.length-1];const l=o<s;l&&([s,o]=[o,s]);let c,u,d=r(s),m=r(o);const h=null==e?10:+e;let p=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),s>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;p.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;p.push(u)}2*p.length<h&&(p=gb(s,o,h))}else p=gb(d,m,Math.min(m-d,h)).map(i);return l?p.reverse():p},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===a?"s":","),"function"!=typeof n&&(a%1||null!=(n=kb(n)).precision||(n.trim=!0),n=Cb(n)),e===1/0)return n;const s=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*a<a-.5&&(t*=a),t<=s?n(e):""}},t.nice=()=>n(function(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],s=e[i];return s<a&&(n=r,r=i,i=n,n=a,a=s,s=n),e[r]=t.floor(a),e[i]=t.ceil(s),e}(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}(function(){var e,t,n,r,i,a,s=zg,o=zg,l=Og,c=jg;function u(){var e=Math.min(s.length,o.length);return c!==jg&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),r=e>2?Rg:Dg,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(s.map(e),o,l)))(e(c(t)))}return d.invert=function(n){return c(t((a||(a=r(o,s.map(e),Tg)))(n)))},d.domain=function(e){return arguments.length?(s=Array.from(e,Ng),u()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),l=$g,u()},d.clamp=function(e){return arguments.length?(c=!!e||jg,u()):c!==jg},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,n=Yg(),n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,n},Fg.apply(e,arguments),e}var Kg=n(3208);function Wg(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function Gg(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Wg(n);return(e,n)=>r.then((r=>n(r.transaction(t,e).objectStore(t))))}let Jg;function Qg(){return Jg||(Jg=Gg("keyval-store","keyval")),Jg}function Xg(e,t=Qg()){return t("readonly",(t=>Wg(t.get(e))))}function Zg(e,t,n=Qg()){return n("readwrite",(n=>(n.put(t,e),Wg(n.transaction))))}var ew;!function(e){e.Looking="looking",e.NotFound="not-found"}(ew||(ew={}));const tw=ew;var nw=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},rw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const iw=new K("playlist"),aw=Gg("ampcast/playlist","keyval"),sw=[],ow=new ct(sw),lw=new ct("");function cw(){return ow.getValue()}function uw(e){e=e.concat(),ow.next(e),0===e.length?mw(""):hw()||mw(e[0].id)}function dw(){return lw.getValue()}function mw(e){lw.next(e)}function hw(){const e=cw(),t=dw();return e.find((e=>e.id===t))||null}function pw(e){mw(e.id)}function fw(){return qr([ow,lw]).pipe(He((([e,t])=>{var n;return null!==(n=e.find((e=>e.id===t)))&&void 0!==n?n:null})),Kr())}function yw(){return qr([ow,lw]).pipe(He((([e,t])=>e.findIndex((e=>e.id===t)))),Kr())}function vw(){const e=ow.getValue(),t=dw();return e.findIndex((e=>e.id===t))}function bw(){return ow.pipe(He((e=>e.length)),Kr())}function gw(){return ow.getValue().length}function ww(e){const t=dw();if(t){const n=cw(),r=n.findIndex((e=>e.id===t));if(-1!==r){const t=n[r+e];t&&pw(t)}}}function Ew(e,t){return nw(this,void 0,void 0,(function*(){const n=cw(),r=Ry.get().allowDuplicates;let i=yield function(e){return nw(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===si.Album;let n=[];return n=Array.isArray(e)?t(e[0])?(yield Promise.all(e.map((e=>xw(e))))).flat():e:t(e)?yield xw(e):[e],n.filter(l)}))}(e);if(r||(i=i.filter((e=>-1===n.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},_(e)),{id:Ia()})));t>=0&&t<n.length?(n.splice(t,0,...e),uw(n)):uw(n.concat(e))}}))}function kw(e){const t=cw(),n=Array.isArray(e)?e:[e],r=t.filter((e=>!n.includes(e)));if(r.length!==t.length){const e=vw(),t=dw(),n=r.findIndex((e=>e.id===t));if(-1===n)if(-1===e)mw("");else{const t=r[e]||r.at(-1);mw((null==t?void 0:t.id)||"")}uw(r)}}function xw(e){return nw(this,void 0,void 0,(function*(){return bi(e.pager,{keepAlive:!0})}))}const Sw={get atEnd(){return vw()===gw()-1},get atStart(){return 0===gw()||0===vw()},observe:function(){return ow.pipe(Ue((e=>e!==sw)))},observeCurrentIndex:yw,observeCurrentItem:fw,observeNextItem:function(){return qr([ow,lw]).pipe(He((([e,t])=>{const n=e.findIndex((e=>e.id===t));return-1===n?null:e[n+1]||null})),Kr())},observeSize:bw,getCurrentIndex:vw,getCurrentItem:hw,setCurrentItem:pw,getItems:cw,add:function(e){return nw(this,void 0,void 0,(function*(){return Ew(e,-1)}))},clear:function(){uw([])},eject:function(){const e=hw();e&&kw(e)},inject:function(e){return nw(this,void 0,void 0,(function*(){return Ew(e,vw()+1)}))},injectAt:Ew,moveSelection:function(e,t){return nw(this,void 0,void 0,(function*(){const n=cw(),r=n[t];if(e.includes(r))return;const i=n.filter((t=>!e.includes(t))),a=i.indexOf(r);a>=0?(i.splice(a,0,...e),uw(i)):uw(i.concat(e))}))},next:function(){ww(1)},prev:function(){ww(-1)},remove:kw,removeAt:function(e){const t=function(e){var t;return null!==(t=cw()[e])&&void 0!==t?t:null}(e);t&&kw(t)},reverseAt:function(e,t){const n=cw(),r=n.slice(e,e+t).reverse();n.splice(e,t,...r),uw(n)},shuffle:function(e){const t=cw().slice();if(t.length>0){const n=hw();if(e&&n){const e=f(t.filter((e=>e!==n)));e.unshift(n),uw(e)}else{const e=f(t);uw(e),pw(e[0])}}}},Tw=Sw;nw(void 0,void 0,void 0,(function*(){const[e=[],t=""]=yield Promise.all([Xg("items",aw),Xg("currently-playing-id",aw)]);mw(t),uw(e.map((e=>{var t;if(null===(t=e.plex)||void 0===t?void 0:t.ratingKey){const[,t,n]=e.src.split(":");e.src=`plex:${t}:${e.plex.ratingKey}`,e.srcs=[n],delete e.plex.ratingKey}return e})))})),ow.pipe(ep(2),Pv(200),rt((e=>Zg("items",e=e.map((e=>{if("lookupStatus"in e){const{lookupStatus:t}=e;return rw(e,["lookupStatus"])}return e})),aw)))).subscribe(iw),lw.pipe(ep(2),Pv(200),rt((e=>Zg("currently-playing-id",e,aw)))).subscribe(iw),il.pipe(ut((({lookupItem:e})=>{const t=cw(),n=t.findIndex((t=>t.id===e.id));-1!==n&&(t[n]=Object.assign(Object.assign({},e),{lookupStatus:tw.Looking}),uw(t))}))).subscribe(iw),al.pipe(ut((({lookupItem:e,foundItem:t})=>{const n=cw(),r=n.findIndex((t=>t.id===e.id));-1!==r&&(n[r]=t?Object.assign(Object.assign({},x(t,e)),{id:e.id}):Object.assign(Object.assign({},e),{lookupStatus:tw.NotFound}),uw(n))}))).subscribe(iw),sl.pipe(ut((({lookupItem:e})=>{const t=cw(),n=t.findIndex((t=>t.id===e.id));if(-1!==n){const{lookupStatus:r}=e,i=rw(e,["lookupStatus"]);t[n]=i,uw(t)}}))).subscribe(iw),Zr().pipe(ut((e=>{let t=!1;const n=cw().map((n=>{for(const{match:r,values:i}of e)if(r(n)){const e=_(i);if(Object.keys(e).length>0)return t=!0,Object.assign(Object.assign({},n),e)}return n}));t&&uw(n)}))).subscribe(iw);const Pw=new ct(!1),Aw=new ct({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function Iw(){return Pw.pipe(Ue((e=>e)),Vi(1),He((()=>{})))}function Cw(){return Aw}function Mw(){return Cw().pipe(Ue((e=>0!==e.startedAt)),Kr(((e,t)=>e.startedAt===t.startedAt)))}function Ow(){return Cw().pipe(Ue((e=>0!==e.endedAt)),Kr(((e,t)=>e.endedAt===t.endedAt)))}function $w(e=1e4){return Mw().pipe(mr((()=>Cw().pipe(Ga(e,void 0,{trailing:!0}),hr(Ow())))))}function Nw(){return Cw().pipe(He((e=>e.currentTime)),Kr())}function zw(){return Cw().pipe(He((e=>e.duration)),Kr())}function jw(){return Cw().pipe(He((e=>e.paused)),Kr())}function Lw(){const e=Aw.getValue();e.startedAt&&(e.endedAt||Aw.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),Aw.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}fw().subscribe((e=>{var t;const n=Aw.getValue();(null==e?void 0:e.id)===(null===(t=n.currentItem)||void 0===t?void 0:t.id)?Aw.next(Object.assign(Object.assign({},n),{currentItem:e})):(Lw(),Aw.next(Object.assign(Object.assign({},n),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0})))}));const Dw={get paused(){return Aw.getValue().paused},observePlaybackReady:Iw,observePlaybackState:Cw,observePlaybackStart:Mw,observePlaybackEnd:Ow,observePlaybackProgress:$w,observeCurrentTime:Nw,observeDuration:zw,observePaused:jw,getCurrentTime:function(){return Aw.getValue().currentTime},setCurrentTime:function(e){const t=Aw.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&Aw.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return Aw.getValue().duration},setDuration:function(e){const t=Aw.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const n=Math.min(t.currentTime,e);Aw.next(Object.assign(Object.assign({},t),{duration:e,currentTime:n}))}},play:function(){const e=Aw.getValue();e.currentItem&&e.paused&&Aw.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=Aw.getValue();e.paused||Aw.next(Object.assign(Object.assign({},e),{paused:!0}))},ready:function(){Pw.next(!0)},stop:function(){const e=Aw.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});Aw.next(t),e.startedAt&&Aw.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=Aw.getValue();e.startedAt||Aw.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:Lw},Rw=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const n=[{index:t,value:e}];for(let r=1;r<12;r++)n[r]={index:t,value:e*Math.pow(2,r)};return n})).flat().sort(((e,t)=>e.value-t.value));function Fw(e,t,n){return function(e,t){const n=e*t,r=n+t,i=Rw.filter((e=>e.value>=n&&e.value<r));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<Rw.length;e++){const t=Rw[e];if(t.value>r){const i=Rw[e-1],a=t.value-i.value;return[{index:i.index,value:1-(r-i.value)/a},{index:t.index,value:1-(t.value-n)/a}]}}return[]}(t,n).map((({index:t,value:n})=>e[t]*n)).reduce(((e,t)=>e+t),0)}var _w,Bw=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};_w=new WeakMap;const Vw=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new ct({bars:{},beats:{},sections:{},segments:{},tatums:{}}),_w.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,e.observeCurrentTrackState().subscribe((t=>Bw(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.track_window)||void 0===n?void 0:n.current_track)||void 0===r?void 0:r.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield dh.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,_w,"f")}observeBar(){return this.observeActiveIntervals().pipe(He((e=>e.bars)),Kr())}observeBeat(){return this.observeActiveIntervals().pipe(He((e=>e.beats)),Kr())}observeSection(){return this.observeActiveIntervals().pipe(He((e=>e.sections)),Kr())}observeSegment(){return this.observeActiveIntervals().pipe(He((e=>e.segments)),Kr())}observeTatum(){return this.observeActiveIntervals().pipe(He((e=>e.tatums)),Kr())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const n=hb([.5,1,.5])(this.beat.progress)*this.volume,r=(this.segment.timbre[1]-180)/360,i=this.frequencyBinCount;for(let a=0;a<i;a++){let s=(a-i/2-r*i)/i+1;(s<0||s>2)&&(s=0);const o=Math.sin(s*(Math.PI/2)),l=Fw(t,a,this.sampleSize);e[a]=(l+o)/2*255*n}}else e.fill(0)}getFloatFrequencyData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Uint8Array(t);this.getByteFrequencyData(n);for(let r=0;r<t;r++)e[r]=n[r]-128}getByteTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Float32Array(t);this.getFloatTimeDomainData(n);const r=Uint8Array.from(n);for(let n=0;n<t;n++)e[n]=r[n]}getFloatTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Float32Array(t);this.getFloatFrequencyData(n);const{real:r,imag:i}=(0,Kg.MF)(n);for(let n=0;n<t;n++)e[n]=Math.sqrt(r[n]*r[n]+i[n]*i[n])-128}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return jw().pipe(mr((e=>e?ur:this.activeIntervals$)),Ue((()=>this.active)))}updateState(e){return Bw(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],n=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<n&&n<t[e+1].start)return e}return 0};this.intervalTypes.forEach((n=>{const r=t(n);null!=e[n].start&&r===e[n].index||(e[n]=Object.assign(Object.assign({},this.trackAnalysis[n][r]),{index:r}));const{start:i,duration:a}=e[n],s=this.trackProgress-i;e[n].elapsed=s,e[n].progress=this.easeOutQuart(s/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:n,duration:r,elapsed:i,start:a,index:s}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[s+1])return 0;const o=this.trackAnalysis.segments[s+1].loudness_start,l=a+i;if(i<n){const r=Math.min(1,i/n);return this.interpolate(t,e)(r)}{const t=l-(a+n),i=r-n,s=Math.min(1,t/i);return this.interpolate(e,o)(s)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),n=this.queues;function r(e){return e.reduce(((e,t)=>e+t))/e.length}n.volume.unshift(t),n.volume.length>400&&n.volume.pop(),n.beat.unshift(t),n.beat.length>this.volumeSmoothing&&n.beat.pop();const i=Yg().domain([pb(n.volume),r(n.volume)]).range([0,1]),a=r(n.beat);!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,_w,i(a)||0,"f")}interpolate(e,t){return n=>e*(1-n)+t*n}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(mp),Uw=new K("SpotifyVizPlayer");class Hw extends Wy{constructor(){super(),this.analyser=Vw,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz";const e=this.analyser;e.observeBar().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===n||n.call(t,e)})),e.observeBeat().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===n||n.call(t,e)})),e.observeSection().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===n||n.call(t,e)})),e.observeSegment().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===n||n.call(t,e)})),e.observeTatum().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===n||n.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.cancelAnimation():this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){var t,n;Uw.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.analyser.volumeSmoothing=null!==(n=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==n?n:100),this.autoplay&&!this.animationFrameId&&this.render()}play(){Uw.log("play"),this.animationFrameId||this.render()}pause(){Uw.log("pause"),this.cancelAnimation()}stop(){Uw.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}let qw="",Yw="";const Kw={volumeSmoothing:10,onBar(){const e=en.getVisualizerColors();qw=Yw||k(e),Yw=k(e.filter((e=>e!==Yw)))},onPaint({context2D:e,height:t,width:n,now:r,analyser:i}){const a=hb([0,10*i.volume,0])(i.bar.progress),s=hb([0,300*i.volume,0])(i.beat.progress),{r:o,g:l,b:c}=new It(en.black).toRgb(),u=`${o},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,n,t),e.lineWidth=a,e.strokeStyle=Eg(qw,Yw)(i.bar.progress),function(e,t,n,r,i,a=5){const s=e=>r*Math.sin(e/i+t)+n,{width:o}=e.canvas;e.beginPath();for(let t=-50;t<o+50;t+=a)-50===t?e.moveTo(t,s(t)):e.lineTo(t,s(t))}(e,r/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=s,function(e,t,n,r,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,n,r,i,a),e.closePath()}(e,n/2,t/2,i.volume*t/5+s/10),e.stroke(),e.fill()}},Ww=[{providerId:"spotifyviz",name:"example by zachwinter",config:Kw,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],Gw={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",visualizers:Ww,observeVisualizers:()=>wr(Ww),createPlayer(){return this.player||(this.player=new Hw),this.player}};function Jw(){return en.isLight&&en.isFrameLight?en.frameColor:en.isTextLight?en.textColor:en.frameTextColor}const Qw=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i),s=t/i;let o=0;e.lineWidth=Math.round(en.fontSize/(document.fullscreenElement?2:4)),e.clearRect(0,0,t,n),e.strokeStyle=Jw(),e.beginPath(),r.getByteTimeDomainData(a);for(let t=0;t<i;t++){const r=a[t]/128*n/2;0===t?e.moveTo(o,r):e.lineTo(o,r),o+=s}e.lineTo(t,n/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=document.fullscreenElement?8:4,a=r.frequencyBinCount,s=new Uint8Array(a);r.getByteFrequencyData(s),e.clearRect(0,0,t,n),e.fillStyle=Jw();const o=(t-15*i)/16,l=.0075*n,c=a/16;let u,d=0;for(let t=0;t<a;t+=c){const r=s.slice(t,t+c).reduce(((e,t)=>e+t),0)/c;u=l*r,e.fillRect(d,n-u/2,o,u/2),d+=o+i}}}}],Xw=Qw,Zw={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",visualizers:Xw,observeVisualizers:()=>wr(Xw),createPlayer(e){return this.player||(this.player=new Ev(e,"main")),this.player}},eE=Zw,tE=new K("visualizerProviders");function nE(){return[zv,Uv,Jv,ib,db,Gw,eE]}function rE(e){return nE().find((t=>t.id===e))}function iE(e){var t;return(null===(t=rE(e))||void 0===t?void 0:t.visualizers)||[]}function aE({providerRef:e,fullscreenProgressRef:t,ambientVideoEnabled:n,onSubmit:i}){const a=(0,r.useId)(),s=Hy.provider,o=(0,r.useMemo)(nE,[]);return r.createElement("form",{className:"visualizer-settings-general",method:"dialog"},r.createElement("p",null,r.createElement("label",{htmlFor:`${a}-visualizer-provider`},"Provider:"),r.createElement("select",{id:`${a}-visualizer-provider`,defaultValue:s,ref:e},r.createElement("option",{value:"none"},"(none)"),o.length>1?r.createElement("option",{value:""},"(random)"):null,o.filter((e=>"ambientvideo"!==e.id||n)).map((e=>r.createElement("option",{value:e.id,key:e.id},e.name))))),r.createElement("fieldset",null,r.createElement("legend",null,"Fullscreen"),r.createElement("p",null,r.createElement("input",{type:"checkbox",id:`${a}-fullscreen-progress`,defaultChecked:Hy.fullscreenProgress,ref:t}),r.createElement("label",{htmlFor:`${a}-fullscreen-progress`},"Show progress bar"))),r.createElement(kn,{onSubmit:i}))}function sE({ambientVideoEnabledRef:e,ambientVideoSourceRef:t,useAmbientVideoSourceRef:n,beatsOverlayEnabledRef:i,onAmbientVideoEnabledChange:a,onSubmit:s}){const o=(0,r.useId)(),[l,c]=(0,r.useState)((()=>!!Hy.useAmbientVideoSource)),u=(0,r.useCallback)((()=>{t.current.validity.valid||n.current.checked||(t.current.value=""),c(n.current.checked)}),[t,n]),d=(0,r.useCallback)((()=>{const e=t.current.value;let n="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(n="Not a YouTube video or playlist.",Hc(e)&&(n="")),t.current.setCustomValidity(n)}),[t]),m=(0,r.useCallback)((()=>{a(e.current.checked)}),[e,a]);return r.createElement("form",{className:"ambient-video-settings",method:"dialog"},r.createElement("p",null,r.createElement("input",{id:`${o}-ambient-video-enabled`,type:"checkbox",defaultChecked:Hy.ambientVideoEnabled,onChange:m,ref:e}),r.createElement("label",{htmlFor:`${o}-ambient-video-enabled`},"Enable ambient video")),r.createElement("fieldset",null,r.createElement("legend",null,"Source"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-default`,defaultChecked:!Hy.useAmbientVideoSource,onChange:u}),r.createElement("label",{htmlFor:`${o}-source-default`},"Default videos")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-youtube`,defaultChecked:Hy.useAmbientVideoSource,onChange:u,ref:n}),r.createElement("label",{htmlFor:`${o}-source-youtube`},"YouTube video or playlist:")),r.createElement("p",null,r.createElement("input",{type:"url",defaultValue:Hy.ambientVideoSource,disabled:!l,required:l,onInput:d,"aria-labelledby":`${o}-source-youtube-label`,ref:t}))),r.createElement("p",null,r.createElement("input",{id:`${o}-beats-overlay`,type:"checkbox",defaultChecked:Hy.ambientVideoBeats,ref:i}),r.createElement("label",{htmlFor:`${o}-beats-overlay`},'Show "beats" overlay')),r.createElement(kn,{onSubmit:s}))}function oE({animatedBackgroundEnabledRef:e,beatsOverlayEnabledRef:t,onSubmit:n}){const i=(0,r.useId)();return r.createElement("form",{className:"cover-art-settings",method:"dialog"},r.createElement("p",null,r.createElement("input",{id:`${i}-beats-overlay`,type:"checkbox",defaultChecked:Hy.coverArtBeats,ref:t}),r.createElement("label",{htmlFor:`${i}-beats-overlay`},'Show "beats" overlay')),r.createElement("p",null,r.createElement("input",{id:`${i}-animated-background`,type:"checkbox",defaultChecked:Hy.coverArtAnimatedBackground,ref:e}),r.createElement("label",{htmlFor:`${i}-animated-background`},"Animated background (experimental)")),r.createElement(kn,{onSubmit:n}))}function lE(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useRef)(null),o=(0,r.useRef)(null),l=(0,r.useRef)(null),[c,u]=(0,r.useState)(Hy.ambientVideoEnabled),d=(0,r.useCallback)((()=>{Hy.provider=e.current.value,Hy.ambientVideoEnabled=t.current.checked,Hy.useAmbientVideoSource=i.current.checked,Hy.ambientVideoSource=n.current.value,Hy.ambientVideoBeats=a.current.checked,Hy.coverArtAnimatedBackground=s.current.checked,Hy.coverArtBeats=o.current.checked,Hy.fullscreenProgress=l.current.checked}),[]),m=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(aE,{providerRef:e,fullscreenProgressRef:l,ambientVideoEnabled:c,onSubmit:d})},{tab:"Ambient Video",panel:r.createElement(sE,{ambientVideoEnabledRef:t,ambientVideoSourceRef:n,useAmbientVideoSourceRef:i,beatsOverlayEnabledRef:a,onAmbientVideoEnabledChange:u,onSubmit:d})},{tab:"Cover Art",panel:r.createElement(oE,{animatedBackgroundEnabledRef:s,beatsOverlayEnabledRef:o,onSubmit:d})}]),[c,d]);return r.createElement(ff,{className:"visualizer-settings",items:m,label:"Visualizers"})}function cE(e){return r.createElement(fn,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),r.createElement(lE,null))}or(nE()).pipe(rt((e=>e.observeVisualizers().pipe(He((e=>e.length)),Rr((e=>0===e)),ut((t=>tE.log(`${e.id} (total=${t})`))))))).subscribe(tE);const uE=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useCallback)((e=>{e.preventDefault(),function(){var e,t,n,i;e=this,t=void 0,i=function*(){if(yield Pn({title:"Factory Reset",message:r.createElement("p",null,"This will delete all of your current settings",r.createElement("br",null),"and disconnect you from all services."),okLabel:"Continue",system:!0})){try{yield Promise.all(Kp().filter((e=>e.isConnected())).map((e=>e.logout())))}catch(e){console.error(e)}localStorage.clear(),sessionStorage.clear();try{const e=yield indexedDB.databases();yield Promise.all(e.map((e=>e.name)).filter(l).map((e=>indexedDB.deleteDatabase(e))))}catch(e){console.error(e)}location.reload()}},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}))}()}),[]);return r.createElement("form",{className:"advanced-settings-general",method:"dialog"},r.createElement("p",null,r.createElement("button",{onClick:e},"Factory Reset…")),r.createElement(kn,null))}),null)}];function dE(){return r.createElement(ff,{className:"advanced-settings",items:uE,label:"Advanced Settings"})}const mE=new Z("settings-sources");function hE(e){const t=(0,r.useMemo)((()=>[{id:"app",label:r.createElement(In,{text:"Application",icon:"ampcast"}),value:r.createElement(vf,null)},{id:"streaming-media",label:r.createElement(In,{text:"Streaming Media",icon:"globe"}),value:r.createElement(cy,{title:"Streaming Media Settings",serviceType:Dr.PublicMedia,services:Zp(),key:Dr.PublicMedia}),startExpanded:!0,children:Zp().filter(Rm).map((e=>({id:e.id,label:r.createElement(df,{service:e}),value:r.createElement(jy,{service:e,key:e.id})})))},{id:"personal-media",label:r.createElement(In,{text:"Personal Media",icon:"network"}),value:r.createElement(cy,{title:"Personal Media Settings",serviceType:Dr.PersonalMedia,services:Qp(),key:Dr.PersonalMedia}),startExpanded:!0,children:Qp().filter(Rm).map((e=>({id:e.id,label:r.createElement(df,{service:e}),value:r.createElement(jy,{service:e,key:e.id})})))},{id:"data-services",label:r.createElement(In,{text:"Data Services",icon:"data"}),value:r.createElement(cy,{title:"Data Services Settings",serviceType:Dr.DataService,services:Gp(),key:Dr.DataService}),startExpanded:!0,children:Gp().filter(Rm).map((e=>({id:e.id,label:r.createElement(df,{service:e}),value:r.createElement(jy,{service:e,key:e.id})})))},{id:"visualizer",label:r.createElement(In,{text:"Visualizer",icon:"visualizer"}),value:r.createElement(lE,null)},{id:"playlist",label:r.createElement(In,{text:"Playlist",icon:"playlist"}),value:r.createElement(_y,null)},{id:"appearance",label:r.createElement(In,{text:"Appearance",icon:"palette"}),value:r.createElement(ty,null)},{id:"advanced",label:r.createElement(In,{text:"Advanced",icon:"settings"}),value:r.createElement(dE,null)}]),[]),[n,i]=(0,r.useState)(null);return r.createElement(fn,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),r.createElement($r,{className:"settings-dialog-sources",roots:t,storageId:mE.id,onSelect:i}),r.createElement("div",{className:"settings-dialog-source"},n))}function pE(){return r.createElement("div",{className:"app-drag-region",onContextMenu:g})}var fE=n(9128),yE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function vE(e){var{service:t,onClick:n=t.login}=e,i=yE(e,["service","onClick"]);return r.createElement("p",null,r.createElement("button",Object.assign({},i,{className:"branded login",onClick:n}),"Connect to ",t.name,"…"))}function bE({service:e}){return r.createElement("p",null,"You need to be logged in to"," ",e.serviceType===Dr.DataService?"access your data":"play music"," from"," ",e.name,".")}function gE({service:e}){return r.createElement("p",{className:`service-link service-link-${e.id}`},r.createElement(ot,{name:e.icon}),r.createElement(rc,{href:e.url}))}function wE({service:e}){const{musicKit:t,error:n}=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const e=or(_i()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{musicKit:e,error:n}}();return r.createElement(r.Fragment,null,r.createElement(bE,{service:e}),r.createElement(vE,{service:e,disabled:!t}),n?r.createElement("p",{className:"error"},"Could not load Apple MusicKit library."):null,r.createElement(gE,{service:e}))}function EE({service:{observeConnectionLogging:e}}){const[t,n]=(0,r.useState)([]);return(0,r.useEffect)((()=>{if(e){const t=e().subscribe((e=>{n(e?t=>t.concat(e):[])}));return()=>t.unsubscribe()}n([])}),[e]),e?r.createElement("div",{className:"connection-logging"},t.map(((e,t)=>r.createElement("p",{key:t},e)))):null}function kE({service:e}){return r.createElement(r.Fragment,null,r.createElement(bE,{service:e}),r.createElement(vE,{service:e}),r.createElement(gE,{service:e}),r.createElement(EE,{service:e}))}function xE(){(0,r.useEffect)((()=>{const e=new Le,t=e.pipe(rt((e=>Hn(e))),rt((()=>function(){return Hd(this,void 0,void 0,(function*(){return Gd=yield Ud.fetchJSON({host:Cd,path:"/pins",method:"POST",params:{strong:"true"}}),Gd}))}())),He((e=>1e3*e.expiresIn)),ut((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()}))}function SE({service:e}){return xE(),r.createElement(kE,{service:e})}function TE({service:e}){const t=e.authService;return xE(),r.createElement(r.Fragment,null,r.createElement(bE,{service:e}),r.createElement(vE,{service:t}),r.createElement(gE,{service:t}),r.createElement(gE,{service:e}),r.createElement(EE,{service:t}))}function PE({service:e,url:t}){return r.createElement("div",{className:"credentials-required note"},r.createElement("p",null,"Please register a client application to continue."),r.createElement("p",{className:`${e.id}-link service-link`},r.createElement(rc,{href:t},t)))}function AE({service:e}){return r.createElement("div",{className:"dev-mode note"},r.createElement("p",null,"This application is in ",r.createElement("strong",null,"development mode"),"."),r.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function IE(e){return r.createElement(fn,Object.assign({},e,{className:"settings-dialog spotify-credentials-dialog",title:"Spotify Credentials"}),r.createElement(vy,null))}var CE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ME({service:e}){const t=(0,r.useCallback)((()=>CE(this,void 0,void 0,(function*(){ph.clientId||(yield vn(IE)),ph.clientId&&(yield e.login())}))),[e]);return r.createElement(r.Fragment,null,ph.clientId?Si?r.createElement(AE,{service:e}):null:r.createElement(PE,{service:e,url:"https://developer.spotify.com/dashboard/create"}),r.createElement("p",null,"You need to be logged in to play music from Spotify.*"),r.createElement(vE,{service:e,onClick:t}),r.createElement("p",null,r.createElement("small",null,"*Spotify Premium required.")),r.createElement(gE,{service:e}))}function OE(e){return r.createElement(fn,Object.assign({},e,{className:"settings-dialog youtube-credentials-dialog",title:"YouTube Credentials"}),r.createElement(gy,null))}var $E=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function NE({service:e}){const{client:t,error:n}=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const e=or(Cc()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{client:e,error:n}}(),i=yc.apiKey&&yc.clientId,a=(0,r.useCallback)((()=>$E(this,void 0,void 0,(function*(){yc.apiKey&&yc.clientId||(yield vn(OE)),yc.apiKey&&yc.clientId&&(yield e.login())}))),[e]);return r.createElement(r.Fragment,null,i?Pi?r.createElement(AE,{service:e}):null:r.createElement(PE,{service:e,url:"https://developers.google.com/youtube/registering_an_application"}),r.createElement("p",null,"You can still play YouTube videos without being logged in.",r.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),r.createElement(vE,{service:e,disabled:!t,onClick:a}),n?r.createElement("p",{className:"error"},"Could not load Google client library."):null,r.createElement(gE,{service:e}))}function zE({service:e}){return r.createElement("div",{className:"panel"},r.createElement("div",{className:`page login login-${e.id}`},r.createElement(jE,{service:e})))}function jE({service:e}){switch(e.id){case"apple":return r.createElement(wE,{service:e});case"plex":return r.createElement(SE,{service:e});case"plex-tidal":return r.createElement(TE,{service:e});case"spotify":return r.createElement(ME,{service:e});case"youtube":return r.createElement(NE,{service:e});default:return r.createElement(kE,{service:e})}}const LE=new ct(RE());function DE(){return LE.pipe(Kr())}function RE(){return navigator.onLine}function FE(){return bf(DE,RE())}function _E(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement("div",{className:"note"},r.createElement("p",null,"Internet connection required."))))}function BE({children:e}){return r.createElement("div",{className:"panel empty-screen"},e)}function VE({error:e,children:t}){return r.createElement("div",{className:"panel error-screen"},r.createElement("div",{className:"error-screen-content"},r.createElement("h2",null,"Error"),r.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function UE({icon:e,children:t}){return r.createElement("h2",{className:"page-header"},r.createElement(In,{icon:e,text:t}))}function HE({min:e="1970",max:t=qE(),value:n=t,onSelect:i}){const[a,s]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),o=function(e,t){const[n,i]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const n=[],r=new Date(e),a=new Date(t),s=r.getFullYear();let o=a.getFullYear();for(;o>=s;)n.push(o),o--;i(n)}),[e,t]),n}(e,t);(0,r.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,r.useCallback)((e=>{s(e.target.value)}),[]);return r.createElement("span",{className:"year-picker"},r.createElement("select",{defaultValue:a,onChange:l},o.map((e=>r.createElement("option",{value:e,key:e},e)))))}function qE(){const e=new Date;return String(e.getFullYear())}dr(Xn(window,"online").pipe(He((()=>!0))),Xn(window,"offline").pipe(He((()=>!1)))).subscribe(LE);const YE=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function KE({min:e="1970-01",max:t=v(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),[l,c]=(0,r.useState)((()=>new Date(n).getMonth())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),s=new Date(n),o=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===s.getFullYear()?s.getMonth():11;for(;l>=o;)r.push(l),l--;a(r)}),[e,t,n]),i}(s,e,t);(0,r.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{-1!==l&&(null==i||i(`${s}-${String(l+1).padStart(2,"0")}`))}),[i,s,l]);const d=(0,r.useCallback)((e=>{c(-1),o(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"month-picker"},r.createElement(HE,{min:e,max:t,value:s,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},YE[e])))))}function WE({min:e="1970-01-01",max:t=y(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)((()=>v(n))),[l,c]=(0,r.useState)((()=>new Date(n).getDate())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),s=new Date(n),o=e.split("-").map(Number),l=o[0],c=o[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===s.getFullYear()&&c===s.getMonth()?s.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)r.push(d),d--;a(r)}),[e,t,n]),i}(s,e,t);(0,r.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{l&&(null==i||i(`${s}-${String(l).padStart(2,"0")}`))}),[i,s,l]);const d=(0,r.useCallback)((e=>{c(0),o(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"date-picker"},r.createElement(KE,{min:e,max:t,value:s,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},e)))))}function GE(){return bf(fw,null)}var JE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function QE(e){var{className:t="",children:n}=e,i=JE(e,["className","children"]);return r.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`,onDoubleClick:w}),n)}var XE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},ZE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const ek=new Z("recentPlaylists"),tk=4;function nk(e){const{pager:t}=e,n=ZE(e,["pager"]),[r]=n.src.split(":"),i=ek.getJson("all",[]),a=i.findIndex((t=>t.src===e.src));-1!==a&&i.splice(a,1);const s=e=>e.src.startsWith(`${r}:`);if(i.filter(s).length===tk){const e=i.findLastIndex(s);i.splice(e,1)}i.unshift(n),ek.setJson("all",i)}function rk(e){const t=e.map((e=>e.id));return ek.getJson("all",[]).filter((e=>{const[n]=e.src.split(":");return t.includes(n)})).slice(0,tk).map((e=>Object.assign(Object.assign({},e),{pager:new wi})))}function ik(e){const t=d(e,(e=>{const t=nf(e);return(null==t?void 0:t.id)||""})),n=t.plex,r=t["plex-tidal"];r&&(t.plex=(null==n?void 0:n.concat(r))||r);const i=Object.keys(t).filter((e=>""!==e&&"listenbrainz"!==e)).map((e=>({service:tf(e),items:t[e]}))).filter((({service:e})=>!!(null==e?void 0:e.editablePlaylists)));i.sort(((e,t)=>t.items.length-e.items.length));const a=tf("listenbrainz");if(a){const t=e.filter((({recording_mbid:e,track_mbid:t,isrc:n})=>e||t||n));t.length>0&&i.push({service:a,items:t})}return i.filter((({service:e})=>e.isLoggedIn()))}function ak({id:e,children:t,onClose:n,x:i,y:a,align:s="left",autoFocus:o,hidden:l,popupRef:c}){const u=(0,r.useRef)(null),d=(0,r.useRef)(document.activeElement),[m,h]=(0,r.useState)({visibility:"hidden"}),[p,f]=(0,r.useState)([]),[y,v]=(0,r.useState)("");c&&(c.current=u.current),(0,r.useEffect)((()=>{const e={},t=u.current,n=Array.from(t.querySelectorAll(":scope > li > button"));"right"===s||i+t.offsetWidth>document.body.clientWidth?e.left=i-t.offsetWidth+"px":e.left=`${i}px`,a+t.offsetHeight>document.body.clientHeight?e.top=a-t.offsetHeight+"px":e.top=`${a}px`,l&&(e.visibility="hidden"),f(n),h(e)}),[s,i,a,l]),(0,r.useEffect)((()=>{const e=p.find((e=>!e.disabled));v((null==e?void 0:e.id)||""),o&&e&&e.focus()}),[p,o]),(0,r.useEffect)((()=>{if(n){const e=dr(Hn(0).pipe(mr((()=>Xn(document,"mousedown",{capture:!0}).pipe(Ue((e=>!u.current.contains(e.target))))))),Xn(document,"keydown",{capture:!0}).pipe(Ue((e=>"Escape"===e.code||"Tab"===e.code))),Xn(window,"blur")).subscribe((()=>{var e;null===(e=d.current)||void 0===e||e.focus(),null==n||n()}));return()=>e.unsubscribe()}}),[n]);const b=(0,r.useCallback)((e=>{var t;if(n){let r=e.target;for(;r&&"BUTTON"!==r.nodeName;)r=r.parentElement;(null==r?void 0:r.value)&&!r.disabled&&(null===(t=d.current)||void 0===t||t.focus(),n(r.value))}}),[n]),w=(0,r.useCallback)((e=>{let t=p.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),p.length-1);const n=p[t];n&&!n.disabled&&(n.focus(),v(n.id))}),[p]),E=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),v(t.id))}),[]);return r.createElement("ul",{className:"popup-menu",id:e,tabIndex:-1,hidden:l,role:"menu","aria-label":"Actions","aria-activedescendant":y,style:m,onClick:b,onContextMenu:g,onKeyDown:w,onMouseOver:E,ref:u},t)}var sk=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ok(e){var{className:t="",label:n,acceleratorKey:i="",children:a,role:s="menuitem"}=e,o=sk(e,["className","label","acceleratorKey","children","role"]);const l=(0,r.useId)(),c=(0,r.useRef)(null),u=(0,r.useRef)(null),d=(0,r.useRef)(null),m=!!a,[h,p]=(0,r.useState)(!0),[{x:f,y},v]=(0,r.useState)({x:0,y:0}),[b,g]=(0,r.useState)("left"),k=(0,r.useCallback)((()=>{if(m){const e=c.current,t=d.current;if(e&&t){const{left:n,right:r,top:i}=e.getBoundingClientRect(),{width:a}=t.getBoundingClientRect();r+a+1>=document.body.clientWidth?(g("right"),v({x:n,y:i-1})):(g("left"),v({x:r,y:i-1}))}}}),[m]);tn(c,k);const x=(0,r.useCallback)((()=>{p(!0)}),[]),S=(0,r.useCallback)((()=>{k(),p(!1)}),[k]),T=(0,r.useCallback)((e=>{const t=e.code;if("Enter"===t||"Space"===t)e.stopPropagation();else if("left"===b&&"ArrowLeft"===t||"right"===b&&"ArrowRight"===t)e.stopPropagation(),u.current.focus();else if("left"===b&&"ArrowRight"===t||"right"===b&&"ArrowLeft"===t){e.stopPropagation();const t=Array.from(d.current.querySelectorAll(":scope > li > button")).find((e=>!e.disabled));null==t||t.focus()}}),[b]);return r.createElement("li",{className:`popup-menu-item ${t} ${m?"has-popup has-popup-"+b:""}`,role:"presentation",onBlur:m?x:void 0,onFocus:m?S:void 0,onKeyDown:h?void 0:T,ref:c},r.createElement("button",Object.assign({},o,{id:l,role:m?void 0:s,tabIndex:-1,"aria-haspopup":m?"true":void 0,"aria-controls":m?`${l}-popup`:void 0,onMouseDown:m?w:E,onMouseUp:w,onClick:m?w:void 0,ref:u}),r.createElement("span",{className:"popup-menu-item-label"},n),i&&!m?r.createElement("span",{className:"popup-menu-item-accelerator-key"},i):null),m?r.createElement(ak,{id:`${l}-popup`,x:f,y,align:b,hidden:h,popupRef:d},a):null)}var lk=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ck(e){var{className:t="",checked:n=!1}=e,i=lk(e,["className","checked"]);return r.createElement(ok,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":n}))}function uk(){return r.createElement("li",{className:"popup-menu-separator",role:"separator"})}var dk=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function mk(e,t,n,a){return dk(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.C)(c);try{const i=e=>{u.unmount(),c.remove(),s(e)};l.append(c),u.render(r.createElement(e,{x:t,y:n,align:a,onClose:i,autoFocus:!0}))}catch(e){u.unmount(),c.remove(),o(e)}}))}))}function hk(e){const[t,n]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const t=ik(e).slice(),r=t.findIndex((e=>"listenbrainz"===e.service.id));if(-1!==r){const e=t[r],i=or(Fl(e.items,!1)).subscribe((i=>{if(0===(i=i.filter((e=>e.recording_mbid))).length)t.splice(r,1);else{const n=e.service;t[r]={service:n,items:i}}n(t)}));return()=>i.unsubscribe()}n(t)}),[e]),t}function pk({items:e}){const t=hk((0,r.useMemo)((()=>e.filter((e=>e.itemType===si.Media))),[e])),n=rk(t.map((e=>e.service)));return 0===t.length?null:r.createElement(ok,{label:"Add to playlist"},r.createElement(ok,{label:"New playlist…",value:ii.AddToNewPlaylist,key:ii.AddToNewPlaylist}),r.createElement(uk,null),n.map(((e,n)=>r.createElement(fk,{playlist:e,itemsByService:t,index:n+1,key:e.src}))),r.createElement(uk,null),r.createElement(ok,{label:"Other…",value:ii.AddToPlaylist,key:ii.AddToPlaylist}))}function fk({playlist:e,itemsByService:t,index:n}){var i;const a=nf(e),s=(null===(i=t.find((e=>e.service===a)))||void 0===i?void 0:i.items)||[];return a?r.createElement(ok,{label:r.createElement(In,{icon:a.icon,text:`${e.title} (${s.length})`}),value:`add-to-recent-playlist-${n}`}):null}var yk=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},vk=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function bk(e,t,n,i,a="left"){return yk(this,void 0,void 0,(function*(){return mk((n=>r.createElement(gk,Object.assign({},n,{items:e,isContextMenu:t}))),n,i,a)}))}function gk(e){var{items:t,isContextMenu:n}=e,i=vk(e,["items","isContextMenu"]);const a=t[0],s=1===t.length&&!!a,o=t.every((e=>e.itemType===si.Media||e.itemType===si.Album));return r.createElement(ak,Object.assign({},i),o?r.createElement(wk,null):null,n&&s?r.createElement(Ek,{item:a}):null,r.createElement(pk,{items:t}),r.createElement(uk,null),s?r.createElement(ok,{label:"Info…",value:ii.Info,acceleratorKey:`${R.ctrlKeyStr}+I`,key:ii.Info}):null)}function wk(){return r.createElement(r.Fragment,null,r.createElement(ok,{label:"Queue",value:ii.Queue,acceleratorKey:"Enter",key:ii.Queue}),r.createElement(ok,{label:"Play next",value:ii.PlayNext,acceleratorKey:"Shift+Enter",key:ii.PlayNext}),r.createElement(ok,{label:"Play now",value:ii.PlayNow,acceleratorKey:`${R.ctrlKeyStr}+Enter`,key:ii.PlayNow}),r.createElement(uk,null))}function Ek({item:e}){const t=nf(e);return r.createElement(r.Fragment,null,e.itemType===si.Playlist&&(null==t?void 0:t.createSourceFromPin)?r.createElement(ok,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?ii.Unpin:ii.Pin,key:e.isPinned?ii.Unpin:ii.Pin}):null,void 0!==e.rating&&(null==t?void 0:t.canRate(e,!0))?r.createElement(ok,{label:e.rating?ZS(t,ii.Unlike):ZS(t,ii.Like),value:e.rating?ii.Unlike:ii.Like,key:e.rating?ii.Unlike:ii.Like}):null,!1===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?r.createElement(ok,{label:ZS(t,ii.AddToLibrary),value:ii.AddToLibrary,key:ii.AddToLibrary}):null,"apple"!==(null==t?void 0:t.id)&&!0===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?r.createElement(ok,{label:ZS(t,ii.RemoveFromLibrary),value:ii.RemoveFromLibrary,key:ii.RemoveFromLibrary}):null,r.createElement(uk,null))}function kk({value:e=0,tabIndex:t=0,onChange:n}){const[i,a]=(0,r.useState)((()=>Math.max(e-1,0))),[s,o]=(0,r.useState)(-1),[l,c]=(0,r.useState)(!1),u=(0,r.useCallback)((t=>{switch(t.key){case"ArrowLeft":if(0===i&&1===e)null==n||n(0);else if(i>0){const e=i-1;a(e),null==n||n(e+1)}break;case"ArrowRight":if(0===i&&0===e)null==n||n(1);else if(i<4){const e=i+1;a(e),null==n||n(e+1)}}}),[i,e,n]);return r.createElement("div",{className:"star-rating",tabIndex:t,onKeyDown:u,onMouseDown:E,onMouseUp:w,onMouseLeave:()=>o(-1)},r.createElement("button",{className:"star-rating-button "+(0===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(0),1===e?(c(!0),null==n||n(0)):null==n||n(1)},onMouseEnter:()=>{o(0),c(!1)}},-1===s&&e>0||0===s&&!l||s>0?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(1===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(1),2===e?null==n||n(1):null==n||n(2)},onMouseEnter:()=>o(1)},-1===s&&e>1||s>=1?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(2===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(2),3===e?null==n||n(2):null==n||n(3)},onMouseEnter:()=>o(2)},-1===s&&e>2||s>=2?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(3===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(3),4===e?null==n||n(3):null==n||n(4)},onMouseEnter:()=>o(3)},-1===s&&e>3||s>=3?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(4===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(4),5===e?null==n||n(4):null==n||n(5)},onMouseEnter:()=>o(4)},-1===s&&e>4||4===s?"★":"☆"))}class xk extends AnalyserNode{constructor(e,t){super(e,t),this.isPlayingSpotify=!1,Mw().subscribe((({currentItem:e})=>{this.isPlayingSpotify=!!(null==e?void 0:e.src.startsWith("spotify:"))}))}getByteFrequencyData(e){this.isPlayingSpotify?Vw.getByteFrequencyData(e):super.getByteFrequencyData(e)}getFloatFrequencyData(e){this.isPlayingSpotify?Vw.getFloatFrequencyData(e):super.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.isPlayingSpotify?Vw.getByteTimeDomainData(e):super.getByteTimeDomainData(e)}getFloatTimeDomainData(e){this.isPlayingSpotify?Vw.getFloatTimeDomainData(e):super.getFloatTimeDomainData(e)}}class Sk extends AudioContext{createAnalyser(){return new xk(this)}}var Tk,Pk,Ak,Ik,Ck=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Mk=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Ok=new K("audio");Tk=new WeakMap,Pk=new WeakMap,Ak=new WeakMap,Ik=new WeakMap;const $k=new class{constructor(){this.ready$=new ct(!1),this.sourceNodes=new WeakMap,this.sourceNode$=new ct(void 0),Tk.set(this,void 0),Pk.set(this,void 0),Ak.set(this,void 0),Ik.set(this,1),this.streamingSupported="safari"!==R.name,Iw().pipe(ut((()=>{const e=new Sk;Ck(this,Tk,e,"f"),Ck(this,Pk,e.createDelay(),"f"),Ck(this,Ak,e.createGain(),"f"),Mk(this,Ak,"f").gain.value=Mk(this,Ik,"f"),Mk(this,Pk,"f").connect(Mk(this,Ak,"f")),Mk(this,Ak,"f").connect(e.destination),this.ready$.next(!0)}))).subscribe(Ok),Mw().pipe(He((e=>e.currentItem)),Ue(l),He((e=>this.getSourceNode(e)))).subscribe(this.sourceNode$),this.observeReady().pipe(mr((()=>this.sourceNode$)),Kr(),_e((function(e,t){var n,r=!1;e.subscribe(Be(t,(function(e){var i=n;n=e,r&&t.next([i,e]),r=!0})))})),ut((([e,t])=>{null==e||e.disconnect(Mk(this,Pk,"f")),null==t||t.connect(Mk(this,Pk,"f"))}))).subscribe(Ok)}get context(){return Mk(this,Tk,"f")}get source(){return Mk(this,Pk,"f")}get volume(){return Mk(this,Ik,"f")}set volume(e){Ck(this,Ik,e,"f"),Mk(this,Ak,"f")&&(Mk(this,Ak,"f").gain.value=e)}observeReady(){return this.ready$.pipe(Ue((e=>e)),Vi(1),He((()=>this)))}getSourceNode(e){const t=this.getAudioElement(e);if(t){if(!this.sourceNodes.has(t)){const e=this.context.createMediaElementSource(t);this.sourceNodes.set(t,e)}return this.sourceNodes.get(t)}}getAudioElement(e){if(this.canUseWebAudio(e)){const t=this.getAudioElementId(e);if(t)return document.querySelector(`audio#${t}`)}return null}canUseWebAudio(e){return e.mediaType===li.Audio&&e.playbackType!==_r.IFrame&&(this.streamingSupported||!this.isStreamed(e))}getAudioElementId(e){if(e.src.startsWith("apple:"))return"apple-music-player";switch(e.playbackType){case _r.DASH:return"ampcast-audio-dash";case _r.HLS:return"ampcast-audio-hls";default:return"ampcast-audio-main"}}isStreamed(e){if(e.src.startsWith("apple:"))return!0;switch(e.playbackType){case _r.DASH:case _r.HLS:return!0;default:return!1}}},Nk=new K("visualizerPlayer"),zk=new wv("visualizer-player",(function(e){return function(e){var t;return null===(t=rE(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));zk.loop=!0,zk.muted=!0,zk.volume=.07,zk.observeError().subscribe(Nk.error),$k.observeReady().pipe(ut((e=>zk.registerPlayers(nE().map((t=>t.createPlayer(e))))))).subscribe(Nk);const jk=zk;var Lk=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class Dk extends Zy{constructor(e,t="hls"){super(e,t),this.maxFatalErrors=3,this.hasNativeSupport=!1,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.errorCount=0,(this.element.canPlayType("application/x-mpegURL").replace("no","")||this.element.canPlayType("application/vnd.apple.mpegURL").replace("no",""))&&(this.logger.log("Using native HLS."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||$k.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||$k.streamingSupported||(this.element.volume=e)}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0,this.loadedSrc&&(this.loadedSrc="",this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src")))}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return Lk(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);this.loadedSrc!==t&&(this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src"),this.player.loadSource(t),this.player.attachMedia(this.element),this.loadedSrc=t)}this.errorCount=0,yield this.element.play()}catch(e){this.error$.next(e)}}))}loadScript(){return Lk(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield n.e(316).then(n.bind(n,3836));this.scriptLoading=!1,this.scriptLoaded=!0,e.isSupported()&&(this.player=new e,this.player.on(e.Events.ERROR,((t,n)=>{n.fatal?n.type===e.ErrorTypes.MEDIA_ERROR&&this.errorCount<this.maxFatalErrors?(this.errorCount++,this.logger.warn("Fatal media error encountered, trying to recover..."),this.player.recoverMediaError()):this.error$.next(n):this.errorCount<this.maxFatalErrors&&(this.logger.warn("Non-fatal media error:"),this.logger.warn(n))}))),this.autoplay&&this.item&&this.safePlay(this.item)}))}}var Rk,Fk,_k=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Bk=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Vk=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Uk=new K("MusicKitPlayer"),Hk="Apple Music player not connected";Rk=new WeakMap,Fk=new WeakMap;const qk=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new ct(!0),this.duration$=new Le,this.currentTime$=new Le,this.ended$=new Le,this.playing$=new Le,this.error$=new Le,this.playerLoaded$=new Le,this.playerActivated$=new ct(!1),this.src$=new ct(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,Rk.set(this,!0),Fk.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.hasPlayed&&this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(Ue((e=>e)),ut((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;this.synchVolume(),e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),this.playerLoaded$.next(void 0)})),Vi(1)).subscribe(Uk),this.observeReady().pipe(mr((()=>this.observeIsLoggedIn())),mr((e=>e?this.observePaused():ur)),mr((e=>e?ur:this.observeSrc())),mr((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(this.getUnplayableReason(e))),ur;const[,t,n]=e.split(":"),r=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return or(this.player.setQueue({[r]:n})).pipe(mr((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():ur))),Jr((e=>(this.loadedSrc="",this.error$.next(e),ur))))}return ur}))).subscribe(Uk),this.observeIsLoggedIn().pipe(Rr((e=>e===this.isLoggedIn)),ut((e=>{var t;this.isLoggedIn=e,e||(this.loadedSrc="",this.paused&&!(null===(t=this.player)||void 0===t?void 0:t.isPlaying)||(this.stop(),this.error$.next(Error(Hk))))}))).subscribe(Uk),this.observeError().subscribe(Uk.error),this.observeError().pipe(Ue((()=>{var e;return!1===(null===(e=this.player)||void 0===e?void 0:e.isAuthorized)})),mr((()=>Ri())),Jr((()=>ur))).subscribe(Uk)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return Bk(this,Rk,"f")}set muted(e){Vk(this,Rk,e,"f"),this.synchVolume()}get volume(){return Bk(this,Fk,"f")}set volume(e){Vk(this,Fk,e,"f"),this.synchVolume()}observeCurrentTime(){return this.currentTime$.pipe(Kr())}observeDuration(){return this.duration$.pipe(Kr())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load({src:e}){Uk.log("load",{src:e}),this.autoplay&&this.playerActivated$.next(!0),this.src$.next(e),this.synchVolume(),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(this.getUnplayableReason(e)))):this.autoplay&&this.error$.next(Error(Hk))}play(){Uk.log("play"),this.playerActivated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(this.getUnplayableReason(this.src))):this.isLoggedIn||this.error$.next(Error(Hk))}pause(){var e;Uk.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){Uk.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(Kr())}observeReady(){return this.playerLoaded$.pipe(mr((()=>this.playerActivated$)),Ue((e=>e)),He((()=>{})),Vi(1))}observeSrc(){return this.src$.pipe(Kr())}canPlay(e){return!this.getUnplayableReason(e)}getUnplayableReason(e){var t;const[,n]=e.split(":");return/video/i.test(n)&&(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))?"Video playback not supported":""}safePlay(){var e,t,n,r,i;return t=this,n=void 0,i=function*(){try{this.src&&this.src===this.loadedSrc&&!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed||(this.hasPlayed=!0,this.player.isPlaying&&this.playing$.next(void 0)))}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}))}synchVolume(){if(this.player){const[,e]=this.src.split(":");this.player.volume=!$k.streamingSupported||/video/i.test(e)?this.muted?0:this.volume:1}}}(Li()),Yk=new class extends Zy{constructor(e,t="shaka"){super(e,t),this.hasNativeSupport=!1,this.shaka=null,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.hasPlayed=!1,this.onError=e=>{this.error$.next(e)},this.element.canPlayType("application/dash+xml").replace("no","")&&(this.logger.log("Using native DASH."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||$k.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||$k.streamingSupported||(this.element.volume=e)}observePlaying(){return super.observePlaying().pipe(Ue((()=>this.hasPlayed)))}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0)}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return _k(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);if(this.loadedSrc!==t){this.loadedSrc&&(yield this.recreatePlayer());const n=this.getDrmConfig(e),r=this.getStreamingConfig();this.player.configure({drm:n,streaming:r}),yield this.player.load(t),this.loadedSrc=t}}this.autoplay&&this.item===e&&(yield this.element.play(),this.hasPlayed||this.item!==e||(this.hasPlayed=!0,this.playing$.next(void 0)))}catch(t){"AbortError"===t.name||this.item!==e?this.logger.warn(t):this.error$.next(t)}}))}getDrmConfig(e){var t;if(e){const n={},r=nf(e),i=null===(t=null==r?void 0:r.getDrmInfo)||void 0===t?void 0:t.call(r,e);return i&&(n.servers={[i.keySystem]:i.license},"fairplay"===i.type&&(n.advanced={[i.keySystem]:{serverCertificateUri:i.certificate}},n.initDataTransform=(e,t,n)=>{if("skd"!==t)return e;const r=this.shaka.util,i=r.StringUtils.fromBytesAutoDetect(e).replace("skd://","");return r.FairPlayUtils.initDataTransform(e,i,n.serverCertificate)})),n}throw Error("No playable item")}getStreamingConfig(){return{bufferingGoal:10,jumpLargeGaps:!0,retryParameters:{maxAttempts:1/0,timeout:1e4},stallSkip:.1}}loadScript(){return _k(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield n.e(864).then(n.t.bind(n,7636,23));this.scriptLoading=!1,this.scriptLoaded=!0,e.polyfill.installAll(),e.Player.isBrowserSupported()&&(this.shaka=e,this.player=new e.Player,yield this.player.attach(this.element),this.player.addEventListener("error",this.onError)),this.autoplay&&this.item&&this.safePlay(this.item)}))}recreatePlayer(){var e,t,n;return _k(this,void 0,void 0,(function*(){const{hidden:r,loop:i,muted:a,volume:s}=this.element,o=this.element.cloneNode();o.removeAttribute("src"),Object.assign(o,{hidden:r,loop:i,muted:a,volume:s}),null===(e=this.player)||void 0===e||e.removeEventListener("error",this.onError),yield null===(t=this.player)||void 0===t?void 0:t.unload(),yield null===(n=this.player)||void 0===n?void 0:n.destroy(),this.player=new this.shaka.Player,yield this.player.attach(o),this.player.addEventListener("error",this.onError),this.loadedSrc="",this.hasPlayed=!1,this.element.replaceWith(o),this.element$.next(o)}))}}("audio","dash"),Kk=new Dk("audio","hls"),Wk=new Dk("video","hls"),Gk=new Zy("audio","main"),Jk=new Zy("video","main"),Qk=new uv("main"),Xk=new wv("media-player",(function(e){if(!e)return null;if(e.src.startsWith("youtube:"))return Qk;if(e.src.startsWith("apple:"))return qk;if(e.src.startsWith("spotify:"))return mp;{const t=e.mediaType===li.Video;switch(e.playbackType){case _r.DASH:return t?Jk:Yk;case _r.HLS:return t?Wk:Kk;default:return t?Jk:Gk}}}),(function(e,t){e.load(function(e){if(e){if(e.unplayable)throw Error("Unplayable");return e.blob?{src:URL.createObjectURL(e.blob)}:e}throw Error("No source")}(t))}),$k);Xk.registerPlayers([Yk,Kk,Wk,Gk,Jk,Qk,qk,mp]);const Zk=Xk;var ex=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const tx=new K("embyReporting");function nx(e,t,n,r,i){return ex(this,void 0,void 0,(function*(){try{const[,,a]=e.src.split(":");yield Va.post("Sessions/Playing/Progress",{ItemId:a,IsPaused:n,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:r},i)}catch(e){tx.error(e)}}))}function rx(e,t){const n=new K(`${e.id}Scrobbler`),r=t=>{var n;return!!(null===(n=t.currentItem)||void 0===n?void 0:n.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(mr((e=>e?Mw():ur)),Ue(r),rt((({currentItem:e})=>function(e,t){return ex(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield Va.post("Sessions/Playing",{ItemId:n,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"},t)}catch(e){tx.error(e)}}))}(e,t)))).subscribe(n),e.observeIsLoggedIn().pipe(mr((e=>e?Ow():ur)),Ue(r),rt((({currentItem:e,currentTime:n})=>function(e,t,n){return ex(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");if(yield Va.post("Sessions/Playing/Stopped",{ItemId:r,IsPaused:!1,PositionTicks:Math.floor(1e7*t)},n),e.mediaType===li.Video){const{deviceId:t,sessionId:r}=n,[,,i]=e.src.split(":");yield Va.delete("Videos/ActiveEncodings",{DeviceId:t,PlaySessionId:`${r}-${i}`},n)}}catch(e){tx.error(e)}}))}(e,n,t)))).subscribe(n),e.observeIsLoggedIn().pipe(mr((e=>e?$w(1e4):ur)),Ue(r),Ue((({currentTime:e})=>e>0)),rt((({currentItem:e,currentTime:n,paused:r})=>nx(e,n,r,"timeupdate",t)))).subscribe(n),e.observeIsLoggedIn().pipe(mr((e=>e?Mw():ur)),mr((e=>r(e)?Cw().pipe(Kr(((e,t)=>e.paused===t.paused)),ep(1),hr(Ow())):ur)),rt((({currentItem:e,currentTime:n,paused:r})=>nx(e,n,r,r?"pause":"unpause",t)))).subscribe(n)}rx(xs,Ma),rx(lo,Ms);const ix=new K("lastfmScrobbler");function ax(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=nf(e);return!t||Ny.canScrobble(_o,t)}return!1}Mo().pipe(mr((e=>e?Mw():ur)),Ue((()=>Ny.canUpdateNowPlaying(_o))),He((({currentItem:e})=>e)),Ue(l),Ue((e=>ax(e))),rt((e=>xo.updateNowPlaying(e)))).subscribe(ix),Mo().pipe(mr((e=>e?Go():ur)),He((e=>e.filter((e=>!e.lastfmScrobbledAt)))),Pv(1e4),rt((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new No({from:n-30,to:t+30,limit:No.maxPageSize}),i=yield bi(r),a=i.map((e=>Xo(e,30))),[s,o]=m(e,(e=>!ax(e)||a.includes(Xo(e,30))||!!Zo(i,e)));if(yield Qo(s.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield xo.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Qo(o.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){ix.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(ix);const sx=new K("listenbrainzScrobbler");function ox(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=nf(e);return!t||Ny.canScrobble(yu,t)}return!1}dc().pipe(mr((e=>e?Mw():ur)),Ue((()=>Ny.canUpdateNowPlaying(yu))),He((({currentItem:e})=>e)),Ue(l),Ue((e=>ox(e))),rt((e=>tc.updateNowPlaying(e)))).subscribe(sx),dc().pipe(mr((e=>e?Go():ur)),He((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),Pv(1e4),rt((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new Qc({min_ts:n-30,max_ts:t+30,count:Qc.maxPageSize}),i=yield bi(r),a=i.map((e=>Xo(e,30))),[s,o]=m(e,(e=>!ox(e)||a.includes(Xo(e,30))||!!Zo(i,e)));if(yield Qo(s.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield tc.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Qo(o.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){sx.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(sx);var lx=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const cx=new K("subsonicReporting");function ux(e,t){const n=new K(`${e.id}Scrobbler`),r=t=>{var n;return!!(null===(n=t.currentItem)||void 0===n?void 0:n.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(mr((e=>e?Mw():ur)),Ue(r),rt((({currentItem:e})=>function(e,t){return lx(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield Ou.scrobble({id:n,submission:!1},t)}catch(e){cx.error(e)}}))}(e,t)))).subscribe(n),e.observeIsLoggedIn().pipe(mr((e=>e?Ow():ur)),Ue(r),rt((({currentItem:e,startedAt:n})=>function(e,t,n){return lx(this,void 0,void 0,(function*(){try{if(Jo(e.duration,t,Date.now())){const[,,r]=e.src.split(":");yield Ou.scrobble({id:r,time:t,submission:!0},n)}}catch(e){cx.error(e)}}))}(e,n,t)))).subscribe(n)}ux(pd,Nu);var dx=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const mx=new K("plexReporting");let hx="";function px(e,t,n){return dx(this,void 0,void 0,(function*(){try{yield fx(e,t,n)}catch(e){mx.error(e)}}))}function fx(e,t,n,r){return dx(this,void 0,void 0,(function*(){hx||mx.warn("reportState: `playQueueItemID` not defined",{state:n});const[i,,a]=e.src.split(":"),s="plex-tidal"===i;yield Ud.fetch({host:s?Md:void 0,path:s?"/timeline":"/:/timeline",params:{key:`/library/metadata/${a}`,ratingKey:a,playQueueItemID:hx,state:n,time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:r})}))}const yx=new K("plexScrobbler"),vx=e=>{var t;return/^(plex(-tidal)?):/.test(null===(t=e.currentItem)||void 0===t?void 0:t.src)};Qd().pipe(mr((e=>e?Mw():ur)),Ue(vx),rt((({currentItem:e})=>function(e){return dx(this,void 0,void 0,(function*(){try{hx="",hx=yield function(e){return dx(this,void 0,void 0,(function*(){const[t,,n]=e.src.split(":"),r=`/library/metadata/${n}`,i="plex-tidal"===t,{MediaContainer:a}=yield Ud.fetchJSON({host:i?"https://play.provider.plex.tv":void 0,path:"/playQueues",method:"POST",params:{key:r,type:"music",uri:i?`provider://tv.plex.provider.music${r}`:`server://${kd.serverId}/com.plexapp.plugins.library${r}`,continuous:"0",repeat:"0",own:"1"}});return String(a.playQueueSelectedItemID)}))}(e),yield fx(e,0,"playing")}catch(e){mx.error(e)}}))}(e)))).subscribe(yx),Qd().pipe(mr((e=>e?Ow():ur)),Ue(vx),rt((({currentItem:e})=>function(e){return dx(this,void 0,void 0,(function*(){try{yield fx(e,0,"stopped",!0)}catch(e){mx.error(e)}}))}(e)))).subscribe(yx),Qd().pipe(mr((e=>e?$w(1e4):ur)),Ue(vx),Ue((({currentTime:e})=>e>0)),rt((({currentItem:e,currentTime:t,paused:n})=>px(e,t,n?"paused":"playing")))).subscribe(yx),Qd().pipe(mr((e=>e?Mw():ur)),mr((e=>vx(e)?Cw().pipe(Kr(((e,t)=>e.paused===t.paused)),ep(1),hr(Ow())):ur)),rt((({currentItem:e,currentTime:t,paused:n})=>px(e,t,n?"paused":"playing")))).subscribe(yx),ux(_p,ku);const bx=new K("mediaPlayback/scrobbler");Ow().pipe(rt((e=>function(e){return Uo(this,void 0,void 0,(function*(){try{let t=e.currentItem;if(!t||!e.startedAt||!e.endedAt)throw Error("Invalid playback state");if(Jo(t.duration,e.startedAt,e.endedAt)){try{t=yield Fl(t,!0)}catch(e){Ho.error(e)}const{id:n,lookupStatus:r,blob:i}=t,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["id","lookupStatus","blob"]);Ho.log("add",{listen:a}),yield Wo.items.add(Object.assign(Object.assign({},a),{playedAt:Math.floor(e.startedAt/1e3),lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}catch(e){Ho.error(e)}}))}(e)))).subscribe(bx);const gx=new K("mediaPlayback"),wx=new Z("mediaPlayback"),Ex=new Z("mediaPlayback","session"),kx=new ct(!0),xx=new Le;let Sx="forward";function Tx(){return Tw.observeCurrentItem()}function Px(){return Dw.observeCurrentTime()}function Ax(){return Dw.observeDuration()}function Ix(){return Zk.observeEnded()}function Cx(){return Zk.observeError()}function Mx(){return Dw.observePaused()}function Ox(){return Dw.observePlaybackStart()}function $x(){return Dw.observePlaybackEnd()}function Nx(){return Zk.observePlaying()}function zx(e){gx.log("load",{item:e}),Zk.autoplay&&Dw.ready(),Zk.load(e),Zk.autoplay&&Dw.play()}function jx(){gx.log("play"),Dw.ready(),Sx="forward",Hx(),Dw.play(),Dw.paused||(Zk.play(),jk.play())}function Lx(){gx.log("pause"),Yx.stopAfterCurrent=!1,Hx(),Dw.pause(),Zk.pause(),jk.pause()}function Dx(e){gx.log("seek",{time:b(e)}),Zk.seek(e)}function Rx(){gx.log("stop"),Yx.stopAfterCurrent=!1,Hx(),Dw.stop(),Zk.stop(),jk.stop()}function Fx(){gx.log("prev"),Sx="backward",Tw.atStart||(Yx.stopAfterCurrent=!1,Ux(),Tw.prev())}function _x(){gx.log("next"),Sx="forward",Tw.atEnd||(Yx.stopAfterCurrent=!1,Ux(),Tw.next())}function Bx(){Yx.stopAfterCurrent=!1,Ux(),Tw.eject()}function Vx(){return qr([Tw.observeCurrentIndex(),Tw.observeSize()]).pipe(He((([e,t])=>e===t-1)),Kr())}function Ux(){Dw.paused||!1!==kx.getValue()||(Dw.stop(),Zk.stop(),Dw.play()),kx.next(!0)}function Hx(){kx.next(!1)}function qx(e){return t=this,n=void 0,i=function*(){if(!rf(e)){const t=yield function(e){return Ml(this,void 0,void 0,(function*(){if(!e)return;if(rf(e))return e;const t=Nl.current;return(null==t?void 0:t.item.id)===e.id?t.promise:new Nl(e).find()}))}(e);if(!t)return e;e=Object.assign(Object.assign({},e),t)}if(void 0===e.playbackType){const t=yield function(e){return t=this,n=void 0,i=function*(){let t=e.playbackType;if(void 0===t){const n=nf(e);t=(null==n?void 0:n.getPlaybackType)?yield n.getPlaybackType(e):_r.Direct,Xr({match:t=>t.src===e.src,values:{playbackType:t}})}return t},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e);e=Object.assign(Object.assign({},e),{playbackType:t})}return e},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}const Yx={stopAfterCurrent:!1,get autoplay(){return Zk.autoplay},set autoplay(e){Zk.autoplay=e,jk.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return Zk.muted},set muted(e){Ex.setBoolean("muted",e),Zk.muted=e},get paused(){return Dw.paused},get volume(){return Zk.volume},set volume(e){wx.setNumber("volume",e),Zk.volume=e},observeCurrentItem:Tx,observeCurrentTime:Px,observeDuration:Ax,observeEnded:Ix,observeError:Cx,observePaused:Mx,observePlaying:Nx,observePlaybackStart:Ox,observePlaybackEnd:$x,observePlaybackProgress:function(e){return Dw.observePlaybackProgress(e)},observePlaybackState:function(){return Dw.observePlaybackState()},appendTo:function(e){Zk.appendTo(e),jk.appendTo(e)},load:zx,play:jx,pause:Lx,stop:Rx,seek:Dx,resize:function(e,t){Zk.resize(e,t),jk.resize(e,t)},next:_x,prev:Fx,shuffle:function(e){Tw.shuffle(e)}},Kx=Yx;Yx.muted=Ex.getBoolean("muted"),Yx.volume=wx.getNumber("volume",1),Zk.observeCurrentTime().subscribe((e=>Dw.setCurrentTime(e))),Zk.observeDuration().subscribe((e=>Dw.setDuration(e))),Zk.observePlaying().subscribe((()=>Dw.started())),Zk.observeEnded().subscribe((()=>Dw.ended())),Zk.observePlaying().subscribe((()=>Sx="forward")),Zk.observeEnded().pipe(Zh(Vx()),hr(xx)).subscribe((([,e])=>{e||Yx.stopAfterCurrent?Rx():Tw.next()})),Zk.observeError().pipe(Pv(2e3),Zh(Mx(),Tw.observeCurrentIndex().pipe(He((e=>0===e)),Kr()),Vx()),hr(xx)).subscribe((([,e,t,n])=>{e||(n||t&&"backward"===Sx?Rx():"backward"===Sx?Tw.prev():Tw.next())})),Tw.observeSize().pipe(He((e=>0===e)),Kr(),Rr((e=>e)),Ue((e=>e))).subscribe(Rx),Tx().pipe(mr((e=>0===(null==e?void 0:e.duration)?Ax().pipe(Ue((e=>0!==e)),Vi(1),ut((t=>Xr({match:t=>t.src===e.src,values:{duration:t}})))):ur))).subscribe(gx),kx.pipe(Pv(300),Ue((e=>e))).subscribe((()=>{Yx.autoplay=!Dw.paused,kx.next(!1)})),kx.pipe(Kr(),mr((e=>e?ur:Tx())),Kr(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),mr((e=>e?qx(e):wr(null))),Rr((e=>!e)),ut(zx)).subscribe(gx),Tw.observeNextItem().pipe(Kr(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),Pv(3e3),Gr((e=>e?qx(e):wr(null)))).subscribe(gx),Xn(window,"pagehide").subscribe((function(){xx.next(void 0),Rx()})),Iw().subscribe(gx.rx("playbackReady")),Ox().subscribe(gx.rx("playbackStart")),$x().subscribe(gx.rx("playbackEnd")),Nx().subscribe(gx.rx("playing")),Ix().subscribe(gx.rx("ended")),Cx().subscribe(gx.error),Ax().pipe(Rr((e=>!e)),He(b),Kr()).subscribe(gx.rx("duration")),Px().pipe(Ue((e=>Math.round(e)%30==0)),He(b)).subscribe(gx.rx("currentTime"));var Wx=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Gx=new K("musicbrainz/coverart");class Jx extends Yt.cp{constructor(){super("ampcast/musicbrainz/coverart"),this.version(2).stores({items:"&mbid, [album+artist], thumbnails"})}}const Qx=new Jx;function Xx(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}var Zx=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const eS=new K("CoverArt");function tS({item:e,size:t,className:n="",onLoad:i,onError:a}){const[s,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)((()=>e.thumbnails)),u=!!(null==l?void 0:l.length),d=u?function(e,t=240){if(1===e.length)return e[0];let n=e.filter((e=>iS(e)<1.34));return 0===n.length&&(n=e.filter((e=>iS(e)<1.5)),0===n.length&&(n=e)),t*=window.devicePixelRatio||1,n.sort(((e,n)=>Math.abs(e.height-t)-Math.abs(n.height-t))),n[0]}(l,t):void 0,m=d?nS(d):"",h=function(e){switch(e.itemType){case si.Artist:return"artist";case si.Album:{const t=rS(e);return t&&"audio"!==t?t:"album"}case si.Media:return e.mediaType===li.Video?"video":"audio";case si.Playlist:return"playlist";case si.Folder:return"folder"}}(e),p=e.itemType===si.Album&&rS(e);(0,r.useEffect)((()=>{o(!1),c(e.thumbnails)}),[e.thumbnails]),(0,r.useEffect)((()=>{var t;if(!u){if(e.itemType===si.Media){const n=el(e);if(null===(t=null==n?void 0:n.thumbnails)||void 0===t?void 0:t[0])return void c(n.thumbnails)}const n=or(function(e){var t,n;return Zx(this,void 0,void 0,(function*(){if(e.itemType===si.Media&&(null===(t=e.link)||void 0===t?void 0:t.externalUrl)){const t=hc()(null===(n=e.link)||void 0===n?void 0:n.externalUrl);if(t)try{return(yield Yc(t)).thumbnails}catch(e){return void eS.error(e)}}return function(e){var t;return Wx(this,void 0,void 0,(function*(){if(!e||e.itemType!==si.Album&&e.itemType!==si.Media)return;let n=!1;const r=e.release_mbid;if(r){const e=yield Qx.items.get(r);if(n=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===si.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield Qx.items.get({album:i,artist:a});if(e)return e.thumbnails}if(r&&!n)try{const e=yield function(e){return Wx(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(r),t=e.images.filter((e=>e.front&&e.approved))[0],n=t?Object.keys(t.thumbnails).filter((e=>0!==Xx(e))).map((e=>({url:t.thumbnails[e],width:Xx(e),height:Xx(e)}))):[];return yield Qx.items.put(0===n.length?{mbid:r}:{mbid:r,album:i,artist:a,thumbnails:n}),n}catch(e){404===e.status?yield Qx.items.put({mbid:r}):Gx.error(e)}}))}(e)}))}(e)).subscribe((e=>{(null==e?void 0:e[0])?c(e):(o(!0),null==a||a())}));return()=>n.unsubscribe()}}),[u,e,a]);const f=(0,r.useCallback)((()=>{o(!0),null==a||a()}),[a]),y=(0,r.useCallback)((()=>{o(!1),null==i||i(m)}),[i,m]);return r.createElement("figure",{className:`cover-art ${n} ${p?"cover-art-"+p:""}`,key:e.src},m&&!s?r.createElement(r.Fragment,null,r.createElement("img",{className:"cover-art-image",src:m,alt:`${e.title}: Cover art`,onError:f,onLoad:y}),p?r.createElement("div",{className:"cover-art-icon-overlay"},r.createElement(ot,{className:"cover-art-icon",name:p})):null):h?r.createElement(ot,{className:"cover-art-image",name:h}):null)}function nS(e){return Kp().reduce(((e,t)=>{var n,r;return null!==(r=null===(n=null==t?void 0:t.getThumbnailUrl)||void 0===n?void 0:n.call(t,e))&&void 0!==r?r:e}),(null==e?void 0:e.url)||"")}function rS(e){if(!e.synthetic)return"";const[,t]=e.src.split(":");switch(t){case"top-tracks":return"star";case"videos":return"video";default:return"audio"}}function iS({width:e,height:t}){return e/t}function aS({className:e,children:t}){const n=(0,r.useRef)(null),[i,a]=(0,r.useState)(0),s=(0,r.useCallback)((({scrollHeight:e})=>a(e)),[]);return r.createElement("div",{className:`text-box ${e}`,style:{height:`${i}px`},ref:n},r.createElement("div",{style:{position:"relative",height:"100%"}},r.createElement(br,{onResize:s},t)))}function sS(e){const[t,n]=(0,r.useState)(e);return(0,r.useEffect)((()=>{null==t&&null!=e&&n(e)}),[t,e]),t}const oS=new K("Media/useCurrentItem");var lS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function cS(e){const t=function(e){const[t,n]=(0,r.useState)(e),[i,a]=(0,r.useState)("");return(0,r.useEffect)((()=>{if(i!==e.src){const t=nf(e);if(null==t?void 0:t.getMetadata){const r=or(t.getMetadata(e)).pipe(ut((t=>{a(e.src),n(Object.assign(Object.assign({},e),t))}))).subscribe(oS);return()=>r.unsubscribe()}a(e.src)}}),[e,i]),(0,r.useEffect)((()=>{const e=Zr().pipe(ut((e=>{for(const{match:r,values:i}of e)if(r(t)){n(Object.assign(Object.assign({},t),i));break}}))).subscribe(oS);return()=>e.unsubscribe()}),[t]),t}(e.item),n=sS(t);if(e.debug)return r.createElement(PS,{item:n});switch(t.itemType){case si.Media:return r.createElement(uS,{item:t});case si.Artist:return r.createElement(mS,{item:t});case si.Album:return r.createElement(dS,{item:t});case si.Playlist:return r.createElement(hS,{item:t});case si.Folder:return r.createElement(pS,{item:t})}}function uS({item:e}){var t;return r.createElement("article",{className:"media-info media-item-info"},r.createElement("div",{className:"media-info-main"},r.createElement(TS,{item:e}),r.createElement(fS,{title:e.title}),r.createElement(vS,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),r.createElement(wS,{album:e.album,year:e.year}),r.createElement(ES,{album:e.album,disc:e.disc,track:e.track}),r.createElement(bS,{owner:e.owner,src:e.src}),r.createElement(QS,{item:e})),r.createElement(yS,{description:e.description}),r.createElement(gS,{url:e.externalUrl,src:e.src}))}function dS({item:e}){return r.createElement("article",{className:"media-info album-info"},r.createElement("div",{className:"media-info-main"},r.createElement(TS,{item:e}),r.createElement(fS,{title:e.title}),r.createElement(vS,{artist:e.artist}),r.createElement(kS,{year:e.year}),r.createElement(QS,{item:e})),r.createElement(yS,{description:e.description}),r.createElement(gS,{url:e.externalUrl,src:e.src}))}function mS({item:e}){return r.createElement("article",{className:"media-info artist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(TS,{item:e}),r.createElement(fS,{title:e.title}),r.createElement(xS,{genres:e.genres}),r.createElement(SS,{country:e.country}),r.createElement(QS,{item:e})),r.createElement(yS,{description:e.description}),r.createElement(gS,{url:e.externalUrl,src:e.src}))}function hS({item:e}){return r.createElement("article",{className:"media-info playlist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(TS,{item:e}),r.createElement(fS,{title:e.title}),r.createElement(bS,{owner:e.owner,src:e.src}),r.createElement(xS,{genres:e.genres}),r.createElement(QS,{item:e})),r.createElement(yS,{description:e.description}),r.createElement(gS,{url:e.externalUrl,src:e.src}))}function pS({item:e}){return r.createElement("article",{className:"media-info folder-info"},r.createElement("div",{className:"media-info-main"},r.createElement(TS,{item:e}),r.createElement(fS,{title:e.title})))}function fS({title:e}){return r.createElement("h3",{className:"title"},e||"(no title)")}function yS({description:e}){const t=null==e?void 0:e.trim().split(/[\n\r]+/);return(null==t?void 0:t.length)?r.createElement(aS,{className:"blurb"},t.map(((e,t)=>r.createElement("p",{key:t},e)))):null}function vS({artist:e}){return e?r.createElement("h4",{className:"artist"},r.createElement("span",{className:"by"},"By: "),e):null}function bS({src:e,owner:t}){if(!t||!t.name)return null;const[n]=e.split(":"),i="youtube"===n?"Channel":"Curator";return r.createElement("p",{className:"owner"},i,":"," ",t.url?r.createElement(rc,{href:t.url},t.name):t.name)}function gS({src:e,url:t=""}){let[n]=e.split(":"),i=n;switch(n){case"musicbrainz":i="MusicBrainz";break;case"plex-tidal":i="Plex";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",n="musicbrainz"):i="ListenBrainz";break;case"blob":case"file":i="local file system";break;case"http":case"https":i="external source";break;default:{const e=tf(n);e&&(i=e.name)}}return r.createElement("p",{className:"external-view"},r.createElement(ot,{name:n}),t?r.createElement(rc,{href:t},"View on ",i):r.createElement("span",{className:"external-provider"},"Provided by ","plex-tidal"===n?"TIDAL":i))}function wS({album:e,year:t}){return e&&t?r.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?r.createElement("h4",{className:"album"},"From: ",e):t?r.createElement("h4",{className:"album"},"Year: ",t):null}function ES({album:e,disc:t=1,track:n}){return e&&n?r.createElement("p",{className:"track"},"Track: ",n,t>1?` (Disc ${t})`:""):null}function kS({year:e}){return e?r.createElement("p",{className:"year"},"Year: ",e):null}function xS({genres:e}){return e?r.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function SS({country:e}){return e?r.createElement("p",{className:"country"},"Country: ",e):null}function TS(e){return r.createElement("div",{className:"thumbnail"},r.createElement(tS,Object.assign({},e)))}function PS(e){const t=e.item,{pager:n,parent:i}=t,a=lS(t,["pager","parent"]);return r.createElement("article",{className:"media-info debug"},r.createElement("pre",null,JSON.stringify(a,void 0,2)),r.createElement(gS,{url:a.externalUrl,src:a.src}))}function AS(e){const[t,n]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=Xn(document,"keydown",{capture:!0}).subscribe((t=>{var r;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?n((e=>!e)):t[R.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(t.preventDefault(),null===(r=e.current)||void 0===r||r.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var IS=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},CS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function MS(e){return IS(this,void 0,void 0,(function*(){yield vn((t=>r.createElement(OS,Object.assign({},t,{item:e}))))}))}function OS(e){var{item:t}=e,n=CS(e,["item"]);const i=(0,r.useRef)(null),{debug:a}=AS(i),s=function(e){switch(e.itemType){case si.Playlist:return"Playlist info";case si.Album:return"Album info";case si.Artist:return"Artist info";case si.Folder:return"Folder info";default:return"Media info"}}(t);return r.createElement(fn,Object.assign({},n,{className:"media-info-dialog",title:s,ref:i}),r.createElement("form",{method:"dialog"},r.createElement(cS,{item:t,debug:a}),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}var $S=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const NS={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function zS(e){var{className:t="",layout:n=NS}=e,i=$S(e,["className","layout"]);return r.createElement(yT,Object.assign({},i,{className:`playlists ${t}`,layout:n}))}function jS(e,t){const[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const n=(null==e?void 0:e.search(t))||null;return i(n),()=>null==n?void 0:n.disconnect()}),[e,t]),n}var LS=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},DS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const RS={view:"card minimal",fields:["Thumbnail","Title","TrackCount"]};function FS(e){var{items:t}=e,n=DS(e,["items"]);const i=(0,r.useId)(),a=(0,r.useRef)(null),s=hk(t),[o,l]=(0,r.useState)(null),c=jS((null==(u=o)?void 0:u.editablePlaylists)||null);var u;const[d,m]=(0,r.useState)(null),h=t.length;(0,r.useEffect)((()=>{l((e=>{var t;return e||(null===(t=s[0])||void 0===t?void 0:t.service)||null}))}),[s]);const p=(0,r.useCallback)((()=>LS(this,void 0,void 0,(function*(){if((null==o?void 0:o.addToPlaylist)&&d){const e=s.find((e=>e.service===o)),t=null==e?void 0:e.items;try{yield o.addToPlaylist(d,t),nk(d)}catch(e){console.error(e),yield Mn("An error occurred while updating your playlist.")}}}))),[o,d,s]),f=(0,r.useCallback)((()=>{const e=tf(a.current.value);l(e)}),[]),y=(0,r.useCallback)((([e])=>{m(e)}),[]);return r.createElement(fn,Object.assign({},n,{className:`add-to-playlist-dialog service-${(null==o?void 0:o.id)||""}`,title:"Add to playlist"}),r.createElement("form",{method:"dialog",onSubmit:p},r.createElement("p",null,r.createElement("label",{htmlFor:`${i}-service`},"Save to:"),r.createElement("select",{id:`${i}-service`,required:!0,onChange:f,ref:a},s.map((({service:e,items:t})=>r.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",h,")"))))),r.createElement(zS,{title:o?`${null==o?void 0:o.name}: Playlists`:"",pager:c,layout:RS,onContextMenu:()=>{},onSelect:y}),r.createElement(kn,{submitText:"Add",disabled:!d})))}var _S=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},BS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function VS(e){return _S(this,void 0,void 0,(function*(){yield vn((t=>r.createElement(US,Object.assign({},t,{items:e}))))}))}function US(e){var{items:t}=e,n=BS(e,["items"]);const i=(0,r.useId)(),a=(0,r.useRef)(null),s=(0,r.useRef)(null),o=(0,r.useRef)(null),l=(0,r.useRef)(null),c=hk(t),[u,d]=(0,r.useState)((()=>{var e;return null===(e=c[0])||void 0===e?void 0:e.service.id})),m=t.length,h=(0,r.useCallback)((()=>_S(this,void 0,void 0,(function*(){const e=tf(a.current.value);if(null==e?void 0:e.createPlaylist){const t=s.current.value,n=o.current.value,i=l.current.checked,a=c.find((t=>t.service===e)),u=null==a?void 0:a.items;try{const a=yield e.createPlaylist(t,{description:n,isPublic:i,items:u});yield wn({title:r.createElement(In,{icon:e.id,text:e.name}),message:"Your playlist has been created."}),nk(a)}catch(e){console.error(e),yield Mn("An error occurred while creating your playlist.")}}}))),[c]),p=(0,r.useCallback)((()=>{const e=a.current.value;d(e)}),[]);return r.createElement(fn,Object.assign({},n,{className:`create-playlist-dialog service-${u||""}`,title:"Create Playlist"}),r.createElement("form",{method:"dialog",onSubmit:h},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${i}-service`},"Save to:"),r.createElement("select",{id:`${i}-service`,required:!0,onChange:p,ref:a},c.map((({service:e,items:t})=>r.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",m,")"))))),r.createElement("p",null,r.createElement("label",{htmlFor:`${i}-name`},"Name:"),r.createElement("input",{type:"text",id:`${i}-name`,required:!0,ref:s})),r.createElement("p",null,r.createElement("label",{htmlFor:`${i}-description`},"Description:"),r.createElement("textarea",{id:`${i}-description`,rows:2,cols:40,ref:o})),r.createElement("p",{className:"save-playlist-dialog-public"},r.createElement("label",{htmlFor:`${i}-public`},"Public:"),r.createElement("input",{type:"checkbox",id:`${i}-public`,ref:l,disabled:HS(u)}))),r.createElement(kn,{submitText:"Save"})))}function HS(e){switch(e){case"emby":case"jellyfin":case"plex":case"plex-tidal":return!0;default:return!1}}var qS=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const YS=new K("ampcast/performAction");function KS(e,t,n){return qS(this,void 0,void 0,(function*(){const i=t[0];if(!i)return;const a=i.itemType;switch(e){case ii.PlayNow:case ii.PlayNext:case ii.Queue:!function(e,t){qS(this,void 0,void 0,(function*(){const n=t[0];if(!n)return;const r=n.itemType;if(r===si.Media||r===si.Album)switch(e){case ii.PlayNow:case ii.PlayNext:e===ii.PlayNow&&(Kx.autoplay=!0),r===si.Media?yield Tw.inject(t):yield Tw.inject(n),e===ii.PlayNow&&Tw.next();break;case ii.Queue:r===si.Media?yield Tw.add(t):yield Tw.add(n)}}))}(e,t);break;case ii.Like:case ii.Unlike:case ii.Rate:case ii.AddToLibrary:case ii.RemoveFromLibrary:!function(e,t,n){qS(this,void 0,void 0,(function*(){if(t)try{switch(e){case ii.Like:yield ni.rate(t,1);break;case ii.Unlike:yield ni.rate(t,0);break;case ii.Rate:"number"==typeof n&&(yield ni.rate(t,n));break;case ii.AddToLibrary:yield ni.store(t,!0);break;case ii.RemoveFromLibrary:yield ni.store(t,!1)}}catch(r){YS.warn("Failed to perform action:",{action:e,item:t,payload:n}),YS.error(r)}}))}(e,i,n);break;case ii.Pin:a===si.Playlist&&(yield na.pin(t));break;case ii.Unpin:a===si.Playlist&&(yield na.unpin(t));break;case ii.Info:yield MS(i);break;case ii.AddToPlaylist:yield function(e){return LS(this,void 0,void 0,(function*(){yield vn((t=>r.createElement(FS,Object.assign({},t,{items:e}))))}))}(t);break;case ii.AddToNewPlaylist:yield VS(t);break;case ii.AddToRecentPlaylist1:case ii.AddToRecentPlaylist2:case ii.AddToRecentPlaylist3:case ii.AddToRecentPlaylist4:try{yield function(e,t){var n;return XE(this,void 0,void 0,(function*(){const r=ik(t),i=rk(r.map((e=>e.service))),a=i[e],s=nf(a),o=(null===(n=r.find((e=>e.service===s)))||void 0===n?void 0:n.items)||[];yield s.addToPlaylist(a,o),nk(a)}))}(Number(e.slice(-1))-1,t)}catch(e){YS.error(e),yield Mn("An error occurred while updating your playlist.")}}}))}var WS=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const GS={[ii.AddToLibrary]:"heart",[ii.RemoveFromLibrary]:"heart-fill",[ii.Rate]:"star",[ii.Like]:"heart",[ii.Unlike]:"heart-fill"},JS={[ii.AddToLibrary]:"Add to library",[ii.RemoveFromLibrary]:"Remove from library",[ii.Rate]:"Rate",[ii.Like]:"Like",[ii.Unlike]:"Unlike"};function QS({item:e,inline:t}){const n=nf(e),i=t?-1:void 0,a=(0,r.useCallback)((()=>WS(this,void 0,void 0,(function*(){e.itemType===si.Playlist&&(e.isPinned?yield KS(ii.Unpin,[e]):yield KS(ii.Pin,[e]))}))),[e]),s=(0,r.useCallback)((()=>WS(this,void 0,void 0,(function*(){e.rating?yield KS(ii.Unlike,[e]):yield KS(ii.Like,[e])}))),[e]),o=(0,r.useCallback)((()=>WS(this,void 0,void 0,(function*(){e.inLibrary?yield KS(ii.RemoveFromLibrary,[e]):yield KS(ii.AddToLibrary,[e])}))),[e]),l=(0,r.useCallback)((t=>WS(this,void 0,void 0,(function*(){const n=t.target.getBoundingClientRect(),r=yield bk([e],!1,n.right,n.bottom,"right");r&&(yield KS(r,[e]))}))),[e]),c=(0,r.useCallback)((t=>WS(this,void 0,void 0,(function*(){yield KS(ii.Rate,[e],t)}))),[e]);return r.createElement(QE,null,t?r.createElement(kf,{icon:"menu",title:"More…",tabIndex:i,onClick:l,key:"menu"}):null,e.itemType===si.Playlist&&(null==n?void 0:n.createSourceFromPin)?r.createElement(kf,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:i,onClick:a,key:"pin"}):null,n?r.createElement(r.Fragment,null,void 0!==e.rating&&(null==n?void 0:n.canRate(e,t))?"plex"===n.id?r.createElement(kk,{value:e.rating,tabIndex:i,onChange:c}):r.createElement(kf,{icon:e.rating?XS(n,ii.Unlike):XS(n,ii.Like),title:e.rating?ZS(n,ii.Unlike):ZS(n,ii.Like),tabIndex:i,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==n?void 0:n.canStore(e,t))?r.createElement(kf,{icon:e.inLibrary?XS(n,ii.RemoveFromLibrary):XS(n,ii.AddToLibrary),title:e.inLibrary?ZS(n,ii.RemoveFromLibrary):ZS(n,ii.AddToLibrary),tabIndex:i,disabled:"apple"===n.id&&e.inLibrary,onClick:o,key:"store"}):null):null)}function XS(e,t){var n;return(null===(n=e.icons)||void 0===n?void 0:n[t])||GS[t]}function ZS(e,t){var n;return(null===(n=e.labels)||void 0===n?void 0:n[t])||JS[t]}function eT({children:e}){return r.createElement("footer",{className:"status-bar"},e)}function tT({items:e,size:t,maxSize:n,error:i,loading:a,loadingText:s="Loading",selectedCount:o,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=r.createElement("span",{className:"message"},s,"…");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=r.createElement("span",{className:"selected"},"(",nT(o)," selected)"),s=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${nT(i)} of ${void 0===t?n||`${nT(e.length)}+`:nT(n?Math.min(t,n):t)} ${c}`;u=r.createElement("span",{className:"message"},s," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||rT[e.status]||e.status||"")}(i);u=r.createElement(r.Fragment,null,r.createElement(ot,{name:"error"}),r.createElement("span",{className:"message error"},e?`Error: ${e}`:"Error"))}else u=r.createElement("span",{className:"message"},"0 ",c);return r.createElement(eT,null,u)}function nT(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const rT={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"},iT=(0,r.memo)((function({time:e}){const t=100/6,n=new Date(e);let i=n.getHours()+n.getMinutes()/60,a=Math.min(i,6),s=i-a;return i>12&&(i=24-i,s=Math.min(i,6),a=i-s),r.createElement("span",{role:"presentation",className:"sun-clock",title:n.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":s*t+"%"}})}));function aT({time:e,className:t}){return r.createElement("time",{className:t},b(e))}const sT={view:"details",fields:["Title","Genre","Owner"]};const oT=e=>r.createElement(aT,{className:"text",time:e.duration||0});function lT({value:e=""}){return""===e?null:r.createElement("span",{className:"text"},e)}const cT={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return r.createElement(lT,{value:e.itemType===si.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>r.createElement(lT,{value:e.albumArtist}),className:"artist"},AlbumTrack:{title:"#",render:e=>r.createElement("span",{className:"text"},e.track?r.createElement(r.Fragment,null,r.createElement("span",{className:"disc"},e.disc||"?","."),e.track):"-"),align:"right",width:60,className:"index"},Title:{title:"Title",render:e=>r.createElement(lT,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const t=nf(e);return t?r.createElement(In,{icon:t.icon,text:e.title}):r.createElement(lT,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>r.createElement(lT,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>r.createElement(lT,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>r.createElement(lT,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>r.createElement(lT,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:oT,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const n=e.itemType===si.Media?e.mediaType===li.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return r.createElement("figure",{className:"cover-art"},r.createElement(ot,{className:"cover-art-image",name:n}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>r.createElement(lT,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>r.createElement(lT,{value:uT(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>r.createElement(lT,{value:uT(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>r.createElement(lT,{value:e.year||""}),width:120,className:"year"},Views:{title:"Views",render:e=>null==e.globalPlayCount?null:r.createElement(lT,{value:mT(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return r.createElement(lT,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return r.createElement(lT,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},AddedAt:{title:"Date Added",render:e=>{if(!e.addedAt)return null;const t=new Date(1e3*e.addedAt),n=dT(t.valueOf());return r.createElement("time",{className:"text added-at",title:t.toLocaleString()},n)},className:"added-at"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return r.createElement("span",{className:"text last-played"},"unplayed");const t=new Date(1e3*e.playedAt),n=dT(t.valueOf());return r.createElement("time",{className:"text last-played",title:t.toLocaleString()},n)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt,n=new Date(t);return r.createElement("time",{className:"text",title:n.toLocaleString()},r.createElement(iT,{time:t}),r.createElement("span",{className:"date"},n.toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>r.createElement(tS,{item:e}),className:"thumbnail"},Rate:{title:r.createElement(kk,{value:0,tabIndex:-1}),render:e=>r.createElement(kk,{value:e.rating,tabIndex:-1,onChange:t=>{return n=void 0,r=void 0,a=function*(){yield KS(ii.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}}),align:"right",width:120,className:"rate"}};function uT(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function dT(e){const t=Date.now()-e;if(t<12e4)return"just now";const n=36e5;if(t<54e5)return`${Math.round(t/6e4)} mins ago`;const r=24*n;if(t<1.5*r)return`${Math.round(t/n)} hours ago`;if(t<12*r)return`${Math.round(t/r)} days ago`;const i=7*r;if(t<10*i)return`${Math.round(t/i)} weeks ago`;const a=365*r;return t<a?`${Math.round(t/2592e6)} months ago`:t<2*a?"1 year ago":`${Math.floor(t/a)} years ago`}function mT(e=0,t="listen",n=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${n}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${n}`:e<1e6?`${Math.round(e/1e3)}K  ${n}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${n}`:e<1e9?`${Math.round(e/1e6)}M  ${n}`:`${(e/1e9).toFixed(1).replace(".0","")}B  ${n}`}function hT(e){return(0,r.useCallback)((t=>{const n=e.filter((e=>e.src.startsWith("spotify:track:")));if(n.length>0){const e=n.map((e=>e.src));t.dataTransfer.setData("text/x-spotify-tracks",e.join("\n")),t.dataTransfer.effectAllowed="copyMove"}}),[e])}var pT=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},fT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function yT(e){var{className:t="",pager:n=null,statusBar:i=!0,loadingText:a,onContextMenu:s,onDoubleClick:o,onEnter:l,onError:c,onLoad:u,onNoContent:d,onSelect:m}=e,h=fT(e,["className","pager","statusBar","loadingText","onContextMenu","onDoubleClick","onEnter","onError","onLoad","onNoContent","onSelect"]);const p=function(e=sT){return(0,r.useMemo)((()=>function(e){if("none"===e.view)return{view:"details",cols:[]};const{view:t,fields:n}=e,i=n.map((e=>cT[e]));return i.push({title:r.createElement(ot,{name:"menu"}),render:e=>r.createElement(QS,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(h.layout),[f,y]=(0,r.useState)(0),[v,b]=(0,r.useState)(0),[{items:g,loaded:w,error:E,size:k,maxSize:x},S]=function(e){const[t,n]=function(){const e=(0,r.useRef)(null);null===e.current&&(e.current=new Le);const t=(0,r.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[i,a]=(0,r.useState)([]),[s,o]=(0,r.useState)(void 0),[l,c]=(0,r.useState)(void 0),[u,d]=(0,r.useState)(),[m,h]=(0,r.useState)(!1),p=(0,r.useMemo)((()=>({items:i,size:s,maxSize:l,error:u,loaded:m})),[i,s,l,u,m]),f=(0,r.useCallback)(((e,t)=>{n([e,t])}),[n]);return(0,r.useEffect)((()=>{if(a([]),o(void 0),c(void 0),d(void 0),h(!1),!e)return;const n=e.observeItems(),r=e.observeSize(),i=e.observeError(),s=dr(n,i).pipe(Vi(1),He((()=>!0))),l=lr(wr([]),wr([]).pipe(np(0))),u=new de;return u.add(lr(l,n).subscribe(a)),u.add(r.subscribe(o)),u.add(i.subscribe(d)),u.add(s.subscribe(h)),u.add(t.subscribe((([t,n])=>{e.fetchAt(t,n)}))),c(e.maxSize),()=>u.unsubscribe()}),[e,t]),[p,f]}(n),[T,P]=(0,r.useState)([]),A=GE(),I=null==A?void 0:A.src,C=function(e){const[t,n]=(0,r.useState)("");return(0,r.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at|added-at|rate/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),n(t?`clip-${t}`:"")}),[e]),t}(p),M=w?g.length>0:void 0,O=hT(T);(0,r.useEffect)((()=>{E&&c&&c(E)}),[E,c]),(0,r.useEffect)((()=>{w&&u&&u()}),[w,u]),(0,r.useEffect)((()=>{!1===M&&d&&d()}),[M,d]),(0,r.useEffect)((()=>{f>=0&&v>0&&S(f,v)}),[S,f,v,n]);const $=(0,r.useCallback)((e=>{P(e),null==m||m(e)}),[m]),N=(0,r.useCallback)(((e,t,n,r,i)=>pT(this,void 0,void 0,(function*(){if(0===e.length)return;const r=yield bk(e,!0,t,n,-1===i?"right":"left");r&&(yield KS(r,e))}))),[]),z=(0,r.useCallback)(((e,t)=>pT(this,void 0,void 0,(function*(){vT(e)?yield KS(ii.Queue,[e]):null==o||o(e,t)}))),[o]),j=(0,r.useCallback)(((e,t,n)=>pT(this,void 0,void 0,(function*(){e.every(vT)?t||n?t&&!n?yield KS(ii.PlayNow,e):n&&!t&&(yield KS(ii.PlayNext,e)):yield KS(ii.Queue,e):null==l||l(e,t,n)}))),[l]),L=(0,r.useCallback)((e=>pT(this,void 0,void 0,(function*(){yield KS(ii.Info,e)}))),[]),D=(0,r.useCallback)((e=>{if((null==e?void 0:e.itemType)===si.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===I?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[I]);return r.createElement("div",{className:`panel ${t} ${C}`,onDragStart:O},r.createElement(Bf,Object.assign({},h,{className:"media-list",layout:p,items:g,itemClassName:D,itemKey:"src",selectedIndex:0===g.length?-1:0,onContextMenu:s||N,onDoubleClick:z,onEnter:j,onInfo:L,onPageSizeChange:b,onScrollIndexChange:y,onSelect:$})),i?r.createElement(tT,{items:g,error:E,size:k,maxSize:x,loading:!!n&&!w,loadingText:a,selectedCount:T.length}):null)}function vT(e){return e.itemType===si.Media||e.itemType===si.Album}var bT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const gT={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function wT(e){var{className:t="",layout:n=gT,draggable:i=!0}=e,a=bT(e,["className","layout","draggable"]);return r.createElement(yT,Object.assign({},a,{className:`albums ${t}`,layout:n,draggable:i}))}var ET=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const kT={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function xT(e){var{className:t="",layout:n=kT,multiple:i=!0,draggable:a=!0}=e,s=ET(e,["className","layout","multiple","draggable"]);return r.createElement(yT,Object.assign({},s,{className:`media-items ${t}`,layout:n,multiple:i,draggable:a}))}const ST={view:"details",fields:["AlbumTrack","Title","Artist","Duration"]},TT={view:"card compact",fields:["Thumbnail","Title","Artist","Duration"]};function PT(e,t=ST){const[n,i]=(0,r.useState)(t);return(0,r.useEffect)((()=>{if((null==e?void 0:e.synthetic)&&"details"===t.view){const[,n]=e.src.split(":");if("videos"===n)i(TT);else{const e=t.fields.slice();"Track"!==e[0]&&"AlbumTrack"!==e[0]||(e[0]="Index");const n=e.indexOf("Duration");-1!==n&&e.splice(n+1,0,"Album","Year"),i({view:"details",fields:h(e)})}}else i(t)}),[e,t]),n}var AT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function IT(e){var t,{source:n}=e,i=AT(e,["source"]);const[a,s]=(0,r.useState)(null),o=PT(a,n.secondaryLayout),l=(null==a?void 0:a.pager)||null,c=(0,r.useCallback)((([e])=>{s(e||null)}),[]),u=r.createElement(wT,Object.assign({},i,{title:n.title,onSelect:c})),d=r.createElement(xT,{title:a?`${a.title}: Tracks`:"",className:"album-tracks "+((null==a?void 0:a.multiDisc)?"multi-disc":""),pager:l,layout:o,key:null==a?void 0:a.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=n.secondaryLayout)||void 0===t?void 0:t.view)?u:r.createElement(mn,{id:"album-browser-layout",arrange:"rows",primaryIndex:0},u,d))}var CT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const MT={view:"card compact",fields:["Thumbnail","Title","Genre"]};function OT(e){var{className:t="",layout:n=MT}=e,i=CT(e,["className","layout"]);return r.createElement(yT,Object.assign({},i,{className:`artists ${t}`,layout:n}))}var $T=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const NT={view:"card compact",fields:["Thumbnail","Title","Year"]};function zT(e){var t,n,{source:i}=e,a=$T(e,["source"]);const[s,o]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),u=PT(l,i.tertiaryLayout),d=(null==s?void 0:s.pager)||null,m=(null==l?void 0:l.pager)||null,h=(0,r.useCallback)((([e])=>{o(e||null)}),[]),p=(0,r.useCallback)((([e])=>{c(e||null)}),[]),f=r.createElement(OT,Object.assign({},a,{title:i.title,onSelect:h})),y=r.createElement(wT,{title:s?`${s.title}: Albums`:"",className:"artist-albums",pager:d,layout:i.secondaryLayout||NT,onSelect:p,key:null==s?void 0:s.src}),v=r.createElement(xT,{title:l?`${l.title}: Tracks`:"",className:"album-tracks "+((null==l?void 0:l.multiDisc)?"multi-disc":""),pager:m,layout:u,key:null==l?void 0:l.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=i.secondaryLayout)||void 0===t?void 0:t.view)?f:"none"===(null===(n=i.tertiaryLayout)||void 0===n?void 0:n.view)?r.createElement(mn,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},f,y):r.createElement(mn,{id:"artist-browser-layout",arrange:"columns",primaryIndex:1},f,r.createElement(mn,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},y,v)))}var jT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function LT(e){var{source:t}=e,n=jT(e,["source"]);return r.createElement("div",{className:"panel"},r.createElement(xT,Object.assign({},n,{title:t.title})),";")}var DT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const RT={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},FT={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function _T(e){var{source:t}=e,n=DT(e,["source"]);const[i,a]=(0,r.useState)(),[s,o]=(0,r.useState)(null),l=(null==s?void 0:s.pager)||null;(0,r.useEffect)((()=>()=>na.unlock()),[t]),(0,r.useEffect)((()=>{s&&na.lock(s)}),[s]);const c=(0,r.useCallback)((([e])=>{o(e||null)}),[]),u=(0,r.useCallback)((()=>{a(Error("Not found"))}),[]);return r.createElement("div",{className:"panel pinned-playlist"},i?r.createElement(BT,{src:t.id}):r.createElement(zS,Object.assign({},n,{title:t.title,layout:t.layout||RT,onError:a,onNoContent:u,onSelect:c,statusBar:!1,disabled:!0})),r.createElement(xT,{title:`${t.title}: Tracks`,className:"playlist-items",pager:l,layout:t.secondaryLayout||FT,onError:a}))}function BT({src:e}){const t=(0,r.useCallback)((()=>{na.unlock(),na.unpin({src:e})}),[e]);return r.createElement("div",{className:"playlists playlists-error"},r.createElement("p",{className:"message"},r.createElement(ot,{name:"error"}),r.createElement("span",{className:"text"},"Failed to load playlist.")),r.createElement("p",{className:"buttons"},r.createElement("button",{onClick:t},"Unpin")))}var VT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const UT={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function HT(e){var t,{source:n}=e,i=VT(e,["source"]);const[a,s]=(0,r.useState)(null),o=(null==a?void 0:a.pager)||null,l=(0,r.useCallback)((([e])=>{s(e||null)}),[]),c=r.createElement(zS,Object.assign({},i,{title:n.title,onSelect:l})),u=r.createElement(xT,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:o,layout:n.secondaryLayout||UT,key:null==a?void 0:a.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=n.secondaryLayout)||void 0===t?void 0:t.view)?c:r.createElement(mn,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:0},c,u))}function qT(e){return ga()?r.createElement(LT,Object.assign({},e,{service:ba})):r.createElement(YT,null)}function YT(){return r.createElement(BE,null,r.createElement("div",{className:"note"},r.createElement("p",null,r.createElement("strong",null,"Apple MusicKit beta required.")),r.createElement("p",null,"You need to enable ",r.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from ",ba.name,".")))}function KT(e){return"apple"===e.service.id?r.createElement(qT,Object.assign({},e)):r.createElement(LT,Object.assign({},e))}function WT(e){switch(e.source.itemType){case si.Artist:return r.createElement(zT,Object.assign({},e));case si.Album:return r.createElement(IT,Object.assign({},e));case si.Playlist:return e.source.isPin?r.createElement(_T,Object.assign({},e)):r.createElement(HT,Object.assign({},e));default:return e.source.mediaType===li.Video?r.createElement(KT,Object.assign({},e)):r.createElement(LT,Object.assign({},e))}}var GT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const JT={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function QT(e){var{service:t,source:n,minDate:i="2010-01-01"}=e,a=GT(e,["service","source","minDate"]);const[s,o]=(0,r.useState)(0),l=function(e,t=0){return jS(e,(0,r.useMemo)((()=>({startAt:t})),[t]))}(n,s),c=(0,r.useCallback)((e=>{const t=new Date,n=new Date(e);n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?o(0):o(Math.floor(n.valueOf()/1e3))}),[]);return r.createElement(r.Fragment,null,r.createElement(UE,{icon:t.icon},t.name,":",r.createElement(WE,{min:i,onSelect:c})),r.createElement(WT,Object.assign({},a,{service:t,source:n,pager:l,layout:n.layout||JT})))}const XT="2002-11-20",ZT=new K("lastfm/useHistoryStart");function eP(){const e=function(){const[e,t]=(0,r.useState)((()=>go.firstScrobbledAt)),n=""===e||e===XT;return(0,r.useEffect)((()=>{if(n){t(XT);const e=or(xo.getUserInfo()).pipe(He((e=>Number(e.user.playcount))),rt((e=>{return e?wr(e):(n=oe(t=()=>Error("No history."))?t:function(){return t},new Ne((function(e){return e.error(n())})));var t,n})),He((e=>Math.floor(e/50))),He((e=>new No({page:e},{pageSize:50}))),rt((e=>bi(e))),He((e=>e.at(-1))),Ue(l),He((e=>new Date(1e3*e.playedAt))),He(y),ut((e=>go.firstScrobbledAt=e)),ut(t)).subscribe(ZT);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(QT,{service:_o,source:Lo,minDate:e})}var tP=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const nP={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function rP(e){var{service:t,source:n,total:i}=e,a=tP(e,["service","source","total"]);const[,s]=(0,r.useReducer)((e=>e++),0);return(0,r.useEffect)((()=>{const e=or(qn(6e4)).subscribe(s);return()=>e.unsubscribe()}),[]),r.createElement(r.Fragment,null,r.createElement(UE,{icon:t.icon},void 0===i?t.name:r.createElement(r.Fragment,null,t.name,": ",i.toLocaleString()," ",function(e){return sf(e)&&!!e.canScrobble}(t)?"scrobbles":"plays")),r.createElement(WT,Object.assign({},a,{service:t,source:n,layout:n.layout||nP})))}class iP extends Yi{fetchAt(){}next(e){this.disconnected||(this.connect(),this.size=e.length,this.items=e)}}var aP=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const sP=new K("useRecentlyPlayedPager");function oP(e){const t=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[n,i]=(0,r.useState)(null),[a,s]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{const n=new iP,r=e(void 0,t),a=new Qi(n,r),o=dr(Go().pipe(ep(1),np(2e4)),qn(3e5)),l=new de,c=t=>aP(this,void 0,void 0,(function*(){const n=e(t);return yield bi(n)}));return l.add(r.observeItems().pipe(Rr((e=>0===e.length)),Vi(1),He((e=>e[0].playedAt)),mr((e=>o.pipe(rt((()=>c(e+1))),ut((e=>n.next(e))))))).subscribe(sP)),l.add(a.observeSize().pipe(ut(s)).subscribe(sP)),n.next([]),i(a),()=>l.unsubscribe()}),[t,e]),{pager:n,total:a}}function lP(){const e=(0,r.useCallback)(((e,t)=>new No(e?{from:e}:{to:t})),[]),{pager:t,total:n}=oP(e);return r.createElement(rP,{service:_o,source:Do,pager:t,total:n})}var cP=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const uP=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function dP(e){var{source:t}=e,n=cP(e,["source"]);const i=(0,r.useId)(),[a,s]=(0,r.useState)(),o=function(e,t="overall"){return jS(e,(0,r.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,r.useCallback)((e=>{s(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(UE,{icon:_o.icon},_o.name,": ",t.title),r.createElement("div",{className:"lastfm-period-selector options"},r.createElement("ul",{className:"lastfm-periods"},uP.map((({value:e,text:t})=>r.createElement("li",{className:"lastfm-period",key:e},r.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),r.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),r.createElement(WT,Object.assign({},n,{service:_o,source:t,pager:o,layout:t.layout})))}const mP="2015-09-17";function hP(){const e=function(){const[e,t]=(0,r.useState)(Ql.firstScrobbledAt),n=""===e||e===mP;return(0,r.useEffect)((()=>{if(n){t(mP);const e=or(tc.getListeningActivity()).pipe(He((e=>e.find((e=>e.listen_count>0)))),Ue(l),He((e=>y(1e3*Number(e.from_ts)))),ut((e=>Ql.firstScrobbledAt=e)),Vi(1)).subscribe(t);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(QT,{service:yu,source:ou,minDate:e})}function pP(){const e=(0,r.useCallback)(((e,t)=>new Qc(e?{min_ts:e}:{max_ts:t},!0)),[]),{pager:t,total:n}=oP(e);return r.createElement(rP,{service:yu,source:lu,pager:t,total:n})}const fP=[{value:"all_time",text:"All time"},{value:"this_year",text:"Year"},{value:"this_month",text:"Month"},{value:"this_week",text:"Week"}];function yP({source:e}){const t=(0,r.useId)(),[n,i]=(0,r.useState)(),a=function(e,t="all_time"){return jS(e,(0,r.useMemo)((()=>({range:t})),[t]))}(e,n),s=(0,r.useCallback)((e=>{i(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(UE,{icon:yu.icon},yu.name,": ",e.title),r.createElement("div",{className:"listenbrainz-range-selector options"},r.createElement("ul",{className:"listenbrainz-ranges"},fP.map((({value:e,text:n})=>r.createElement("li",{className:"listenbrainz-range",key:e},r.createElement("input",{id:`${t}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),r.createElement("label",{htmlFor:`${t}-range-${e}`},n)))))),r.createElement(WT,{service:yu,source:e,pager:a,layout:e.layout}))}function vP({icon:e,placeholder:t="Search",onSubmit:n}){const i=(0,r.useRef)(null),a=(0,r.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==n||n(t)}),[n]);return r.createElement("form",{className:"search-bar",onSubmit:a},r.createElement("p",{className:"text-with-button"},e?r.createElement(ot,{name:e}):null,r.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),r.createElement("button",{type:"submit",title:"Search"},r.createElement(ot,{name:"search"}))))}function bP({sources:e,onSourceChange:t}){const n=(0,r.useId)(),i=(0,r.useCallback)((n=>{const r=Number(n.target.value),i=e[r];null==t||t(i)}),[e,t]);return r.createElement("div",{className:"media-source-selector options"},r.createElement("ul",{className:"media-sources"},e.map(((e,t)=>r.createElement("li",{className:"media-source",key:e.id},r.createElement("input",{id:`${n}-${e.id}`,type:"radio",name:n,value:t,defaultChecked:0===t,onChange:i}),r.createElement("label",{htmlFor:`${n}-${e.id}`},e.title))))))}function gP({service:e,sources:t}){const[n,i]=(0,r.useState)((()=>t[0])),[a,s]=(0,r.useState)(""),o=function(e,t=""){return jS(e,(0,r.useMemo)((()=>({q:t})),[t]))}(n,a),l=!!n.searchable,c=!l&&!n.isPin;return r.createElement(r.Fragment,null,c?r.createElement(UE,{icon:e.icon},e.name,": ",n.title):null,l?r.createElement(vP,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:s}):null,t.length>1?r.createElement(bP,{sources:t,onSourceChange:i}):null,r.createElement(WT,{service:e,source:n,pager:o,layout:n.layout,loadingText:a?"Searching":void 0}))}function wP({service:e,viewType:t,itemType:n,onSelect:i}){const a=(0,r.useId)(),[s,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(),u=t===Sa.ByDecade?"Decade":"Genre";(0,r.useEffect)((()=>{l&&i&&i(l)}),[l,i]),(0,r.useEffect)((()=>{const r=or(e.getFilters(t,n)).subscribe(o);return()=>r.unsubscribe()}),[e,t,n]),(0,r.useEffect)((()=>{l||c(s[0])}),[s,l]);const d=(0,r.useCallback)((e=>{c(s[Number(e.target.value)])}),[s]);return r.createElement("div",{className:"filter-selector"},r.createElement("label",{htmlFor:a},u,":"),r.createElement("select",{id:a,onChange:d},s.map(((e,t)=>r.createElement("option",{value:t,key:e.id},e.title)))))}function EP({service:e,source:t}){const[n,i]=(0,r.useState)(),a=jS(t,n);return r.createElement(r.Fragment,null,r.createElement(UE,{icon:e.icon},e.name,": ",t.title),r.createElement(wP,{service:e,viewType:t.viewType,itemType:t.itemType,onSelect:i}),r.createElement(WT,{service:e,source:t,pager:a,layout:t.layout}))}var kP=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const xP={view:"card minimal",fields:["FileIcon","FileName"]};function SP(e){var{className:t="",layout:n=xP,multiple:i=!0,draggable:a=!0,onSelect:s}=e,o=kP(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,r.useState)([]),u=l.every((e=>e.itemType===si.Media)),d=i&&u,m=a&&u,h=(0,r.useCallback)((e=>{c(e),null==s||s(e)}),[s]);return r.createElement(yT,Object.assign({},o,{className:`folder-items ${t}`,layout:n,multiple:d,draggable:m,onSelect:h}))}var TP=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function PP({service:e,source:t}){const[n,i]=(0,r.useState)(null),[a,s]=(0,r.useState)("/");(0,r.useEffect)((()=>{const e=t.search();return i(e),s("/"),()=>e.disconnect()}),[t]);const o=(0,r.useCallback)((e=>TP(this,void 0,void 0,(function*(){e.itemType===si.Folder&&(i(e.pager),s(e.path||"/"))}))),[]),l=(0,r.useCallback)((e=>TP(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===si.Folder&&(i(t.pager),s(t.path||"/"))}}))),[]);return r.createElement(r.Fragment,null,r.createElement(UE,{icon:e.icon},e.name,": ",a),r.createElement("div",{className:"panel"},r.createElement(SP,{title:`Path: ${a}`,pager:n,onEnter:l,onDoubleClick:o})))}function AP({service:e,sources:t}){const n=1===t.length?t[0]:null;switch((0,r.useEffect)((()=>{(null==n?void 0:n.lockActionsStore)?ni.lock(e.id,n.itemType):ni.unlock()}),[e,n]),(0,r.useEffect)((()=>()=>ni.unlock()),[e]),null==n?void 0:n.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return r.createElement(dP,{source:n});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return r.createElement(yP,{source:n});case"lastfm/history":return r.createElement(eP,null);case"listenbrainz/history":return r.createElement(hP,null);case"lastfm/recently-played":return r.createElement(lP,null);case"listenbrainz/recently-played":return r.createElement(pP,null);default:switch(null==n?void 0:n.viewType){case Sa.ByDecade:case Sa.ByGenre:return r.createElement(EP,{service:e,source:n});case Sa.Folders:return r.createElement(PP,{service:e,source:n});default:return r.createElement(gP,{service:e,sources:t})}}}function IP({service:e,sources:t}){const n=FE(),i=bf(e.observeIsLoggedIn,e.isLoggedIn()),a=function(e,t){return(0,r.useMemo)((()=>function({error:n}){return n instanceof di?r.createElement(r.Fragment,null,r.createElement(UE,{icon:e.icon},1===t.length?`${e.name}: ${t[0].title}`:e.name),r.createElement(BE,null,r.createElement("div",{className:"note"},r.createElement("p",null,(null==n?void 0:n.message)||String(n))))):r.createElement(VE,{error:n},e&&r.createElement("p",{className:"buttons"},r.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e,t])}(e,t);return r.createElement("div",{className:`media-browser ${e.id}-browser`},r.createElement(fE.Ou,{fallbackRender:a},e.internetRequired&&!n?r.createElement(_E,null):i?r.createElement(AP,{service:e,sources:t}):r.createElement(zE,{service:e})))}function CP(e){return e.sources.filter(Rm).map((t=>({id:t.id,label:r.createElement(In,{icon:t.icon,text:t.title}),value:r.createElement(IP,{service:e,sources:[t],key:`${OP(e)}/${t.id}`})})))}function MP(e){return na.getPinsForService(e.id).map((t=>{var n;return null===(n=e.createSourceFromPin)||void 0===n?void 0:n.call(e,t)})).filter(l).map((t=>({id:t.id,label:r.createElement(In,{icon:t.icon,text:t.title}),value:r.createElement(IP,{service:e,sources:[t],key:t.id})})))}function OP(e){return of(e)?`${e.id}/${e.libraryId||""}`:e.id}var $P=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function NP(e){const[t,n]=(0,r.useState)(0),i=(0,r.useMemo)((()=>[r.createElement(zP,{key:0}),r.createElement(LP,{key:1}),r.createElement(jP,{key:2})]),[]),a=(0,r.useCallback)((()=>{n((e=>e-1))}),[]),s=(0,r.useCallback)((()=>{n((e=>e+1))}),[]);return r.createElement(fn,Object.assign({},e,{className:"settings-dialog startup-wizard",title:"Media Services"}),r.createElement("form",{method:"dialog"},i[t],r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",disabled:0===t,onClick:a},"« Prev"),r.createElement("button",{type:"button",disabled:t>=i.length-1,onClick:s},"Next »"),r.createElement("button",{className:"dialog-button-submit"},"Finish"))))}function zP(){const e=(0,r.useMemo)(Zp,[]);return r.createElement(DP,{icon:"globe",title:"Streaming Media",services:e,multiSelect:Dm})}function jP(){const e=(0,r.useMemo)(Qp,[]);return r.createElement(DP,{icon:"network",title:"Personal Media Servers",services:e})}function LP(){const e=(0,r.useMemo)(ef,[]);return r.createElement(DP,{icon:"data",title:"Listening History",services:e,multiSelect:!0})}function DP({icon:e,title:t,multiSelect:n,services:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)((()=>i.filter(Rm).some(RP))),l=(0,r.useCallback)((()=>$P(this,void 0,void 0,(function*(){const e=a.current.elements,t={};let n=!1;for(const r of e){const e=r.value;if(e){const i=!r.checked;t[e]=i,i||n||(n=RP(tf(e)))}}Fm(t),o(n)}))),[]);return r.createElement("div",{className:"startup-wizard-services"},r.createElement("h3",null,r.createElement(In,{icon:e,text:t})),r.createElement("fieldset",{className:"media-services",onChange:l,ref:a},r.createElement("legend",null,"Enable"),r.createElement(ry,{services:i,multiSelect:n})),s?r.createElement("p",{className:"restricted-access"},"*Access is restricted."):null)}function RP(e){return!!(null==e?void 0:e.restrictedAccess)}const FP=new Z("sources");function _P({onSelect:e}){const t=(0,r.useRef)(null),n=function(){const[e,t]=(0,r.useState)();return(0,r.useEffect)((()=>{const e=dr(Lm.pipe(Rr((e=>e===jm)),He((()=>{}))),dr(...Qp().filter((e=>!!e.observeLibraryId)).map((e=>e.observeLibraryId()))).pipe(He((()=>{}))),na.observe()),n=na.observe().pipe(Vi(1),mr((()=>e)),He((()=>Kp().filter(Rm).map((e=>function(e){return{id:e.id,label:r.createElement(df,{service:e,showConnectivity:!0}),value:r.createElement(IP,{service:e,sources:e.roots,key:OP(e)}),startExpanded:!0,children:[...CP(e),...MP(e)]}}(e)))))).subscribe(t);return()=>n.unsubscribe()}),[]),e}(),[i,a]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{t.current.focus()}),[]),(0,r.useEffect)((()=>{if(n){const e=0===n.length&&!i;a(!0),e&&vn(NP,!0)}}),[n,i]),r.createElement("div",{className:"panel media-sources"},r.createElement($r,{roots:n||[],onSelect:e,storageId:FP.id,treeViewRef:t}))}const BP=(0,r.memo)((function(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)((()=>{vn(hE,!0)}),[]);return r.createElement("div",{className:"media-library"},r.createElement("header",{className:"media-library-head"},r.createElement(lt,null),r.createElement(pE,null),r.createElement(kf,{icon:"settings",className:"in-frame",title:"Settings",onClick:n})),r.createElement("div",{className:"media-library-body"},r.createElement(mn,{id:"media-library-layout",arrange:"columns",primaryIndex:1},r.createElement(_P,{onSelect:t}),e||r.createElement(BE,null))))})),VP=new K("visualizer"),UP={providerId:"none",name:""},HP=new ct(UP),qP=new Le,YP=[...Array(74).fill("butterchurn"),...Array(10).fill("ampshader"),...Array(4).fill("audiomotion"),...Array(1).fill("coverart"),...Array(1).fill("waveform")],KP=[...Array(58).fill("ampshader"),...Array(10).fill("butterchurn"),...Array(10).fill("spotifyviz"),...Array(2).fill("coverart")],WP=Array(10).fill("ambientvideo"),GP=Array(20).fill("ambientvideo");function JP(){return HP}function QP(){return ZP().pipe(He((e=>rE(e))),mr((e=>e?e.observeVisualizers():wr([]))))}function XP(){return qy().pipe(He((e=>!!e.lockedVisualizer)),Kr())}function ZP(){return qy().pipe(He((e=>e.provider||"")),Kr())}function eA(e){qP.next(e)}function tA(){Hy.lockedVisualizer=rA()}function nA(){Hy.lockedVisualizer=null}function rA(){return HP.getValue()}function iA(e,t){const n=rE(e);return{providerId:"none",name:(null==n?void 0:n.name)||e,reason:t}}function aA(e,t=1){var n;null===(n=rE(e))||void 0===n||n.observeVisualizers().pipe(Rr((e=>0===e.length)),Zh(JP()),ut((([,e])=>{e===UP&&eA("sync")})),Vi(t)).subscribe(VP)}function sA(){const[e,t]=(0,r.useState)("searching"),n=GE(),i=null==n?void 0:n.id,a=null==n?void 0:n.src,s=null==n?void 0:n.lookupStatus;return(0,r.useEffect)((()=>t("searching")),[i]),(0,r.useEffect)((()=>{switch(s){case tw.Looking:t("searching");break;case tw.NotFound:t("error");break;default:if(a){if(lf(a)){t("loading");const e=new de;return e.add(Nx().pipe(Vi(1)).subscribe((()=>t("loaded")))),e.add(Cx().pipe(Vi(1)).subscribe((()=>t("error")))),()=>e.unsubscribe()}t("searching")}else t("loaded")}}),[i,a,s]),e}Iw().pipe(mr((()=>fw())),Kr(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),Pv(200)).subscribe((()=>eA("item"))),jk.observeError().subscribe((()=>eA("error"))),QP().subscribe((()=>eA("provider"))),qP.pipe(gr((e=>"click"===e?Hn(50):wr(void 0)))).pipe(Zh(fw(),qy()),He((([e,t,n])=>function(e,t,n){if(!t||t.mediaType===li.Video)return UP;const r="error"===e,i=t.src.startsWith("spotify:"),a=n.lockedVisualizer;let s=(null==a?void 0:a.providerId)||n.provider;switch(s){case"spotifyviz":if(!i)return iA(s,"not supported");break;case"audiomotion":if(i)return iA(s,"not supported");break;case"none":return UP}if(a)return r?iA(s,"error"):function(e,t){return iE(e).find((e=>e.name===t))}(a.providerId,a.name)||iA(s,"not found");const o=rA();if(s=n.provider,!s){let t=i?KP:YP;n.ambientVideoEnabled&&(t=t.concat(i?GP:WP)),s=k(t,r?o.providerId:void 0),"click"===e&&s===o.providerId&&1===iE(s).length&&(s=k(t,s))}if("ambientvideo"!==s&&!$k.streamingSupported&&(t.playbackType===_r.DASH||t.playbackType===_r.HLS))return iA(s,"not supported");const l=iE(s);return r&&n.provider&&1===l.length?iA(s,"error"):k(l,o)||UP}(e,t,n)))).subscribe(HP),JP().pipe(ut((e=>jk.load(e)))).subscribe(VP),aA("ampshader"),aA("butterchurn",2);var oA=n(4752);function lA(){return bf(jw,!0)}function cA(){const e=sA(),t=lA();return r.createElement("p",{className:"media-state playback-state"},"error"===e?e:t?"":`${"loaded"===e?"playing":e}…`)}function uA(){const e=bf(zw,0),t=bf(Nw,0);return r.createElement("progress",{className:"progress-bar",max:e,value:t})}const dA=["#3e3e3e","#ebebeb"];function mA({item:e,hidden:t,onPaletteChange:n}){var i;const a=bf(Yy,!1),[s,o]=(0,r.useState)(dA),[l,c]=(0,r.useState)("dark"),[u,d]=(0,r.useState)("light"),[m,p]=(0,r.useState)({}),f=(0,r.useCallback)((e=>{const t=new oA.c,n=new Image,r=e=>{console.warn("Could not load image.",{err:e}),o(dA)},i=e=>{var n,i;try{const r=e=>`rgb(${e.map(Number)})`,a=e=>new It(r(e)).toHexString(),s=a(t.getColor(e)),l=new It(s).isDark(),c=(null===(n=t.getPalette(e))||void 0===n?void 0:n.map(a))||dA,u=(null===(i=Af(s,c,{includeFallbackColors:!0,level:"AA",size:"large"}))||void 0===i?void 0:i.toHexString())||(l?"#ffffff":"#000000");o(h([s,u,...c]))}catch(e){r(e)}};n.crossOrigin="anonymous",n.src=e,n.complete?i(n):(n.onload=()=>i(n),n.onerror=()=>{const t=new Image;t.crossOrigin="anonymous",t.src=`${e}${e.includes("?")?"&":"?"}ampcast_ts=${Date.now()}`,t.complete?i(t):(t.onerror=r,t.onload=()=>i(t))})}),[]),y=(0,r.useCallback)((()=>{o(dA)}),[]);return(0,r.useEffect)((()=>{const[e,t]=s.slice(0,2).map((e=>new It(e))),{h:r,s:i,l:a}=t.toHsl();p({"--background-color":e.toHexString(),"--text-color-h":`${r}`,"--text-color-s":100*Number(i)+"%","--text-color-l":100*Number(a)+"%"}),c(e.isDark()?"dark":"light"),d(t.isDark()?"dark":"light"),null==n||n(s)}),[s,n]),r.createElement("div",{className:`currently-playing themed ${l} text-${u}`,hidden:t,style:m},e?r.createElement(r.Fragment,null,r.createElement("div",{className:"currently-playing-thumbnail"},r.createElement(TS,{item:e,size:800,onLoad:f,onError:y,key:e.id}),r.createElement(hA,{item:e})),r.createElement("div",{className:"currently-playing-text"},r.createElement(fS,{title:e.title}),r.createElement(vS,{artist:null===(i=e.artists)||void 0===i?void 0:i.join(", ")}))):null,r.createElement(cA,null),a?r.createElement(uA,null):null)}function hA({item:e}){const t=nf(e);return t&&cf(t)?r.createElement(In,{icon:t.icon,text:`Provided by ${t.name}`}):null}const pA=()=>qy().pipe(He((e=>e.coverArtAnimatedBackground)),Kr());function fA(){const e=(0,r.useRef)(null),t=bf(pA,!1),[n,i]=(0,r.useState)(null),[a,s]=(0,r.useState)("row"),[o,l]=(0,r.useState)(["#000000"]),c=o[0],[u,d]=(0,r.useState)(0),[m,h]=(0,r.useState)(0),[p,f]=(0,r.useState)(0),y=rn(),v=GE(),b=(null==v?void 0:v.mediaType)===li.Video?null:v,g=kr(b),w=(null==b?void 0:b.id)||"",E=(0,r.useRef)(-1),[k,x]=(0,r.useState)(null),[T,P]=(0,r.useState)(null),A=sA(),[I,C]=(0,r.useState)(!1),M=(null==k?void 0:k.id)===w,O=(null==T?void 0:T.id)===w;return(0,r.useEffect)((()=>{if("error"===A)C(!0);else if(C(!1),"loaded"===A){const e=setTimeout((()=>C(!0)),4500);return()=>clearTimeout(e)}}),[A]),(0,r.useEffect)((()=>{const t=$k.observeReady().subscribe((t=>{const n=db.createPlayer(t);n.appendTo(e.current),i(n)}));return()=>t.unsubscribe()}),[]),(0,r.useEffect)((()=>{if(u>m){const e=m-5*y;f(Math.min(Math.floor(.45*u),e)),s("row")}else{const e=u-3*y;f(Math.min(Math.floor(.45*m),e)),s("column")}}),[u,m,y]),tn(e,(({width:e,height:t})=>{d(e),h(t)})),(0,r.useEffect)((()=>{let e=E.current?1:0;(null==b?void 0:b.id)!==(null==g?void 0:g.id)&&(e=E.current?0:1),0===e?x(b):P(b),E.current=e}),[b,g]),(0,r.useEffect)((()=>{if(n){const[e,t]=o.slice(0,2).map((e=>new Dv.c(e)));let[,,...r]=o;r=S(r,(t=>(t=new Dv.c(t),e.deltaE2000(t)>10))),r=S(r,(e=>(e=new Dv.c(e),t.deltaE2000(e)>10))),n.backgroundColor=e.toString({format:"hex"}),n.beatsColor=r[0]}}),[n,o]),r.createElement("div",{className:`visualizer visualizer-coverart arrange-${a} ${I?"ready":""} ${t?"animated-background-enabled":""}`,style:{"--thumbnail-size":`${p}px`},ref:e},r.createElement("div",{className:"animated-background",style:{"--background-color":c}}),r.createElement(mA,{item:k,hidden:!M,onPaletteChange:M?l:void 0,key:"item0"}),r.createElement(mA,{item:T,hidden:!O,onPaletteChange:O?l:void 0,key:"item1"}),r.createElement("div",{className:"beats-player"}))}function yA(){return bf(JP,null)}function vA({visualizer:e}){return r.createElement("article",{className:"visualizer-info"},r.createElement(bA,{visualizer:e}),r.createElement(gA,{visualizer:e}))}function bA({visualizer:e}){return r.createElement("h3",null,"Visualizer: ",function(e){if(e){if(EA(e))return e.name||"none";{const t=rE(e.providerId);if(t)return t.name}}return"none"}(e))}function gA({visualizer:e}){var t;if(e){if(EA(e))return r.createElement("p",{className:"no-visualizer-reason"},function(e){if(EA(e))switch(e.reason){case"not supported":return"Visualizer not supported for this media";case"not found":return"Visualizer not found";case"error":return"Visualizer error"}return""}(e));{const n="ambientvideo"===e.providerId&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=rE(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return n?r.createElement(wA,{visualizer:e}):e.name?r.createElement(r.Fragment,null,r.createElement("h4",null,"Name: ",e.name),i?r.createElement("p",{className:"external-view"},r.createElement("span",null,"Url:")," ",r.createElement(rc,{href:i})):null):null}}}function wA({visualizer:e}){const t=function(e){const[t,,n]=e.split(":"),[i,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(a(null),"youtube"===t&&n){const e=or(Yc(n)).subscribe(a);return()=>e.unsubscribe()}}),[t,n]),i}(e.src);return t?r.createElement("div",{className:"youtube-video-info"},r.createElement("h4",null,"Title: ",t.title),r.createElement(bS,{owner:t.owner,src:t.src}),r.createElement("p",{className:"external-view"},"View on YouTube: ",r.createElement(ot,{name:"youtube"})," ",r.createElement(rc,{href:t.externalUrl}))):null}function EA(e){return"none"===(null==e?void 0:e.providerId)}function kA(e){const t=(0,r.useRef)(null),{debug:n}=AS(t),i=GE(),a=yA(),s=sS(i),o=sS(a);return r.createElement(fn,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),r.createElement("form",{method:"dialog"},s?r.createElement(cS,{item:s,debug:n}):r.createElement("p",null,"The playlist is empty."),s&&s.mediaType!==li.Video?r.createElement(vA,{visualizer:o}):null,r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}var xA=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function SA(){const e=GE(),t=lA(),n=(0,r.useCallback)((()=>xA(this,void 0,void 0,(function*(){Tw.atStart||Kx.prev()}))),[]),i=(0,r.useCallback)((()=>xA(this,void 0,void 0,(function*(){Tw.atEnd||Kx.next()}))),[]);return e?r.createElement(QE,{className:"media-buttons"},r.createElement(kf,{className:"with-overlay","aria-label":"Previous track",icon:"prev",tabIndex:-1,onClick:n}),r.createElement(kf,{className:"with-overlay","aria-label":t?"Play":"Pause",icon:t?"play":"pause",tabIndex:-1,onClick:t?jx:Lx}),r.createElement(kf,{className:"with-overlay","aria-label":"Stop",icon:"stop",onClick:Rx}),r.createElement(kf,{className:"with-overlay","aria-label":"Next track",icon:"next",tabIndex:-1,onClick:i})):null}function TA(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=()=>{const r=t.current,i=r.getContext("2d"),a=i.createImageData(r.width,r.height),s=new Uint32Array(a.data.buffer);for(let e=0;e<s.length;e++)s[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),n=requestAnimationFrame(e)};let n=0;return e(),()=>cancelAnimationFrame(n)}),[]),tn(e,(({width:e,height:n})=>{const r=t.current;r.width=Math.ceil(e),r.height=Math.ceil(n)})),r.createElement("div",{className:"static",ref:e},r.createElement("canvas",{ref:t}))}const PA=(0,r.memo)((function(){var e;const t=bf(QP,[]),n=yA(),i=bf(XP,!1),a=bf(ZP,""),s=kr(a),o="none"!==a,l=!a||t.length>1,c=l&&!i,u=function(){const e=GE(),t=yA(),[n,i]=(0,r.useState)("");return(0,r.useEffect)((()=>{if((null==e?void 0:e.mediaType)===li.Video){const t=nf(e);(null==t?void 0:t.serviceType)===Dr.PublicMedia?i("apple"===t.id?"apple-logo":t.icon):i("")}else"ambientvideo"===(null==t?void 0:t.providerId)&&t.src.startsWith("youtube:")?i("youtube"):i("")}),[e,t]),n}(),[d,m]=(0,r.useState)(0),h=lA(),p=(null===(e=GE())||void 0===e?void 0:e.mediaType)===li.Video,f="none"===(null==(g=n)?void 0:g.providerId)&&g.reason?`visualizer ${g.reason}`:"",y=(0,r.useCallback)((()=>{vn(kA)}),[]),v=(0,r.useCallback)((()=>{vn(cE,!0)}),[]),b=(0,r.useCallback)((()=>{m(d+1),0===d&&setTimeout((()=>eA("click")))}),[d]);var g;return(0,r.useEffect)((()=>{s&&s!==a&&!p&&m((e=>e+1))}),[s,a,p]),(0,r.useEffect)((()=>{if(d){const e=Hn(500).subscribe((()=>m(0)));return()=>e.unsubscribe()}}),[d]),r.createElement("div",{className:"visualizer-controls",style:d?{opacity:"1"}:void 0},o&&d&&!h?r.createElement(TA,null):null,r.createElement(QE,{className:"visualizer-buttons visualizer-controls-settings"},r.createElement(kf,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:y}),r.createElement(kf,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:v})),o?r.createElement(QE,{className:"visualizer-buttons visualizer-controls-selector"},l?r.createElement(kf,{className:"with-overlay",icon:i?"locked":"unlocked",title:i?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:i?nA:tA}):null,c?r.createElement(kf,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:b}):null):null,r.createElement(SA,null),u?r.createElement(ot,{className:"video-source-icon",name:u}):null,r.createElement("p",{className:"media-state no-visualizer-reason"},f),r.createElement(uA,null))}));function AA(){var e;const t=GE(),n=function(){var e,t;const[n,i]=(0,r.useState)("show"),a=bf(Cw,null),s=null===(e=null==a?void 0:a.paused)||void 0===e||e,o=null==a?void 0:a.currentItem,l=(null==a?void 0:a.currentTime)||0,c=(null==o?void 0:o.mediaType)===li.Video,u=(null===(t=yA())||void 0===t?void 0:t.providerId)||"none",[d,m]=(0,r.useState)(!0),h=l>0;return(0,r.useEffect)((()=>{if(m(!0),h){const e=setTimeout((()=>m(!1)),1e4);return()=>clearTimeout(e)}}),[h]),(0,r.useEffect)((()=>{i(s?"show":"coverart"!==u||c?("none"!==u||c)&&h?d?"fade-out":"hide":"show":"hide")}),[s,u,c,h,d]),n}();return r.createElement("div",{className:`interstitial ${n}`},r.createElement("div",{className:"currently-playing"},t?r.createElement(r.Fragment,null,r.createElement("h2",null,t.title),(null===(e=t.artists)||void 0===e?void 0:e.length)?r.createElement(r.Fragment,null,r.createElement("span",{className:"by"},"by"),r.createElement("h3",null,t.artists.join(", "))):null):r.createElement("p",null,"The playlist is empty.")),r.createElement(cA,null))}n(4784);const IA=(0,r.memo)((function(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=bf(Yy,!1),[i,a]=(0,r.useState)(!1),[s,o]=(0,r.useState)(!1),l=GE(),c=null==l?void 0:l.id,u=(null==l?void 0:l.mediaType)===li.Video,d=yA(),m=!d||"none"===d.providerId,h=!u&&"coverart"===(null==d?void 0:d.providerId),p=!function(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e){const n=t=>Xn(e,t),r=dr(n("mousemove"),n("mousedown"),n("mouseup")).pipe(ut((()=>i(!0))),Pv(t),ut((()=>i(!1)))).subscribe();return()=>r.unsubscribe()}i(!1)}),[e,t]),n}(e.current,4e3),f=sA();(0,r.useEffect)((()=>{const e=setTimeout((()=>o(!1)),1e4);return o(!0),()=>clearTimeout(e)}),[c]),(0,r.useEffect)((()=>{Kx.appendTo(t.current)}),[]),(0,r.useEffect)((()=>{const t=Xn(document,"fullscreenchange").pipe(He((()=>document.fullscreenElement===e.current))).subscribe(a);return()=>t.unsubscribe()}),[]),tn(e,(({width:e,height:t})=>{Kx.resize(e,t)}));const y=(0,r.useCallback)((()=>{i?document.exitFullscreen():e.current.requestFullscreen()}),[i]);return r.createElement("div",{className:`panel media ${f} ${u?"is-playing-video":"is-playing-audio"} ${m?"no-visualizer":""}  ${h?"is-showing-cover-art":""} ${p?"idle":""} ${s?"is-new-item":""}`,onDoubleClick:y,ref:e},r.createElement("div",{className:"players",ref:t}),r.createElement(fA,null),r.createElement(AA,null),n&&i?r.createElement(uA,null):null,r.createElement(PA,null))}));var CA=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const MA={duration:!0,skipCovers:!0,skipPostHeaders:!0};function OA(e,t,n,r){var i,a,s;const{common:o}=r,l=(e=0)=>Math.floor(Number(e))||0;return{itemType:si.Media,mediaType:e,playbackType:_r.Direct,src:t,externalUrl:"",title:o.title||n,artists:o.artist?[o.artist]:o.artists,albumArtist:o.album&&o.albumartist||"",album:o.album||"",genres:o.genre,duration:0,track:l(null===(i=o.track)||void 0===i?void 0:i.no),disc:l(null===(a=o.disk)||void 0===a?void 0:a.no),year:l(o.year),mood:o.mood||"",rating:Number(o.rating)||0,isrc:null===(s=o.isrc)||void 0===s?void 0:s[0],recording_mbid:o.musicbrainz_recordingid,playedAt:0,noScrobble:!o.title}}var $A=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const NA=new K("usePlaylistInject"),zA={items:Ew,files:function(e,t){return $A(this,void 0,void 0,(function*(){try{e instanceof FileList&&(e=Array.from(e));const r=yield Promise.all(e.map((e=>function(e){return CA(this,void 0,void 0,(function*(){const{parseBlob:t}=yield Promise.all([n.e(552),n.e(88)]).then(n.bind(n,1552)),r=yield t(e,MA),{format:i}=r,a=e.type.startsWith("video"),s=i.duration||0,o=OA(a?li.Video:li.Audio,`blob:${Ia()}`,e.name.replace(/\.\w+$/,""),r);return Object.assign(Object.assign({},o),{duration:s?Number(s.toFixed(3)):0,blob:e})}))}(e))));yield Ew(r,t)}catch(e){yield LA(e)}}))},urls:function(e,t){return $A(this,void 0,void 0,(function*(){const[r,i]=m(e,(e=>!!hc()(e))),a=r.map((e=>hc()(e)));try{const e=yield Promise.all([Promise.all(a.map((e=>Yc(e)))),Promise.all(i.map((e=>function(e){return CA(this,void 0,void 0,(function*(){const t=yield function(e,t){var r;return CA(this,void 0,void 0,(function*(){const{parseBlob:i,parseReadableStream:a}=yield Promise.all([n.e(552),n.e(88)]).then(n.bind(n,1552)),s=yield fetch(e,{signal:AbortSignal.timeout(3e3)});if(s.ok){if(s.body){const e=s.headers.get("Content-Length"),n={size:e?parseInt(e,10):void 0,mimeType:null!==(r=s.headers.get("Content-Type"))&&void 0!==r?r:void 0},i=yield a(s.body,n,t);return s.body.locked||(yield s.body.cancel()),i}return i(yield s.blob(),t)}throw Error(s.statusText||"Could not load media")}))}(e,MA),{format:r}=t,i=r.duration||0,a=OA(li.Audio,e,e,t);return Object.assign(Object.assign({},a),{duration:i?Number(i.toFixed(3)):0})}))}(e))))]);yield Ew(e.flat(),t)}catch(e){yield LA(e)}}))},spotifyTracks:function(e,t){return $A(this,void 0,void 0,(function*(){try{const n=tf("spotify");if(null==n?void 0:n.isConnected()){const r=yield n.getTracksById(e);yield Ew(r,t)}else yield LA(Error("Not connected to Spotify."))}catch(e){yield LA(Error("Failed to load Spotify tracks."))}}))}};function jA(){return zA}function LA(e){return $A(this,void 0,void 0,(function*(){NA.error(e);const t="Media could not be loaded.",n=e instanceof TypeError?t:e.message||t;yield Mn(n)}))}var DA=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function RA(e){var{icon:t,className:n=""}=e,i=DA(e,["icon","className"]);const a=(0,r.useRef)(null),s=(0,r.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return r.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${n}`,type:"button",onMouseDown:s,ref:a}),r.createElement(ot,{name:t}))}const FA=(0,r.memo)((function(){const[e,t]=(0,r.useState)((()=>Kx.muted)),[n,i]=(0,r.useState)((()=>Kx.volume)),a=n<=.33?"low":n<=.67?"medium":"high";(0,r.useEffect)((()=>{Kx.muted=e}),[e]),(0,r.useEffect)((()=>{Kx.volume=n}),[n]);const s=(0,r.useCallback)((e=>{const n=e.target.valueAsNumber;i(n),t(0===n)}),[]),o=(0,r.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return r.createElement("div",{className:`volume-control volume-${a}`},r.createElement(kf,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:o}),r.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:n,onChange:s}))}));function _A(e){const t=0===bf(bw,0),n=lA();return r.createElement(ak,Object.assign({},e),r.createElement(ck,{label:"Stop after current",value:"stop-after-current",checked:Kx.stopAfterCurrent,disabled:n,key:"stop-after-current"}),r.createElement(ok,{label:"Jump to current",value:"jump-to-current",disabled:t,key:"jump-to-current"}),r.createElement(uk,null),r.createElement(ok,{label:"Shuffle",value:"shuffle",disabled:t,key:"shuffle"}),r.createElement(uk,null),r.createElement(ok,{label:"Save as playlist…",value:"save-as-playlist",disabled:t,key:"save-as-playlist"}),r.createElement(uk,null),r.createElement(ok,{label:"Add from file…",value:"add-from-file",key:"add-from-file"}),r.createElement(ok,{label:"Add from url…",value:"add-from-url",key:"add-from-url"}),r.createElement(uk,null),r.createElement(ok,{label:"Clear",value:"clear",disabled:t,key:"clear"}))}var BA=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function VA({listViewRef:e}){const t=(0,r.useRef)(null),n=bf(yw,-1),i=bf(Nw,0),a=bf(zw,0),s=lA(),{showPlaylistMenu:o}=function(e,t){const n=jA();return{showPlaylistMenu:(0,r.useCallback)(((i,a)=>{return s=this,o=void 0,c=function*(){const s=e.current;switch(yield mk((e=>r.createElement(_A,Object.assign({},e))),i,a)){case"jump-to-current":s.scrollIntoView(Tw.getCurrentIndex()),s.focus();break;case"stop-after-current":Kx.stopAfterCurrent=!Kx.stopAfterCurrent;break;case"clear":Tw.clear();break;case"shuffle":Tw.shuffle(!Kx.paused),s.scrollIntoView(0);break;case"add-from-file":t.current.click();break;case"add-from-url":{const e=yield Nn({title:"External Media",type:"url",label:"Url",okLabel:"Add"});e&&(yield n.urls([e],-1));break}case"save-as-playlist":yield VS(Tw.getItems())}},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(s,o||[])).next())}));var s,o,l,c}),[e,t,n])}}(e,t),l=jA(),c=(0,r.useCallback)((e=>{Dx(e.target.valueAsNumber)}),[]),u=(0,r.useCallback)((e=>BA(this,void 0,void 0,(function*(){const{right:t,bottom:n}=e.target.getBoundingClientRect();yield o(t,n+4)}))),[o]),d=(0,r.useCallback)((()=>BA(this,void 0,void 0,(function*(){Tw.atStart||(Kx.prev(),e.current.scrollIntoView(n-1))}))),[e,n]),m=(0,r.useCallback)((()=>BA(this,void 0,void 0,(function*(){Tw.atEnd||(Kx.next(),e.current.scrollIntoView(n+1))}))),[e,n]),h=(0,r.useCallback)((e=>BA(this,void 0,void 0,(function*(){const t=e.target.files;t&&(yield l.files(t,-1),e.target.value="")}))),[l]);return r.createElement("div",{className:"media-controls"},r.createElement("div",{className:"current-time-control"},r.createElement(aT,{time:i}),r.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:a,step:1,value:i,disabled:s,onChange:c})),r.createElement("div",{className:"playback-control"},r.createElement(FA,null),r.createElement("div",{className:"media-buttons"},r.createElement(RA,{"aria-label":"Previous track",icon:"prev",onClick:d}),r.createElement(RA,{"aria-label":s?"Play":"Pause",icon:s?"play":"pause",onClick:s?jx:Lx}),r.createElement(RA,{"aria-label":"Stop",icon:"stop",onClick:Rx}),r.createElement(RA,{"aria-label":"Next track",icon:"next",onClick:m})),r.createElement("div",{className:"media-buttons-more"},r.createElement(RA,{title:"More…",icon:"menu",onClick:u}),r.createElement("input",{type:"file",accept:"audio/*,video/*",multiple:!0,onChange:h,ref:t}))))}var UA=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function HA(e){var{items:t,selectedItems:n,rowIndex:i}=e,a=UA(e,["items","selectedItems","rowIndex"]);const s=t.length,o=n.length,l=o===s,c=1===o;return r.createElement(ak,Object.assign({},a),-1===i?null:r.createElement(r.Fragment,null,c?r.createElement(ok,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,r.createElement(ok,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"})),r.createElement(uk,null),l?null:r.createElement(ok,{label:"Select all",value:"select-all",acceleratorKey:`${R.ctrlKeyStr}+A`,key:"select-all"}),!c&&function(e,t){const n=e.findIndex((e=>e===t[0]));return t.every(((t,r)=>t===e[n+r]))}(t,n)?r.createElement(ok,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,r.createElement(uk,null),r.createElement(pk,{items:n}),r.createElement(uk,null),c?r.createElement(ok,{label:"Info…",value:"info",acceleratorKey:`${R.ctrlKeyStr}+I`,key:"info"}):null)}const qA={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[n]=e.split(":");let i;switch(t){case tw.Looking:i="lookup-looking";break;case tw.NotFound:i="lookup-not-found";break;default:i=lf(e)?n:"lookup-pending"}return r.createElement(ot,{name:i,className:"youtube"===n?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return(null==t?void 0:t.length)?r.createElement(r.Fragment,null,r.createElement("span",{className:"artist-text"},t.join("/")),r.createElement("span",{role:"separator"},"-"),r.createElement("span",{className:"title-text"},e)):r.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:oT,align:"right",className:"duration"}]};var YA=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const KA=["audio/*","video/*","text/x-spotify-tracks","text/uri-list"];function WA(e){var{onSelect:t,onPlay:n,onEject:i,listViewRef:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["onSelect","onPlay","onEject","listViewRef"]);const o=bf(Tw.observe,[]),l=function(e){const t=GE(),n=null==t?void 0:t.id,i=lA(),a=String(e).length,{zeroPadLineNumbers:s,showLineNumbers:o,showSourceIcons:l}=bf(Ry.observe,Ry.get());return(0,r.useMemo)((()=>Object.assign(Object.assign({},qA),{cols:qA.cols.filter((e=>{switch(e.className){case"index":return o;case"source":return l;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,t)=>{const o=function(e,t=0){return r.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(t,s?a:0);return e.id===n?r.createElement(r.Fragment,null,r.createElement(ot,{name:i?"pause":"play"}),o):o}}):e))})),[s,o,l,a,n,i])}(o.length),c=GE(),u=null==c?void 0:c.id,[d,m]=(0,r.useState)([]),h=hT(d),p=jA(),f=(0,r.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===u?"playing":""} ${e.unplayable||e.lookupStatus===tw.NotFound?"unplayable":""}`}),[u]),y=(0,r.useCallback)((e=>{m(e),null==t||t(e)}),[t]),v=(0,r.useCallback)((e=>{null==n||n(e)}),[n]),b=(0,r.useCallback)((e=>{1===e.length&&(null==n||n(e[0]))}),[n]),g=(0,r.useCallback)((e=>{1===e.length&&e[0].id===u?null==i||i():Tw.remove(e)}),[i,u]),w=(0,r.useCallback)((([e])=>YA(this,void 0,void 0,(function*(){e&&(yield MS(e))}))),[]),E=(0,r.useCallback)(((e,t,i,s,l)=>YA(this,void 0,void 0,(function*(){if(0===o.length)return;const c=yield function(e,t,n,i,a,s="left"){return o=this,l=void 0,u=function*(){return mk((i=>r.createElement(HA,Object.assign({},i,{items:e,selectedItems:t,rowIndex:n}))),i,a,s)},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(o,l||[])).next())}));var o,l,c,u}(o,e,s,t,i,-1===l?"right":"left");switch(c){case"play":null==n||n(e[0]);break;case"remove":Tw.remove(e);break;case"info":yield MS(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=o.findIndex((t=>t===e[0]));Tw.reverseAt(t,e.length);break}default:yield KS(c,e)}}))),[n,o,a]),k=(0,r.useCallback)(((e,t)=>YA(this,void 0,void 0,(function*(){if(e instanceof DataTransferItem)switch(e.type){case"text/x-spotify-tracks":e.getAsString((e=>YA(this,void 0,void 0,(function*(){const n=e.split(/\s+/).map((e=>e.split(":")[2]));yield p.spotifyTracks(n,t)}))));break;case"text/uri-list":e.getAsString((e=>YA(this,void 0,void 0,(function*(){const n=e.split(/\s+/);yield p.urls(n,t)}))))}else e[0]instanceof File?yield p.files(e,t):yield p.items(e,t)}))),[p]);return r.createElement("div",{className:"playlist",onDragStart:h},r.createElement(Bf,Object.assign({},s,{title:"Playlist",className:"media-list",layout:l,items:o,itemKey:"id",itemClassName:f,selectedIndex:0===o.length?-1:0,draggable:!0,droppable:!0,droppableTypes:KA,multiple:!0,reorderable:!0,onContextMenu:E,onDelete:g,onDoubleClick:v,onDrop:k,onEnter:b,onInfo:w,onMove:Tw.moveSelection,onSelect:y,listViewRef:a})),r.createElement(tT,{items:o,size:o.length,selectedCount:d.length}))}const GA=(0,r.memo)((function(){const e=(0,r.useRef)(null),t=GE(),n=null==t?void 0:t.id,i=lA(),a=(0,r.useCallback)((e=>{e.id===n?Kx.play():(Kx.load(null),Kx.autoplay=!0,Tw.setCurrentItem(e))}),[n]);return r.createElement("div",{className:"media-playback "+(i?"paused":"")},r.createElement(pE,null),r.createElement(mn,{id:"media-playback-layout",arrange:"rows"},r.createElement("div",{className:"panel playback"},r.createElement(VA,{listViewRef:e}),r.createElement(WA,{onPlay:a,onEject:Bx,listViewRef:e})),r.createElement(IA,null)))}));function JA(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function QA(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),XA());break;case"MediaPlayPause":e.preventDefault(),XA();break;case"MediaStop":e.preventDefault(),Kx.stop();break;case"MediaTrackPrevious":e.preventDefault(),Kx.prev();break;case"MediaTrackNext":e.preventDefault(),Kx.next()}}function XA(){Kx.paused?Kx.play():Kx.pause()}function ZA(){return(0,r.useEffect)((()=>{document.body.classList.add(`browser-${R.name.replace(/\s+/g,"-")}`),R.isElectron&&document.body.classList.add("electron")}),[]),(0,r.useEffect)((()=>{const e=new de,t=DE();return Kp().forEach((n=>{const r=qr([t,n.observeIsLoggedIn()]).subscribe((([e,t])=>{const r=n.internetRequired?e&&t:t;document.body.classList.toggle(`${n.id}-connected`,r),document.body.classList.toggle(`${n.id}-not-connected`,!r)}));e.add(r)})),()=>e.unsubscribe()}),[]),(0,r.useEffect)((()=>{let e=!1;const t=document.getElementById("app"),n=document.getElementById("system"),r=new de,i=e=>Xn(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return document.activeElement.classList.toggle("focus",!0),r.add(Xn(document,"keydown",{capture:!0}).subscribe((()=>{e=!0}))),r.add(Xn(document,"mousedown",{capture:!0}).subscribe((()=>{e=!1}))),r.add(Xn(document,"focusin").subscribe((()=>{document.body.classList.toggle("focus-visible",e)}))),r.add(Xn(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?n:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),r.add(Xn(document,"mouseup",{capture:!0}).subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),r.add(Xn(n,"mousedown").subscribe(w)),r.add(i(t)),r.add(i(n)),()=>r.unsubscribe()}),[]),(0,r.useEffect)((()=>{const e=Xn(document,"dragenter"),t=Xn(document,"dragover"),n=Xn(document,"drop"),r=dr(e,t).pipe(ut(JA)),i=dr(r,n.pipe(ut(g))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=bf(Cw,void 0);(0,r.useEffect)((()=>function({currentItem:e,currentTime:t=0,duration:n=0,paused:r=!0}={}){var i,a;const s=navigator.mediaSession;s.playbackState=r?t?"paused":"none":"playing",s.setPositionState({duration:n,position:t,playbackRate:1}),s.metadata=new MediaMetadata({title:null==e?void 0:e.title,artist:null===(i=null==e?void 0:e.artists)||void 0===i?void 0:i.join(", "),album:null==e?void 0:e.album,artwork:null===(a=null==e?void 0:e.thumbnails)||void 0===a?void 0:a.map((e=>({src:nS(e),sizes:`${e.width}x${e.height}`})))}),s.setActionHandler("play",jx),s.setActionHandler("pause",Lx),s.setActionHandler("stop",Rx),s.setActionHandler("previoustrack",Fx),s.setActionHandler("nexttrack",_x),s.setActionHandler("seekto",(e=>{null!=e.seekTime&&Dx(e.seekTime)}))}(e)),[e])}(),(0,r.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",w),document.getElementById("popup").addEventListener("keydown",w),document.body.addEventListener("keydown",QA)}),[]),r.createElement(mn,{id:"main-layout",arrange:"columns"},r.createElement(BP,null),r.createElement(GA,null))}function eI({onDismiss:e}){return r.createElement("div",{className:"desktop-warning"},r.createElement(lt,null),r.createElement("p",null,"This application is intended for a desktop browser."),r.createElement("p",null,r.createElement("button",{onClick:e},"Proceed")))}function tI({onDismiss:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=at.port,a=(0,r.useCallback)((()=>{var r;const i=window.ampcastElectron;switch(i?null===(r=n.current[t])||void 0===r?void 0:r.value:"continue"){case"switch":at.port=location.port,i.setPort(Number(location.port));break;case"quit":i.quit();break;default:e()}}),[e,t]);return r.createElement("form",{className:"port-unavailable",onSubmit:a,ref:n},r.createElement(lt,null),r.createElement("h2",null,r.createElement("span",{className:"error"},"Port unavailable:")," ",i),r.createElement("p",null,"The port this application uses is currently unavailable. ",r.createElement("br",null),"This is possibly due to it being used by another application."),r.createElement("p",null,"You are currently using a temporary port: ",r.createElement("strong",null,location.port)),r.createElement("p",null,"Switching ports would mean losing access to your current settings/history. ",r.createElement("br",null),"This change is revertible however."),r.createElement("p",null,"How would you like to proceed?"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{type:"radio",name:t,id:`${t}-continue`,value:"continue",defaultChecked:!0}),r.createElement("label",{htmlFor:`${t}-continue`},"Continue using the temporary port (but remember the old port)")),r.createElement("li",null,r.createElement("input",{type:"radio",name:t,id:`${t}-switch`,value:"switch"}),r.createElement("label",{htmlFor:`${t}-switch`},"Switch to the new port")),r.createElement("li",null,r.createElement("input",{type:"radio",name:t,id:`${t}-quit`,value:"quit"}),r.createElement("label",{htmlFor:`${t}-quit`},"Quit the application"))),r.createElement("p",null,r.createElement("button",{type:"submit"},"Proceed")))}const nI=new Z("desktopWarning");"https:"===location.protocol&&window.addEventListener("load",(()=>{var e;null===(e=navigator.serviceWorker)||void 0===e||e.register("/service-worker.js")})),(0,i.C)(document.getElementById("app")).render(r.createElement(r.StrictMode,null,r.createElement((function(){const[e,t]=(0,r.useState)((()=>R.desktop||nI.getBoolean("dismissed"))),[n,i]=(0,r.useState)((()=>!R.isElectron||at.port===location.port)),a=(0,r.useCallback)((()=>{nI.setBoolean("dismissed",!0),t(!0)}),[]),s=(0,r.useCallback)((()=>{i(!0)}),[]);return r.createElement(r.Fragment,null,r.createElement(st,null),r.createElement("main",null,e?n?r.createElement(ZA,null):r.createElement(tI,{onDismiss:s}):r.createElement(eI,{onDismiss:a})))}),null)))}},e=>{e.O(0,[872,776,712],(()=>(3728,e(e.s=3728)))),e.O()}]);