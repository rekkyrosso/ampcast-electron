(globalThis.webpackChunkampcast=globalThis.webpackChunkampcast||[]).push([[336],{4556:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var r,n=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(r=0;r<n.length;++r)if(n[r].test(e))return n[r].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(r=0;r<i.length;++r)if(/^[^#\&\?]{11}$/.test(i[r]))return i[r]}}return null}},1104:(e,t,r)=>{var n=r(6512);e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===n||"object"!=typeof n.versions||!n.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},8352:(e,t,r)=>{"use strict";var n=r(7104);t.C=n.createRoot,n.hydrateRoot},1680:(e,t,r)=>{"use strict";var n=r(1504),i=r(8352),a=r(7928),s=r.n(a),o=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(n))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(n,""),t()})),i.addEventListener("error",(()=>r(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const r=[],n=[...e];for(;n.length;)r.push(n.splice(0,t));return r}function d(e,t){const r="function"==typeof t?t:e=>e[t];return e.reduce(((e,t)=>{const n=r(t);return e[n]||(e[n]=[]),e[n].push(t),e}),{})}function m(e,t){const r=[],n=[];for(const i of e)t(i)?r.push(i):n.push(i);return[r,n]}function h(e){return[...new Set(e)]}function f(e,t){return e.filter(((e,r,n)=>r===n.findIndex((r=>e[t]===r[t]))))}function p(e){let t=e.length;for(;t>0;){const r=Math.floor(Math.random()*t);t--;const n=e[t];e[t]=e[r],e[r]=n}return e}function y(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function v(e){return y(e).slice(0,7)}function b(e){return new Date(Math.floor(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function g(e){e.preventDefault()}function w(e){e.stopPropagation()}function E(e){e.preventDefault(),e.stopPropagation()}function k(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function x(e,t={}){return h(Object.keys(e).concat(Object.keys(t))).reduce(((r,n)=>(void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n]),r)),{})}function S(e,t,r){const n=e.filter(t,r);return 0===n.length?e.slice():n}function T(e,t,r=.9){return Math.max(s()(e,t,.99),s()(t,e,.99))>=r}function P(e=""){const t=document.createElement("p"),r=String(null!=e?e:"").trim().split(/[\n\r]+/);return null==r?void 0:r.map((e=>(t.innerHTML=e,t.textContent))).join("\n")}function A(e){return new Promise((t=>setTimeout(t,e)))}const I=(0,r(8368).IT)(),C=(null==I?void 0:I.name)||"unknown",M=/^edge/.test(C)?"Microsoft Edge":C.replace(/^\w/,(e=>e.toUpperCase())),O=(null==I?void 0:I.version)||"0",$=(null==I?void 0:I.os)||"unknown",N="Mac OS"===$?"metaKey":"ctrlKey",z="Mac OS"===$?"⌘":"Ctrl",j={name:C,displayName:M,version:O,os:$,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test($),ctrlKey:N,ctrlKeyStr:z};const L=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function D(e){return Object.keys(e).reduce(((t,r)=>(void 0===e[r]||L.includes(r)||(t[r]=e[r]),t)),{})}function R(e){return/m[uú][sz](i|ie)[ckq]/i.test(e)}const F="Mac OS"===j.os||"iOS"===j.os?"fairplay":"widevine";let _="";const B={widevine:"com.widevine.alpha",fairplay:"com.apple.fairplay",playready:"com.microsoft.playready"};function V(e,t){return new Promise((r=>{const n=document.createElement(e),i=e=>()=>{n.removeAttribute("src"),clearTimeout(o),r(e)},a=i(!1),s=i(!0),o=setTimeout(s,1e3);try{n.muted=!0,n.crossOrigin="anonymous",n.onerror=a,n.oncanplay=s,n.onplaying=s,n.ontimeupdate=s,n.setAttribute("src",t),n.play().then(void 0,a)}catch(e){a()}}))}class U{constructor(e="",t=!1,r=window.console){const n=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(U.only)&&r.log(...t)};this.log=(...e)=>a(`##${n}`,...e),this.warn=(...e)=>a(`###${n}`,...e),this.error=t=>{e.startsWith(U.only)&&(a(`####${n} ERROR`),r.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=n=>new U(i(e,n),t,r),this.rx=t=>new U(i(e,t),!0,r),this.only=()=>this}}U.only="";const H=U,q=new Map,Y={get length(){return q.size},clear(){q.clear()},key(e){var t;return null!==(t=[...q.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=q.get(String(e)))&&void 0!==t?t:null},setItem(e,t){q.set(String(e),String(t))},removeItem(e){q.delete(String(e))}},K=Y,W=new H("LiteStorage");class G{constructor(e,t="local"){const r=`${t}-${e}`;if(G.ids.includes(r))throw Error(`Duplicate storageId: ${r}`);switch(G.ids.push(r),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=K}}getBoolean(e,t=!1){var r;const n=null!==(r=this.getItem(e))&&void 0!==r?r:t;return!!n&&"false"!==n}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const r=this.getItem(e);try{return r?JSON.parse(r):t}catch(e){W.error(e)}return t}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){W.error(e)}}getNumber(e,t=0){var r;const n=Number(null!==(r=this.getItem(e))&&void 0!==r?r:t);return isNaN(n)?t:n}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var r;return String(null!==(r=this.getItem(e))&&void 0!==r?r:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}hasItem(e){return null!==this.getItem(e)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let r=0;r<this.storage.length;r++){const n=this.storage.key(r);n.startsWith(e)&&t.push(n)}t.forEach((e=>this.storage.removeItem(e)))}}G.ids=[];const J=G;var Q=function(e,t){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Q(e,t)};function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Q(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Z(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function ee(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return s}function re(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function ne(e){return this instanceof ne?(this.v=e,this):new ne(e)}function ie(e){return"function"==typeof e}function ae(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var se=ae((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function oe(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var le=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=ee(a),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(ie(l))try{l()}catch(e){i=e instanceof se?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=ee(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{de(m)}catch(e){i=null!=i?i:[],e instanceof se?i=re(re([],te(i)),te(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(i)throw new se(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)de(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&oe(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&oe(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),ce=le.EMPTY;function ue(e){return e instanceof le||e&&"closed"in e&&ie(e.remove)&&ie(e.add)&&ie(e.unsubscribe)}function de(e){ie(e)?e():e.unsubscribe()}var me={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},he={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=he.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,re([e,t],te(r))):setTimeout.apply(void 0,re([e,t],te(r)))},clearTimeout:function(e){var t=he.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function fe(e){he.setTimeout((function(){var t=me.onUnhandledError;if(!t)throw e;t(e)}))}function pe(){}var ye=ve("C",void 0,void 0);function ve(e,t,r){return{kind:e,value:t,error:r}}var be=null;function ge(e){if(me.useDeprecatedSynchronousErrorHandling){var t=!be;if(t&&(be={errorThrown:!1,error:null}),e(),t){var r=be,n=r.errorThrown,i=r.error;if(be=null,n)throw i}}else e()}var we=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,ue(t)&&t.add(r)):r.destination=Ae,r}return X(t,e),t.create=function(e,t,r){return new Se(e,t,r)},t.prototype.next=function(e){this.isStopped?Pe(function(e){return ve("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Pe(function(e){return ve("E",void 0,e)}(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Pe(ye,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(le),Ee=Function.prototype.bind;function ke(e,t){return Ee.call(e,t)}var xe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Te(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Te(e)}else Te(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Te(e)}},e}(),Se=function(e){function t(t,r,n){var i,a,s=e.call(this)||this;return ie(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&me.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&ke(t.next,a),error:t.error&&ke(t.error,a),complete:t.complete&&ke(t.complete,a)}):i=t,s.destination=new xe(i),s}return X(t,e),t}(we);function Te(e){var t;me.useDeprecatedSynchronousErrorHandling?(t=e,me.useDeprecatedSynchronousErrorHandling&&be&&(be.errorThrown=!0,be.error=t)):fe(e)}function Pe(e,t){var r=me.onStoppedNotification;r&&he.setTimeout((function(){return r(e,t)}))}var Ae={closed:!0,next:pe,error:function(e){throw e},complete:pe},Ie="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ce(e){return e}var Me=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this,i=function(e){return e&&e instanceof we||function(e){return e&&ie(e.next)&&ie(e.error)&&ie(e.complete)}(e)&&ue(e)}(e)?e:new Se(e,t,r);return ge((function(){var e=n,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?n._subscribe(i):n._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Oe(t))((function(t,n){var i=new Se({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ie]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?Ce:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=Oe(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Oe(e){var t;return null!==(t=null!=e?e:me.Promise)&&void 0!==t?t:Promise}var $e=ae((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ne=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return X(t,e),t.prototype.lift=function(e){var t=new ze(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new $e},t.prototype.next=function(e){var t=this;ge((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=ee(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;ge((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ge((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,a=r.observers;return n||i?ce:(this.currentObservers=null,a.push(e),new le((function(){t.currentObservers=null,oe(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},t.prototype.asObservable=function(){var e=new Me;return e.source=this,e},t.create=function(e,t){return new ze(e,t)},t}(Me),ze=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return X(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:ce},t}(Ne),je=ae((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Le(e,t){var r="object"==typeof t;return new Promise((function(n,i){var a=new Se({next:function(e){n(e),a.unsubscribe()},error:i,complete:function(){r?n(t.defaultValue):i(new je)}});e.subscribe(a)}))}function De(e){return function(t){if(function(e){return ie(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Re(e,t,r,n,i){return new Fe(e,t,r,n,i)}var Fe=function(e){function t(t,r,n,i,a,s){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=s,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return X(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(we);function _e(e,t){return De((function(r,n){var i=0;r.subscribe(Re(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}function Be(e,t){return De((function(r,n){var i=0;r.subscribe(Re(n,(function(r){n.next(e.call(t,r,i++))})))}))}var Ve=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ue(e){return ie(null==e?void 0:e.then)}function He(e){return ie(e[Ie])}function qe(e){return Symbol.asyncIterator&&ie(null==e?void 0:e[Symbol.asyncIterator])}function Ye(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Ke="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function We(e){return ie(null==e?void 0:e[Ke])}function Ge(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof ne?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}var r}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return Z(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,ne(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,ne(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,ne(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Je(e){return ie(null==e?void 0:e.getReader)}function Qe(e){if(e instanceof Me)return e;if(null!=e){if(He(e))return i=e,new Me((function(e){var t=i[Ie]();if(ie(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ve(e))return t=e,new Me((function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()}));if(Ue(e))return n=e,new Me((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,fe)}));if(qe(e))return Xe(e);if(We(e))return r=e,new Me((function(e){var t,n;try{for(var i=ee(r),a=i.next();!a.done;a=i.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()}));if(Je(e))return Xe(Ge(e))}var t,r,n,i;throw Ye(e)}function Xe(e){return new Me((function(t){(function(e,t){var r,n,i,a,s,o,l,c;return s=this,o=void 0,c=function(){var s,o;return Z(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=ee(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,r.next()];case 2:if((n=l.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(r,n)}i((c=c.apply(s,o||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ze(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var a=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(a),!i)return a}function et(e,t,r){return void 0===r&&(r=1/0),ie(t)?et((function(r,n){return Be((function(e,i){return t(r,e,n,i)}))(Qe(e(r,n)))}),r):("number"==typeof t&&(r=t),De((function(t,n){return function(e,t,r,n,i,a,s,o){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<n?f(e):l.push(e)},f=function(e){c++;var i=!1;Qe(r(e,u++)).subscribe(Re(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<n;)e=void 0,e=l.shift(),f(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(Re(t,h,(function(){d=!0,m()}))),function(){}}(t,n,e,r)})))}const tt=(0,n.memo)((function(){return n.createElement("svg",{className:"svg-defs",width:"0",height:"0"},n.createElement("defs",null,n.createElement("linearGradient",{id:"apple-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"36",y1:"2.2858",x2:"36",y2:"72.455",gradientTransform:"matrix(1 0 0 -1 0 74.0068)"},n.createElement("stop",{offset:"0",style:{stopColor:"#fa233b"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#fb5c74"}})),n.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},n.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))))}));function rt({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),n.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),n.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"calendar":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"}));case"shuffle":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z"}));case"info":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},n.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},n.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return n.createElement("svg",{className:t,viewBox:"0 0 64 64"},n.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"genre":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"m12 2-5.5 9h11z"}),n.createElement("circle",{stroke:"none",cx:"17.5",cy:"17.5",r:"4.5"}),n.createElement("path",{stroke:"none",d:"M3 13.5h8v8H3z"}));case"star":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),n.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return n.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M4 8h5v5h-5v-5z"}),n.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),n.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"http":case"https":case"globe":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"network":return n.createElement("svg",{className:t,viewBox:"0 0 640 512"},n.createElement("path",{d:"M256 64H384v64H256V64zM240 0c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48h48v32H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96v32H80c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H240c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H192V288H448v32H400c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H560c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H512V288h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V192h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48H240zM96 448V384H224v64H96zm320-64H544v64H416V384z"}));case"data":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{d:"M19.88 18.47c.44-.7.7-1.51.7-2.39 0-2.49-2.01-4.5-4.5-4.5s-4.5 2.01-4.5 4.5 2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21.58 23 23 21.58l-3.12-3.11zm-3.8.11c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zm-.36-8.5c-.74.02-1.45.18-2.1.45l-.55-.83-3.8 6.18-3.01-3.52-3.63 5.81L1 17l5-8 3 3.5L13 6l2.72 4.08zm2.59.5c-.64-.28-1.33-.45-2.05-.49L21.38 2 23 3.18l-4.69 7.4z"}));case"visualizer":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),n.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},n.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},n.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},n.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return n.createElement("svg",{className:t,viewBox:"0 0 384 512"},n.createElement("path",{stroke:"none",d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),n.createElement("rect",{x:"177",y:"220",width:"40",height:"210",stroke:"none"}),n.createElement("rect",{x:"87",y:"310",width:"210",height:"40",stroke:"none"}));case"playlist":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},n.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return n.createElement("svg",{className:t,viewBox:"0 0 73 73"},n.createElement("rect",{className:"icon-apple-inner",x:"10",y:"10",width:"53",height:"53"}),n.createElement("path",{className:"icon-apple-outer",fillRule:"evenodd",clipRule:"evenodd",stroke:"none",d:"M72,19.94c0-0.72-0.01-1.45-0.03-2.17c-0.04-1.58-0.14-3.17-0.42-4.73c-0.28-1.58-0.75-3.06-1.48-4.5\r\n\t\t\tc-0.72-1.41-1.66-2.71-2.78-3.83c-1.12-1.12-2.42-2.06-3.83-2.78c-1.44-0.73-2.91-1.2-4.49-1.48c-1.56-0.28-3.15-0.37-4.73-0.42\r\n\t\t\tC53.51,0.02,52.78,0.01,52.06,0c-0.86,0-1.72,0-2.58,0H22.52c-0.86,0-1.72,0-2.58,0c-0.72,0-1.45,0.01-2.17,0.03\r\n\t\t\tc-1.58,0.04-3.17,0.14-4.73,0.42C11.46,0.74,9.98,1.2,8.55,1.94C7.13,2.66,5.84,3.6,4.72,4.72S2.65,7.13,1.93,8.55\r\n\t\t\tc-0.73,1.44-1.2,2.91-1.48,4.5c-0.28,1.56-0.37,3.15-0.42,4.73C0.02,18.5,0.01,19.22,0,19.94c0,0.86,0,1.72,0,2.58v26.95\r\n\t\t\tc0,0.86,0,1.72,0,2.58c0,0.72,0.01,1.45,0.03,2.17c0.04,1.58,0.14,3.17,0.42,4.73c0.28,1.58,0.75,3.06,1.48,4.5\r\n\t\t\tc0.72,1.41,1.66,2.71,2.78,3.83s2.42,2.06,3.83,2.78c1.44,0.73,2.91,1.2,4.49,1.48c1.56,0.28,3.15,0.37,4.73,0.42\r\n\t\t\tc0.72,0.02,1.45,0.03,2.17,0.03c0.86,0.01,1.72,0,2.58,0h26.95c0.86,0,1.72,0,2.58,0c0.72,0,1.45-0.01,2.17-0.03\r\n\t\t\tc1.58-0.04,3.17-0.14,4.73-0.42c1.58-0.28,3.06-0.75,4.49-1.48c1.41-0.72,2.71-1.66,3.83-2.78c1.12-1.12,2.06-2.41,2.78-3.83\r\n\t\t\tc0.73-1.44,1.2-2.91,1.48-4.5c0.28-1.56,0.37-3.15,0.42-4.73c0.02-0.72,0.03-1.45,0.03-2.17c0.01-0.86,0-1.72,0-2.58V22.52\r\n\t\t\tC72,21.66,72,20.8,72,19.94z M52.71,46.85c0,0.91-0.01,1.74-0.2,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.73-2.5,0.91c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.68-2.6-1.32\r\n\t\t\tc-1.03-0.95-1.68-2.23-1.82-3.56c-0.16-1.57,0.36-3.24,1.53-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.43-0.52,0.43-1.16,0.43-1.78V24.32c0-1.21-0.54-1.54-1.7-1.32\r\n\t\t\tc-0.83,0.16-18.62,3.75-18.62,3.75c-1,0.24-1.36,0.57-1.36,1.82v23.23c0,0.91-0.05,1.74-0.24,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.74-2.5,0.92c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.69-2.6-1.33\r\n\t\t\tc-1.03-0.95-1.63-2.23-1.78-3.56c-0.16-1.57,0.31-3.24,1.49-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.42-0.52,0.47-1.13,0.47-1.75c0-4.92,0-26.78,0-26.78\r\n\t\t\tc0-0.36,0.03-0.6,0.05-0.72c0.09-0.56,0.31-1.05,0.72-1.39c0.34-0.28,0.78-0.48,1.33-0.6l0.01,0L49,11.33\r\n\t\t\tc0.19-0.04,1.73-0.31,1.91-0.33c1.16-0.1,1.81,0.66,1.81,1.89L52.71,46.85L52.71,46.85z"}));case"emby":return n.createElement("svg",{className:t,viewBox:"0 0 48 48"},n.createElement("path",{className:"icon-emby-outer",stroke:"none",d:"m9.104 12.415 2.482 2.482L0 26.484l12.414 12.414 2.483-2.483 11.586 11.586L39.725 34.76l-2.483-2.483L48 21.518 35.587 9.104l-2.483 2.483L21.517 0z"}),n.createElement("path",{className:"icon-emby-inner",stroke:"none",d:"M18.45 32.929v-18.1l15.86 9.05-7.93 4.525z"}));case"plex":return n.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},n.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),n.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"plex-tidal":case"tidal":return n.createElement("svg",{className:t,viewBox:"0 0 560 560"},n.createElement("path",{className:"icon-tidal-inner",d:"M373.331 186.32l-93.324 93.332-93.337-93.341L280.007 93l93.332 93.309L466.67 93 560 186.318l-93.33 93.341-93.339-93.339zm.01 186.669l-93.334 93.34-93.337-93.34 93.337-93.337 93.334 93.337zm-186.67-186.67l-93.338 93.34L0 186.32 93.333 93l93.337 93.318z",fillRule:"nonzero"}));case"jellyfin":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),n.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return n.createElement("svg",{className:t,viewBox:"0 0 168 168"},n.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return n.createElement("svg",{className:t,viewBox:"0 0 455 455"},n.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),n.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return n.createElement("svg",{className:t,viewBox:"0 0 27 30"},n.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),n.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"navidrome":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 10.449C120.275 10.449 10.449 120.276 10.449 256c0 135.725 109.826 245.551 245.551 245.551S501.551 391.725 501.551 256C501.551 120.276 391.725 10.449 256 10.449z"}),n.createElement("path",{fill:"#fff",d:"M256 168.229c-48.515.0-87.771 39.257-87.771 87.771s39.257 87.771 87.771 87.771 87.771-39.257 87.771-87.771S304.515 168.229 256 168.229z"}),n.createElement("path",{fill:"black",d:"M437.061 74.94C388.735 26.615 324.434.0 256 0S123.265 26.615 74.939 74.94.0 187.566.0 256s26.614 132.735 74.939 181.061S187.566 512 256 512s132.735-26.614 181.061-74.939S512 324.434 512 256 485.386 123.266 437.061 74.94zM256 491.102C126.365 491.102 20.898 385.635 20.898 256S126.365 20.898 256 20.898 491.102 126.365 491.102 256 385.635 491.102 256 491.102z"}),n.createElement("path",{fill:"black",d:"M354.22 256c0-54.158-44.061-98.22-98.22-98.22s-98.22 44.062-98.22 98.22 44.062 98.22 98.22 98.22 98.22-44.061 98.22-98.22zm-175.542.0c0-42.636 34.686-77.322 77.322-77.322s77.322 34.686 77.322 77.322S298.636 333.322 256 333.322 178.678 298.636 178.678 256z"}),n.createElement("path",{fill:"black",d:"M285.257 256c0-16.132-13.124-29.257-29.257-29.257S226.743 239.868 226.743 256s13.125 29.257 29.257 29.257S285.257 272.133 285.257 256zm-37.616.0c0-4.609 3.75-8.359 8.359-8.359 4.609.0 8.359 3.75 8.359 8.359.0 4.609-3.75 8.359-8.359 8.359C251.391 264.359 247.641 260.609 247.641 256z"}),n.createElement("path",{fill:"black",d:"M256 391.837c-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c41.897.0 81.265-16.294 110.853-45.883 29.587-29.587 45.881-68.955 45.881-110.852.0-5.771-4.678-10.449-10.449-10.449s-10.449 4.678-10.449 10.449C391.837 330.9 330.9 391.837 256 391.837z"}),n.createElement("path",{fill:"black",d:"M449.306 245.551c-5.771.0-10.449 4.678-10.449 10.449.0 1.481-.018 2.958-.052 4.43-.136 5.769 4.43 10.557 10.199 10.692.085.002.168.003.252.003 5.656.0 10.307-4.517 10.442-10.202.039-1.637.059-3.279.059-4.925C459.755 250.229 455.077 245.551 449.306 245.551z"}),n.createElement("path",{fill:"black",d:"M447.55 284.239c-5.656-1.145-11.168 2.52-12.308 8.178-17.107 84.854-92.489 146.44-179.242 146.44-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c47.353.0 93.467-16.573 129.847-46.668 35.9-29.697 60.717-71.084 69.881-116.54C456.868 290.891 453.207 285.38 447.55 284.239z"}),n.createElement("path",{fill:"black",d:"M256 120.163c5.771.0 10.449-4.678 10.449-10.449S261.771 99.265 256 99.265c-41.897.0-81.265 16.294-110.853 45.883C115.559 174.735 99.265 214.103 99.265 256c0 5.771 4.678 10.449 10.449 10.449s10.449-4.678 10.449-10.449c0-74.9 60.937-135.837 135.837-135.837z"}),n.createElement("path",{fill:"black",d:"M62.996 240.876c-5.759-.14-10.557 4.43-10.692 10.199-.039 1.637-.059 3.279-.059 4.925.0 5.771 4.678 10.449 10.449 10.449S73.143 261.771 73.143 256c0-1.481.018-2.958.052-4.43C73.331 245.8 68.765 241.013 62.996 240.876z"}),n.createElement("path",{fill:"black",d:"M256 73.143c5.771.0 10.449-4.678 10.449-10.449S261.771 52.245 256 52.245c-47.353.0-93.467 16.573-129.847 46.668-35.9 29.697-60.717 71.084-69.881 116.54-1.14 5.657 2.521 11.168 8.178 12.308.697.141 1.392.208 2.076.208 4.872.0 9.232-3.426 10.232-8.386C93.864 134.729 169.247 73.143 256 73.143z"}));case"subsonic":return n.createElement("svg",{className:t,viewBox:"0 0 700 700",transform:"scale(1.125) translate(0 -1)"},n.createElement("path",{d:"M202 108.1c-7 1.1-8.5 1.6-12.3 4.1-2.7 1.7-3.6 3.1-3.9 5.7-.5 3.8-.1 54.1.6 75.1.2 7.4.5 19.3.6 26.4l.2 12.8-5.8 6-5.9 5.9.2 26.8.2 26.8-20.7 10-20.7 10-5-1.9c-8.5-3.4-21.9-6.6-30.1-7.3-4.4-.4-8.2-.9-8.5-1.1-1.4-.8-1.8 2.8-1.9 16.7-.2 15.1-.2 15.7-1.4 22.9-1.1 5.9-19.2 61.8-21.1 64.6-.7 1.1-4 3.1-7.2 4.3-14.4 5.6-18.6 7.5-21.3 10.1-1.9 1.8-2.8 3.4-2.4 4.4.3.9 5.2 4.2 10.8 7.3 15.6 8.7 17.2 10.2 19.7 18.6 5.3 18.1 9.5 26.3 18.9 37.2 3.3 3.8 6 7.2 6 7.5-.1.3-4 5.5-8.8 11.7-12.8 16.4-17.5 26.8-15.8 35.5 2.9 15.5 33.8 17.4 61.6 3.8 3-1.5 8.6-4.4 12.3-6.5 8.2-4.5 10.7-4.5 26.7.9 15.8 5.2 42 13 55.5 16.5 12.7 3.3 48 11.6 53.3 12.6 1.8.3 7.6 1.4 12.9 2.4 5.4 1.1 11.8 2.2 14.3 2.6 2.5.3 5.2.8 6 1 .8.3 4.7.9 8.5 1.5 3.9.5 7.9 1.1 9 1.4 2.2.4 12.8 1.8 16 2.1 1.1.1 4.7.5 8 .9s8 .9 10.5 1.2c2.5.2 6.5.6 9 .8 26.9 3 67.6 3.5 94.5 1.1 5.6-.5 7.7-.8 18-1.9 33.3-3.9 71.6-15.5 96.4-29.3 29.7-16.4 55.6-43.4 71.2-74 5.5-11 10.6-25.6 11.4-33.3.2-1.4.6-5.1 1-8.3l.8-5.7-9.9.5c-15.4.8-22.7 1.6-30.4 3-8.1 1.5-18.5 3.9-28 6.5-18.5 4.9-45.6 11.8-48.6 12.4-25.6 4.6-31 5.4-49.9 7.1-33.9 3-91.7 2.2-110.2-1.6-5.7-1.1-7.1-2.8-2.5-3 1.5 0 6.3-.2 10.7-.4 4.4-.2 19.3-.6 33-1 13.8-.3 26.8-.7 29-.9 2.2-.2 8-.7 12.9-1.1 4.9-.4 9.7-.8 10.6-1 .9-.2 4.1-.6 7.1-1 25.9-3.2 56.5-10.2 86.5-19.9 27.8-8.9 29.5-9.4 42.4-12 11.9-2.4 28.3-2.8 42.9-1.1l6.4.7-.7-3.3c-5.5-26.1-11.7-40.2-24.9-56.6-8.1-10.2-23-25.1-33.7-33.6-7.6-6.1-24.8-17.9-40.6-27.7-3.6-2.2-6.3-4.8-7.5-7.2-2.9-5.6-4.6-6.1-18.1-5.5-6.5.4-12.2.8-12.6 1.1-.4.2-3.9.7-7.9 1-4 .4-7.8.8-8.5 1.1-.7.2-3.1.6-5.3.9-9.3 1.2-39 5.7-46.5 7.1-1.4.2-5 .7-8 1.1-3 .3-6.6.7-8 .9-12.7 1.8-124.9 2.7-145 1.2-4.1-.3-8.6-.6-10-.6-4.3-.2-.8-1.9 5-2.6 3-.3 7.3-.8 9.5-1 2.2-.2 8.1-.7 13-1 5-.4 11.5-.8 14.5-1 3-.2 10.2-.7 16-1 5.8-.3 12.6-.8 15.2-1 2.5-.2 9-.6 14.5-1 5.4-.3 11.4-.8 13.3-.9 2-.2 7.6-.7 12.5-1.1 4.9-.4 9.6-.8 10.4-1 .9-.1 4.3-.6 7.6-.9 8.5-1 11.9-1.5 21.5-3.3 4.7-.8 9.6-1.7 10.9-2 1.4-.2 2.8-.6 3.1-.8.4-.2 2.1-.7 3.9-1 3.5-.6 17.4-5.2 25.6-8.4l5-1.9-.3-15.4c-.2-8.4-.5-15.4-.7-15.6-.1-.2-4-1.2-8.6-2.3-4.6-1.1-9.1-2.2-9.9-2.4-28.8-7-45.7-10.2-53-9.9-6.2.1-11.3.9-32.1 4.9-.9.2-4 .6-6.9 1-2.9.4-6.2.9-7.4 1.1-12.1 2.3-54.6 2.2-66.8-.1-1.3-.3-4.5-.9-7.3-1.4-6-1.1-10.1-2.6-10.9-4-1.2-1.9-1.3-1.9 28.4-3.6 4.7-.3 11.9-.7 16-1 4.1-.3 11.8-.7 17-1 9.9-.6 17.6-1.2 24.5-2 2.2-.3 6-.7 8.5-.9 6.9-.8 14.4-2.4 18.1-3.9l3.3-1.3-4.8-3.6c-5.2-4-13-6.9-24.6-9.2-7-1.4-9.5-1.7-22.5-3.2-24.4-2.8-62.6-1.6-81.7 2.6-10.8 2.3-15.4 4.7-22.9 11.6-3.2 3-6.5 5.4-7.3 5.4-1 0-1.7-3-2.6-11.3-.7-6.1-1.4-12.3-1.5-13.7-.2-1.4-.6-6.1-.9-10.5-.4-4.4-.8-9.6-1.1-11.5-.2-1.9-.7-6.7-1-10.5-.8-10.5-2.1-24.4-3.1-32.5-2.1-18.3-2.6-19.4-9.6-21.4-7.1-2-10.5-2.3-15.8-1.5zm-82.2 305.3c6.5 4 7.5 42.2 1.5 54.3-2.7 5.4-4.5 6.1-8.1 3.2-6.2-5-6.6-6.7-6.8-26.2-.2-21.4.4-25.1 5.1-29.4 3.3-3.2 5.5-3.7 8.3-1.9zm75.2 3.1c7.6 3.9 12.1 14.6 12.5 29.5.6 19.9-4.7 34.4-13.7 37.9-2.1.8-3.5.5-7-1.2-8.2-4.2-12.1-13.8-12.2-30.7-.1-13.6 1.2-20.2 5.8-27.9 2.3-4.1 3.2-5 6.6-7.4 3-2.1 4.3-2.1 8-.2zm106.7 1.7c14 7 21.7 24.1 20.9 46.8-.3 8.1-1 12.3-3 18.4-4.9 14.4-11.3 20.8-22 22-10.9 1.3-20.2-7.4-25.9-24.4-7.9-23.4.8-54.6 17.5-62.9 5.4-2.6 7-2.6 12.5.1z"}));case"youtube":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},n.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),n.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},n.createElement("title",null,"Lookup scheduled"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},n.createElement("title",null,"Searching…"),n.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},n.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},n.createElement("title",null,"Not found"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"apple-logo":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{fillRule:"nonzero",d:"M11.624 7.222c-.876 0-2.232-.996-3.66-.96-1.884.024-3.612 1.092-4.584 2.784-1.956 3.396-.504 8.412 1.404 11.172.936 1.344 2.04 2.856 3.504 2.808 1.404-.06 1.932-.912 3.636-.912 1.692 0 2.172.912 3.66.876 1.512-.024 2.472-1.368 3.396-2.724 1.068-1.56 1.512-3.072 1.536-3.156-.036-.012-2.94-1.128-2.976-4.488-.024-2.808 2.292-4.152 2.4-4.212-1.32-1.932-3.348-2.148-4.056-2.196-1.848-.144-3.396 1.008-4.26 1.008zm3.12-2.832c.78-.936 1.296-2.244 1.152-3.54-1.116.048-2.46.744-3.264 1.68-.72.828-1.344 2.16-1.176 3.432 1.236.096 2.508-.636 3.288-1.572z"}));case"error":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"11"}),n.createElement("circle",{cx:"12",cy:"12",r:"6",stroke:"none",fill:"white"}),n.createElement("path",{stroke:"none",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))}}function nt(){return n.createElement("h1",{className:"app-title"},n.createElement("span",{className:"app-name"},n.createElement(rt,{className:"app-icon",name:"ampcast"}),n.createElement("span",{className:"app-text"},"ampcast"))," ",n.createElement("span",{className:"app-version"},"0.9.5"))}var it=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return X(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Ne);function at(e,t,r){var n=ie(e)||t||r?{next:e,error:t,complete:r}:e;return n?De((function(e,t){var r;null===(r=n.subscribe)||void 0===r||r.call(n);var i=!0;e.subscribe(Re(t,(function(e){var r;null===(r=n.next)||void 0===r||r.call(n,e),t.next(e)}),(function(){var e;i=!1,null===(e=n.complete)||void 0===e||e.call(n),t.complete()}),(function(e){var r;i=!1,null===(r=n.error)||void 0===r||r.call(n,e),t.error(e)}),(function(){var e,t;i&&(null===(e=n.unsubscribe)||void 0===e||e.call(n)),null===(t=n.finalize)||void 0===t||t.call(n)})))})):Ce}var st=r(1104),ot=r.n(st);function lt(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");const r=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function ct(e){return Math.min(1,Math.max(0,e))}function ut(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function dt(e){return Number(e)<=1?100*Number(e)+"%":e}function mt(e){return 1===e.length?"0"+e:String(e)}function ht(e,t,r){e=lt(e,255),t=lt(t,255),r=lt(r,255);const n=Math.max(e,t,r),i=Math.min(e,t,r);let a=0,s=0;const o=(n+i)/2;if(n===i)s=0,a=0;else{const l=n-i;switch(s=o>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{h:a,s,l:o}}function ft(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*r*(t-e):r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function pt(e,t,r){e=lt(e,255),t=lt(t,255),r=lt(r,255);const n=Math.max(e,t,r),i=Math.min(e,t,r);let a=0;const s=n,o=n-i,l=0===n?0:o/n;if(n===i)a=0;else{switch(n){case e:a=(t-r)/o+(t<r?6:0);break;case t:a=(r-e)/o+2;break;case r:a=(e-t)/o+4}a/=6}return{h:a,s:l,v:s}}function yt(e,t,r,n){const i=[mt(Math.round(e).toString(16)),mt(Math.round(t).toString(16)),mt(Math.round(r).toString(16))];return n&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function vt(e){return bt(e)/255}function bt(e){return parseInt(e,16)}const gt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};const wt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",Et="[\\s|\\(]+("+wt+")[,|\\s]+("+wt+")[,|\\s]+("+wt+")\\s*\\)?",kt="[\\s|\\(]+("+wt+")[,|\\s]+("+wt+")[,|\\s]+("+wt+")[,|\\s]+("+wt+")\\s*\\)?",xt={CSS_UNIT:new RegExp(wt),rgb:new RegExp("rgb"+Et),rgba:new RegExp("rgba"+kt),hsl:new RegExp("hsl"+Et),hsla:new RegExp("hsla"+kt),hsv:new RegExp("hsv"+Et),hsva:new RegExp("hsva"+kt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function St(e){return Boolean(xt.CSS_UNIT.exec(String(e)))}class Tt{constructor(e="",t={}){if(e instanceof Tt)return e;"number"==typeof e&&(e=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(e)),this.originalInput=e;const r=function(e){let t={r:0,g:0,b:0},r=1,n=null,i=null,a=null,s=!1,o=!1;var l,c,u;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;let t=!1;if(gt[e])e=gt[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};let r=xt.rgb.exec(e);return r?{r:r[1],g:r[2],b:r[3]}:(r=xt.rgba.exec(e),r?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=xt.hsl.exec(e),r?{h:r[1],s:r[2],l:r[3]}:(r=xt.hsla.exec(e),r?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=xt.hsv.exec(e),r?{h:r[1],s:r[2],v:r[3]}:(r=xt.hsva.exec(e),r?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=xt.hex8.exec(e),r?{r:bt(r[1]),g:bt(r[2]),b:bt(r[3]),a:vt(r[4]),format:t?"name":"hex8"}:(r=xt.hex6.exec(e),r?{r:bt(r[1]),g:bt(r[2]),b:bt(r[3]),format:t?"name":"hex"}:(r=xt.hex4.exec(e),r?{r:bt(r[1]+r[1]),g:bt(r[2]+r[2]),b:bt(r[3]+r[3]),a:vt(r[4]+r[4]),format:t?"name":"hex8"}:(r=xt.hex3.exec(e),!!r&&{r:bt(r[1]+r[1]),g:bt(r[2]+r[2]),b:bt(r[3]+r[3]),format:t?"name":"hex"})))))))))}(e)),"object"==typeof e&&(St(e.r)&&St(e.g)&&St(e.b)?(l=e.r,c=e.g,u=e.b,t={r:255*lt(l,255),g:255*lt(c,255),b:255*lt(u,255)},s=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):St(e.h)&&St(e.s)&&St(e.v)?(n=dt(e.s),i=dt(e.v),t=function(e,t,r){e=6*lt(e,360),t=lt(t,100),r=lt(r,100);const n=Math.floor(e),i=e-n,a=r*(1-t),s=r*(1-i*t),o=r*(1-(1-i)*t),l=n%6;return{r:255*[r,s,a,a,o,r][l],g:255*[o,r,r,s,a,a][l],b:255*[a,a,o,r,r,s][l]}}(e.h,n,i),s=!0,o="hsv"):St(e.h)&&St(e.s)&&St(e.l)&&(n=dt(e.s),a=dt(e.l),t=function(e,t,r){let n,i,a;if(e=lt(e,360),t=lt(t,100),r=lt(r,100),0===t)i=r,a=r,n=r;else{const s=r<.5?r*(1+t):r+t-r*t,o=2*r-s;n=ft(o,s,e+1/3),i=ft(o,s,e),a=ft(o,s,e-1/3)}return{r:255*n,g:255*i,b:255*a}}(e.h,n,a),s=!0,o="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(r=e.a)),r=ut(r),{ok:s,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}(e);this.originalInput=e,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=t.format??r.format,this.gradientType=t.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3}getLuminance(){const e=this.toRgb();let t,r,n;const i=e.r/255,a=e.g/255,s=e.b/255;return t=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),r=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),n=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),.2126*t+.7152*r+.0722*n}getAlpha(){return this.a}setAlpha(e){return this.a=ut(e),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:e}=this.toHsl();return 0===e}toHsv(){const e=pt(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}}toHsvString(){const e=pt(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.v);return 1===this.a?`hsv(${t}, ${r}%, ${n}%)`:`hsva(${t}, ${r}%, ${n}%, ${this.roundA})`}toHsl(){const e=ht(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}}toHslString(){const e=ht(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.l);return 1===this.a?`hsl(${t}, ${r}%, ${n}%)`:`hsla(${t}, ${r}%, ${n}%, ${this.roundA})`}toHex(e=!1){return yt(this.r,this.g,this.b,e)}toHexString(e=!1){return"#"+this.toHex(e)}toHex8(e=!1){return function(e,t,r,n,i){const a=[mt(Math.round(e).toString(16)),mt(Math.round(t).toString(16)),mt(Math.round(r).toString(16)),mt((s=n,Math.round(255*parseFloat(s)).toString(16)))];var s;return i&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))&&a[3].startsWith(a[3].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}(this.r,this.g,this.b,this.a,e)}toHex8String(e=!1){return"#"+this.toHex8(e)}toHexShortString(e=!1){return 1===this.a?this.toHexString(e):this.toHex8String(e)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),r=Math.round(this.b);return 1===this.a?`rgb(${e}, ${t}, ${r})`:`rgba(${e}, ${t}, ${r}, ${this.roundA})`}toPercentageRgb(){const e=e=>`${Math.round(100*lt(e,255))}%`;return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}}toPercentageRgbString(){const e=e=>Math.round(100*lt(e,255));return 1===this.a?`rgb(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%)`:`rgba(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%, ${this.roundA})`}toName(){if(0===this.a)return"transparent";if(this.a<1)return!1;const e="#"+yt(this.r,this.g,this.b,!1);for(const[t,r]of Object.entries(gt))if(e===r)return t;return!1}toString(e){const t=Boolean(e);e=e??this.format;let r=!1;const n=this.a<1&&this.a>=0;return t||!n||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex4"===e&&(r=this.toHex8String(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new Tt(this.toString())}lighten(e=10){const t=this.toHsl();return t.l+=e/100,t.l=ct(t.l),new Tt(t)}brighten(e=10){const t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(-e/100*255))),t.g=Math.max(0,Math.min(255,t.g-Math.round(-e/100*255))),t.b=Math.max(0,Math.min(255,t.b-Math.round(-e/100*255))),new Tt(t)}darken(e=10){const t=this.toHsl();return t.l-=e/100,t.l=ct(t.l),new Tt(t)}tint(e=10){return this.mix("white",e)}shade(e=10){return this.mix("black",e)}desaturate(e=10){const t=this.toHsl();return t.s-=e/100,t.s=ct(t.s),new Tt(t)}saturate(e=10){const t=this.toHsl();return t.s+=e/100,t.s=ct(t.s),new Tt(t)}greyscale(){return this.desaturate(100)}spin(e){const t=this.toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,new Tt(t)}mix(e,t=50){const r=this.toRgb(),n=new Tt(e).toRgb(),i=t/100,a={r:(n.r-r.r)*i+r.r,g:(n.g-r.g)*i+r.g,b:(n.b-r.b)*i+r.b,a:(n.a-r.a)*i+r.a};return new Tt(a)}analogous(e=6,t=30){const r=this.toHsl(),n=360/t,i=[this];for(r.h=(r.h-(n*e>>1)+720)%360;--e;)r.h=(r.h+n)%360,i.push(new Tt(r));return i}complement(){const e=this.toHsl();return e.h=(e.h+180)%360,new Tt(e)}monochromatic(e=6){const t=this.toHsv(),{h:r}=t,{s:n}=t;let{v:i}=t;const a=[],s=1/e;for(;e--;)a.push(new Tt({h:r,s:n,v:i})),i=(i+s)%1;return a}splitcomplement(){const e=this.toHsl(),{h:t}=e;return[this,new Tt({h:(t+72)%360,s:e.s,l:e.l}),new Tt({h:(t+216)%360,s:e.s,l:e.l})]}onBackground(e){const t=this.toRgb(),r=new Tt(e).toRgb(),n=t.a+r.a*(1-t.a);return new Tt({r:(t.r*t.a+r.r*r.a*(1-t.a))/n,g:(t.g*t.a+r.g*r.a*(1-t.a))/n,b:(t.b*t.a+r.b*r.a*(1-t.a))/n,a:n})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(e){const t=this.toHsl(),{h:r}=t,n=[this],i=360/e;for(let a=1;a<e;a++)n.push(new Tt({h:(r+a*i)%360,s:t.s,l:t.l}));return n}equals(e){return this.toRgbString()===new Tt(e).toRgbString()}}const Pt=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),At=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),It=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),Ct=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),Mt=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),Ot=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),$t=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),Nt=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),zt=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),jt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),Lt=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),Dt=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),Rt=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),Ft=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),_t={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},Bt=Object.assign(Object.assign({},_t),It),Vt=[Bt,Pt,At,Mt,Ot,$t,Nt,zt,jt,Lt,Dt,Rt,Ft,Ct];var Ut=r(6872),Ht=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const qt=new H("themeStore");class Yt extends Ut.cp{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(Vt.map((e=>[e.name,e]))),this.themes$=new it([]),this.version(1).stores({themes:"&name"}),(0,Ut.k7)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return Ht(this,void 0,void 0,(function*(){try{qt.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){qt.error(e)}}))}remove(e){return Ht(this,void 0,void 0,(function*(){try{qt.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){qt.error(e)}}))}rename(e,t){return Ht(this,void 0,void 0,(function*(){try{const r=yield this.themes.get(e);if(!r)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},r),{name:t,userTheme:!0}))}catch(e){qt.error(e)}}))}}const Kt=new Yt,Wt=new H("theme"),Gt=new class{constructor(){this.defaultFontSize=17.2,this.storage=new J("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new it(Bt),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe(at((()=>this.applyAppStyles()))).subscribe(Wt)}observe(){return this.theme$.pipe(_e((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new Tt(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new Tt(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new Tt(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new Tt(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new Tt(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?Kt.getUserTheme(this.name):Kt.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new Tt(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new Tt(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){var t;this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley(),ot()()&&(null===(t=window.ampcastElectron)||void 0===t||t.setFontSize(e))}get frameColor(){return this.current.frameColor}set frameColor(e){var t;if(this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor,ot()())null===(t=window.ampcastElectron)||void 0===t||t.setFrameColor(e);else{let t=document.head.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.setAttribute("name","theme-color"),document.head.append(t)),t.setAttribute("content",e)}}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){var t;this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor,ot()()&&(null===(t=window.ampcastElectron)||void 0===t||t.setFrameTextColor(e))}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new Tt(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new Tt(this.backgroundColor).isDark()}get isLight(){return new Tt(this.backgroundColor).isLight()}get isButtonDark(){return new Tt(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new Tt(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new Tt(this.frameColor).isDark()}get isFrameLight(){return new Tt(this.frameColor).isLight()}get isFrameTextDark(){return new Tt(this.frameTextColor).isDark()}get isFrameTextLight(){return new Tt(this.frameTextColor).isLight()}get isMediaButtonLight(){return new Tt(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new Tt(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new Tt(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new Tt(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new Tt(this.selectedBackgroundColor).isLight()}get isTextDark(){return new Tt(this.textColor).isDark()}get isTextLight(){return new Tt(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new Tt(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){var t;this.applyingUpdate=!0;const r=Object.assign(Object.assign(Object.assign({},_t),{userTheme:void 0}),e);this.frameColor=r.frameColor,this.frameTextColor=r.frameTextColor,Object.assign(this,r),this.applyingUpdate=!1,this.theme$.next(this.current),ot()()&&(null===(t=window.ampcastElectron)||void 0===t||t.setTheme(this.current))}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",Bt);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},r={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((r=>r in e&&typeof e[r]===t[r]))&&Object.keys(e).every((n=>n in t||typeof e[n]===r[n]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,r){const n=this.toDashName(e);let i=t||r;if(i){"string"==typeof i&&(i=new Tt(i));const r=i.toHsl();this.setProperty(`${n}-h`,String(r.h)),this.setProperty(`${n}-s`,100*r.s+"%"),this.setProperty(`${n}-l`,100*r.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${n}-h`,null),this.setProperty(`${n}-s`,null),this.setProperty(`${n}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new Tt(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),r=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",r),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,r){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${r}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:r}){return t=Math.min(Math.max(t,0),1),r=Math.min(Math.max(r,0),1),new Tt({h:e,s:t,l:r}).toHexString()}};function Jt(e,t,r="content-box"){const i=(0,n.useRef)(t);(0,n.useEffect)((()=>{i.current=t}),[t]),(0,n.useEffect)((()=>{const t=e.current;if(t){const n=new ResizeObserver((t=>{const n=e.current;if(n){const e=t.find((e=>e.target===n));if(e){const[{inlineSize:t=0,blockSize:n=0}={}]="border-box"===r?e.borderBoxSize:e.contentBoxSize;i.current({width:t,height:n})}}}));return n.observe(t,{box:r}),()=>n.disconnect()}}),[e,r])}const Qt=document.createElement("div");function Xt(){const e=(0,n.useRef)(Qt),[t,r]=(0,n.useState)(0);return(0,n.useEffect)((()=>{Qt.parentElement||(document.body.append(Qt),r(Zt()))}),[]),Jt(e,(()=>r(Zt()))),t}function Zt(){return parseFloat(getComputedStyle(Qt).fontSize)||Gt.defaultFontSize}function er({vertical:e,primary:t,size:r,children:i}){const a={};return t||(e?a.height=`${r}px`:a.width=`${r}px`),n.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}Qt.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n    z-index: -1;\n";const tr=new J("layout"),rr={get:(e,t=0)=>tr.getNumber(e,t),set(e,t){tr.setNumber(e,t)}};function nr(e,t){switch(t.type){case"setContainerSize":{const r=Math.max(t.containerSize,0);if(r!==e.containerSize){const{primaryMinSize:t,secondaryMinSize:n,secondaryPaneSize:i,splitterSize:a}=e;return Object.assign(Object.assign({},e),{containerSize:r,secondaryPaneSize:ir(t,n,i,a,r)})}return e}case"setSecondaryPaneSize":{const{primaryMinSize:r,secondaryMinSize:n,splitterSize:i,containerSize:a}=e,s=ir(r,n,Math.max(t.secondaryPaneSize,0),i,a);return s!==e.secondaryPaneSize?Object.assign(Object.assign({},e),{secondaryPaneSize:s}):e}case"setMinSizes":{const r=Math.max(t.primaryMinSize,0),n=Math.max(t.secondaryMinSize,0),i=Math.max(t.splitterSize,0);return r!==e.primaryMinSize||n!==e.secondaryMinSize||i!==e.splitterSize?Object.assign(Object.assign({},e),{primaryMinSize:r,secondaryMinSize:n,splitterSize:i,secondaryPaneSize:ir(r,n,e.secondaryPaneSize,i,e.containerSize)}):e}default:return e}}function ir(e,t,r,n,i){if(i>0){const a=i-n-r;if(a<e)return Math.max(r-(e-a),0);if(r<t)return Math.min(i-n-e,t)}return r}const ar={primaryMinSize:0,secondaryMinSize:0,secondaryPaneSize:0,splitterSize:0,containerSize:0};function sr({id:e,arrange:t="columns",primaryIndex:r=0,children:i}){const a=(0,n.useRef)(null),{secondaryPaneSize:s,setContainerSize:o,setSecondaryPaneSize:l,setMinSizes:c}=function(e){const t=(0,n.useMemo)((()=>Object.assign(Object.assign({},ar),{secondaryPaneSize:e?rr.get(e):0})),[e]),[{secondaryPaneSize:r},i]=(0,n.useReducer)(nr,t);(0,n.useEffect)((()=>{e&&r&&rr.set(e,r)}),[e,r]);const a=(0,n.useCallback)((e=>i({type:"setContainerSize",containerSize:e})),[]),s=(0,n.useCallback)((e=>i({type:"setSecondaryPaneSize",secondaryPaneSize:e})),[]),o=(0,n.useCallback)(((e,t,r)=>i({type:"setMinSizes",primaryMinSize:e,secondaryMinSize:t,splitterSize:r})),[]);return{secondaryPaneSize:r,setContainerSize:a,setSecondaryPaneSize:s,setMinSizes:o}}(e),[u,d]=(0,n.useState)(-1),[m,h]=(0,n.useState)(0),f=-1!==u,p=Xt(),y="rows"===t;(0,n.useEffect)((()=>{var e;if(p>0){let t=0,r=0,n=0;const i=a.current,s=y?"minHeight":"minWidth",o=i.querySelector(":scope > .layout-pane-primary");o&&(t=parseInt(getComputedStyle(o)[s],10)||0);const l=i.querySelector(":scope > .layout-pane-secondary");if(l){l.style[s]="",r=parseInt(getComputedStyle(l)[s],10)||0,l.style[s]="unset";const t=y?"offsetHeight":"offsetWidth",a=i.querySelector(":scope > .layout-splitter");n=null!==(e=null==a?void 0:a[t])&&void 0!==e?e:4}c(t,r,n)}}),[y,p,c]);const v=(0,n.useCallback)((e=>{if(0===e.button){const t=y?e.screenY:e.screenX;d(t),h(s),e.preventDefault()}}),[y,s]),b=(0,n.useCallback)((e=>{const t=(y?e.screenY:e.screenX)-u;l(0===r?m-t:m+t)}),[y,r,u,m,l]),g=(0,n.useCallback)((()=>{d(-1),h(0)}),[]);return(0,n.useEffect)((()=>{if(f)return document.documentElement.style.cursor=y?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",g),document.addEventListener("mousemove",b),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",g),document.removeEventListener("mousemove",b)}}),[y,f,b,g]),Jt(a,(({width:e,height:t})=>{o(y?t:e)})),n.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},n.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===r,a=i?0:s,o=[];return 1===t&&o.push(n.createElement("div",{className:"layout-splitter "+(f?"active":""),role:"separator",onMouseDown:v,key:"splitter"})),o.push(n.createElement(er,{vertical:y,primary:i,size:a,key:t},e)),o})))}var or=r(4472);const lr={left:0,top:0},cr=(0,n.forwardRef)((function(e,t){var{title:r,className:i="",children:a,onClose:s}=e,o=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["title","className","children","onClose"]);const l=(0,n.useRef)(null),[c,u]=(0,n.useState)(lr),[d,m]=(0,n.useState)(null),[h,f]=(0,n.useState)(lr);(0,n.useImperativeHandle)(t,(()=>({close:e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.open)&&l.current.close(e)}}))),(0,n.useEffect)((()=>{const e=l.current;or.c.registerDialog(e),e.showModal()}),[]);const p=(0,n.useCallback)((()=>{l.current.close()}),[]),y=(0,n.useCallback)((()=>{s(l.current.returnValue)}),[s]),v=(0,n.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l.current.close())}),[]),b=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),g=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),E=(0,n.useCallback)((e=>{f({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),k=(0,n.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),f(lr),m(null)}),[c,d]);return(0,n.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",k),document.addEventListener("mousemove",E),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",E)}}),[d,E,k]),n.createElement("dialog",Object.assign({},o,{className:`dialog ${i}`,onClose:y,onKeyDown:v,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),n.createElement("header",{className:"dialog-head",onMouseDown:g},n.createElement("h2",null,r),n.createElement("div",{className:"dialog-close",role:"button",onClick:p,onMouseDown:w,"aria-label":"Close"},n.createElement(rt,{name:"close"}))),n.createElement("div",{className:"dialog-body",onClick:b},a))}));var ur=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function dr(e,t=!1){return ur(this,void 0,void 0,(function*(){return new Promise(((r,a)=>{const s=document.createElement("div"),o=(0,i.C)(s);try{const i=e=>{o.unmount(),s.remove(),r(e)};document.getElementById(document.fullscreenElement?"fullscreen-popup":t?"system":"popup").append(s),o.render(n.createElement(e,{onClose:i}))}catch(e){o.unmount(),s.remove(),a(e)}}))}))}var mr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},hr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function fr({title:e,message:t,system:r=!1}){return mr(this,void 0,void 0,(function*(){"string"==typeof t&&(t=n.createElement("p",null,t)),yield dr((r=>n.createElement(pr,Object.assign({},r,{title:e,message:t}))),r)}))}function pr(e){var{message:t,title:r="Message"}=e,i=hr(e,["message","title"]);return n.createElement(cr,Object.assign({},i,{className:"alert-dialog",title:r}),n.createElement("form",{method:"dialog"},n.createElement("div",{className:"alert-message"},t),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"OK"))))}function yr({value:e="",disabled:t,submitText:r="Confirm",onCancel:i,onSubmit:a}){return n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",{className:"dialog-button-cancel",type:"button",value:"#cancel",onClick:i},"Cancel"),n.createElement("button",{className:"dialog-button-submit",value:e,disabled:t,onClick:a},r))}var vr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},br=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const gr=new J("confirm");function wr({title:e,message:t,okLabel:r,storageId:i,system:a=!1}){return vr(this,void 0,void 0,(function*(){return!(!i||!gr.getBoolean(i))||("string"==typeof t&&(t=n.createElement("p",null,t)),"confirmed"===(yield dr((a=>n.createElement(Er,Object.assign({},a,{title:e,message:t,okLabel:r,storageId:i}))),a)))}))}function Er(e){var{title:t="Confirm",message:r,okLabel:i="OK",storageId:a}=e,s=br(e,["title","message","okLabel","storageId"]);const o=(0,n.useId)(),l=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{a&&l.current.checked&&gr.setBoolean(a,!0)}),[a]);return n.createElement(cr,Object.assign({},s,{className:"confirm-dialog",title:t}),n.createElement("form",{method:"dialog",onSubmit:c},n.createElement("div",{className:"confirm-message"},r),n.createElement(yr,{value:"confirmed",submitText:i}),a?n.createElement("footer",{className:"confirm-dialog-storage"},n.createElement("input",{id:o,type:"checkbox",ref:l}),n.createElement("label",{htmlFor:o},"Don't show this message again.")):null))}function kr({icon:e,text:t,className:r="",showConnectivity:i}){return n.createElement("span",{className:`media-source-label ${r}`},n.createElement(rt,{name:e,className:i?"show-connectivity":""}),n.createElement("span",{className:"text"},t))}var xr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Sr(e,t){return xr(this,void 0,void 0,(function*(){yield fr({title:n.createElement(kr,{icon:"error",text:"Error"}),message:e,system:t})}))}var Tr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Pr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Ar(e){var{system:t=!1}=e,r=Pr(e,["system"]);return Tr(this,void 0,void 0,(function*(){return dr((e=>n.createElement(Ir,Object.assign({},e,r))),t)}))}function Ir(e){var{title:t="Input",type:r="text",placeholder:i="",label:a,suggestedValue:s="",okLabel:o="OK"}=e,l=Pr(e,["title","type","placeholder","label","suggestedValue","okLabel"]);const c=(0,n.useId)(),[u,d]=(0,n.useState)(s),m=(0,n.useCallback)((e=>{d(e.target.value)}),[]);return n.createElement(cr,Object.assign({},l,{className:"prompt-dialog",title:t}),n.createElement("form",{method:"dialog"},n.createElement("p",null,a?n.createElement("label",{htmlFor:c},a,": "):null,n.createElement("input",{type:r,id:c,defaultValue:s,placeholder:i,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:m})),n.createElement(yr,{value:u,submitText:o})))}var Cr=function(e){function t(t,r){return e.call(this)||this}return X(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(le),Mr={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Mr.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,re([e,t],te(r))):setInterval.apply(void 0,re([e,t],te(r)))},clearInterval:function(e){var t=Mr.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Or=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return X(t,e),t.prototype.schedule=function(e,t){var r;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),Mr.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&Mr.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,oe(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Cr),$r={now:function(){return($r.delegate||Date).now()},delegate:void 0},Nr=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=$r.now,e}(),zr=function(e){function t(t,r){void 0===r&&(r=Nr.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return X(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(Nr),jr=new zr(Or),Lr=jr;function Dr(e){return e&&ie(e.schedule)}function Rr(e,t,r){void 0===e&&(e=0),void 0===r&&(r=Lr);var n=-1;return null!=t&&(Dr(t)?r=t:n=t),new Me((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;i<0&&(i=0);var a=0;return r.schedule((function(){t.closed||(t.next(a++),0<=n?this.schedule(void 0,n):t.complete())}),i)}))}function Fr(e,t){return void 0===e&&(e=0),void 0===t&&(t=jr),e<0&&(e=0),Rr(e,e,t)}function _r({children:e}){return n.createElement(n.Fragment,null,e)}var Br=Array.isArray;function Vr(e){return Be((function(t){return function(e,t){return Br(t)?e.apply(void 0,re([],te(t))):e(t)}(e,t)}))}var Ur=["addListener","removeListener"],Hr=["addEventListener","removeEventListener"],qr=["on","off"];function Yr(e,t,r,n){if(ie(r)&&(n=r,r=void 0),n)return Yr(e,t,r).pipe(Vr(n));var i=te(function(e){return ie(e.addEventListener)&&ie(e.removeEventListener)}(e)?Hr.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return ie(e.addListener)&&ie(e.removeListener)}(e)?Ur.map(Kr(e,t)):function(e){return ie(e.on)&&ie(e.off)}(e)?qr.map(Kr(e,t)):[],2),a=i[0],s=i[1];if(!a&&Ve(e))return et((function(e){return Yr(e,t,r)}))(Qe(e));if(!a)throw new TypeError("Invalid event target");return new Me((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return a(t),function(){return s(t)}}))}function Kr(e,t){return function(r){return function(n){return e[r](t,n)}}}function Wr(e){return void 0===e&&(e=1/0),et(Ce,e)}function Gr(e){return e[e.length-1]}function Jr(e){return ie(Gr(e))?e.pop():void 0}function Qr(e){return Dr(Gr(e))?e.pop():void 0}function Xr(e,t){return void 0===t&&(t=0),De((function(r,n){r.subscribe(Re(n,(function(r){return Ze(n,e,(function(){return n.next(r)}),t)}),(function(){return Ze(n,e,(function(){return n.complete()}),t)}),(function(r){return Ze(n,e,(function(){return n.error(r)}),t)})))}))}function Zr(e,t){return void 0===t&&(t=0),De((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function en(e,t){if(!e)throw new Error("Iterable cannot be null");return new Me((function(r){Ze(r,t,(function(){var n=e[Symbol.asyncIterator]();Ze(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function tn(e,t){return t?function(e,t){if(null!=e){if(He(e))return function(e,t){return Qe(e).pipe(Zr(t),Xr(t))}(e,t);if(Ve(e))return function(e,t){return new Me((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(Ue(e))return function(e,t){return Qe(e).pipe(Zr(t),Xr(t))}(e,t);if(qe(e))return en(e,t);if(We(e))return function(e,t){return new Me((function(r){var n;return Ze(r,t,(function(){n=e[Ke](),Ze(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return ie(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(Je(e))return function(e,t){return en(Ge(e),t)}(e,t)}throw Ye(e)}(e,t):Qe(e)}function rn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Wr(1)(tn(e,Qr(e)))}function nn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e);return De((function(t,n){(r?rn(e,t,r):rn(e,t)).subscribe(n)}))}var an=new Me((function(e){return e.complete()}));function sn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e),n=function(e,t){return"number"==typeof Gr(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?Qe(i[0]):Wr(n)(tn(i,r)):an}function on(e,t){return De((function(r,n){var i=null,a=0,s=!1,o=function(){return s&&!i&&n.complete()};r.subscribe(Re(n,(function(r){null==i||i.unsubscribe();var s=0,l=a++;Qe(e(r,l)).subscribe(i=Re(n,(function(e){return n.next(t?t(r,e,l,s++):e)}),(function(){i=null,o()})))}),(function(){s=!0,o()})))}))}function ln(e){return De((function(t,r){Qe(e).subscribe(Re(r,(function(){return r.complete()}),pe)),!r.closed&&t.subscribe(r)}))}function cn(e,t){switch(t.type){case"resize":{const r=Math.max(t.clientSize,0),n=Math.max(t.scrollSize,r);if(r!==e.clientSize||n!==e.scrollSize){const t=n-r,i=un(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:r,scrollSize:n})}return e}case"scrollBy":{const r=un(e.position+t.amount,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}case"scrollTo":{const r=un(t.position,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}default:return e}}function un(e,t){return Math.min(Math.max(e,0),t)}const dn={position:0,max:0,clientSize:0,scrollSize:0};const mn=(0,n.memo)((function(e){var{scrollableId:t,orientation:r,scrollAmount:i,onChange:a,onResize:s,scrollbarRef:o}=e,l=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,n.useRef)(null),u=(0,n.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:f,resize:p,scrollBy:y,scrollTo:v}=function(){const[{position:e,max:t,clientSize:r,scrollSize:i},a]=(0,n.useReducer)(cn,dn),s=(0,n.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),o=(0,n.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:r,scrollSize:i,scrollTo:o,scrollBy:(0,n.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:s}}(),[b,g]=(0,n.useState)(0),[w,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(-1),[A,I]=(0,n.useState)(0),C=-1!==T,M="vertical"===r,O=Math.ceil(d/m*(w-x));(0,n.useEffect)((()=>{o.current={scrollBy:y,scrollTo:v}}),[o,y,v]),(0,n.useEffect)((()=>p(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,p]),(0,n.useEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,n.useEffect)((()=>null==s?void 0:s(b)),[b,s]),Jt(c,(({width:e,height:t})=>{k(M?t:e),g(M?e:t)}),"border-box"),Jt(u,(({width:e,height:t})=>{S(M?t:e)}),"border-box");const $=(0,n.useCallback)(((e,t)=>{const r=()=>o.current.scrollBy(t),n=t=>t.target===e,i=Yr(document,"mouseup"),a=sn(Yr(e,"mouseover").pipe(Be(n),nn(!0)),Yr(e,"mouseout").pipe(_e(n),Be((()=>!1)))).pipe(on(((e,t)=>e?Rr(0===t?400:0,40):an)),ln(i)).subscribe(r);return r(),()=>a.unsubscribe()}),[o]),N=(0,n.useCallback)((e=>{if(0===e.button)return $(e.target,-i)}),[i,$]),z=(0,n.useCallback)((e=>{if(0===e.button)return $(e.target,i)}),[i,$]),j=(0,n.useCallback)((e=>{if(0===e.button){const t=M?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return $(e.target,t<O?-h:h)}}),[M,h,O,$]),L=(0,n.useCallback)((e=>{e.stopPropagation(),0===e.button&&(P(M?e.screenY:e.screenX),I(O))}),[M,O]),D=(0,n.useCallback)((e=>{const t=M?e.screenY:e.screenX;v((A+(t-T))*m/(w-x))}),[M,T,A,m,x,w,v]),R=(0,n.useCallback)((()=>{P(-1),I(0)}),[]);return(0,n.useEffect)((()=>{if(C)return document.body.classList.add("dragging"),document.addEventListener("mouseup",R),document.addEventListener("mousemove",D),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",R),document.removeEventListener("mousemove",D)}}),[C,D,R]),n.createElement("div",{className:`scrollbar scrollbar-${r}`,role:"scrollbar","aria-controls":t,"aria-orientation":r,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:E,onMouseDown:E},n.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:N},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),n.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},n.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[M?"height":"width"]:w*(f?h/f:0)+"px",transform:`translate${M?"Y":"X"}(${O}px)`},ref:u})),n.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function hn({children:e,scrollWidth:t=0,scrollHeight:r=0,scrollAmount:i=10,droppable:a,onResize:s,onScroll:o,scrollableRef:l}){const c=(0,n.useId)(),u=(0,n.useRef)(null),d=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),y=(0,n.useRef)(null),[v,b]=(0,n.useState)(0),[g,w]=(0,n.useState)(0),[E,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(0),[A,I]=(0,n.useState)(t),[C,M]=(0,n.useState)(r),[O,$]=(0,n.useState)(0),[N,z]=(0,n.useState)(0),[j,L]=(0,n.useState)(!1),[D,R]=(0,n.useState)(!1),[F,_]=(0,n.useState)(0),B=Math.max(O-(D?g:0),0),V=Math.max(N-(j?v:0),0),[U,H]=(0,n.useState)(!0);(0,n.useEffect)((()=>{if(j||D){const e=setTimeout((()=>H(!1)),50);return()=>clearTimeout(e)}}),[j,D]),(0,n.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&p.current.scrollTo(e),void 0!==t&&y.current.scrollTo(t)}})}),[l]),(0,n.useEffect)((()=>{L(!(!A||!B)&&A-B>1)}),[A,B]),(0,n.useEffect)((()=>{R(!(!C||!V)&&C-V>1)}),[C,V]),(0,n.useEffect)((()=>{var e;I(0===t?(null===(e=d.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,n.useEffect)((()=>{var e;M(0===r?(null===(e=d.current)||void 0===e?void 0:e.scrollHeight)||0:r)}),[r]);const q=(0,n.useCallback)((()=>{const e=u.current;$(e.clientWidth),z(e.clientHeight),k(e.getBoundingClientRect().top)}),[]),Y=(0,n.useCallback)((()=>{var e;const n=d.current,i=f.current;0===t&&I(n.scrollWidth),0===r&&M(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:o}=n,{scrollWidth:l,scrollHeight:c}=i;null==s||s({clientWidth:a,clientHeight:o,scrollWidth:l,scrollHeight:c})}),[t,r,s]);Jt(u,q),Jt(d,Y),Jt(f,Y),(0,n.useEffect)((()=>{null==o||o({left:x,top:T})}),[x,T,o]);const K=(0,n.useCallback)((e=>{y.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),W=(0,n.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>N?_(i):t<i&&_(-i)}),[E,N,i]);(0,n.useEffect)((()=>{if(F){const e=()=>y.current.scrollBy(F),t=Fr(100).subscribe(e);return()=>t.unsubscribe()}}),[F]);const G=(0,n.useCallback)((()=>_(0)),[]),[J,Q]=m(n.Children.toArray(e),(e=>(null==e?void 0:e.type)===_r));return n.createElement("div",{className:`scrollable ${j?"overflow-x":""} ${D?"overflow-y":""} ${U?"scrollbars-hidden":""}`,id:c,onWheel:K,ref:u},n.createElement("div",{className:"scrollable-content",onDragOver:a?W:void 0,onDragLeave:a?G:void 0,onDragEnd:a?G:void 0,onDrop:a?G:void 0,style:{right:D?`${g}px`:"0",bottom:j?`${v}px`:"0",transform:`translateX(-${x}px)`},ref:d},(null==J?void 0:J.length)?n.createElement("div",{className:"scrollable-head",ref:h},J):null,n.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},n.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${T}px)`},ref:f},Q))),n.createElement(mn,{scrollableId:c,orientation:"horizontal",clientSize:B,scrollSize:A,scrollAmount:i,onChange:S,onResize:b,scrollbarRef:p}),n.createElement(mn,{scrollableId:c,orientation:"vertical",clientSize:V,scrollSize:C,scrollAmount:i,onChange:P,onResize:w,scrollbarRef:y}))}function fn(e){return De((function(t,r){var n=!1,i=null,a=null,s=function(){if(null==a||a.unsubscribe(),a=null,n){n=!1;var e=i;i=null,r.next(e)}};t.subscribe(Re(r,(function(t){null==a||a.unsubscribe(),n=!0,i=t,a=Re(r,s,pe),Qe(e(t)).subscribe(a)}),(function(){s(),r.complete()}),void 0,(function(){i=a=null})))}))}function pn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tn(e,Qr(e))}function yn(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const r=t=>!e||e.includes(t.code),n=(e,t)=>Yr(document,e,{capture:!0}).pipe(_e(r),Be((()=>t))),a=sn(n("keydown",!0),n("keyup",!1)).pipe(fn((e=>e?pn(0):Rr(t)))).subscribe(i);return()=>a.unsubscribe()}),[e,t]),r}function vn(e){const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e}),[e]),t.current}function bn(e){return{storeExpandedState:(0,n.useCallback)(((t,r)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!r))}),[e]),retrieveExpandedState:(0,n.useCallback)(((t,r=!1)=>{if(e){const n=localStorage.getItem(`${e}/${t}`);return"string"==typeof n?"true"===n:r}return r}),[e]),storeSelectedNodeId:(0,n.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,n.useCallback)((()=>e&&localStorage.getItem(`${e}/selectedId`)||""),[e])}}function gn(e,t){return e.reduce(((e,r)=>(t(r.id,r.startExpanded)&&e.push(r.id),r.children?e.concat(gn(r.children,t)):e)),[])}function wn(e,t){return(0,n.useMemo)((()=>En(e,t)),[e,t])}function En(e,t){return e.reduce(((e,r)=>(e.push(r.id),r.children&&t.includes(r.id)?e.concat(En(r.children,t)):e)),[])}var kn=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function xn({id:e,label:t,children:r=[],selectedId:i,expandedIds:a,level:s,rowHeight:o,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),f=0!==r.length,p=e===i,y=`${f?"expandable":""} ${h?"expanded":""} ${p?"selected":""} ${0===r.length?"empty":""}`,v=(0,n.useCallback)((e=>{e.stopPropagation()}),[]),b=(0,n.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),g=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&In(r,i)&&(null==d||d(e))}),[e,i,h,r,d,m]);return n.createElement("li",{className:`tree-view-node ${y}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":s,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:b},n.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:f?g:void 0,style:{height:`${o}px`}},f?n.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:v,onClick:w},h?n.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):n.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&n.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:v},n.createElement("circle",{cx:"12",cy:"12",r:"4"})),n.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&n.createElement("ul",{className:"tree-view-node-children",role:"group"},r.map(((e,t)=>{var{id:l}=e,c=kn(e,["id"]);return n.createElement(xn,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:s+1,rowHeight:o,nodeIndex:t,setSize:r.length,onSelect:d,onToggle:m,key:l}))}))))}var Sn=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Tn=24,Pn=["ArrowUp","ArrowDown"];function An({roots:e,className:t="",storageId:r,onContextMenu:i,onDelete:a,onEnter:s,onInfo:o,onSelect:l,treeViewRef:c}){const u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:f}=bn(r),[p,y]=(0,n.useState)(""),{expandedIds:v,toggle:b}=function(e,t){const{storeExpandedState:r,retrieveExpandedState:i}=bn(t),[a,s]=(0,n.useState)((()=>gn(e,i)));(0,n.useEffect)((()=>{s(gn(e,i))}),[e,i]);const o=(0,n.useCallback)(((e,t)=>{const n=a.includes(e);n!==t&&(s(n?a.filter((t=>t!==e)):a.concat(e)),r(e,!n))}),[a,r]);return{expandedIds:a,toggle:o}}(e,r),g=wn(e,v),w=g.indexOf(p),E=vn(w)||0,k=g[E-1],[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(Tn),[A,I]=(0,n.useState)(0),C=Math.floor(x/T)-1,M=g.length,O=Cn(e,p),$=yn(Pn),N=-1===w,z=$&&!(0===w||w===M-1),[L,D]=(0,n.useState)((()=>O)),R=(0,n.useCallback)((()=>u.current.focus()),[]);(0,n.useEffect)((()=>{c&&(c.current={focus:R})}),[c,R]),(0,n.useEffect)((()=>{var t;if(N){const r=Mn(e,k);y(r||(null===(t=e[0])||void 0===t?void 0:t.id)||"")}}),[e,N,k]),(0,n.useEffect)((()=>{if(!p&&e.length>0){const t=f();In(e,t)?y(t):y(e[0].id)}}),[e,p,f]),(0,n.useEffect)((()=>{null==l||l(L)}),[L,l]),(0,n.useEffect)((()=>{p&&h(p)}),[p,h]),(0,n.useEffect)((()=>{z||D(O)}),[O,z]);const F=(0,n.useCallback)((e=>{e.preventDefault(),null==i||i(O,e.pageX,e.pageY)}),[O,i]),_=(0,n.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==s||s(O);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(O);break;case"KeyI":e.stopPropagation(),!e[j.ctrlKey]||e.shiftKey||e.repeat||null==o||o(O);break;case"ArrowLeft":e.stopPropagation(),e.repeat||b(p,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||b(p,!0);break;default:{const t=function(e,t,r){switch(e){case"ArrowUp":return t[t.indexOf(r)-1]||r;case"ArrowDown":return t[t.indexOf(r)+1]||r;case"Home":return t[0]||r;case"End":return t[t.length-1]||r;default:return""}}(e.key,g,p);if(t&&(e.preventDefault(),t!==p)){e.stopPropagation();const r=d.current,n=Math.floor(A/T),i=g.indexOf(t);if(i>=n+C-1){const e=M*T,t=M-C-1,n=Math.min(M-1,i+1)-C,a=n===t?e:n*T;r.scrollTo({top:a})}else if(i<=n){const e=Math.max(0,i-1)*T;r.scrollTo({top:e})}y(t)}}}}),[g,p,O,T,C,M,A,a,s,o,b]),B=(0,n.useCallback)((({clientHeight:e})=>S(e)),[]),V=(0,n.useCallback)((({top:e})=>I(e)),[]);return Jt(m,(({height:e})=>P(e)),"border-box"),n.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:F,onKeyDown:_,ref:u},n.createElement(hn,{scrollAmount:T,onResize:B,onScroll:V,scrollableRef:d},n.createElement("ul",{role:"tree"},e.map(((t,r)=>{var{id:i}=t,a=Sn(t,["id"]);return n.createElement(xn,Object.assign({},a,{id:i,selectedId:p,expandedIds:v,level:1,rowHeight:T,nodeIndex:r,setSize:e.length,emptyMarker:!0,onSelect:y,onToggle:b,key:i}))}))),n.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*T}px)`},ref:m})))}function In(e,t){for(const r of e){if(r.id===t)return!0;if(r.children&&In(r.children,t))return!0}return!1}function Cn(e,t){return e.reduce(((e,r)=>{if(void 0===e)if(r.id===t)e=r.value;else if(r.children)return Cn(r.children,t);return e}),void 0)}function Mn(e,t){return e.reduce(((e,r)=>!e&&r.children?r.children.find((e=>e.id===t))?r.id:Mn(r.children,t):e),"")}var On;!function(e){e[e.PublicMedia=0]="PublicMedia",e[e.PersonalMedia=1]="PersonalMedia",e[e.DataService=2]="DataService"}(On||(On={}));const $n=On;function Nn(e){return De((function(t,r){var n=!1,i=0;t.subscribe(Re(r,(function(t){return(n||(n=!e(t,i++)))&&r.next(t)})))}))}var zn;!function(e){e[e.Direct=0]="Direct",e[e.HLS=1]="HLS",e[e.DASH=2]="DASH",e[e.IFrame=3]="IFrame"}(zn||(zn={}));const jn=zn;var Ln=Array.isArray,Dn=Object.getPrototypeOf,Rn=Object.prototype,Fn=Object.keys;function _n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e),n=Jr(e),i=function(e){if(1===e.length){var t=e[0];if(Ln(t))return{args:t,keys:null};if((n=t)&&"object"==typeof n&&Dn(n)===Rn){var r=Fn(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}(e),a=i.args,s=i.keys;if(0===a.length)return tn([],r);var o=new Me(function(e,t,r){return void 0===r&&(r=Ce),function(n){Bn(t,(function(){for(var i=e.length,a=new Array(i),s=i,o=i,l=function(i){Bn(t,(function(){var l=tn(e[i],t),c=!1;l.subscribe(Re(n,(function(e){a[i]=e,c||(c=!0,o--),o||n.next(r(a.slice()))}),(function(){--s||n.complete()})))}),n)},c=0;c<i;c++)l(c)}),n)}}(a,r,s?function(e){return function(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}(s,e)}:Ce));return n?o.pipe(Vr(n)):o}function Bn(e,t,r){e?Ze(r,e,t):t()}function Vn(e,t){return void 0===t&&(t=Ce),e=null!=e?e:Un,De((function(r,n){var i,a=!0;r.subscribe(Re(n,(function(r){var s=t(r);!a&&e(i,s)||(a=!1,i=s,n.next(r))})))}))}function Un(e,t){return e===t}function Hn(e,t){return ie(t)?et(e,t,1):et(e,1)}function qn(e){return De((function(t,r){var n,i=null,a=!1;i=t.subscribe(Re(r,void 0,void 0,(function(s){n=Qe(e(s,qn(e)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):a=!0}))),a&&(i.unsubscribe(),i=null,n.subscribe(r))}))}const Yn=new Ne;function Kn(e){const t=e?Array.isArray(e)?e:[e]:[];t.length>0&&Yn.next(t)}function Wn(){return Yn}var Gn=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Jn extends Ut.cp{constructor(){super("ampcast/pending-actions"),this.inLibraryChanges$=new it([]),this.ratingChanges$=new it([]),this.lock$=new it(null),this.logger=new H("actionsStore"),this.version(2).stores({inLibraryChanges:"&src",ratingChanges:"&src"}),(0,Ut.k7)((()=>this.inLibraryChanges.toArray())).subscribe(this.inLibraryChanges$),(0,Ut.k7)((()=>this.ratingChanges.toArray())).subscribe(this.ratingChanges$)}registerServices(e){for(const t of e)this.registerService(t)}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}getInLibrary(e,t){const r=this.getInLibraryChangedItem(e);return r?r.inLibrary:t}getRating(e,t){const r=this.getRatingChangedItem(e);return r?r.rating:t}rate(e,t){return Gn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Qf(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.rate)throw Error(`rate() not supported by ${n}`);if(this.isLocked(e))yield this.ratingChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{rating:t})));else{const r=this.getRatingChangedItem(e);r&&(yield this.ratingChanges.delete(r.src)),yield i.rate(e,t)}Kn({match:t=>i.compareForRating(t,e),values:{rating:t}})}))}store(e,t){return Gn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Qf(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.store)throw Error(`store() not supported by ${n}`);{const r=this.getInLibraryChangedItem(e);r&&(yield this.inLibraryChanges.delete(r.src)),this.isLocked(e)?r||(yield this.inLibraryChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{inLibrary:t})))):yield i.store(e,t),Kn({match:t=>i.compareForRating(t,e),values:{inLibrary:t}})}}))}observeInLibraryChanges(e){return this.observeUpdates(e,this.inLibraryChanges$)}observeRatingChanges(e){return this.observeUpdates(e,this.ratingChanges$)}observeUpdates(e,t){return _n([t,this.lock$]).pipe(_e((([e])=>e.length>0)),Be((([t])=>t.filter((t=>t.src.startsWith(`${e.id}:`)&&!this.isLocked(t))))),Vn(((e,t)=>{const r=e.map((e=>e.src)).sort(),n=t.map((e=>e.src)).sort();return String(r)===String(n)})))}bulkRate(e,t,r,n=10){return Gn(this,void 0,void 0,(function*(){const i=t=>Gn(this,void 0,void 0,(function*(){const n=t.map((e=>e.src));yield this.ratingChanges.bulkDelete(n),Kn({match:r=>t.some((t=>e.compareForRating(r,t))),values:{rating:r}})}));if(e.bulkRate)yield e.bulkRate(t,r),i(t);else{const a=u(t,n);for(const t of a)yield Promise.all(t.map((t=>e.rate(t,r)))),i(t)}}))}bulkStore(e,t,r,n=10){return Gn(this,void 0,void 0,(function*(){const i=t=>Gn(this,void 0,void 0,(function*(){const n=t.map((e=>e.src));yield this.inLibraryChanges.bulkDelete(n),Kn({match:r=>t.some((t=>e.compareForRating(r,t))),values:{inLibrary:r}})}));if(e.bulkStore)yield e.bulkStore(t,r),i(t);else{const a=u(t,n);for(const t of a)yield Promise.all(t.map((t=>e.store(t,r)))),i(t)}}))}createStorableMediaObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"])}return e}getInLibraryChangedItem(e){const t=Xf(e);if(null==t?void 0:t.store)return this.inLibraryChanges$.getValue().find((r=>t.compareForRating(r,e)))}getRatingChangedItem(e){const t=Xf(e);if(null==t?void 0:t.rate)return this.ratingChanges$.getValue().find((r=>t.compareForRating(r,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[r]=e.src.split(":");return t.serviceId===r&&t.itemType===e.itemType}return!1}registerService(e,t){if(e.rate){const r=this.logger.id(`${e.id}/rating`);this.observeRatingChanges(e).pipe(_e((e=>e.length>0)),Be((e=>d(e,(e=>e.rating)))),et((e=>Object.keys(e).map((t=>({items:e[t],rating:Number(t)}))))),Hn((({items:r,rating:n})=>this.bulkRate(e,r,n,t))),qn((e=>(r.error(e),[])))).subscribe(r)}if(e.store){const r=this.logger.id(`${e.id}/inLibrary`);this.observeInLibraryChanges(e).pipe(_e((e=>e.length>0)),Be((e=>d(e,(e=>String(!!e.inLibrary))))),et((e=>Object.keys(e).map((t=>({items:e[t],inLibrary:"false"!==t}))))),Hn((({items:r,inLibrary:n})=>this.bulkStore(e,r,n,t))),qn((e=>(r.error(e),[])))).subscribe(r)}}}const Qn=new Jn;var Xn;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue",e.AddToPlaylist="add-to-playlist",e.AddToNewPlaylist="add-to-new-playlist",e.AddToRecentPlaylist1="add-to-recent-playlist-1",e.AddToRecentPlaylist2="add-to-recent-playlist-2",e.AddToRecentPlaylist3="add-to-recent-playlist-3",e.AddToRecentPlaylist4="add-to-recent-playlist-4"}(Xn||(Xn={}));const Zn=Xn;var ei;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(ei||(ei={}));const ti=ei;var ri;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(ri||(ri={}));const ni=ri,ii=/^en(-us)?$/i.test(navigator.language);function ai(e){return e&&!ii?e.replaceAll(/(F)avorite(s?)/gi,"$1avourite$2"):e}class si extends Error{constructor(){super(),Object.setPrototypeOf(this,si.prototype)}}class oi extends si{constructor(){super(...arguments),this.message="No music library found."}}class li extends si{constructor(){super(...arguments),this.message="No music video library found."}}class ci extends si{constructor(){super(...arguments),this.message="No TIDAL subscription found."}}class ui extends si{constructor(){super(...arguments),this.message=ai("No favorites playlist found.")}}var di=Array.isArray;function mi(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===(t=1===(e=t).length&&di(e[0])?e[0]:e).length?Qe(t[0]):new Me(function(e){return function(t){for(var r=[],n=function(n){r.push(Qe(e[n]).subscribe(Re(t,(function(e){if(r){for(var i=0;i<r.length;i++)i!==n&&r[i].unsubscribe();r=null}t.next(e)}))))},i=0;r&&!t.closed&&i<e.length;i++)n(i)}}(t))}function hi(e,{timeout:t=5e3,keepAlive:r=!1}={}){return new Promise(((n,i)=>{const a=e.observeItems(),s=mi(e.observeError().pipe(Be((e=>e instanceof Error?e:Error(String((null==e?void 0:e.message)||"unknown"))))),Rr(t).pipe(Be((()=>Error("timeout")))));mi(a,s).subscribe((t=>{r||e.disconnect(),t instanceof Error?i(t):n(t)})),e.fetchAt(0)}))}var fi=new Me(pe);class pi{constructor(e=[]){this.items$=new it([]),this.maxSize=void 0,this.items$.next(e)}observeItems(){return this.items$}observeSize(){return this.items$.pipe(Be((e=>e.length)))}observeError(){return fi}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()}))}get items(){return this.items$.getValue()}}const yi="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE3MDM5NTczMDcsImV4cCI6MTcxOTUwOTMwNywiaXNzIjoiODM4Nk5ERlhMQiJ9.UJjNLqpKbxC5Jr81w1JPSSZbBNdVjVvvd3LNcaGwJQpuy8U_R5EMcwGy0Z6nDu9IzfwYa9uGPT5ooB4qcKE5Kw".toString(),vi="41bd731be5b78200d2bbaea2312b917b".toString(),bi="78aa93b641329f00e68cf1542356b8fc".toString(),gi="".toString(),wi="".toString(),Ei="".toString(),ki=new J("apple"),xi={get connectedAt(){return ki.getNumber("connectedAt")},set connectedAt(e){ki.setNumber("connectedAt",e)},get favoriteSongsId(){return ki.getString("favoriteSongsId")},set favoriteSongsId(e){ki.setString("favoriteSongsId",e)},get useMusicKitBeta(){return ki.getBoolean("useMusicKitBeta",!0)},set useMusicKitBeta(e){ki.setBoolean("useMusicKitBeta",e)}};var Si=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Ti{constructor(e){this.MusicKit=e,this.isWrapper=!0}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return Si(this,void 0,void 0,(function*(){if(!this.instance){const t=this.MusicKit.configure(e);this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}})}return this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}}),e;throw Error("Not configured")}formatArtworkURL(e,t,r){return this.MusicKit.formatArtworkURL(e,t,r)}music(e,t,r){return Si(this,void 0,void 0,(function*(){const n=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",n.storefrontId);const i=(null==r?void 0:r.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{Authorization:`Bearer ${n.developerToken}`,"Music-User-Token":n.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok){const e=new Error(String(a.status));throw e.data=a,e}return{data:yield a.json()}}))}}var Pi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ai=new H("appleAuth"),Ii=new it(!1);function Ci(){return!!xi.connectedAt}function Mi(){return Ii.getValue()}function Oi(){return Ii.pipe(Vn())}function $i(){return Pi(this,void 0,void 0,(function*(){Ai.log("disconnect");try{const e=yield ji();try{e.isPlaying&&e.stop(),e.queue.isEmpty||(yield e.setQueue({}))}catch(e){Ai.error(e)}try{yield e.unauthorize()}catch(e){Ai.error(e)}}catch(e){}xi.connectedAt=0,xi.favoriteSongsId="",Ii.next(!1)}))}function Ni(){return Pi(this,void 0,void 0,(function*(){throw Ai.log("refreshToken"),yield $i(),Error("Access token refresh is not supported.")}))}const zi=new Promise(((e,t)=>{document.addEventListener("musickitloaded",(()=>Pi(void 0,void 0,void 0,(function*(){Ai.log("Loaded MusicKit version",MusicKit.version),MusicKit.version.startsWith("1")&&!MusicKit.isWrapper&&(window.MusicKit=new Ti(MusicKit));try{const t=yield MusicKit.configure({developerToken:yi,app:{name:"ampcast",build:"0.9.5"},sourceType:8,suppressErrorDialog:!0});t.addEventListener(MusicKit.Events.authorizationStatusDidChange,(()=>Pi(void 0,void 0,void 0,(function*(){const e=t.isAuthorized;if(e)try{yield Li(t)}catch(e){Ai.error(e)}Ii.next(e)})))),e(t)}catch(e){t(e)}}))))}));function ji(){return Pi(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${xi.useMusicKitBeta?3:1}/musickit.js`).then((()=>zi.then(e,t)),t)}))}))}function Li(e){return Pi(this,void 0,void 0,(function*(){if(!xi.favoriteSongsId){const{data:{data:t=[]}}=yield e.api.music("/v1/me/library/playlists",{"extend[library-playlists]":"tags","fields[library-playlists]":"tags"}),r=t.find((e=>{var t,r;return null===(r=null===(t=e.attributes)||void 0===t?void 0:t.tags)||void 0===r?void 0:r.includes("favorited")}));r&&(xi.favoriteSongsId=r.id)}}))}function Di(e){return e<=0?function(){return an}:De((function(t,r){var n=0;t.subscribe(Re(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}Oi().pipe(Nn((e=>!e))).subscribe((e=>xi.connectedAt=e?Date.now():0)),Pi(void 0,void 0,void 0,(function*(){try{if(Ci()){const e=yield ji();e.isAuthorized&&(yield Li(e),Ii.next(!0))}}catch(e){Ai.error(e)}}));var Ri;const Fi=[],_i=new H("AbstractPager");Ri=new WeakMap;const Bi=class{constructor(e={}){this.config=e,this.additions$=new it(Fi),this.error$=new it(Fi),this.items$=new it(Fi),this.fetches$=new it({index:0,length:0}),this.size$=new it(-1),this.srcs=new Set,Ri.set(this,!1)}get maxSize(){return this.config.maxSize}observeAdditions(){return this.additions$.pipe(Nn((e=>e===Fi)))}observeError(){return this.error$.pipe(Nn((e=>e===Fi)))}observeItems(){return this.items$.pipe(Nn((e=>e===Fi)))}observeSize(){return this.size$.pipe(Nn((e=>-1===e)),Vn())}disconnect(){this.disconnected||(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Ri,!0,"f"),this.subscriptions&&this.subscriptions.unsubscribe(),this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.additions$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){this.disconnected?_i.warn("disconnected"):(t||(t=50),this.connected||this.connect(),this.fetches$.next({index:e,length:t}))}get connected(){return!!this.subscriptions}get disconnected(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Ri,"f")}get error(){const e=this.error$.getValue();return e===Fi?void 0:e}set error(e){this.error$.next(e)}get items(){return this.items$.getValue()}set items(e){const t=[];this.items$.next(e.map((e=>{if(!this.srcs.has(e.src)){this.srcs.add(e.src);const r=Qn.getInLibrary(e,e.inLibrary),n=Qn.getRating(e,e.rating);e.inLibrary===r&&e.rating===n||(e=Object.assign(Object.assign({},e),{inLibrary:r,rating:n})),t.push(e)}return e}))),t.length>0&&this.additions$.next(t)}get size(){const e=this.size$.getValue();return-1===e?void 0:e}set size(e){this.size$.next(e)}observeComplete(){return _n([this.observeItems(),this.observeSize()]).pipe(_e((([e,t])=>e.reduce((e=>e+1),0)===t)),Be((([e])=>e)),Di(1))}observeFetches(){return this.fetches$}connect(){this.disconnected||this.connected||(this.subscriptions=new le,this.config.lookup||(this.subscribeTo(this.observeAdditions().pipe(at((e=>this.addMultiDisc(e)))),_i),this.subscribeTo(this.observeAdditions().pipe(at((e=>this.addTrackCount(e)))),_i),this.subscribeTo(Wn().pipe(at((e=>this.applyChanges(e)))),_i)))}subscribeTo(e,t){this.subscriptions.add(e.subscribe(t))}applyChanges(e){let t=!1;const r=this.items.map((r=>{for(const{match:n,values:i}of e)if(n(r))return t=!0,Object.assign(Object.assign({},r),i);return r}));t&&this.items$.next(r)}addMultiDisc(e){e.forEach((e=>{e.itemType===ti.Album&&void 0===e.multiDisc&&this.subscribeTo(e.pager.observeItems().pipe(Di(1),at((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n],i=h(t.map((e=>e.disc)).filter(l)),a=i.length>1||i[0]>1;e[n]=Object.assign(Object.assign({},r),{multiDisc:a}),this.items$.next(e)}}))),_i)}))}addTrackCount(e){e.forEach((e=>{e.itemType===ti.Playlist&&!e.trackCount&&e.pager&&this.subscribeTo(e.pager.observeSize().pipe(Di(1),at((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n];e[n]=Object.assign(Object.assign({},r),{trackCount:t}),this.items$.next(e)}}))),_i)}))}},Vi=new H("SequentialPager");class Ui extends Bi{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new it(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeShouldFetch().pipe(nn(void 0),at((()=>this.fetching$.next(!0))),Hn((()=>this.fetchNext(this.config.pageSize))),at((e=>this.addPage(e))),qn((e=>(Vi.error(e),this.error=e,pn(void 0)))),at((()=>this.fetching$.next(!1))),ln(this.observeComplete()),Di(100)),Vi))}observeShouldFetch(){const e=_n([this.observeFetches(),this.observeItems()]).pipe(Be((([{index:e,length:t},r])=>e+t+1>=r.length)),_e((e=>e)),Be((()=>{})),Di(1));return this.fetching$.pipe(on((t=>t?an:e)))}addPage(e){var t,r;const n=(e.items||[]).filter(l),i=f(this.items.concat(n),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);let a=e.atEnd||i.length===this.maxSize||this.emptyCount>=this.maxEmptyCount;const s=this.config.pageSize;a||void 0!==e.atEnd||void 0!==e.total||void 0===s||(a=e.items.length<s);const o=a?i.length:e.total;void 0!==o&&(this.size=Math.min(o,null!==(r=this.maxSize)&&void 0!==r?r:1/0)),this.items=i}}class Hi extends Bi{constructor(e){super(),this.fetch=e}fetchAt(){this.disconnected||this.connected||(this.connect(),this.fetch().then((e=>{this.size=e.length,this.items=e})).catch((e=>this.error=e)))}}const qi=new H("WrappedPager");class Yi{constructor(e,t,r){this.headerPager=e,this.bodyPager=t,this.footerPager=r,this.fetches$=new it({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){var e,t;return _n([(null===(e=this.headerPager)||void 0===e?void 0:e.observeItems())||pn([]),this.bodyPager.observeItems(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeItems())||pn([]),this.observeComplete()]).pipe(Be((([e,t,r,n])=>e.concat(n?t.concat(r):t))))}observeSize(){var e;return _n([this.observeHeaderSize(),this.bodyPager.observeSize(),(null===(e=this.footerPager)||void 0===e?void 0:e.observeSize())||pn(0),this.observeComplete()]).pipe(Be((([e,t,r,n])=>e+t+(n?r:0))))}observeError(){return this.bodyPager.observeError()}disconnect(){var e,t,r;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),null===(t=this.headerPager)||void 0===t||t.disconnect(),this.bodyPager.disconnect(),null===(r=this.footerPager)||void 0===r||r.disconnect())}fetchAt(e,t){this.disconnected?qi.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){this.subscriptions||(this.subscriptions=new le,this.headerPager&&this.subscriptions.add(this.observeFetches().pipe(Di(1),at((({index:e,length:t})=>this.headerPager.fetchAt(e,t)))).subscribe(qi)),this.subscriptions.add(_n([this.observeHeaderSize(),this.observeFetches()]).pipe(at((([e,t])=>this.bodyPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(qi)),this.footerPager&&this.subscriptions.add(this.observeComplete().pipe(at((()=>this.footerPager.fetchAt(0)))).subscribe(qi)))}observeComplete(){return _n([this.bodyPager.observeItems(),this.bodyPager.observeSize()]).pipe(Be((([e,t])=>e.reduce((e=>e+1),0)===t)),nn(!1),Vn())}observeFetches(){return this.fetches$.pipe(_e((e=>e.length>0)))}observeHeaderSize(){var e;return(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize().pipe(nn(0),Be((e=>e||0)),Vn()))||pn(0)}}var Ki=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Wi=new H("pinStore"),Gi=[];class Ji extends Ut.cp{constructor(){super("ampcast/pins"),this.pins$=new it(Gi),this.lockedPin$=new it(null),this.version(2).stores({pins:"&src"}),(0,Ut.k7)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return Ki(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Wi.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"]);return Object.assign(Object.assign({},r),{isPinned:!0})}))),Kn(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){Wi.error(e)}}))}unpin(e){return Ki(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Wi.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),Kn(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){Wi.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return _n([this.pins$,this.lockedPin$]).pipe(_e((([e])=>e!==Gi)),Be((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),r=this.lockedPin$.getValue();return r&&!t.find((e=>e.src===r.src))&&t.push(r),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const Qi=new Ji;var Xi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Zi=new H("MusicKitPager");class ea{static defaultToPage(e){var t,r,n;const i=(null===(r=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===r?void 0:r.tracks)||e,a=i.data||[],s=i.next;return{items:a,total:null===(n=i.meta)||void 0===n?void 0:n.total,nextPageUrl:s}}constructor(e,t,r,n,i=ea.defaultToPage){this.options=r,this.parent=n,this.nextPageUrl=void 0,this.pager=new Ui((r=>Xi(this,void 0,void 0,(function*(){const n=yield this.fetchNext(this.nextPageUrl||e,r?t?Object.assign(Object.assign({},t),{limit:r}):{limit:r}:t),a=i(n.data),s=this.createItems(a.items),o=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:s,total:o,atEnd:l}}))),r)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new le,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>va(e,!0,this.parent)))).subscribe(Zi)))}fetchNext(e,t){var r;return Xi(this,void 0,void 0,(function*(){const n=MusicKit.getInstance();try{return yield n.api.music(e,t)}catch(i){const a=null===(r=null==i?void 0:i.data)||void 0===r?void 0:r.status;if(401===a||403===a)return yield Ni(),n.api.music(e,t);throw i}}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,r;const n=MusicKit.getInstance(),i=this.createFromLibrary(e),a=(null===(t=i.description)||void 0===t?void 0:t.standard)||(null===(r=i.description)||void 0===r?void 0:r.short),s=`apple:${e.type}:${e.id}`,o=this.getCatalogId(e),l=e.type.startsWith("library-")||void 0,c={src:s,itemType:ti.Playlist,externalUrl:l?`https://music.apple.com/${n.storefrontId}/library/playlist/${e.id}`:i.url,title:i.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(i),owner:i.curatorName?{name:i.curatorName}:void 0,modifiedAt:Math.floor(new Date(i.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!i.playParams||void 0,isPinned:Qi.isPinned(s),inLibrary:l,apple:{catalogId:o}};return c.pager=new ea(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,c),c}createMediaArtist(e){var t,r;const n=this.createFromLibrary(e),i=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),a=this.getCatalogId(e);return{itemType:ti.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:n.url||void 0,title:n.name,description:i?P(i):void 0,thumbnails:this.createThumbnails(n),genres:this.getGenres(n),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createMediaAlbum(e){var t,r;const n=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),s=this.getCatalogId(e),o={itemType:ti.Album,src:i,externalUrl:n.url||void 0,title:n.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(n),artist:n.artistName,trackCount:n.trackCount,genres:this.getGenres(n),year:new Date(n.releaseDate).getFullYear()||0,unplayable:!n.playParams||void 0,inLibrary:e.type.startsWith("library-")||void 0,apple:{catalogId:s}};return o.pager=new ea(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,o),o}createMediaItem(e){var t,r,n,i,a;const s=this.createFromLibrary(e),{id:o,kind:l}=s.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${o}`,u=(null===(t=s.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=s.editorialNotes)||void 0===r?void 0:r.short),d=e.type.startsWith("library-"),m=(null===(n=this.parent)||void 0===n?void 0:n.itemType)===ti.Playlist,h=this.getCatalogId(e);let f=s.url||void 0;return!f&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===ti.Album&&this.parent.externalUrl&&(f=`${this.parent.externalUrl}?i=${h}`),{itemType:ti.Media,mediaType:"musicVideo"===l?ni.Video:ni.Audio,playbackType:jn.HLS,src:c,externalUrl:f,title:s.name,description:u?P(u):void 0,thumbnails:this.createThumbnails(s),artists:[s.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===ti.Album?this.parent.artist:void 0,album:s.albumName,duration:s.durationInMillis/1e3,genres:this.getGenres(s),disc:s.discNumber,track:s.trackNumber,year:new Date(s.releaseDate).getFullYear()||void 0,isrc:s.isrc,unplayable:!s.playParams||void 0,playedAt:0,inLibrary:d&&!m||void 0,apple:{catalogId:h}}}getCatalogId(e){var t,r,n;if(e.type.startsWith("library-")){let i=null===(r=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===r?void 0:r["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(n=this.getCatalog(e))||void 0===n?void 0:n.id),i||""}return e.id}createFromLibrary(e){var t;return x(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,r,n;return null===(n=null===(r=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===r?void 0:r.data)||void 0===n?void 0:n[0]}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new ea(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const r=this.createArtistTopTracks(e);let n;if(fa()){const t=this.createArtistVideos(e);n=new Hi((()=>Xi(this,void 0,void 0,(function*(){try{return 0===(yield hi(t.pager,{keepAlive:!0})).length?[r]:[r,t]}catch(e){return Zi.error(e),[r]}}))))}else n=new pi([r]);return new Yi(n,t)}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:ti.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createArtistVideos(e){const t=this.createFromLibrary(e);return{itemType:ti.Album,src:`apple:videos:${e.id}`,title:"Music Videos",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createVideosPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createTopTracksPager(e){return this.createArtistViewPager(e,"top-songs")}createVideosPager(e){return this.createArtistViewPager(e,"top-music-videos")}createArtistViewPager(e,t){return new ea(e.href,{[`limit[artists:${t}]`]:30,views:t},{maxSize:100},void 0,(e=>{var r,n,i;const a=(null===(n=null===(r=e.data[0])||void 0===r?void 0:r.views)||void 0===n?void 0:n[t])||e,s=a.data||[],o=a.next;return{items:s,total:null===(i=a.meta)||void 0===i?void 0:i.total,nextPageUrl:o}}))}}var ta=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ra={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},na={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:ti.Playlist,search:()=>new ea("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:r})=>{const n=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:n,total:null==r?void 0:r.total,nextPageUrl:t}}))},ia={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,layout:ra,search:()=>new ea("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},aa={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:ti.Media,lockActionsStore:!0,layout:ra,defaultHidden:!0,search:()=>new ea("/v1/me/library/songs",{"include[library-songs]":"catalog"})},sa={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:ti.Album,lockActionsStore:!0,search:()=>new ea("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog",sort:"-dateAdded"})},oa={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:ti.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new ea("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},la={id:"apple/playlists",title:"My Playlists",icon:"tick",itemType:ti.Playlist,lockActionsStore:!0,search:()=>new ea("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog",sort:"-dateAdded"})},ca={id:"apple/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search:()=>new ea("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog","filter[featured]":"suggested"})},ua={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:ti.Media,mediaType:ni.Video,lockActionsStore:!0,layout:ra,defaultHidden:!0,search:()=>new ea("/v1/me/library/music-videos")},da={id:"apple/favorite-songs",get title(){return ai("Favorite Songs")},icon:"star",itemType:ti.Media,layout:ra,defaultHidden:!0,search(){const e=xi.favoriteSongsId;if(!e)throw new ui;return new ea(`/v1/me/library/playlists/${e}/tracks`,{"include[library-songs]":"catalog"},void 0,{src:`apple:library-playlists:${e}`,itemType:ti.Playlist})}},ma={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",serviceType:$n.PublicMedia,primaryMediaType:ni.Audio,defaultHidden:!0,internetRequired:!0,roots:[pa(ti.Media,{title:"Songs",layout:ra}),pa(ti.Album,{title:"Albums"}),pa(ti.Artist,{title:"Artists"}),pa(ti.Playlist,{title:"Playlists"}),pa(ti.Media,{title:"Videos",layout:ra,mediaType:ni.Video},{types:"music-videos"},{maxSize:250})],sources:[aa,sa,oa,la,ua,da,ia,na],icons:{[Zn.AddToLibrary]:"plus",[Zn.RemoveFromLibrary]:"tick-fill"},labels:{[Zn.AddToLibrary]:"Add to Apple Music Library",[Zn.RemoveFromLibrary]:"Saved to Apple Music Library"},editablePlaylists:ca,addToPlaylist:function(e,t){return ta(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,,n]=e.src.split(":"),i=t.map((e=>{const[,t,r]=e.src.split(":");return{id:r,type:t}}));return r.api.music(`/v1/me/library/playlists/${n}/tracks`,void 0,{fetchOptions:{method:"POST",body:JSON.stringify({data:i})}})}))},canRate:()=>!1,canStore:function(e){switch(e.itemType){case ti.Media:case ti.Playlist:return!0;case ti.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r,items:n=[]}={}){return ta(this,void 0,void 0,(function*(){const i=MusicKit.getInstance(),a={name:e,description:t,isPublic:r},s={tracks:{data:n.map((e=>{const[,t,r]=e.src.split(":");return{id:r,type:t}}))}},o=yield i.api.music("/v1/me/library/playlists",void 0,{fetchOptions:{method:"POST",body:JSON.stringify({attributes:a,relationships:s})}});return{src:`apple:${o.type}:${o.id}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,r]=e.src.split(":"),n=t.startsWith("library-");return new ea(`${n?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${r}`,n?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return ta(this,void 0,void 0,(function*(){if(e.itemType===ti.Album&&e.synthetic)return e;let r=e;if(!e.externalUrl){const[,n,i]=e.src.split(":"),a=n.startsWith("library-"),s=new ea(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${n.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${n.replace("library-","")}]`]:"relationships"},{lookup:!0}),o=yield hi(s,{timeout:2e3});r=x(e,o[0]),r.description=(null===(t=o[0])||void 0===t?void 0:t.description)||e.description}return r.inLibrary=Qn.getInLibrary(r,r.inLibrary),void 0===r.inLibrary&&va([r]),r}))},getPlaybackType:function(){return ta(this,void 0,void 0,(function*(){return jn.HLS}))},lookup:function(e,t,r=10,n){return ta(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=ya(ti.Media,`${e} ${t}`,void 0,{pageSize:r,maxSize:r,lookup:!0});return(yield hi(i,{timeout:n})).filter((e=>!e.unplayable))}))},lookupByISRC:function(e,t,r){return ta(this,void 0,void 0,(function*(){if(0===e.length)return[];const n=new ea("/v1/catalog/{{storefrontId}}/songs",{"filter[isrc]":e.slice(0,25).join(",")},{pageSize:t,maxSize:t,lookup:!0});return(yield hi(n,{timeout:r})).filter((e=>!e.unplayable))}))},store:function(e,t){var r;return ta(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),s=null===(r=e.apple)||void 0===r?void 0:r.catalogId,o="/v1/me/library";if(t){const e=`ids[${a}]`;return n.api.music(o,{[e]:s},{fetchOptions:{method:"POST"}})}return n.api.music(`${o}/${a}/${s}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:Oi,isConnected:Ci,isLoggedIn:Mi,login:function(){return Pi(this,void 0,void 0,(function*(){if(!Mi()){Ai.log("connect");try{const e=MusicKit.getInstance();yield e.authorize()}catch(e){Ai.error(e)}}}))},logout:$i},ha=ma;function fa(){var e;return null===(e=window.MusicKit)||void 0===e?void 0:e.version.startsWith("3")}function pa(e,t,r,n){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>ya(e,t,r,n)})}function ya(e,t,r,n){if(t){const i=Object.assign(Object.assign({},r),{term:t});if(!i.types){switch(e){case ti.Media:i.types="songs";break;case ti.Album:i.types="albums";break;case ti.Artist:i.types="artists";break;case ti.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new ea("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},n),void 0,(e=>{var t;const r=e.results[a]||{data:[]},n=r.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:r.data,total:i,nextPageUrl:n}}))}return new pi}function va(e,t=!1,r){return ta(this,void 0,void 0,(function*(){const n=e[0];if(!n||!ma.canStore(n,t))return;const i=(null==r?void 0:r.itemType)===ti.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,s]=n.src.split(":");s=s.replace("library-","");const o=MusicKit.getInstance(),{data:{resources:l}}=yield o.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${s}]`]:"inLibrary","format[resources]":"map",[`ids[${s}]`]:a,"omit[resource]":"autos"}),c=l[s];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));Kn(a.map((e=>({match:t=>{var r;return(null===(r=t.apple)||void 0===r?void 0:r.catalogId)===e},values:{inLibrary:!!u.get(e)}}))))}))}var ba;!function(e){e[e.Folders=6]="Folders",e[e.ByDecade=7]="ByDecade",e[e.ByGenre=8]="ByGenre"}(ba||(ba={}));const ga=ba;var wa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ea=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function ka(e){var{service:t,settings:r,userName:i="",login:a}=e,s=Ea(e,["service","settings","userName","login"]);const o=t.id,[l,c]=(0,n.useState)(!1),[u,d]=(0,n.useState)(""),m=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),y=n.createElement(kr,{icon:t.icon,text:`Log in to ${t.name}`}),v=(0,n.useCallback)((()=>wa(this,void 0,void 0,(function*(){try{const e=h.current.value.replace(/\/+$/,""),t=f.current.value,n=p.current.value;if(r.host=e,c(!0),d("Connecting..."),"https:"===location.protocol&&!e.startsWith("https:"))throw Error("https required");const i=yield a(e,t,n);m.current.close(i)}catch(e){console.error(e),c(!1),e instanceof TypeError?d("Host not found"):d(e.message||e.statusText||"Error")}}))),[r,a]),b=(0,n.useCallback)((e=>{e.preventDefault(),v()}),[v]);return n.createElement(cr,Object.assign({},s,{className:`login-dialog login-dialog-${t.id}`,title:y,ref:m}),n.createElement("form",{id:`${o}-login`,method:"dialog",onSubmit:b},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-host`},"Host:"),n.createElement("input",{type:"url",id:`${o}-host`,name:`${o}-host`,autoFocus:!r.host,defaultValue:r.host,placeholder:"https://",required:!0,ref:h})),n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-username`},"User:"),n.createElement("input",{type:"text",id:`${o}-username`,name:`${o}-username`,autoFocus:!!r.host,defaultValue:i,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",required:!0,ref:f})),n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-password`},"Password:"),n.createElement("input",{type:"password",id:`${o}-password`,name:`${o}-password`,ref:p,required:!0}))),n.createElement("p",{className:"message "+(l?"":"error")},u),n.createElement(yr,{submitText:"Login"})))}let xa=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t};class Sa{constructor(e){this.storage=new J(e),this.session=new J(`${e}/session`,"session"),this.libraryId$=new it(this.storage.getString("libraryId"))}get audioLibraries(){return this.libraries.filter((e=>"musicvideos"!==e.type))}get device(){return"PC"}get deviceId(){let e=this.storage.getString("deviceId");return e||(e=xa(),this.storage.setString("deviceId",e)),e}get host(){return this.storage.getString("host")}set host(e){this.storage.setString("host",e)}get isLocal(){return this.storage.getBoolean("isLocal")}set isLocal(e){this.storage.setBoolean("isLocal",e)}get libraryId(){return this.storage.getString("libraryId")}set libraryId(e){this.storage.setString("libraryId",e),this.libraryId$.next(e)}observeLibraryId(){return this.libraryId$.pipe(Vn())}get libraries(){return this.storage.getJson("libraries")||[]}set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>"music"===e.type&&R(e.title)))||e.find((e=>"music"===e.type))||e.find((e=>"audiobooks"===e.type));this.storage.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""}get serverId(){return this.storage.getString("serverId")}set serverId(e){this.storage.setString("serverId",e)}get sessionId(){let e=this.session.getString("id");return e||(e=String(Math.floor(1e7*Math.random())),this.session.setString("id",e)),e}get token(){return this.storage.getString("token")}set token(e){this.storage.setString("token",e)}get userId(){return this.storage.getString("userId")}set userId(e){this.storage.setString("userId",e)}get videoLibraryId(){var e;return null===(e=this.libraries.find((e=>"musicvideos"===e.type)))||void 0===e?void 0:e.id}clear(){this.storage.removeItem("serverId"),this.storage.removeItem("userId"),this.storage.removeItem("token")}}const Ta=new Sa("emby");var Pa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Aa=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Ia(e=bs,t=Ta){return Pa(this,void 0,void 0,(function*(){return dr((r=>n.createElement(Ca,Object.assign({},r,{service:e,settings:t}))),!0)}))}function Ca(e){var{service:t,settings:r}=e,i=Aa(e,["service","settings"]);const a=(0,n.useCallback)(((e,t,n)=>Pa(this,void 0,void 0,(function*(){const{device:i,deviceId:a}=r,s=`MediaBrowser Client="ampcast", Version="0.9.5", Device="${i}", DeviceId="${a}"`,o=yield fetch(`${e}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":s},body:JSON.stringify({Username:t,Pw:n})});if(!o.ok)throw o;const l=yield o.json(),c=l.ServerId,u=l.User.Id,d=l.AccessToken;return JSON.stringify({serverId:c,userId:u,token:d})}))),[r]);return n.createElement(ka,Object.assign({},i,{service:t,settings:r,login:a}))}var Ma=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Oa(e,t,r){return Ma(this,void 0,void 0,(function*(){return(yield za(e,t,{method:"GET"},r)).json()}))}function $a(e,t,r=Ta){return Ma(this,void 0,void 0,(function*(){const n={UserId:r.userId,ParentId:r.libraryId,IncludeItemTypes:"Audio",SortBy:"SortName",Recursive:!0,Limit:500,StartIndex:0,EnableImages:!1,EnableUserData:!1,EnableTotalRecordCount:!1};switch(t){case ti.Album:n.IncludeItemTypes="MusicAlbum";break;case ti.Artist:n.IncludeItemTypes="AlbumArtist"}return((yield Oa(e,n,r)).Items||[]).map((({Id:e,Name:t})=>({id:e||t,title:t})))}))}function Na(e,t={},r=Ta){return Ma(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return za(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:n},r)}))}function za(e,t,r,n=Ta){return Ma(this,void 0,void 0,(function*(){const{host:i,device:a,deviceId:s,token:o}=n;if(!o)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{Accept:"application/json","X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.9.5", Device="${a}", DeviceId="${s}", Token="${o}"`});const l=yield fetch(`${i}/${e}`,r);if(!l.ok)throw l;return l}))}function ja(e,t=Ta){const{host:r,userId:n,token:i,deviceId:a,sessionId:s}=t;if(r&&n&&i&&a){const[,t,o,l]=e.src.split(":"),c=`${s}-${o}`;return"video"===t?e.playbackType===jn.Direct?`${r}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:n,DeviceId:a,api_key:i,PlaySessionId:c})}`:`${r}/Videos/${o}/master.m3u8?${new URLSearchParams({MediaSourceId:l||o,DeviceId:a,api_key:i,TranscodeReasons:"ContainerNotSupported",VideoCodec:"h264,h265,hevc",AudioCodec:"mp3,aac",PlaySessionId:c})}`:`${r}/Audio/${o}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"aac",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",UserId:n,api_key:i,DeviceId:a,EnableRedirection:"true",StartTimeTicks:"0",PlaySessionId:c})}`}throw Error("Not logged in")}const La={addToPlaylist:function(e,t,r=Ta){return Ma(this,void 0,void 0,(function*(){const n=r.userId,i=t.join(",");yield za(`Playlists/${e}/Items`,{Ids:i,UserId:n},{method:"POST"},r)}))},createPlaylist:function(e,t,r,n=Ta){return Ma(this,void 0,void 0,(function*(){const i=n.userId,a=r.join(","),s=yield Na("Playlists",{Name:e,Ids:a,UserId:i},n),{Id:o}=yield s.json(),l=`Items/${o}`,c=yield Oa(`Users/${i}/${l}`,void 0,n);return yield Na(l,Object.assign(Object.assign({},c),{Overview:t}),n),c}))},delete:function(e,t,r){return Ma(this,void 0,void 0,(function*(){yield za(e,t,{method:"DELETE"},r)}))},get:Oa,getFilters:function(e,t,r){return Ma(this,void 0,void 0,(function*(){return e===ga.ByDecade?function(e,t){return Ma(this,void 0,void 0,(function*(){const r=(new Date).getFullYear(),n=(yield $a("Years",e,t)).map((e=>Number(e.title))).filter((e=>e>500&&e<=r)),i=d(n,(e=>10*Math.floor(e/10)));return Object.keys(i).sort().reverse().map((e=>({id:i[e].join(","),title:`${e}s`})))}))}(t,r):function(e,t){return Ma(this,void 0,void 0,(function*(){return $a("Genres",e,t)}))}(t,r)}))},getEndpointInfo:function(e=Ta){return Ma(this,void 0,void 0,(function*(){return yield Oa("System/Endpoint",void 0,e)}))},getMusicLibraries:function(e=Ta){var t;return Ma(this,void 0,void 0,(function*(){const r=yield Oa(`Users/${e.userId}/Views`,void 0,e);return((null===(t=r.Items)||void 0===t?void 0:t.filter((e=>/^(audiobooks|music|musicvideos)$/.test(e.CollectionType))))||[]).map((({Id:e,Name:t,CollectionType:r})=>({id:e,title:t,type:r})))}))},post:Na,getPlayableUrl:ja,getPlaybackType:function(e,t=Ta){return Ma(this,void 0,void 0,(function*(){try{if(e.mediaType===ni.Video){const{host:n,userId:i,token:a,deviceId:s}=t,[,,o,l]=e.src.split(":"),c=`${n}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:i,DeviceId:s,api_key:a})}`;return(yield(r=c,V("video",r)))?jn.Direct:jn.HLS}{const r=ja(e,t),n=(yield function(e){return o(this,void 0,void 0,(function*(){return(yield fetch(e,{method:"HEAD"})).headers.get("Content-Type")||""}))}(r)).toLowerCase();return"application/x-mpegurl"===n||"application/vnd.apple.mpegurl"===n?jn.HLS:jn.Direct}}catch(e){return jn.Direct}var r}))}},Da=La;var Ra=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Fa=new H("embyAuth"),_a=new it(""),Ba=new it(!1);function Va(){return Ba.getValue()}function Ua(e){Ta.token=e,_a.next(e)}function Ha(e,t,r){void 0===t&&(t=jr);var n=Rr(e,t);return function(e,t){return De((function(e,r){var i=null!=t?t:{},a=i.leading,s=void 0===a||a,o=i.trailing,l=void 0!==o&&o,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(y(),m&&r.complete())},f=function(){d=null,m&&r.complete()},p=function(e){return d=Qe(n).subscribe(Re(r,h,f))},y=function(){if(c){c=!1;var e=u;u=null,r.next(e),!m&&p()}};e.subscribe(Re(r,(function(e){c=!0,u=e,(!d||d.closed)&&(s?y():p())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))}(0,r)}_a.pipe(Vn()).pipe(_e((e=>""!==e)),et((()=>function(){return Ra(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([Da.getEndpointInfo(),Da.getMusicLibraries()]);return Ta.isLocal=!!e.IsLocal,Ta.libraries=t,!0}catch(e){return 401===e.status?Ta.token="":Fa.error(e),_a.next(""),!1}}))}()))).subscribe(Ba),_a.next(Ta.token);var qa;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(qa||(qa={}));const Ya=new H("OffsetPager");class Ka extends Bi{constructor(e,t){super(t),this.fetch=e,this.fetchStates={}}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeFetches().pipe(Ha(200,void 0,{leading:!1,trailing:!0}),_e((({index:e,length:t})=>t>0&&this.isInRange(e))),Be((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),et((e=>e)),et((e=>this.fetchPage(e))),qn((e=>(Ya.error(e),this.error=e,pn(void 0)))),ln(this.observeComplete())),Ya))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,r=void 0,i=function*(){if(this.fetchStates[e]!==qa.Fulfilled&&this.fetchStates[e]!==qa.Pending){this.fetchStates[e]=qa.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=qa.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=qa.Rejected,t}}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}insertPage(e,t){var r;const n=this.items.slice(),i=Math.min(t.total,null!==(r=this.maxSize)&&void 0!==r?r:1/0),a=Math.ceil(i/this.pageSize),s=(e-1)*this.pageSize;if(t.items.forEach(((e,t)=>n[t+s]=e)),n.length=i,t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=qa.Fulfilled;this.size=i,this.items=n}getPageNumbersFromIndex(e,t){const r=this.size||0,n=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-n,0),a=Math.min(e+n+t-1,0===r?this.maxSize?this.maxSize-1:1/0:r-1),s=this.getPageNumberFromIndex(i),o=this.getPageNumberFromIndex(a);if(s===o)return[s];{const e=[];for(let t=s;t<=o;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){const t=this.size||0;return 0===t?e>=0:e>=0&&e<t}}class Wa{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=Math.min((null==r?void 0:r.maxSize)||1/0,(null==r?void 0:r.pageSize)||(Ta.isLocal?Wa.maxPageSize:200)),this.pager=new Ka((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,ParentIndexNumber,Path,ProductionYear,Overview,PresentationUniqueKey,ProviderIds,,UserDataPlayCount,UserDataLastPlayedDate",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield Da.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r,n;return{itemType:ti.Artist,src:`emby:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",description:e.Overview||void 0,playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,thumbnails:this.createThumbnails(e),artist_mbid:null===(n=e.ProviderIds)||void 0===n?void 0:n.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n,i;return{itemType:ti.Album,src:`emby:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,pager:this.createAlbumTracksPager(e)}}createMediaPlaylist(e){var t,r,n;const i=`emby:playlist:${e.Id}`;return{src:i,itemType:ti.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:Qi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:ti.Folder,src:`emby:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:ti.Media,mediaType:l?ni.Video:ni.Audio,src:`emby:${l?"video":"audio"}:${e.Id}:${e.PresentationUniqueKey||""}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(r=e.UserData)||void 0===r?void 0:r.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480),this.createThumbnail(r,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${Ta.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new pi([t]),n=new Wa(`Users/${Ta.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending"});return new Yi(void 0,n,r)}createArtistAllTracks(e){return{itemType:ti.Album,src:`emby:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Wa(`Users/${Ta.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"SortName",SortOrder:"Ascending"})}createAlbumTracksPager(e){return new Wa(`Users/${Ta.userId}/Items`,{ParentId:e.Id,SortBy:"ParentIndexNumber,IndexNumber",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new Wa(`Playlists/${e.Id}/Items`,{UserId:Ta.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new Wa(`Users/${Ta.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new pi([e]);return new Yi(t,n)}return n}getExternalUrl(e){return`${Ta.host}/web/index.html#!/item?id=${e.Id}&serverId=${Ta.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}Wa.minPageSize=10,Wa.maxPageSize=1e3;const Ga=Wa;var Ja=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Qa="emby",Xa="AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName",Za={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},es={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre","PlayCount"]},ts={id:"emby/liked-songs",title:"My Songs",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>ks({ParentId:xs(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},rs={id:"emby/liked-albums",title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search:()=>ks({ParentId:xs(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},ns={id:"emby/liked-artists",title:"My Artists",icon:"heart",itemType:ti.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Ga("Artists/AlbumArtists",{ParentId:xs(),isFavorite:!0,UserId:Ta.userId})},is={id:"emby/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>ks({ParentId:xs(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},as={id:"emby/most-played",title:"Most Played",icon:"most-played",itemType:ti.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>ks({ParentId:xs(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ss={id:"emby/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,layout:Za,secondaryLayout:es,search:()=>ks({ParentId:xs(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},os={id:"emby/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search:()=>ks({ParentId:xs(),IncludeItemTypes:"Playlist"})},ls={id:"emby/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:ti.Media,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?ks({ParentId:xs(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:Xa}):new pi},cs={id:"emby/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:ti.Album,viewType:ga.ByGenre,search:e=>e?ks({ParentId:xs(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new pi},us={id:"emby/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:ti.Artist,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?new Ga("Artists/AlbumArtists",{ParentId:xs(),GenreIds:e.id,UserId:Ta.userId}):new pi},ds={id:"emby/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:ti.Media,viewType:ga.ByDecade,defaultHidden:!0,search:e=>e?ks({ParentId:xs(),Years:e.id,IncludeItemTypes:"Audio",SortBy:Xa}):new pi},ms={id:"emby/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:ti.Album,viewType:ga.ByDecade,search:e=>e?ks({ParentId:xs(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new pi},hs={id:"emby/random-tracks",title:"Random Songs",icon:"shuffle",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>ks({ParentId:xs(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},fs={id:"emby/random-albums",title:"Random Albums",icon:"shuffle",itemType:ti.Album,search:()=>ks({ParentId:xs(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},ps={id:"emby/videos",title:"Music Videos",icon:"video",itemType:ti.Media,mediaType:ni.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Ta.videoLibraryId;if(!t)throw new li;return ks({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},ys={id:"emby/folders",title:"Folders",icon:"folder",itemType:ti.Folder,viewType:ga.Folders,search(){const e={itemType:ti.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>Ja(this,void 0,void 0,(function*(){return Ta.libraries.map((({id:t,title:r})=>{const n={itemType:ti.Folder,src:`emby:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new pi([i]),s=new Ga(`Users/${Ta.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},void 0,n);return n.pager=new Yi(a,s),n}))})))),e.pager}},vs={id:Qa,icon:Qa,name:"Emby",url:"https://emby.media/",serviceType:$n.PersonalMedia,defaultHidden:!0,roots:[ws(ti.Media,{title:"Songs"}),ws(ti.Album,{title:"Albums"}),ws(ti.Artist,{title:"Artists"}),ws(ti.Playlist,{title:"Playlists",layout:Za,secondaryLayout:es})],sources:[ts,rs,ns,as,is,ss,ls,cs,us,ds,ms,hs,fs,ps,ys],labels:{[Zn.AddToLibrary]:ai("Add to Emby Favorites"),[Zn.RemoveFromLibrary]:ai("Remove from Emby Favorites")},editablePlaylists:os,get audioLibraries(){return Ta.audioLibraries},get libraryId(){return Ta.libraryId},set libraryId(e){Ta.libraryId=e},get libraries(){return Ta.libraries},set libraries(e){Ta.libraries=e},observeLibraryId:()=>Ta.observeLibraryId(),addToPlaylist:function(e,t){return Ja(this,void 0,void 0,(function*(){const r=Ss(e);return Da.addToPlaylist(r,t.map(Ss))}))},canRate:()=>!1,canStore:gs,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return Ja(this,void 0,void 0,(function*(){return{src:`emby:playlist:${(yield Da.createPlaylist(e,t,r.map(Ss))).Id}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>ks({ids:Ss(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return Ja(this,void 0,void 0,(function*(){return Da.getFilters(e,t)}))},getMetadata:function(e){return Ja(this,void 0,void 0,(function*(){if(!gs(e)||void 0!==e.inLibrary)return e;const t=Qn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=Ss(e),n=new Ga(`Users/${Ta.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield hi(n,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return Da.getPlayableUrl(e)},getPlaybackType:function(e){return Ja(this,void 0,void 0,(function*(){return Da.getPlaybackType(e)}))},lookup:function(e,t,r=10,n){return Ja(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return hi(Es(ti.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return Ja(this,void 0,void 0,(function*(){const r=Ss(e),n=`Users/${Ta.userId}/FavoriteItems/${r}`;t?yield Da.post(n):yield Da.delete(n)}))},observeIsLoggedIn:function(){return Ba.pipe(Vn())},isConnected:function(){return!!Ta.token},isLoggedIn:Va,login:function(){return Ra(this,void 0,void 0,(function*(){if(!Va()){Fa.log("connect");try{const e=yield Ia();if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);Ta.serverId=t,Ta.userId=r,Ua(n)}}catch(e){Fa.error(e)}}}))},logout:function(){return Ra(this,void 0,void 0,(function*(){Fa.log("disconnect"),Ta.clear(),Ua(""),Ba.next(!1)}))}},bs=vs;function gs(e){switch(e.itemType){case ti.Album:return!e.synthetic;case ti.Folder:return!1;default:return!0}}function ws(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`emby/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Es(e,t)})}function Es(e,t,r,n){const i=Object.assign({ParentId:xs(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===ti.Artist)return new Ga("Artists",Object.assign(Object.assign({},i),{UserId:Ta.userId}),n);switch(e){case ti.Media:i.IncludeItemTypes="Audio",i.SortBy=Xa;break;case ti.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case ti.Playlist:i.IncludeItemTypes="Playlist"}return ks(i,n)}function ks(e,t){return new Ga(`Users/${Ta.userId}/Items`,e,t)}function xs(){const e=Ta.libraryId;if(!e)throw new oi;return e}function Ss({src:e}){const[,,t]=e.split(":");return t}const Ts=new Sa("jellyfin");var Ps=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const As={addToPlaylist:function(e,t){return Ps(this,void 0,void 0,(function*(){return Da.addToPlaylist(e,t,Ts)}))},createPlaylist:function(e,t,r){return Ps(this,void 0,void 0,(function*(){return Da.createPlaylist(e,t,r,Ts)}))},delete:function(e,t){return Ps(this,void 0,void 0,(function*(){return Da.delete(e,t,Ts)}))},get:function(e,t){return Ps(this,void 0,void 0,(function*(){return Da.get(e,t,Ts)}))},getEndpointInfo:function(){return Ps(this,void 0,void 0,(function*(){return Da.getEndpointInfo(Ts)}))},getFilters:function(e,t){return Ps(this,void 0,void 0,(function*(){return Da.getFilters(e,t,Ts)}))},getMusicLibraries:function(){return Ps(this,void 0,void 0,(function*(){return Da.getMusicLibraries(Ts)}))},post:function(e,t={}){return Ps(this,void 0,void 0,(function*(){return Da.post(e,t,Ts)}))},getPlayableUrl:function(e){return Da.getPlayableUrl(e,Ts)},getPlaybackType:function(e){return Ps(this,void 0,void 0,(function*(){return Da.getPlaybackType(e,Ts)}))}};var Is=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Cs=new H("jellyfinAuth"),Ms=new it(""),Os=new it(!1);function $s(){return Os.getValue()}function Ns(e){Ts.token=e,Ms.next(e)}Ms.pipe(Vn()).pipe(_e((e=>""!==e)),et((()=>function(){return Is(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([As.getEndpointInfo(),As.getMusicLibraries()]);return Ts.isLocal=!!e.IsLocal,Ts.libraries=t,!0}catch(e){return 401===e.status?Ts.token="":Cs.error(e),Ms.next(""),!1}}))}()))).subscribe(Os),Ms.next(Ts.token);class zs{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=Math.min((null==r?void 0:r.maxSize)||1/0,(null==r?void 0:r.pageSize)||(Ts.isLocal?zs.maxPageSize:200)),this.pager=new Ka((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,Path,ProviderIds",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield As.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r,n;return{itemType:ti.Artist,src:`jellyfin:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,artist_mbid:null===(n=e.ProviderIds)||void 0===n?void 0:n.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n,i;return{itemType:ti.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,r,n;const i=`jellyfin:playlist:${e.Id}`;return{src:i,itemType:ti.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:Qi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:ti.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:ti.Media,mediaType:l?ni.Video:ni.Audio,src:`jellyfin:${l?"video":"audio"}:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(r=e.UserData)||void 0===r?void 0:r.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480),this.createThumbnail(r,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${Ts.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createAlbumTracksPager(e){return new zs(`Users/${Ts.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new pi([t]),n=new zs(`Users/${Ts.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending"});return new Yi(void 0,n,r)}createArtistAllTracks(e){return{itemType:ti.Album,src:`jellyfin:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new zs(`Users/${Ts.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"Name",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new zs(`Playlists/${e.Id}/Items`,{UserId:Ts.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new zs(`Users/${Ts.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new pi([e]);return new Yi(t,n)}return n}getExternalUrl(e){return`${Ts.host}/web/index.html#!/details?id=${e.Id}&serverId=${Ts.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}zs.minPageSize=10,zs.maxPageSize=1e3;const js=zs;var Ls=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ds="jellyfin",Rs={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},Fs={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},_s={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>oo({ParentId:lo(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Bs={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search:()=>oo({ParentId:lo(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},Vs={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:ti.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new js("Artists/AlbumArtists",{ParentId:lo(),isFavorite:!0,UserId:Ts.userId})},Us={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>oo({ParentId:lo(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Hs={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:ti.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>oo({ParentId:lo(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},qs={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,layout:Rs,secondaryLayout:Fs,search:()=>oo({ParentId:lo(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},Ys={id:"jellyfin/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search:()=>oo({ParentId:lo(),IncludeItemTypes:"Playlist"})},Ks={id:"jellyfin/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:ti.Media,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?oo({ParentId:lo(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new pi},Ws={id:"jellyfin/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:ti.Album,viewType:ga.ByGenre,search:e=>e?oo({ParentId:lo(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new pi},Gs={id:"jellyfin/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:ti.Artist,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?new js("Artists/AlbumArtists",{ParentId:lo(),GenreIds:e.id,UserId:Ts.userId}):new pi},Js={id:"jellyfin/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:ti.Media,viewType:ga.ByDecade,defaultHidden:!0,search:e=>e?oo({ParentId:lo(),Years:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new pi},Qs={id:"jellyfin/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:ti.Album,viewType:ga.ByDecade,search:e=>e?oo({ParentId:lo(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new pi},Xs={id:"jellyfin/random-tracks",title:"Random Songs",icon:"shuffle",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>oo({ParentId:lo(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},Zs={id:"jellyfin/random-albums",title:"Random Albums",icon:"shuffle",itemType:ti.Album,search:()=>oo({ParentId:lo(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},eo={id:"jellyfin/videos",title:"Music Videos",icon:"video",itemType:ti.Media,mediaType:ni.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Ts.videoLibraryId;if(!t)throw new li;return oo({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},to={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:ti.Folder,viewType:ga.Folders,search(){const e={itemType:ti.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>Ls(this,void 0,void 0,(function*(){return Ts.libraries.map((({id:t,title:r})=>{const n={itemType:ti.Folder,src:`jellyfin:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new pi([i]),s=new js(`Users/${Ts.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},void 0,n);return n.pager=new Yi(a,s),n}))})))),e.pager}},ro={id:Ds,icon:Ds,name:"Jellyfin",url:"https://jellyfin.org",serviceType:$n.PersonalMedia,defaultHidden:!0,roots:[ao(ti.Media,{title:"Songs"}),ao(ti.Album,{title:"Albums"}),ao(ti.Artist,{title:"Artists"}),ao(ti.Playlist,{title:"Playlists",layout:Rs,secondaryLayout:Fs})],sources:[_s,Bs,Vs,Hs,Us,qs,Ks,Ws,Gs,Js,Qs,Xs,Zs,eo,to],labels:{[Zn.AddToLibrary]:ai("Add to Jellyfin Favorites"),[Zn.RemoveFromLibrary]:ai("Remove from Jellyfin Favorites")},editablePlaylists:Ys,get audioLibraries(){return Ts.audioLibraries},get libraryId(){return Ts.libraryId},set libraryId(e){Ts.libraryId=e},get libraries(){return Ts.libraries},set libraries(e){Ts.libraries=e},observeLibraryId:()=>Ts.observeLibraryId(),addToPlaylist:function(e,t){return Ls(this,void 0,void 0,(function*(){const r=co(e);return As.addToPlaylist(r,t.map(co))}))},canRate:()=>!1,canStore:io,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return Ls(this,void 0,void 0,(function*(){return{src:`jellyfin:playlist:${(yield As.createPlaylist(e,t,r.map(co))).Id}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>oo({ids:co(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return Ls(this,void 0,void 0,(function*(){return As.getFilters(e,t)}))},getMetadata:function(e){return Ls(this,void 0,void 0,(function*(){if(!io(e)||void 0!==e.inLibrary)return e;const t=Qn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=co(e),n=new js(`Users/${Ts.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield hi(n,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return As.getPlayableUrl(e)},getPlaybackType:function(e){return Ls(this,void 0,void 0,(function*(){return As.getPlaybackType(e)}))},lookup:function(e,t,r=10,n){return Ls(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return hi(so(ti.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return Ls(this,void 0,void 0,(function*(){const r=co(e),n=`Users/${Ts.userId}/FavoriteItems/${r}`;t?yield As.post(n):yield As.delete(n)}))},observeIsLoggedIn:function(){return Os.pipe(Vn())},isConnected:function(){return!!Ts.token},isLoggedIn:$s,login:function(){return Is(this,void 0,void 0,(function*(){if(!$s()){Cs.log("connect");try{const e=yield Ia(no,Ts);if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);Ts.serverId=t,Ts.userId=r,Ns(n)}}catch(e){Cs.error(e)}}}))},logout:function(){return Is(this,void 0,void 0,(function*(){Cs.log("disconnect"),Ts.clear(),Ns(""),Os.next(!1)}))}},no=ro;function io(e){switch(e.itemType){case ti.Album:return!e.synthetic;case ti.Folder:return!1;default:return!0}}function ao(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>so(e,t)})}function so(e,t,r,n){const i=Object.assign({ParentId:lo(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===ti.Artist)return new js("Artists",Object.assign(Object.assign({},i),{UserId:Ts.userId}),n);switch(e){case ti.Media:i.IncludeItemTypes="Audio",i.SortBy="AlbumArtist,Album,SortName";break;case ti.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case ti.Playlist:i.IncludeItemTypes="Playlist"}return oo(i,n)}function oo(e,t){return new js(`Users/${Ts.userId}/Items`,e,t)}function lo(){const e=Ts.libraryId;if(!e)throw new oi;return e}function co({src:e}){const[,,t]=e.split(":");return t}var uo=r(2752),mo=r.n(uo);const ho=new J("lastfm"),fo={get token(){return ho.getString("token")},set token(e){ho.setString("token",e)},get userId(){return ho.getString("userId")},set userId(e){ho.setString("userId",e)},get sessionKey(){return ho.getString("sessionKey")},set sessionKey(e){ho.setString("sessionKey",e)},get firstScrobbledAt(){return ho.getString("firstScrobbledAt")},set firstScrobbledAt(e){ho.setString("firstScrobbledAt",e)},get playCount(){return ho.getNumber("playCount")},set playCount(e){ho.setNumber("playCount",e)},clear(){ho.clear()}};var po=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const yo=new H("lastfmApi"),vo=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}getSignature(e){const t=Object.keys(e);let r="";return t.sort(),t.forEach((t=>r+=t+e[t])),r+=bi,mo()(r)}scrobble(e){return po(this,void 0,void 0,(function*(){yo.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const r=e[0],n=String(r.playedAt);yield this.post(Object.assign({method:t,timestamp:n},this.getScrobbleParams(r)))}else if(e.length>0){const r={};e.forEach(((e,t)=>{const n=this.getScrobbleParams(e);r[`timestamp[${t}]`]=String(e.playedAt),Object.keys(n).forEach((e=>{r[`${e}[${t}]`]=n[e]}))})),yield this.post(Object.assign({method:t},r))}}))}updateNowPlaying(e){return po(this,void 0,void 0,(function*(){yo.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){yo.log('Failed to update "now playing":',{item:e}),yo.error(t)}}))}getUserInfo(){return po(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:fo.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return po(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:vi,format:"json"}))}`,r=yield fetch(t,{method:"GET"});if(!r.ok)throw r;return r.json()}))}post(e){return po(this,void 0,void 0,(function*(){const t=fo.token,r=fo.sessionKey;e=Object.assign(Object.assign({},e),{api_key:vi,token:t,sk:r});const n=this.getSignature(e),i=`${new URLSearchParams(e)}&api_sig=${n}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.track_mbid&&(t.mbid=e.track_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,r=t){if(e){const n=e["#text"];if(n&&!n.endsWith(this.placeholderImage))return{url:n,width:t,height:r}}}},bo=vo;var go=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const wo=new H("lastfmAuth"),Eo=new it(""),ko=new it("");function xo(){return Eo.pipe(Vn())}function So(){return""!==Eo.getValue()}function To(){return xo().pipe(Be((e=>""!==e)),Vn())}xo().pipe(_e((e=>!!e)),et((()=>function(){return go(this,void 0,void 0,(function*(){try{yield bo.getUserInfo()}catch(e){401===e.status?(fo.clear(),ko.next(""),Eo.next("")):wo.error(e)}}))}()))).subscribe(wo),ko.next(fo.sessionKey),Eo.next(fo.token);class Po{constructor(e,t,r,n){this.album=n,this.defaultConfig={pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),r),{page:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new Ui(((e=this.defaultConfig.pageSize)=>{return r=this,n=void 0,a=function*(){const r=this.pageNumber,n=yield bo.get(Object.assign(Object.assign({},s),{page:r,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:o,itemType:l}=t(n);return{items:this.createMediaObjects(l,i),total:a,atEnd:o}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case ti.Artist:return t.map((e=>this.createMediaArtist(e)));case ti.Album:return t.map((e=>this.createMediaAlbum(e)));case ti.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,r,n,i,a,s;const o=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(ti.Media,e)),{mediaType:ni.Audio,src:o?`lastfm:listen:${o}`:`lastfm:track:${xa()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(r=this.album)||void 0===r?void 0:r.name)||(null===(n=e.album)||void 0===n?void 0:n["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(s=e.album)||void 0===s?void 0:s.mbid),track_mbid:e.mbid,duration:Number(e.duration)||0,track:l&&Number(l)||void 0,inLibrary:"loved"in e?!!Number(e.loved):"user.getLovedTracks"===this.method||void 0,playedAt:o})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(ti.Album,e)),{src:`lastfm:album:${xa()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(ti.Artist,e)),{src:`lastfm:artist:${xa()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:ti.Album,title:"Top Tracks",thumbnails:bo.createThumbnails(e.image),src:`lastfm:top-tracks:${xa()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:bo.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new pi([t]),n=new Po({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:ti.Album}}),{maxSize:100,playCountName:"userplaycount"});return new Yi(r,n)}createAlbumPager(e){return new Po({method:"album.getInfo",album:e.name,artist:e.artist.name,user:fo.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,r=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:r,total:r.length,atEnd:!0,itemType:ti.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new Po({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:ti.Media}}),{pageSize:10,maxSize:10})}}Po.minPageSize=10,Po.maxPageSize=200;const Ao=Po;class Io extends Ao{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:fo.userId}),(({recenttracks:e})=>{var t,r;const n=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],s="true"===(null===(r=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===r?void 0:r.nowplaying),o=Number(n.page)||1,l=Number(n.totalPages)||1,c=1===l||o===l,u=Number(n.total)||void 0;return s&&a.shift(),{items:a,total:u,atEnd:c,itemType:ti.Media}}),t)}}var Co=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Mo={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Oo={id:"lastfm/history",title:"History",icon:"clock",itemType:ti.Media,search:({startAt:e=0}={})=>new Io(e?{to:e}:void 0)},$o={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,search:()=>new Io},No={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new Ao({method:"user.getLovedTracks",user:fo.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},r=e.track,n=r?Array.isArray(r)?r:[r]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,s=1===a||i===a;return{items:n,total:Number(t.total)||void 0,atEnd:s,itemType:ti.Media}}))},zo={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",serviceType:$n.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[$o],sources:[Do("user.getTopTracks",{title:"Top Tracks",itemType:ti.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),Do("user.getTopAlbums",{title:"Top Albums",itemType:ti.Album,layout:Mo}),Do("user.getTopArtists",{title:"Top Artists",itemType:ti.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:Mo}),No,Oo],labels:{[Zn.AddToLibrary]:"Love on last.fm",[Zn.RemoveFromLibrary]:"Unlove on last.fm"},canRate:()=>!1,canStore:function(e){var t;return e.itemType===ti.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},compareForRating:function(e,t){var r,n,i;const[a]=e.src.split(":"),[s]=t.src.split(":");return a===s&&(e.itemType===ti.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(r=e.artists)||void 0===r?void 0:r[0])&&Lo(e.title,t.title)&&Lo(null===(n=e.artists)||void 0===n?void 0:n[0],null===(i=t.artists)||void 0===i?void 0:i[0])))},getMetadata:function(e){return Co(this,void 0,void 0,(function*(){if(e.itemType!==ti.Media||void 0!==e.inLibrary)return e;const t={method:"track.getInfo",user:fo.userId};if(e.track_mbid)t.mbid=e.track_mbid;else{const{title:r,artists:n=[]}=e;if(t.artist=n[0],t.track=r,!t.artist)return e}const{track:r}=yield bo.get(t);if(!r||"error"in r)throw Error((null==r?void 0:r.message)||"Not found");{const t={},{album:n,wiki:i}=r;return n&&(t.album=n.title,t.albumArtist=n.artist,e.thumbnails||(t.thumbnails=bo.createThumbnails(n.image))),!e.description&&i&&(t.description=P(i.content||i.summary)),!e.year&&i&&(t.year=i.published&&new Date(i.published).getFullYear()||void 0),Object.assign(Object.assign(Object.assign({},e),t),{inLibrary:Qn.getInLibrary(e,!!Number(r.userloved)),playCount:Number(r.userplaycount)||0,globalPlayCount:Number(r.playcount)||0})}}))},store:function(e,t){return Co(this,void 0,void 0,(function*(){if(e.itemType===ti.Media){const{title:r,artists:n=[]}=e,i=n[0];r&&i&&(yield bo.post({method:t?"track.love":"track.unlove",track:r,artist:i}))}}))},observeIsLoggedIn:To,isConnected:function(){return!!fo.token},isLoggedIn:So,login:function(){return go(this,void 0,void 0,(function*(){if(!So()){wo.log("connect");try{const e=yield function(){return go(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/lastfm/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});e(r.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${vi}&cb=${n}`,"last.fm","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return go(this,void 0,void 0,(function*(){const t="auth.getSession",r={api_key:vi,token:e,method:t},n=bo.getSignature(r),i=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${vi}&token=${e}&api_sig=${n}&format=json`);if(!i.ok)throw i;const{session:a}=yield i.json();return fo.userId=a.name,fo.token=e,fo.sessionKey=a.key,a.key}))}(e);ko.next(t),Eo.next(e)}catch(e){wo.error(e)}}}))},logout:function(){return go(this,void 0,void 0,(function*(){wo.log("disconnect"),fo.clear(),ko.next(""),Eo.next("")}))}},jo=zo;function Lo(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Do(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:r="overall"}={})=>new Ao({method:e,period:r,user:fo.userId},(r=>{const[,n]=e.toLowerCase().split("."),i=r[n.slice(3)],a=i["@attr"],s=i[n.slice(6,-1)],o=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||o===l;return{items:s,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}var Ro=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Fo=new H("localdb/listens"),_o=[],Bo=new it(_o);class Vo extends Ut.cp{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const Uo=new Vo;function Ho(){return Bo.pipe(_e((e=>e!==_o)))}function qo(e,t,r){const n=Math.min(e/2,240);return t=Math.floor(t/1e3),(r=Math.floor(r/1e3))-t>n}function Yo(e){return Ro(this,void 0,void 0,(function*(){try{e.length>0&&(yield Uo.items.bulkPut(e))}catch(e){Fo.error(e)}}))}function Ko(e,t=30){return Math.round(e.playedAt/t)}function Wo(e,t,r=5){const n=t.playedAt,i=n-r,a=n+t.duration+r;for(const r of e){if(r.playedAt<i)return;if(r.playedAt>i&&r.playedAt<a&&Qo(t,r,.5))return r}}function Go(e,t){const r=Jo();return function(e,t,r=5){const n=t.playedAt;if(n)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<n)return;const s=e[i],o=s.playedAt-r,l=s.playedAt+s.duration+r;if(n>o&&n<l&&Qo(s,t,.75))return s}}(r,e,t)||ol(r,e)}function Jo(){return Bo.getValue()}function Qo(e,t,r){return T(e.title,t.title,r)}function Xo(e){return Ro(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,r=Math.floor(Date.now()/1e3)-1209600,n=yield Uo.items.where(t).equals(0).toArray();yield Yo(n.filter((e=>e.playedAt<r)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}Ro(void 0,void 0,void 0,(function*(){try{yield Xo("lastfm"),yield Xo("listenbrainz")}catch(e){Fo.error(e)}(0,Ut.k7)((()=>Uo.items.orderBy("playedAt").reverse().toArray())).subscribe(Bo)}));const Zo=new Ne,el=new Ne,tl=new Ne;var rl=r(1416),nl=r.n(rl);const il=new J("lookup"),al={get preferPersonalMedia(){return il.getBoolean("preferPersonalMedia")},set preferPersonalMedia(e){il.setBoolean("preferPersonalMedia",e)}},sl=/\s*[\s[({](with\s|featuring\s|feat[\s.]+|ft[\s.]+).+$/i;function ol(e,t,r=[],n){const{artist:i,title:a}=kl(t);if(!i||!a)return;let s=ll(e,t,r);return al.preferPersonalMedia&&(s=S(s,(e=>{const t=Xf(e);return!!t&&rp(t)}))),n&&(s=S(s,(e=>e.src.startsWith(`${n}:`)))),s[0]}function ll(e,t,r,n){let i=[];return r.length>0&&(i=e.filter((e=>e.isrc&&r.includes(e.isrc)))),i=0===i.length?e.filter((e=>ul(e,t))):S(i,(e=>ul(e,t))),0===i.length&&(i=e.filter((e=>cl(e,t,!0,!0)))),n||(0===i.length&&(i=e.filter((e=>cl(e,t,!0,!1)))),0===i.length&&(i=e.filter((e=>cl(e,t,!1,!1))))),i=S(i,(e=>pl(e,t))),i=S(i,(e=>pl(e,t)&&e.track===t.track)),i}function cl(e,t,r,n){return!(!function(e,t,r){const n=t.title;return!!n&&(!!gl(n,e.title)||(r?hl(e,t,!0):!!fl(e,e.title,n)||(!!fl(e,yl(e.title),yl(n))||hl(e,t,!1))))}(e,t,r)||!dl(e,t,n))||!(n||r||!function(e,t){return!(!dl(e,t,!0)||!vl(e,t))||(!(!dl(e,t,!1)||!vl(e,t))||!!T(bl(e),bl(t)))}(e,t))}function ul(e,t){return!!(t.src===e.src||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid||t.track_mbid&&t.track_mbid===e.track_mbid)}function dl(e,t,r){var n;const i=null===(n=t.artists)||void 0===n?void 0:n[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const s=a[0];if(!s)return!1;if(gl(i,s))return!0;if(r)return!1;if(gl(El(i),El(s)))return!0;if(gl(xl(i),xl(s)))return!0;const o=t.albumArtist;return!!(o&&gl(El(o),El(s))||gl(xl(i),e.albumArtist)||function(e,t){const r=ml(t.artists),n=ml(e.artists);return(n.length>1||r.length>1)&&r.filter((e=>n.find((t=>gl(El(e),El(t)))))).length>0}(e,t)||function(e,t){var r,n;const i=El((null===(r=t.artists)||void 0===r?void 0:r[0])||""),a=El((null===(n=e.artists)||void 0===n?void 0:n[0])||""),[s,o]=i.length>a.length?[i,a]:[a,i];return!!(wl(s,`(${o})`)||wl(s,`[${o}]`)||wl(s,`{${o}}`))}(e,t))}function ml(e){return e.join("|").split(/\s*[,;&|/x×]\s*/)}function hl(e,t,r){if(!pl(e,t))return!1;if(e.track!==t.track)return!1;const n=El(e.title),i=El(t.title);return r?gl(n,i):!(!n.startsWith(i)&&!i.startsWith(n))||T(n,i,.75)}function fl(e,t,r){if(t=El(t),gl(r=El(r),t))return!0;const[,...n]=e.artists||[];if(n.length>0){const e=n.length>1?` & ${n.pop()}`:"";if(gl(r,`${t} (feat. ${n.join(", ")}${e})`))return!0}return!(!sl.test(r)||!gl(xl(r),t))||!(!sl.test(e.title)||!gl(r,xl(t)))}function pl(e,t){return!(!e.album||!t.album)&&(!(!t.release_mbid||t.release_mbid!==e.release_mbid)||gl(El(t.album),El(e.album)))}function yl(e){return(e=(e=e.replace(/\s*\((19|20)\d\d(\sDigital)?\sRemaster\)$/gi,"")).replace(/\s*\((Album|Single)(\s+Version)?\)$/gi,"")).replace(/\s*-\s*(Album|Single)(\s+Version)?$/gi,"")}function vl(e,t){return T(El(t.title,!0).toLowerCase(),El(e.title,!0).toLowerCase())}function bl(e){const{artist:t,title:r}=kl(e);return`${El(t,!0)}-${El(r,!0)}`.toLowerCase()}function gl(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function wl(e,t=""){const r=e.length-t.length;for(let n=0;n<=r;n++)if(gl(e.substring(n,n+t.length),t))return!0;return!1}function El(e,t){let r=nl()(e).replace(/\s\s+/g," ").trim();return t&&(r=r.replace(/[^\w\s]/g,"")),r}function kl(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function xl(e){return e.replace(sl,"")}var Sl,Tl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Pl=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const Al=new H("lookup");class Il{constructor(e){this.item=e,this.controller=new AbortController,Sl.set(this,void 0),Il.current&&Il.current.cancel(),Il.current=this}get cancelled(){return this.signal.aborted}get promise(){return Pl(this,Sl,"f")}cancel(){this.controller.abort("Cancelled")}find(){return Tl(this,void 0,void 0,(function*(){const e=this.item;let t;!function(e){Zo.next({lookupItem:e})}(e);try{(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)})(this,Sl,this.findItem(e),"f"),t=yield Pl(this,Sl,"f"),t&&([Il.lastFoundServiceId]=t.src.split(":"))}catch(e){this.cancelled||Al.error(e)}return!t&&this.cancelled?function(e){tl.next({lookupItem:e})}(e):function(e,t){el.next({lookupItem:e,foundItem:t?x(t,e):void 0})}(e,t),Il.current===this&&(Il.current=null),t}))}get signal(){return this.controller.signal}findItem(e){return Tl(this,void 0,void 0,(function*(){const t=Go(e);if(t&&Hf(t))return t;const{link:r}=e,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["link"]),i=r&&Zf(r)?Object.assign(Object.assign({},n),r):void 0;if(i&&Hf(i))return i;let a=[],s=[];const{artist:o,title:l}=kl(e);if(o&&l){s=yield this.getISRCs(e);const t=Xf(r);if(t&&(a=yield this.serviceLookup(t,e,s),0===a.length&&("plex"===t.id||"tidal"===t.id))){const t=Qf("plex-tidal");t&&(a=yield this.serviceLookup(t,e,s))}0===a.length&&s.length>0&&(a=yield this.lookupByISRC(s)),0===a.length&&(a=yield this.multiServiceLookup(e,s,t))}return ol(a,e,s,Il.lastFoundServiceId)||t||i}))}serviceLookup(e,t,r,n){return Tl(this,void 0,void 0,(function*(){this.throwIfCancelled();try{if(e.lookup&&e.isLoggedIn()){const{artist:i,title:a}=kl(t),s=e=>String(e).replace(/[([{}].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," ");return ll(yield e.lookup(s(t.albumArtist||xl(i)),s(xl(a)),10,2e3),t,r,n)}}catch(e){Al.error(e)}return[]}))}multiServiceLookup(e,t,r){return Tl(this,void 0,void 0,(function*(){this.throwIfCancelled();const n=Yf().filter((e=>e!==r&&e.isLoggedIn()));return 0===n.length?[]:(yield Promise.all([...n.map((r=>this.serviceLookup(r,e,t)))])).flat()}))}lookupByISRC(e){return Tl(this,void 0,void 0,(function*(){this.throwIfCancelled();const t=this.getISRCServices();return 0===t.length?[]:(yield Promise.all([...t.map((t=>t.lookupByISRC(e,10,2e3)))])).flat()}))}getISRCs(e){return Tl(this,void 0,void 0,(function*(){if(e.isrc)return[e.isrc];if(this.getISRCServices().length>0)try{return yield Hl.getISRCs(e,this.signal)}catch(e){Al.error(e)}return[]}))}getISRCServices(){return Yf().filter((e=>!!e.lookupByISRC&&e.isLoggedIn()))}throwIfCancelled(){if(this.cancelled)throw Error(this.signal.reason)}}Sl=new WeakMap,Il.current=null,Il.lastFoundServiceId="";class Cl extends Hi{constructor(e){super((()=>{return t=this,r=void 0,i=function*(){const t=yield Hl.get(`release/${e}`,{inc:"recordings+artist-credits+isrcs"}),{media:[{tracks:r=[]}={}]=[]}=t;return r.map((e=>Vl(t,e)))},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}))}}const Ml={CD:1,SACD:2,MiniDisc:3,DAT:4,"Digital Media":5,DCC:6,HDCD:7,"USB Flash Drive":8,slotMusic:9,UMD:10,"CD-R":11,"8cm CD":12,"Blu-spec CD":13,"SHM-CD":14,HQCD:15,"Hybrid SACD":16,"CD+G":17,"8cm CD+G":18,"Enhanced CD":19,"Data CD":20,"DTS CD":21,Playbutton:22,"Music Card":23,VinylDisc:24,'3.5" Floppy Disk':25,"SHM-SACD":26,CED:27,"Copy Control CD":28,"SD Card":29,"Hybrid SACD (CD layer)":30,"Hybrid SACD (SACD layer)":31,PlayTape:32,HiPac:33,"Floppy Disk":34,"Zip Disk":35,"VinylDisc (CD side)":36};var Ol=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const $l="https://musicbrainz.org/ws/2",Nl=new class{constructor(e=1e3,t=1/0){this.period=e,this.maxRequests=t,this.requests=[],this.currentRequest$=new Ne,this.lastFetchTime=0,this.timerId=void 0}get size(){return this.requests.length}fetch(e){return t=this,r=void 0,i=function*(){const t=Le(this.currentRequest$.pipe(_e((t=>t===e)),et((e=>{var t;if(null===(t=e.signal)||void 0===t?void 0:t.aborted)throw Error(e.signal.reason);{this.lastFetchTime=Date.now();const t=[],{signal:r,timeout:n}=e;r&&t.push(r),n&&t.push(AbortSignal.timeout(n));const i=function(e){const t=new AbortController;for(const r of e){if(r.aborted)return t.abort(),r;r.addEventListener("abort",(()=>t.abort(r.reason)),{signal:t.signal})}return t.signal}(t);return fetch(new Request(e.url,Object.assign(Object.assign({},e),{signal:i})))}}))));return this.addRequest(e),t},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}addRequest(e){if(this.flush(),this.size>=this.maxRequests)throw Error("Too many requests");this.requests.push(e),this.startTimer()}startTimer(){if(!this.timerId){const e=Date.now()-this.lastFetchTime;if(e<this.period){const t=this.period-e;this.timerId=setTimeout((()=>{this.timerId=void 0,this.nextRequest()}),t)}else this.nextRequest()}}nextRequest(){this.flush();const e=this.requests.shift();e&&(this.currentRequest$.next(e),this.size>0&&this.startTimer())}flush(){const[e,t]=m(this.requests,(e=>{var t;return null===(t=e.signal)||void 0===t?void 0:t.aborted}));for(const t of e)this.currentRequest$.next(t);this.requests.length=0,this.requests.push(...t)}}(1200,5);function zl(e,t,r){return Ol(this,void 0,void 0,(function*(){const n={signal:r,timeout:2e3},i=Array.isArray(e),a=(i?e:[e]).map(((e,t)=>({item:e,index:t}))),s=[],o=[],l=[],c=[],u=[];for(const e of a){const{recording_mbid:r,release_mbid:n,track_mbid:i,isrc:d}=e.item;r&&n&&i&&d?s.push(e):i?o.push(e):r&&n?l.push(e):t?s.push(e):r?l.push(e):d?u.push(e):n&&1===a.length?c.push(e):s.push(e)}const d=(yield Promise.all([Promise.resolve(s),jl(o,n),Ll(l,n),Rl(c,n),Dl(u,n)])).flat(),m=a.map((e=>d.find((t=>t.index===e.index)).item));return i?m:m[0]}))}function jl(e,t){return Ol(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield _l("/recording",{query:e.map((e=>`tid:${e.item.track_mbid}`)).join(" OR ")},t),n=Bl(r);return e.map((e=>{const{item:t,index:r}=e,i=t.track_mbid,a=n.filter((e=>e.track_mbid===i)),s=ol(a,t);if(s){const{artist_mbids:e,release_mbid:n,recording_mbid:a}=s,o=Fl({artist_mbids:e,release_mbid:n,recording_mbid:a},t,s);return Kn({match:e=>e.track_mbid===i,values:o}),{item:Object.assign(Object.assign({},t),o),index:r}}return e}))}))}function Ll(e,t){return Ol(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield _l("/recording",{query:e.map((e=>`rid:${e.item.recording_mbid}`)).join(" OR ")},t),n=Bl(r);return e.map((e=>{const{item:t,index:r}=e,i=t.recording_mbid,a=t.release_mbid;let s=n.filter((e=>e.recording_mbid===i));s=S(s,(e=>e.release_mbid===a));const o=ol(s,t);if(o){const{artist_mbids:e,release_mbid:n,track_mbid:a}=o,s=Fl({artist_mbids:e,release_mbid:n,track_mbid:a},t,o);return Kn({match:e=>e.recording_mbid===i,values:s}),{item:Object.assign(Object.assign({},t),s),index:r}}return e}))}))}function Dl(e,t){return Ol(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield _l("/recording",{query:e.map((e=>`isrc:${e.item.isrc}`)).join(" OR ")},t);return e.map((e=>{const{item:t,index:n}=e,i=t.isrc,a=ol(Bl(r.filter((e=>{var t;return null===(t=e.isrcs)||void 0===t?void 0:t.includes(i)}))),t);if(a){const{recording_mbid:e,artist_mbids:r,release_mbid:s,track_mbid:o}=a,l=Fl({recording_mbid:e,artist_mbids:r,release_mbid:s,track_mbid:o},t,a);return Kn({match:e=>e.isrc===i,values:l}),{item:Object.assign(Object.assign({},t),l),index:n}}return e}))}))}function Rl(e,t){return Ol(this,void 0,void 0,(function*(){if(1!==e.length)return e;const[r]=e,{item:n,index:i}=r,a=n.release_mbid,s=n.recording_mbid,o=n.src,l=new Cl(a),c=yield hi(l,t),u=s?c.find((e=>e.recording_mbid===s)):ol(c,n);if(u){const{recording_mbid:e,artist_mbids:t,track_mbid:r}=u,s=Fl({recording_mbid:e,artist_mbids:t,track_mbid:r},n,u);return Kn({match:t=>t.release_mbid===a&&(e?t.recording_mbid===e:t.src===o),values:s}),[{item:Object.assign(Object.assign({},n),s),index:i}]}return e}))}function Fl(e,t,r){let{duration:n,track:i,year:a,isrc:s,albumArtist:o}=t;return n=n||r.duration,i=i||r.track,a=a||r.year,s=s||r.isrc,o=o||r.albumArtist,Object.assign(Object.assign({},e),{duration:n,track:i,year:a,isrc:s,albumArtist:o})}function _l(e,t={},r={}){return Ol(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`;const n=new Request(`${$l}/${e}`,Object.assign(Object.assign({},r),{method:"GET",headers:{"User-Agent":"ampcast/0.9.5 ( rekkyrosso@gmail.com )"}})),i=yield Nl.fetch(n);if(!i.ok)throw i;return i.json()}))}function Bl(e){let t=[];for(const r of e){const e=r.releases||[];for(const n of e){const e=n.status||"",i=n.country||"",a=n.media||[];for(const s of a){const a=s.format||"",o=s.track||[];for(const s of o){s.recording=r;const o=Vl(n,s,{status:e,country:i,format:a});t.push(o)}}}}return t=S(t,(e=>"Official"===e.musicBrainz.status)),t.sort(((e,t)=>(Ml[e.musicBrainz.format]||99)-(Ml[t.musicBrainz.format]||99))),t}function Vl(e,t,r){var n;const i=t.recording,[a]=Ul(e)||[],s=Ul(i);return{itemType:ti.Media,mediaType:ni.Audio,src:`musicbrainz:track:${t.id}`,externalUrl:`https://musicbrainz.org/recording/${i.id}`,title:t.title,artists:null==s?void 0:s.map((e=>e.name)),album:e.title,albumArtist:null==a?void 0:a.name,duration:t.length/1e3||0,track:Number(t.number),recording_mbid:i.id,track_mbid:t.id,release_mbid:e.id,artist_mbids:null==s?void 0:s.map((e=>e.id)),isrc:null===(n=i.isrcs)||void 0===n?void 0:n[0],year:new Date(i["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,musicBrainz:r}}function Ul(e){var t;return null===(t=e["artist-credit"])||void 0===t?void 0:t.map((e=>e.artist))}const Hl={get:_l,getISRCs:function(e,t){return Ol(this,void 0,void 0,(function*(){const{recording_mbid:r,release_mbid:n,track_mbid:i}=e,a={signal:t,timeout:2e3};if(r){const{isrcs:e=[]}=yield _l(`/recording/${r}`,{inc:"isrcs"},a);return e}if(i){const{recordings:[{isrcs:e=[]}={}]}=yield _l("/recording",{query:`tid:${i}`},a);return e}if(n){const t=new Cl(n),r=ol(yield hi(t,a),e);return(null==r?void 0:r.isrc)?[r.isrc]:[]}return[]}))},addMetadata:zl},ql=new J("listenbrainz"),Yl={get token(){return ql.getString("token")},set token(e){ql.setString("token",e)},get userId(){return ql.getString("userId")},set userId(e){ql.setString("userId",e)},get firstScrobbledAt(){return ql.getString("firstScrobbledAt")},set firstScrobbledAt(e){ql.setString("firstScrobbledAt",e)},clear(){ql.clear()}};var Kl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Wl=new H("listenbrainzApi"),Gl=new class{constructor(){this.apiHost="https://api.listenbrainz.org/1",this.webHost="https://musicbrainz.org",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}store(e,t){return Kl(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const r="feedback/recording-feedback",n={score:t?1:0};e.recording_msid&&(n.recording_msid=e.recording_msid),e.recording_mbid&&(n.recording_mbid=e.recording_mbid),yield this.post(r,n)}}))}addUserData(e){return Kl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getInLibrary(e);Kn(e.map(((e,r)=>({match:t=>hu(t,e),values:{inLibrary:t[r]}}))))}}))}addToPlaylist(e,t){return Kl(this,void 0,void 0,(function*(){t=(t=yield zl(t,!1)).filter((e=>e.recording_mbid));const[,,r]=e.src.split(":");return this.post(`playlist/${r}/item/add`,{playlist:{track:t.map((e=>this.createTrack(e)))}})}))}createPlaylist(e,{description:t="",isPublic:r,items:n=[]}={}){return Kl(this,void 0,void 0,(function*(){const i=Yl.userId;return n=(n=yield zl(n,!1)).filter((e=>e.recording_mbid)),this.post("playlist/create",{playlist:{extension:{"https://musicbrainz.org/doc/jspf#playlist":{creator:i,public:r}},creator:i,title:e,annotation:t,track:n.map((e=>this.createTrack(e)))}})}))}createTrack(e){var t,r;const n=this.webHost,i=e.recording_mbid,a=e.release_mbid||"";return{title:e.title,id:i,identifier:i?`${n}/recording/${i}`:"",creator:null===(t=e.artists)||void 0===t?void 0:t.join(" & "),trackNum:e.track,duration:e.duration,extension:{"https://musicbrainz.org/doc/jspf#track":{artist_identifiers:(null===(r=e.artist_mbids)||void 0===r?void 0:r.map((e=>`${n}/artist/${e}`)))||[],release_identifier:a?`${n}/release/${a}`:""}},album:e.album||""}}getInLibrary(e){return Kl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,r]=m(e,(e=>!!e.recording_mbid)),n=t.map((e=>e.recording_mbid)),i=r.map((e=>e.recording_msid)),a={};n.length>0&&(a.recording_mbids=n),i.length>0&&(a.recording_msids=i);const{feedback:s}=yield this.post(`feedback/user/${Yl.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=s.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return Kl(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${Yl.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return Kl(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${Yl.userId}/listen-count`);return e}))}getListens(e){return Kl(this,void 0,void 0,(function*(){return yield this.get(`user/${Yl.userId}/listens`,e)}))}scrobble(e){return Kl(this,void 0,void 0,(function*(){e.length>0&&(Wl.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return Kl(this,void 0,void 0,(function*(){Wl.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){Wl.log('Failed to update "now playing":',{item:e}),Wl.error(t)}}))}get(e,t,r){return Kl(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const n=yield this.fetch(e,{method:"GET"},r);if(!n.ok||204===n.status)throw n;return n.json()}))}post(e,t){return Kl(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return(yield this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:r},!0)).json()}))}fetch(e,t,r=!1){return Kl(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),r&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${Yl.token}`})),e.startsWith("/")&&(e=e.slice(1));const n=yield window.fetch(`${this.apiHost}/${e}`,t);if(!n.ok)throw n;const i=n.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&Wl.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),n}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.9.5",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[r]=e.src.split(":");switch(r){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"tidal":case"plex-tidal":t.music_service="tidal.com";break;case"blob":case"file":t.music_service_name="Local file";break;default:{const e=Qf(r);e&&(t.music_service_name=e.name)}}const n={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(n.release_name=e.album),n}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},Jl=Gl;var Ql=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Xl(e){var{href:t,className:r="",children:i=t}=e,a=Ql(e,["href","className","children"]);return n.createElement("a",Object.assign({},a,{className:`external-link ${r}`,href:t,target:"_blank",rel:"noopener"}),n.createElement("span",{className:"external-link-text"},i),n.createElement(rt,{name:"link"}))}var Zl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function ec(e){const t=du.id,[r,i]=(0,n.useState)(!1),[a,s]=(0,n.useState)(""),o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u="https://listenbrainz.org/profile/",d=n.createElement(kr,{icon:du.icon,text:`Log in to ${du.name}`}),m=(0,n.useCallback)((()=>Zl(this,void 0,void 0,(function*(){try{const e=l.current.value,t=c.current.value;Yl.userId=e,i(!0),s("Connecting…");const r=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!r.ok)throw r;const{valid:n,user_name:a}=yield r.json();if(!n)throw Error("Invalid token");if(a!==e)throw Error("Token not valid for this user");s(""),o.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e),s(e.message||e.statusText||"Error")}i(!1)}))),[]),h=(0,n.useCallback)((e=>{e.preventDefault(),m()}),[m]);return n.createElement(cr,Object.assign({},e,{className:"listenbrainz-login-dialog login-dialog",title:d,ref:o}),n.createElement("form",{id:`${t}-login`,method:"dialog",onSubmit:h},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-username`},"User:"),n.createElement("input",{type:"text",id:`${t}-username`,name:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:l})),n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-token`},"Token:"),n.createElement("input",{type:"password",id:`${t}-token`,name:`${t}-token`,required:!0,ref:c}))),n.createElement("p",{className:"message "+(r?"":"error")},a),n.createElement("p",{className:"listenbrainz-link service-link"},n.createElement(Xl,{href:u},n.createElement(rt,{name:"listenbrainz"}),u)),n.createElement(yr,{submitText:"Login"})))}var tc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const rc=new H("listenbrainzAuth"),nc=new it("");function ic(){return nc.pipe(Vn())}function ac(){return""!==nc.getValue()}function sc(){return ic().pipe(Be((e=>""!==e)),Vn())}ic().pipe(_e((e=>!!e)),et((()=>function(){return tc(this,void 0,void 0,(function*(){try{yield Jl.getListenCount()}catch(e){401===e.status?(Yl.clear(),nc.next("")):rc.error(e)}}))}()))).subscribe(rc),nc.next(Yl.token);var oc=r(4556),lc=r.n(oc);const cc="https://musicbrainz.org",uc=new J("youtube"),dc={get apiKey(){return wi||uc.getString("apiKey")},set apiKey(e){uc.setString("apiKey",e)},get clientId(){return Ei||uc.getString("clientId")},set clientId(e){uc.setString("clientId",e)},get connectedAt(){return uc.getNumber("connectedAt")},set connectedAt(e){uc.setNumber("connectedAt",e)},get enabled(){return ot()()||uc.getBoolean("enabled")}};var mc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const hc=new H("youtubeAuth"),fc="https://www.googleapis.com/auth/youtube.readonly",pc=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],yc=new it(""),vc=new Ne;function bc(){return!!dc.connectedAt}function gc(){return""!==Ec()}function wc(){return yc.pipe(Vn()).pipe(Be((e=>""!==e)),Vn())}function Ec(){return yc.getValue()}function kc(){return mc(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}function xc(){return mc(this,void 0,void 0,(function*(){const e=yield kc();return e.client?e.client:new Promise(((t,r)=>{e.load("client",{callback:()=>{const{apiKey:n,clientId:i}=dc,a={apiKey:n,clientId:i,discoveryDocs:pc,scope:fc};e.client.init(a).then((()=>t(e.client)),r)},onerror:r})}))}))}function Sc(){var e,t;return mc(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}wc().pipe(Nn((e=>!e))).subscribe((e=>dc.connectedAt=e?Date.now():0)),wc().pipe(_e((e=>e)),Di(1),et((()=>Promise.all([kc(),xc()]))),at((([e,t])=>{e.load("client:auth2",(()=>{e.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=t.getToken();yc.next((null==e?void 0:e.access_token)||"")}else yc.next("")}))}))}))).subscribe(hc),dc.enabled&&bc()&&tn(xc()).pipe(Be((e=>e.getToken())),at((e=>yc.next((null==e?void 0:e.access_token)||""))),ln(vc)).subscribe(hc);var Tc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Pc=new H("youtubeCache");class Ac extends Ut.cp{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return Tc(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){Pc.error(e)}}))}fetch(e){return Tc(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){Pc.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const Ic=new Ac;var Cc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Mc=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};class Oc{constructor(e,t,r){this.defaultConfig={pageSize:Oc.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),r),this.pager=new Ui((()=>Cc(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},r){return Cc(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,r,n;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:ti.Playlist,externalUrl:`${zc}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),trackCount:null===(n=e.contentDetails)||void 0===n?void 0:n.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistItemsPager(e.id),isPinned:Qi.isPinned(i)}}createMediaItem(e){var t,r,n,i,a;return{itemType:ti.Media,mediaType:ni.Video,playbackType:jn.IFrame,src:`youtube:video:${e.id}`,externalUrl:_c(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(r=e.contentDetails)||void 0===r?void 0:r.duration),thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${zc}/channel/${e}`}:void 0}createPlaylistItemsPager(e){return new Oc("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,r=0,n=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(r)+Number(n)||0}fetchPage(e,t){return Cc(this,void 0,void 0,(function*(){const r=this.createCacheKey(e,t,this.pageNumber),n=yield this.getFromCache(r),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),n),{pageInfo:s,nextPageToken:o}=a,l=Mc(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,r),u=null==s?void 0:s.totalResults,d=!o;return this.nextPageToken=o,this.pageNumber++,yield this.saveToCache(r,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return Cc(this,void 0,void 0,(function*(){const r=`${t}/videos`,n=yield this.getFromCache(r),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Oc.videoFields}`},n);return yield this.saveToCache(r,i),i.items||[]}))}fetch(e,t,r){return Cc(this,void 0,void 0,(function*(){const n=yield xc(),i=(null==r?void 0:r.etag)?{"If-None-Match":r.etag}:void 0,{result:a,status:s,statusText:o}=yield n.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:i});if(a)return a;if(304===s&&r)return r;throw Error(o||`Error (${s})`)}))}getFromCache(e){return Cc(this,void 0,void 0,(function*(){return Ic.fetch(e)}))}saveToCache(e,t){return Cc(this,void 0,void 0,(function*(){this.config.noCache||(yield Ic.store(e,t))}))}createCacheKey(e,t,r){const{fields:n}=t,i=Mc(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${r}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Oc.minPageSize=5,Oc.maxPageSize=50,Oc.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Oc.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const $c=Oc;var Nc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const zc="https://www.youtube.com",jc={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},Lc={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:ti.Media,mediaType:ni.Video,lockActionsStore:!0,layout:jc,defaultHidden:!0,search:()=>new $c("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:$c.videoFields})},Dc={id:"youtube/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,mediaType:ni.Video,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Owner","LastPlayed"]},search(){return new Hi((()=>Nc(this,void 0,void 0,(function*(){return f(Jo().filter((e=>e.src.startsWith("youtube:"))),"src")}))))}},Rc={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,secondaryLayout:jc,search:()=>new $c("/playlists",{mine:"true",part:"snippet,contentDetails",fields:$c.playlistFields})};function Fc(e=""){if(e.startsWith("youtube:"))return e;const t=lc()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function _c(e){return`${zc}/watch?v=${e}`}function Bc(e){return Nc(this,void 0,void 0,(function*(){const t=_c(e),r=yield fetch(`${zc}/oembed?url=${t}&format=json`);if(!r.ok)switch(r.status){case 401:throw Error("Embedding prevented by channel owner");case 403:throw Error("Private video");case 404:throw Error("Video does not exist");default:throw Error(`${r.statusText} (${r.status})`)}const n=yield r.json();return{itemType:ti.Media,mediaType:ni.Video,playbackType:jn.IFrame,src:`youtube:video:${e}`,externalUrl:t,title:n.title,aspectRatio:n.width/n.height||16/9,duration:0,track:0,thumbnails:[{url:n.thumbnail_url,width:n.thumbnail_width,height:n.thumbnail_height}],owner:{name:n.author_name,url:n.author_url},playedAt:0}}))}const Vc={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",serviceType:$n.PublicMedia,primaryMediaType:ni.Video,get disabled(){return!dc.enabled},defaultHidden:!0,defaultNoScrobble:!0,internetRequired:!0,restrictedAccess:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"search",itemType:ti.Media,mediaType:ni.Video,layout:jc,searchable:!0,search:({q:e=""}={})=>e?new $c("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:$c.maxPageSize,noCache:!0}):new pi}],sources:[Lc,Dc,Rc],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},jc),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new $c("/playlists",{id:t,part:"snippet,contentDetails",fields:$c.playlistFields})}}},getPlaybackType:function(){return Nc(this,void 0,void 0,(function*(){return jn.IFrame}))},observeIsLoggedIn:wc,isConnected:bc,isLoggedIn:gc,login:function(){return mc(this,void 0,void 0,(function*(){if(!gc()){hc.log("connect");try{const e=yield function(){return mc(this,void 0,void 0,(function*(){const e=google.accounts.oauth2;return new Promise(((t,r)=>{const n=e.initTokenClient({client_id:dc.clientId,scope:fc,prompt:"",callback:e=>{e.error?r(e.error_description):t(e.access_token)},error_callback:e=>{r(e.message)}});n.requestAccessToken()}))}))}();yc.next(e)}catch(e){hc.error(e)}}}))},logout:function(){return mc(this,void 0,void 0,(function*(){hc.log("disconnect"),vc.next(void 0);try{const e=Ec();e&&(yield Sc()).revoke(e,(()=>yc.next("")))}catch(e){}dc.connectedAt=0,yc.next("")}))}},Uc=Vc;const Hc=new H("ListenBrainzHistoryPager");class qc{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new it(-1),this.nextPageParams=void 0,this.pager=new Ui(((t=50)=>{return r=this,n=void 0,a=function*(){try{const{payload:r}=yield Jl.get(`user/${Yl.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),n=r.listens,i=this.createItems(n),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:n.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(Nn((e=>-1===e)),Vn())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>Jl.addUserData(e)))).subscribe(Hc)),this.fetchListenCount&&this.subscriptions.add(tn(Jl.getListenCount()).pipe(at((e=>this.size$.next(e)))).subscribe(Hc)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,r,n;const i=e.track_metadata,a=i.additional_info,s=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,o=this.getPlayableSrc(a)||"";return{itemType:ti.Media,mediaType:o.startsWith("youtube:")?ni.Video:ni.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:s?`${cc}/recording/${s}`:void 0,recording_mbid:s,recording_msid:e.recording_msid||void 0,release_mbid:null===(r=i.mbid_mapping)||void 0===r?void 0:r.release_mbid,artist_mbids:null===(n=i.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:e.listened_at,link:{src:o,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=lc()(e);if(t)return _c(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const r=e.origin_url;if(r){if(r.includes("apple.com"))return this.getAppleSrc(r);if(r.includes("spotify.com"))return this.getSpotifySrc(r);if(r.includes("tidal.com"))return"tidal:";if(/youtu\.?be/.test(r))return Fc(r)}const n=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i=Yf().map((e=>e.id));for(const e of i)if(n.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}qc.maxPageSize=100;const Yc=qc;class Kc{constructor(){let e=0;this.pager=new Ui(((t=50)=>{return r=this,n=void 0,a=function*(){try{const r=yield Jl.get(`feedback/user/${Yl.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const n=this.createItems(r.feedback),i=r.total_count;return{items:n,total:i,atEnd:r.offset+n.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e))).filter(l)}createItem(e){var t,r;const n=e.track_metadata;if(!n)return;const i=n.additional_info,a=e.recording_mbid;return{itemType:ti.Media,mediaType:ni.Audio,src:`listenbrainz:track:${xa()}`,title:n.track_name,artists:n.artist_name?[n.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:n.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${cc}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=n.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(r=n.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:0,inLibrary:!0}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Kc.maxPageSize=100;const Wc=Kc;const Gc=new H("ListenBrainzPlaylistItemsPager");class Jc{constructor(e){let t=0;this.pager=new Ui(((r=100)=>{return n=this,i=void 0,s=function*(){const{playlist:n}=yield Jl.get(`playlist/${e}`,{offset:t,count:r},!0);t+=r;const i=n.track.map((e=>this.createMediaItem(e)));return{items:i,total:i.length,atEnd:!0}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}));var n,i,a,s}),{pageSize:100})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>Jl.addUserData(e)))).subscribe(Gc)))}createMediaItem(e){var t,r,n;const i=e.identifier.split("/").pop(),a=null===(t=e.extension)||void 0===t?void 0:t["https://musicbrainz.org/doc/jspf#track"],s=null==a?void 0:a.additional_metadata;return{itemType:ti.Media,mediaType:ni.Audio,src:`listenbrainz:track:${i}`,externalUrl:e.identifier,title:e.title,artists:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_credit_name)):e.creator?[e.creator]:void 0,duration:0,recording_mbid:i,release_mbid:null===(r=null==a?void 0:a.additional_metadata)||void 0===r?void 0:r.caa_release_mbid,artist_mbids:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_mbid)):null===(n=null==a?void 0:a.artist_identifiers)||void 0===n?void 0:n.map((e=>e.split("/").pop())),playedAt:0}}}class Qc{constructor(e){let t=0;this.pager=new Ui(((r=50)=>{return n=this,i=void 0,s=function*(){const n=yield Jl.get(e,{offset:t,count:r},!0);t+=r;const i=this.createItems(n.playlists),a=n.playlist_count;return{items:i,total:a,atEnd:n.offset+i.length>=a}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}));var n,i,a,s}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((({playlist:e})=>this.createItem(e)))}createItem(e){const t=e.identifier.split("/").pop();return{itemType:ti.Playlist,src:`listenbrainz:playlist:${t}`,title:e.title,description:this.getTextFromHtml(e.annotation),externalUrl:e.identifier,owner:{name:e.creator},pager:new Jc(t)}}getTextFromHtml(e){if(/<\/?p>/i.test(e)){const t=document.createElement("div");return t.innerHTML=e||"",Array.from(t.querySelectorAll("p")).map((e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.replace(/\s+/g," "))||""})).join("\n")}return P(e)}}const Xc=new H("ListenBrainzStatsPager");class Zc{constructor(e,t){let r=0;this.pager=new Ui(((n=50)=>{return i=this,a=void 0,o=function*(){try{const i=yield Jl.get(e,Object.assign(Object.assign({},t),{offset:r,count:n}));return r+=n,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function n(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(r,n)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(Be((e=>e.filter((e=>e.itemType===ti.Media)))),_e((e=>e.length>0)),et((e=>Jl.addUserData(e)))).subscribe(Xc)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,r=t.recordings.map((e=>this.createMediaItem(e))),n=t.total_recording_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isReleasesResponse(e)){const t=e.payload,r=t.releases.map((e=>this.createMediaAlbum(e))),n=t.total_release_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isArtistsResponse(e)){const t=e.payload,r=t.artists.map((e=>this.createMediaArtist(e))),n=t.total_artist_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}throw Error("Unknown response")}createMediaArtist(e){var t;const r=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:ti.Artist,src:`listenbrainz:artist:${xa()}`,externalUrl:r?`${cc}/artist/${r}`:void 0,title:e.artist_name,artist_mbid:r,playCount:e.listen_count,pager:new pi}}createMediaAlbum(e){const t=e.release_mbid||void 0,r={itemType:ti.Album,src:`listenbrainz:album:${xa()}`,externalUrl:t?`${cc}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},r),{pager:t?new Cl(t):new pi})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:ti.Media,mediaType:ni.Audio,src:`listenbrainz:track:${xa()}`,externalUrl:t?`${cc}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}var eu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const tu={view:"details",fields:["Index","Artist","Title"]},ru={id:"listenbrainz/history",title:"History",icon:"clock",itemType:ti.Media,search:({startAt:e=0}={})=>new Yc(e?{max_ts:e}:void 0)},nu={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,search:()=>new Yc},iu={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new Wc},au={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:ti.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new Zc(`stats/user/${Yl.userId}/recordings`,e)},su={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:ti.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new Zc(`stats/user/${Yl.userId}/releases`,e)},ou={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:ti.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:{view:"none"},search:e=>new Zc(`stats/user/${Yl.userId}/artists`,e)},lu={id:"listenbrainz/playlists",title:"My Playlists",icon:"playlist",itemType:ti.Playlist,secondaryLayout:tu,defaultHidden:!0,search:()=>new Qc(`user/${Yl.userId}/playlists`)},cu={id:"listenbrainz/recommendations",title:"Recommendations",icon:"playlist",itemType:ti.Playlist,secondaryLayout:tu,defaultHidden:!0,search:()=>new Qc(`user/${Yl.userId}/playlists/createdfor`)},uu={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",serviceType:$n.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[nu],sources:[au,su,ou,iu,ru,lu,cu],labels:{[Zn.AddToLibrary]:"Love on ListenBrainz",[Zn.RemoveFromLibrary]:"Unlove on ListenBrainz"},editablePlaylists:lu,addToPlaylist:function(e,t){return eu(this,void 0,void 0,(function*(){return Jl.addToPlaylist(e,t)}))},canRate:()=>!1,canStore:mu,compareForRating:hu,createPlaylist:function(e,t={}){return eu(this,void 0,void 0,(function*(){const{playlist_mbid:r}=yield Jl.createPlaylist(e,t);return{src:`listenbrainz:playlist:${r}`,title:e,itemType:ti.Playlist,pager:new pi}}))},store:function(e,t){return eu(this,void 0,void 0,(function*(){mu(e)&&(yield Jl.store(e,t))}))},observeIsLoggedIn:sc,isConnected:function(){return!!Yl.token},isLoggedIn:ac,login:function(){return tc(this,void 0,void 0,(function*(){if(!ac()){rc.log("connect");try{const e=yield function(){return Zl(this,void 0,void 0,(function*(){return dr(ec,!0)}))}();if(e){const{userId:t,token:r}=JSON.parse(e);Yl.userId=t,Yl.token=r,nc.next(r)}}catch(e){rc.error(e)}}}))},logout:function(){return tc(this,void 0,void 0,(function*(){rc.log("disconnect"),Yl.clear(),nc.next("")}))}},du=uu;function mu(e){return e.itemType===ti.Media&&!(!e.recording_mbid&&!e.recording_msid)}function hu(e,t){const[r]=e.src.split(":"),[n]=t.src.split(":");return r===n&&e.itemType===ti.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}const fu=new J("subsonic"),pu=new it(fu.getString("libraryId")),yu={get audioLibraries(){return this.libraries},get host(){return fu.getString("host")},set host(e){fu.setString("host",e)},get credentials(){return fu.getString("credentials")},set credentials(e){fu.setString("credentials",e)},get libraryId(){return fu.getString("libraryId")},set libraryId(e){fu.setString("libraryId",e),pu.next(e)},observeLibraryId:()=>pu.pipe(Vn()),get libraries(){var e;const t=fu.getJson("libraries",[]);return""!==(null===(e=t[0])||void 0===e?void 0:e.id)&&t.splice(0,0,{id:"",title:"(all)"}),t},set libraries(e){fu.setJson("libraries",e),e.find((e=>e.id===this.libraryId))||(this.libraryId="")},get userName(){return fu.getString("userName")},set userName(e){fu.setString("userName",e)},clear(){fu.removeItem("userName"),fu.removeItem("credentials")}},vu=yu;var bu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function gu(e,t,{host:r,credentials:n}=vu){return bu(this,void 0,void 0,(function*(){if(!n)throw Error("No subsonic credentials");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1));const i=yield fetch(`${r}/rest/${e}${e.includes("?")?"&":"?"}${n}`,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return a}))}function wu(e,t=vu){var r;return bu(this,void 0,void 0,(function*(){const n=yield gu("getAlbumList",t.libraryId?Object.assign(Object.assign({},e),{musicFolderId:t.libraryId}):e,t);return(null===(r=n.albumList.album)||void 0===r?void 0:r.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))}function Eu(e=vu){return bu(this,void 0,void 0,(function*(){return(yield gu("getArtists",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).artists.index.map((e=>e.artist)).flat()}))}function ku(){return bu(this,void 0,void 0,(function*(){const e=[];let t=10*Math.floor((new Date).getFullYear()/10);for(;t>=1930;)e.push({id:String(t),title:`${t}s`}),t-=10;return e}))}function xu(e,t){var r;return bu(this,void 0,void 0,(function*(){const n=yield gu("getGenres",void 0,t);return(null===(r=n.genres.genre)||void 0===r?void 0:r.map((({value:t,albumCount:r,songCount:n})=>{const i=e===ti.Album?r:n;return{id:t,title:`${t} (${i})`,count:i}})).filter((e=>e.count>0)).sort(((e,t)=>e.count===t.count?e.title.localeCompare(t.title):t.count-e.count)))||[]}))}function Su(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getMusicDirectory",{id:e},t)).directory}))}const Tu={addToPlaylist:function(e,t){return bu(this,void 0,void 0,(function*(){const r=u(t,300);for(const t of r){const r=new URLSearchParams({playlistId:e});t.forEach((e=>r.append("songIdToAdd",e))),yield gu(`updatePlaylist?${r}`)}}))},createPlaylist:function(e,t,r,n){return bu(this,void 0,void 0,(function*(){const{playlist:i}=yield gu("createPlaylist",{name:e}),a=u(n,300);for(const e of a){const n=new URLSearchParams({playlistId:i.id,comment:t,public:String(r)});e.forEach((e=>n.append("songIdToAdd",e))),yield gu(`updatePlaylist?${n}`)}return i}))},get:gu,getAlbum:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getAlbum",{id:e},t)).album}))},getAlbumInfo:function(e,t,r){return bu(this,void 0,void 0,(function*(){return(yield gu("getAlbumInfo"+(t?"":"2"),{id:e},r)).albumInfo}))},getAlbumTracks:function(e,t,r){return bu(this,void 0,void 0,(function*(){return t?(yield gu("getMusicDirectory",{id:e},r)).directory.child||[]:(yield gu("getAlbum",{id:e},r)).album.song||[]}))},getAlbumsByDecade:function(e,t,r,n){return bu(this,void 0,void 0,(function*(){const i=Number(e);return wu({type:"byYear",fromYear:i+9,toYear:i,size:r,offset:t},n)}))},getAlbumsByGenre:function(e,t,r,n){return bu(this,void 0,void 0,(function*(){return wu({type:"byGenre",genre:e,size:r,offset:t},n)}))},getArtist:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getArtist",{id:e},t)).artist}))},getArtists:Eu,getArtistAlbums:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getArtist",{id:e},t)).artist.album||[]}))},getArtistInfo:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getArtistInfo2",{id:e},t)).artistInfo2}))},getArtistTopTracks:function(e,t=50,r){return bu(this,void 0,void 0,(function*(){return(yield gu("getTopSongs",{artist:e,count:t},r)).topSongs.song||[]}))},getDecades:ku,getFilters:function(e,t,r){return bu(this,void 0,void 0,(function*(){return e===ga.ByDecade?ku():xu(t,r)}))},getGenres:xu,getIndexes:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getIndexes",{musicFolderId:e},t)).indexes.index||[]}))},getLikedAlbums:function(e,t,r){return bu(this,void 0,void 0,(function*(){return wu({type:"starred",size:t,offset:e},r)}))},getLikedArtists:function(e=vu){return bu(this,void 0,void 0,(function*(){return(yield gu("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.artist||[]}))},getLikedSongs:function(e=vu){return bu(this,void 0,void 0,(function*(){return(yield gu("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.song||[]}))},getMostPlayed:function(e,t,r){return bu(this,void 0,void 0,(function*(){return wu({type:"frequent",size:t,offset:e},r)}))},getMusicDirectory:Su,getMusicDirectoryItems:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield Su(e,t)).child.sort(((e,t)=>e.isDir===t.isDir?e.isDir?e.title.localeCompare(t.title):0:e.isDir?-1:1))}))},getMusicLibraries:function(e){var t;return bu(this,void 0,void 0,(function*(){const r=yield gu("getMusicFolders",void 0,e);return(null===(t=r.musicFolders.musicFolder)||void 0===t?void 0:t.sort(((e,t)=>e.name.localeCompare(t.name))).map((({id:e,name:t})=>({id:String(e),title:t}))))||[]}))},getPlayableUrl:function(e,{host:t,credentials:r}=vu){const[,,n]=e.split(":");return`${t}/rest/stream?id=${n}&${r}`},getPlaylist:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getPlaylist",{id:e},t)).playlist}))},getPlaylists:function(e){return bu(this,void 0,void 0,(function*(){return(yield gu("getPlaylists",void 0,e)).playlists.playlist||[]}))},getPlaylistItems:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getPlaylist",{id:e},t)).playlist.entry||[]}))},getRandomAlbums:function(e=100,t){return bu(this,void 0,void 0,(function*(){return wu({type:"random",size:e,offset:0},t)}))},getRandomArtists:function(e=100,t){return bu(this,void 0,void 0,(function*(){return p(yield Eu(t)).slice(0,e)}))},getRandomSongs:function(e=100,t=vu){return bu(this,void 0,void 0,(function*(){return(yield gu("getRandomSongs",t.libraryId?{musicFolderId:t.libraryId,size:e}:{size:e},t)).randomSongs.song||[]}))},getRecentlyPlayed:function(e,t,r){return bu(this,void 0,void 0,(function*(){return wu({type:"recent",size:t,offset:e},r)}))},getSong:function(e,t){return bu(this,void 0,void 0,(function*(){return(yield gu("getSong",{id:e},t)).song}))},getSongsByGenre:function(e,t,r,n=vu){return bu(this,void 0,void 0,(function*(){const i={genre:e,offset:t,count:r};return(yield gu("getSongsByGenre",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).songsByGenre.song||[]}))},getVideos:function(e){return bu(this,void 0,void 0,(function*(){return(yield gu("getVideos",void 0,e)).videos.video||[]}))},scrobble:function(e,t){return bu(this,void 0,void 0,(function*(){return gu("scrobble",e,t)}))},searchAlbums:function(e,t,r,n=vu){var i;return bu(this,void 0,void 0,(function*(){const a={query:e,albumCount:r,albumOffset:t,songCount:0,artistCount:0},s=yield gu("search2",n.libraryId?Object.assign(Object.assign({},a),{musicFolderId:n.libraryId}):a,n);return(null===(i=s.searchResult2.album)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))},searchArtists:function(e,t,r,n=vu){return bu(this,void 0,void 0,(function*(){const i={query:e,artistOffset:t,artistCount:r,songCount:0,albumCount:0};return(yield gu("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.artist||[]}))},searchSongs:function(e,t,r,n=vu){return bu(this,void 0,void 0,(function*(){const i={query:e,songOffset:t,songCount:r,albumCount:0,artistCount:0};return(yield gu("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.song||[]}))}},Pu=Tu,Au=new J("navidrome"),Iu={get host(){return Au.getString("host")},set host(e){Au.setString("host",e)},get credentials(){return Au.getString("credentials")},set credentials(e){Au.setString("credentials",e)},get token(){return Au.getString("token")},set token(e){Au.setString("token",e)},get userId(){return Au.getString("userId")},set userId(e){Au.setString("userId",e)},clear(){Au.removeItem("token"),Au.removeItem("credentials"),Au.removeItem("userId")}};var Cu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Mu(e){const t=(0,n.useCallback)(((e,t,r)=>Cu(this,void 0,void 0,(function*(){const n=yield fetch(`${e}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:r})});if(!n.ok)throw n;const{token:i,subsonicSalt:a,subsonicToken:s,id:o}=yield n.json(),l=`u=${t}&s=${a}&t=${s}&v=1.16.1&c=ampcast&f=json`;return JSON.stringify({userId:o,token:i,credentials:l})}))),[]);return n.createElement(ka,Object.assign({},e,{service:cd,settings:Iu,login:t}))}var Ou=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function $u(e,t){return Ou(this,void 0,void 0,(function*(){return(yield zu(e,t,{method:"GET"})).json()}))}function Nu(e,t){return Ou(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return zu(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:r})}))}function zu(e,t,r){return Ou(this,void 0,void 0,(function*(){const{host:n,token:i}=Iu;if(!i)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{Accept:"application/json","x-nd-authorization":`Bearer ${i}`});const a=yield fetch(`${n}/api/${e}`,r);if(!a.ok)throw a;return a}))}const ju={addToPlaylist:function(e,t){return Ou(this,void 0,void 0,(function*(){yield Nu(`playlist/${e}/tracks`,{ids:t})}))},createPlaylist:function(e,t,r,n){return Ou(this,void 0,void 0,(function*(){const i=yield Nu("playlist",{name:e,comment:t,public:r}),a=yield i.json();return yield Nu(`playlist/${a.id}/tracks`,{ids:n}),a}))},get:$u,getFilters:function(e){return Ou(this,void 0,void 0,(function*(){return e===ga.ByDecade?Pu.getDecades():function(){return Ou(this,void 0,void 0,(function*(){return(yield $u("genre",{_sort:"name"})).map((({id:e,name:t})=>({id:e,title:t})))}))}()}))},getPage:function(e,t){return Ou(this,void 0,void 0,(function*(){const r=yield zu(e,t,{method:"GET",headers:{Accept:"application/json"}});let n=yield r.json(),i=0;return Array.isArray(n)?i=Number(r.headers.get("X-Total-Count"))||n.length:(n=[n],i=1),{items:n,total:i}}))},getPlayableUrl:function(e){return Pu.getPlayableUrl(e,Iu)}},Lu=ju;var Du=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ru=new H("navidromeAuth"),Fu=new it(""),_u=new it(!1);function Bu(){return _u.getValue()}function Vu(e){Iu.token=e,Fu.next(e)}Fu.pipe(Vn()).pipe(_e((e=>""!==e)),et((()=>function(){return Du(this,void 0,void 0,(function*(){try{return yield Lu.get("playlist",{_end:1}),!0}catch(e){return 401===e.status?Iu.clear():Ru.error(e),Fu.next(""),!1}}))}()))).subscribe(_u),Fu.next(Iu.token);class Uu{constructor(e,t,r,n){this.itemType=e,this.path=t,this.params=r,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new Ka((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,r=void 0,i=function*(){const t=(e-1)*this.pageSize,r=t+this.pageSize,{items:n,total:i}=yield Lu.getPage(this.path,Object.assign(Object.assign({},this.params),{_start:t,_end:r}));return{items:n.map((e=>this.createMediaObject(e))),total:i}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}createMediaObject(e){let t;switch(this.itemType){case ti.Album:t=this.createMediaAlbum(e);break;case ti.Artist:t=this.createMediaArtist(e);break;case ti.Playlist:t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}createMediaItem(e){var t;const r=e.mediaFileId||e.id;return{itemType:ti.Media,mediaType:ni.Audio,src:`navidrome:audio:${r}`,externalUrl:this.getExternalUrl(`album/${e.albumId}`),title:e.title,addedAt:this.parseDate(e.createdAt),artists:[e.artist],albumArtist:e.albumArtist,album:e.album,duration:e.duration,track:e.trackNumber,disc:e.discNumber,inLibrary:e.starred,year:e.year,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),thumbnails:this.createThumbnails(e.albumId),recording_mbid:e.mbzTrackId,release_mbid:e.mbzAlbumId,track_mbid:e.mbzReleaseTrackId,artist_mbids:e.mbzArtistId?[e.mbzArtistId]:void 0}}createMediaAlbum(e){var t;const r=e.id;return{itemType:ti.Album,src:`navidrome:album:${r}`,externalUrl:this.getExternalUrl(`album/${r}`),title:e.name,addedAt:this.parseDate(e.createdAt),artist:e.albumArtist,inLibrary:e.starred,year:e.minYear||e.maxYear,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:new Uu(ti.Media,"song",{album_id:r,_sort:"album"}),thumbnails:this.createThumbnails(r),release_mbid:e.mbzAlbumId,artist_mbids:e.mbzAlbumArtistId?[e.mbzAlbumArtistId]:void 0}}createMediaArtist(e){var t;const r=e.id,n=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:ti.Artist,src:`navidrome:artist:${r}`,externalUrl:this.getExternalUrl(`artist/${r}`),title:e.name,description:P(e.biography)||void 0,inLibrary:e.starred,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:this.createArtistAlbumsPager(e),thumbnails:n?this.createThumbnails(r):void 0,artist_mbid:e.mbzArtistId}}createMediaPlaylist(e){const t=e.id,r=`navidrome:playlist:${t}`;return{itemType:ti.Playlist,src:r,externalUrl:this.getExternalUrl(`playlist/${t}`),title:e.name,description:P(e.comment),addedAt:this.parseDate(e.createdAt),duration:e.duration,trackCount:e.songCount,pager:new Uu(ti.Media,`playlist/${t}/tracks`,{playlist_id:t}),thumbnails:this.createThumbnails(t),isPinned:Qi.isPinned(r),isOwn:e.ownerId===Iu.userId,owner:{name:e.ownerName}}}getExternalUrl(e){return`${Iu.host}/app/#/${e}/show`}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){const{host:n}=Iu;return{url:`${n}/rest/getCoverArt?id=${e}&size=${t}&{navidrome-credentials}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new pi([t]),n=new Uu(ti.Album,"album",{album_artist_id:e.id,_sort:"minYear",_order:"DESC"});return new Yi(void 0,n,r)}createArtistAllTracks(e){const t=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:ti.Album,src:`navidrome:all-tracks:${e.id}`,title:"All Songs",artist:e.name,thumbnails:t?this.createThumbnails(e.id):void 0,pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Uu(ti.Media,"song",{artist:e.name,_sort:"title"})}}Uu.minPageSize=10,Uu.maxPageSize=500;const Hu=Uu;var qu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Yu="navidrome",Ku="order_album_artist_name,order_album_name,disc_number,track_number",Wu="order_album_artist_name,order_album_name",Gu={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Ju={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},Qu={id:"navidrome/liked-songs",title:"My Songs",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>new Hu(ti.Media,"song",{starred:!0,_sort:"starred_at",_order:"DESC"})},Xu={id:"navidrome/liked-albums",title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search:()=>new Hu(ti.Album,"album",{starred:!0,_sort:"starred_at",_order:"DESC"})},Zu={id:"navidrome/liked-artists",title:"My Artists",icon:"heart",itemType:ti.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Hu(ti.Artist,"artist",{starred:!0,_sort:"starred_at",_order:"DESC"})},ed={id:"navidrome/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Hu(ti.Media,"song",{_sort:"play_date",_order:"DESC"})},td={id:"navidrome/most-played",title:"Most Played",icon:"most-played",itemType:ti.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>new Hu(ti.Media,"song",{_sort:"play_count",_order:"DESC"})},rd={id:"navidrome/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,layout:Gu,secondaryLayout:Ju,search:()=>new Hu(ti.Playlist,"playlist",{_sort:"name"})},nd={id:"navidrome/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:ti.Media,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?new Hu(ti.Media,"song",{genre_id:e.id,_sort:Ku}):new pi},id={id:"navidrome/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:ti.Album,viewType:ga.ByGenre,search:e=>e?new Hu(ti.Album,"album",{genre_id:e.id,_sort:Wu}):new pi},ad={id:"navidrome/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:ti.Artist,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?new Hu(ti.Artist,"artist",{genre_id:e.id,_sort:"name"}):new pi},sd={id:"navidrome/random-tracks",title:"Random Songs",icon:"shuffle",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Hu(ti.Media,"song",{_sort:"random"},{maxSize:100})},od={id:"navidrome/random-albums",title:"Random Albums",icon:"shuffle",itemType:ti.Album,search:()=>new Hu(ti.Album,"album",{_sort:"random"},{maxSize:100})},ld={id:Yu,icon:Yu,name:"Navidrome",url:"https://www.navidrome.org/",serviceType:$n.PersonalMedia,defaultHidden:!0,roots:[dd(ti.Media,{title:"Songs"}),dd(ti.Album,{title:"Albums"}),dd(ti.Artist,{title:"Artists"}),dd(ti.Playlist,{title:"Playlists",layout:Gu,secondaryLayout:Ju})],sources:[Qu,Xu,Zu,ed,td,rd,nd,id,ad,sd,od],labels:{[Zn.AddToLibrary]:ai("Add to Navidrome Favorites"),[Zn.RemoveFromLibrary]:ai("Remove from Navidrome Favorites")},editablePlaylists:rd,addToPlaylist:function(e,t){return qu(this,void 0,void 0,(function*(){const r=md(e);return Lu.addToPlaylist(r,t.map(md))}))},canRate:()=>!1,canStore:ud,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n=[]}={}){return qu(this,void 0,void 0,(function*(){return{src:`navidrome:playlist:${(yield Lu.createPlaylist(e,t,r,n.map(md))).id}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const t=md(e);return new Hu(ti.Playlist,`playlist/${t}`)}}},getFilters:function(e){return qu(this,void 0,void 0,(function*(){return Lu.getFilters(e)}))},getMetadata:function(e){return qu(this,void 0,void 0,(function*(){const t=e.itemType,r=md(e);if(t===ti.Album){if(e.synthetic)return e;if(void 0===e.description){const t=yield Pu.getAlbumInfo(r,!1,Iu);e=Object.assign(Object.assign({},e),{description:P(t.notes),release_mbid:t.musicBrainzId})}}else if(t===ti.Artist&&void 0===e.description){const t=yield Pu.getArtistInfo(r,Iu);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!ud(e)||void 0!==e.inLibrary)return e;const n=Qn.getInLibrary(e);if(void 0!==n)return Object.assign(Object.assign({},e),{inLibrary:n});const i=t===ti.Artist?"artist":t===ti.Album?"album":"song",a=new Hu(t,`${i}/${r}`,{pageSize:1,maxSize:1}),s=yield hi(a,{timeout:2e3});return x(e,s[0])}))},getPlayableUrl:function({src:e}){return Lu.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{navidrome-credentials}",Iu.credentials)},lookup:function(e,t,r=10,n){return qu(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return hi(new Hu(ti.Media,"song",{title:`${e} ${t}`,_sort:"order_artist_name,order_album_name,track_number"},i),{timeout:n})}))},store:function(e,t){return qu(this,void 0,void 0,(function*(){const r=md(e),n=t?"star":"unstar";switch(e.itemType){case ti.Media:yield Pu.get(n,{id:r},Iu);break;case ti.Album:yield Pu.get(n,{albumId:r},Iu);break;case ti.Artist:yield Pu.get(n,{artistId:r},Iu)}}))},observeIsLoggedIn:function(){return _u.pipe(Vn())},isConnected:function(){return!!Iu.token},isLoggedIn:Bu,login:function(){return Du(this,void 0,void 0,(function*(){if(!Bu()){Ru.log("connect");try{const e=yield function(){return Cu(this,void 0,void 0,(function*(){return dr(Mu,!0)}))}();if(e){const{userId:t,token:r,credentials:n}=JSON.parse(e);Iu.userId=t,Iu.credentials=n,Vu(r)}}catch(e){Ru.error(e)}}}))},logout:function(){return Du(this,void 0,void 0,(function*(){Ru.log("disconnect"),Iu.clear(),Vu(""),_u.next(!1)}))}},cd=ld;function ud(e){switch(e.itemType){case ti.Media:case ti.Artist:return!0;case ti.Album:return!e.synthetic;default:return!1}}function dd(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`navidrome/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){switch(t=t.trim(),e){case ti.Media:return new Hu(e,"song",{title:t,_sort:Ku});case ti.Album:return new Hu(e,"album",{name:t,_sort:Wu});case ti.Artist:return new Hu(e,"artist",{name:t,_sort:"name"});case ti.Playlist:return new Hu(e,"playlist",{q:t,_sort:"name"});default:return new pi}}})}function md({src:e}){const[,,t]=e.split(":");return t}var hd;!function(e){e[e.Low=4]="Low",e[e.Normal=8]="Normal",e[e.High=12]="High",e[e.Lossless=16]="Lossless",e[e.Master=20]="Master"}(hd||(hd={}));const fd=hd,pd=new J("plex"),yd=new it(pd.getString("libraryId")),vd={get audioLibraries(){return this.libraries},get clientId(){let e=pd.getString("clientId");return e||(e=xa(),pd.setString("clientId",e)),e},get drm(){return pd.getString("drm","widevine")},set drm(e){pd.setString("drm",e)},get connection(){return pd.getJson("connection")},set connection(e){pd.setJson("connection",e)},get hasTidal(){return pd.getBoolean("hasTidal")},set hasTidal(e){pd.setBoolean("hasTidal",e)},get host(){const e=this.connection;return e?e.local&&"http:"===location.protocol?`http://${e.address}:${e.port}`:e.uri:""},get internetRequired(){var e;return!(null===(e=this.connection)||void 0===e?void 0:e.local)||"http:"!==location.protocol},get libraryId(){return pd.getString("libraryId")},set libraryId(e){pd.setString("libraryId",e),yd.next(e)},observeLibraryId:()=>yd.pipe(Vn()),get libraries(){return pd.getJson("libraries")||[]},set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>R(e.title)))||e[0];pd.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""},get server(){return pd.getJson("server")},set server(e){pd.setJson("server",e)},get serverId(){var e;return(null===(e=this.server)||void 0===e?void 0:e.clientIdentifier)||""},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get streamingQuality(){return pd.getNumber("streamingQuality",fd.High)},set streamingQuality(e){pd.setNumber("streamingQuality",e)},get userId(){return pd.getString("userId")},set userId(e){pd.setString("userId",e)},get userToken(){return pd.getString("userToken")},set userToken(e){pd.setString("userToken",e)},clear(){pd.removeItem("userId"),pd.removeItem("userToken"),pd.removeItem("server"),pd.removeItem("connection"),pd.removeItem("hasTidal")}};var bd;!function(e){e.Episode="4",e.Artist="artist",e.Album="album",e.Track="track",e.Clip="clip",e.Playlist="playlist"}(bd||(bd={}));const gd=bd;var wd;!function(e){e.Episode="4",e.Artist="8",e.Album="9",e.Track="10",e.MusicVideo="12",e.Clip="14",e.Playlist="15"}(wd||(wd={}));const Ed=wd;var kd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},xd=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Sd="https://plex.tv/api/v2",Td="https://music.provider.plex.tv",Pd="https://discover.provider.plex.tv";function Ad(e){var{headers:t,body:r}=e,n=xd(e,["headers","body"]);return kd(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),r&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),r=JSON.stringify(r)),(yield Id(Object.assign({headers:t,body:r},n))).json()}))}function Id({host:e=vd.host,path:t,method:r="GET",params:n,headers:i,body:a,token:s,keepalive:o,timeout:l}){return kd(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=n?`${t}?${new URLSearchParams(n)}`:t).startsWith("/")&&(t=t.slice(1)),s||(s=e===vd.host?vd.serverToken:vd.userToken);const c=e===vd.host?void 0:vd.drm,u={method:r,headers:Object.assign(Object.assign({},i),zd(s,c)),body:a,keepalive:o};l&&(u.signal=AbortSignal.timeout(l));const d=yield fetch(`${e}/${t}`,u);if(!d.ok)throw d;return d}))}function Cd(e){const t=e.map(Ld).join(",");return`server://${vd.serverId}/com.plexapp.plugins.library/library/metadata/${t}`}function Md(e){return`provider://tv.plex.provider.music/library/metadata/${e.map(Ld).join(",")}`}function Od(e="all"){return`/library/sections/${$d()}/${e}`}function $d(){const e=vd.libraryId;if(!e)throw new oi;return e}function Nd(e,t=vd.host){return kd(this,void 0,void 0,(function*(){if(0===e.length)return[];const{MediaContainer:{Metadata:r=[]}}=yield Ad({host:t,path:`/library/metadata/${e.join(",")}`,headers:{"X-Plex-Container-Start":"0","X-Plex-Container-Size":String(e.length)}});return r}))}function zd(e,t){const r={"X-Plex-Product":"ampcast","X-Plex-Version":"0.9.5","X-Plex-Platform":j.displayName,"X-Plex-Platform-Version":j.version,"X-Plex-Device":j.os,"X-Plex-Device-Name":j.displayName,"X-Plex-Client-Identifier":vd.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(r["X-Plex-Token"]=e),t&&(r["X-Plex-Drm"]=t),r}function jd(e){switch(e){case ti.Album:return Ed.Album;case ti.Artist:return Ed.Artist;case ti.Playlist:return Ed.Playlist;default:return Ed.Track}}function Ld({src:e}){const[,,t]=e.split(":");return t}const Dd={addToPlaylist:function(e,t,r=vd.host){return kd(this,void 0,void 0,(function*(){const n=Ld(e),[i,a]=m(t,(e=>e.src.startsWith("plex-tidal:"))),s=r===Td,o=`/playlists/${n}/items`;if(a.length>0&&!s){const e=Cd(a);yield Ad({host:r,method:"PUT",path:o,params:{uri:e}})}if(i.length>0){const e=Md(i);yield Ad({host:r,method:"PUT",path:o,params:{uri:e}})}}))},createPlaylist:function(e,t,r,n=vd.host){return kd(this,void 0,void 0,(function*(){const i=n===Td,[a,s]=m(r,(e=>e.src.startsWith("plex-tidal:"))),o=i?Md(a):Cd(s),{MediaContainer:{Metadata:[l]=[]}}=yield Ad({host:n,method:"POST",path:"/playlists",params:{type:"audio",title:e,uri:o,smart:0}});return t&&(yield Id({host:n,method:"PUT",path:`/playlists/${l.ratingKey}`,params:{summary:t}})),!i&&a.length>0&&(yield Ad({host:n,method:"PUT",path:`/playlists/${l.ratingKey}/items`,params:{uri:Md(a)}})),l}))},fetch:Id,fetchJSON:Ad,getAccount:function(e){return kd(this,void 0,void 0,(function*(){const{MyPlex:t}=yield Ad({path:"myplex/account",token:e});return t}))},getFilters:function(e,t){return kd(this,void 0,void 0,(function*(){return e===ga.ByDecade?function(){return kd(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield Ad({path:Od("decade"),params:{type:Ed.Album}}),t=10*Math.floor((new Date).getFullYear()/10);return e.filter((({key:e})=>Number(e)>500&&Number(e)<=t)).map((({key:e,title:t})=>({id:e,title:t})))}))}():function(e){return kd(this,void 0,void 0,(function*(){const t=jd(e),{MediaContainer:{Directory:r}}=yield Ad({path:Od("genre"),params:{type:t}});return r.map((({key:e,title:t})=>({id:e,title:t})))}))}(t)}))},getHeaders:zd,getMetadata:Nd,getMusicLibraries:function(e=vd.host,t=vd.serverToken){return kd(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:r}}=yield Ad({host:e,path:"/library/sections",token:t});return r.filter((e=>"artist"===e.type)).map((({key:e,title:t})=>({id:e,title:t})))}))},getPlayableUrl:function(e){const{host:t,serverToken:r}=vd;if(t&&r){if(e.playbackType===jn.Direct){const[n]=e.srcs||[];if(!n)throw Error("No playable source");return`${t}${n}?X-Plex-Token=${r}`}{const[,n,i]=e.src.split(":");return`${t}/${"video"===n?"video":"music"}/:/transcode/universal/start.mpd?${new URLSearchParams(Object.assign(Object.assign({path:`/library/metadata/${i}`,hasMDE:"1",mediaIndex:"0",partIndex:"0",musicBitrate:"320",directStreamAudio:"1",mediaBufferSize:"12288",protocol:e.playbackType===jn.HLS?"hls":"dash",directPlay:"0"},zd(r)),{"X-Plex-Client-Profile-Extra":"add-transcode-target(type=musicProfile&context=streaming&protocol=dash&container=mp4&audioCodec=aac)+add-transcode-target(type=musicProfile&context=streaming&protocol=hls&container=mpegts&audioCodec=aac,mp3)"}))}`}}throw Error("Not logged in")},getPlaybackType:function(e){return kd(this,void 0,void 0,(function*(){try{const{host:t,serverToken:r}=vd,[n]=e.srcs||[],i=`${t}${n}?X-Plex-Token=${r}`;return(yield V(e.mediaType===ni.Video?"video":"audio",i))?jn.Direct:jn.HLS}catch(e){return jn.Direct}}))},getServers:function(e=vd.serverToken){return kd(this,void 0,void 0,(function*(){return m((yield Ad({host:Sd,path:"/resources",params:{includeHttps:"1"},token:e})).filter((e=>"server"===e.provides)),(e=>e.owned)).flat()}))},search:function(e){var t=e.params,r=void 0===t?{}:t,{type:n}=r,i=xd(r,["type"]),a=xd(e,["params"]);return kd(this,void 0,void 0,(function*(){let e=[];const t=a.host===Pd;if(t){const{MediaContainer:{SearchResults:[{SearchResult:t=[]}]}}=yield Ad(Object.assign(Object.assign({},a),{params:i}));e=t}else{const{MediaContainer:{SearchResult:t=[]}}=yield Ad(Object.assign(Object.assign({},a),{params:i}));e=t}return Nd(e.map((e=>e.Metadata)).filter((e=>e.type===n)).map((e=>e.ratingKey)),t?Td:void 0)}))}},Rd=Dd;var Fd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const _d=new H("plexAuth"),Bd=new it(""),Vd=new it(!1),Ud=new Ne;let Hd;function qd(){return Vd.getValue()}function Yd(){return Vd.pipe(Vn())}function Kd(){return Ud}function Wd(){return Fd(this,void 0,void 0,(function*(){if(!qd()){_d.log("connect");try{Ud.next("");const{id:e,userToken:t,serverToken:r}=yield function(){return Fd(this,void 0,void 0,(function*(){const{id:e,serverToken:t}=yield function(){return Fd(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/plex/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});let n=10;const s=()=>Fd(this,void 0,void 0,(function*(){n--;try{const{authToken:r,id:i}=yield Rd.fetchJSON({host:Sd,path:`/pins/${Hd.id}`});r?e({id:i,serverToken:r}):n?setTimeout(s,200):(Ud.next("Timeout"),t("Timeout"))}catch(e){t(e)}}));s()}};window.addEventListener("message",a,!1);const s=`clientID=${vd.clientId}&code=${Hd.code}&forwardUrl=${encodeURIComponent(n)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${s}`,"Plex","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}();yield function(e){return Fd(this,void 0,void 0,(function*(){const{server:t,connection:r}=vd;if(t&&r){const e=r.local?"local":"public";if(Ud.next(`Trying existing ${e} connection…`),yield Qd(t,r))return;vd.server=null,vd.connection=null}Ud.next(`Searching for ${r?"a new":"a"} connection…`);const n=yield Rd.getServers(e);if(0===n.length){const e="Could not find a Plex server";throw Ud.next(e),Error(e)}for(const e of n){const t=yield Jd(e);if(t)return vd.server=e,void(vd.connection=t)}const i="Could not establish a connection";throw Ud.next(i),Error(i)}))}(t);try{const{authToken:r}=yield Rd.getAccount(t);return{id:e,serverToken:t,userToken:r}}catch(r){return{id:e,serverToken:t,userToken:""}}}))}();vd.userId=e,vd.userToken=t,Bd.next(r)}catch(e){_d.error(e)}}}))}function Gd(){return Fd(this,void 0,void 0,(function*(){_d.log("disconnect"),vd.clear(),Bd.next(""),Vd.next(!1)}))}function Jd(e){return Fd(this,void 0,void 0,(function*(){const t=m(e.connections,(e=>e.local)).flat();for(const r of t)if(yield Qd(e,r))return r;return null}))}function Qd(e,t){return Fd(this,void 0,void 0,(function*(){const r=e.name,n=t.local?"local":"public";try{return yield Rd.fetch({host:t.uri,path:"/",method:"HEAD",token:e.accessToken,timeout:3e3}),Ud.next(`(${r}) ${n} connection successful`),!0}catch(e){Ud.next(`(${r}) ${n} connection failed`)}return!1}))}function Xd(){return Fd(this,void 0,void 0,(function*(){try{const e=yield function(){return e=this,t=void 0,n=function*(){if(!_){const e=Object.entries(B),t={initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]};for(const[r,n]of e)try{yield navigator.requestMediaKeySystemAccess(n,[t]),_=r;break}catch(e){}_||(_=F)}return _},new((r=void 0)||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}));var e,t,r,n}();vd.drm=e}catch(e){_d.error(e)}}))}function Zd(){return Fd(this,void 0,void 0,(function*(){try{vd.userToken&&(yield Rd.fetchJSON({host:Td,path:"/playlists/all",params:{librarySectionID:"tidal"},headers:{"X-Plex-Container-Size":"1"}}),vd.hasTidal=!0)}catch(e){406===e.status?vd.hasTidal=!1:_d.error(e)}}))}Bd.pipe(Vn()).pipe(_e((e=>!!e)),et((()=>function(){return Fd(this,void 0,void 0,(function*(){try{const[e]=yield Promise.all([Rd.getMusicLibraries(),Xd(),Zd()]);return vd.libraries=e,!0}catch(e){return 401===e.status?(vd.clear(),Bd.next(""),Ud.next("Connection failed"),!1):(_d.error(e),Ud.next("Connected with errors"),!0)}}))}()))).subscribe(Vd),Kd().pipe(_e((e=>""!==e))).subscribe(_d.rx()),Bd.next(vd.serverToken);var em=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const tm=new H("PlexPager");class rm{constructor(e,t,r){var n;this.request=e,this.options=t,this.parent=r,this.pageNumber=1,this.serviceId=(null==t?void 0:t.serviceId)||"plex";let i=null==t?void 0:t.pageSize;i||(i=this.isTidal?50:(null===(n=vd.connection)||void 0===n?void 0:n.local)?rm.plexMaxPageSize:200),this.pageSize=Math.min((null==t?void 0:t.maxSize)||1/0,i);const a=Object.assign(Object.assign({},t),{pageSize:this.pageSize});this.pager=this.isTidal?new Ui((()=>this.fetchNext()),a):new Ka((e=>this.fetch(e)),a)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}get isTidal(){return"plex-tidal"===this.serviceId}get isSearch(){return this.request.path.endsWith("/search")}connect(){var e;this.subscriptions||(this.subscriptions=new le,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.isSearch||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>this.enhanceItems(e)))).subscribe(tm)))}enhanceItems(e){return em(this,void 0,void 0,(function*(){const[t,r]=m(e,(e=>e.src.startsWith("plex-tidal:"))),n=(e,t)=>em(this,void 0,void 0,(function*(){if((e=e.filter((e=>!(e.itemType===ti.Media&&e.mediaType===ni.Video)))).length>0){const r=t===Td,n=yield Rd.getMetadata(e.map((({src:e})=>{const[,,t]=e.split(":");return t})),t),i=r?[]:yield this.getPlexAlbums(n),a=n.map((e=>this.createMediaObject(e,i,!0)));Kn(a.map((e=>({match:t=>t.src===e.src,values:e}))))}}));yield Promise.all([n(r.filter((e=>[ti.Media,ti.Album].includes(e.itemType)))),n(t.filter((e=>[ti.Media,ti.Artist].includes(e.itemType))),Td)])}))}fetch(e){var t;return em(this,void 0,void 0,(function*(){const r=this.request.path;let n,i=[],a=0;if(this.isSearch)n=yield Rd.search(this.request),a=n.length;else{const t=this.request,{headers:r}=t,i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["headers"]),s=yield Rd.fetchJSON(Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign({},r),{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)})})),{MediaContainer:{Metadata:o=[],size:l,totalSize:c}}=s;n=o,a=c||l}return(null===(t=this.options)||void 0===t?void 0:t.lookup)&&!this.isTidal&&(i=yield this.getPlexAlbums(n)),r.endsWith("/tidal/myMixes")&&(n=n.map(((e,t)=>"playlist"===e.type&&1===e.leafCount?Object.assign(Object.assign({},e),{leafCount:void 0,title:`My Mix ${t+1}`,summary:e.title}):e))),{items:n.map((e=>this.createMediaObject(e,i))),total:a}}))}fetchNext(){return em(this,void 0,void 0,(function*(){const e=yield this.fetch(this.pageNumber);return this.pageNumber++,e}))}createMediaObject(e,t,r){switch(e.type){case gd.Clip:return this.createMediaItemFromVideo(e);case gd.Album:return this.createMediaAlbum(e,r);case gd.Artist:return this.createMediaArtist(e,r);case gd.Playlist:return this.createMediaPlaylist(e,r);case gd.Track:{const r=t.find((t=>t.ratingKey===e.parentRatingKey));return this.createMediaItemFromTrack(e,r)}default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e,t){var r;const[n]=e.Media||[],[i]=(null==n?void 0:n.Part)||[];let a=(e.title||"").trim();const s=!!a,o=s?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,l=this.getFileName(null==i?void 0:i.file)||"[Unknown]",c="com.tidal"===e.attribution;return a=c?this.fixTrackTitle(a):a||l.replace(/\.\w+/,""),{src:this.getSrc("audio",e),srcs:null===(r=e.Media)||void 0===r?void 0:r.map((({Part:[e]})=>e.key)),itemType:ti.Media,mediaType:ni.Audio,playbackType:c?jn.DASH:void 0,title:a,fileName:c?void 0:l,externalUrl:this.getExternalUrl(e),addedAt:e.addedAt,artists:s?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:o&&!e.originalTitle?e.grandparentTitle:void 0,album:o,duration:e.duration/1e3,track:o?e.index:void 0,disc:o&&e.index?e.parentIndex:void 0,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year||e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e)||(t?this.getGenres(t):void 0),thumbnails:this.createThumbnails((c?void 0:e.thumb)||e.parentThumb||e.grandparentThumb),release_mbid:t?this.getMbid(t):void 0,track_mbid:this.getMbid(e),unplayable:!i||void 0}}createMediaAlbum(e,t){const r={src:this.getSrc("album",e),itemType:ti.Album,externalUrl:this.getExternalUrl(e),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb||e.parentThumb),release_mbid:this.getMbid(e)};return t||(r.pager=this.createPager({path:e.key})),r}createMediaArtist(e,t){var r;const n={src:this.getSrc("artist",e),itemType:ti.Artist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,country:null===(r=e.Country)||void 0===r?void 0:r.map((e=>e.tag)).join(", "),addedAt:e.addedAt,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb),artist_mbid:this.getMbid(e)};return t||(n.pager=this.createArtistAlbumsPager(e)),n}createMediaItemFromVideo(e){var t;const[r]=e.Media||[],[n]=(null==r?void 0:r.Part)||[],i="com.tidal"===e.attribution;return{src:this.getSrc("video",e),srcs:null===(t=e.Media)||void 0===t?void 0:t.map((({Part:[e]})=>e.key)),itemType:ti.Media,mediaType:ni.Video,playbackType:i?jn.HLS:void 0,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(null==n?void 0:n.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e),inLibrary:this.getInLibrary(e),thumbnails:this.createThumbnails(e.thumb),unplayable:!n||void 0}}createMediaPlaylist(e,t){const r=this.getSrc("playlist",e),n={src:r,itemType:ti.Playlist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,thumbnails:this.createThumbnails(e.thumb||e.composite),isPinned:Qi.isPinned(r)};return t||(n.pager=this.createPager({path:e.key})),n}createMediaFolder(e){var t;const r={itemType:ti.Folder,src:`plex:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}getExternalUrl(e){var t,r;const n="com.tidal"===e.attribution,i="https://app.plex.tv/desktop/#!";let a="";if(n)a=`${i}/provider/tv.plex.provider.music`;else{const e=null===(t=vd.server)||void 0===t?void 0:t.clientIdentifier;a=e?`${i}/server/${e}`:""}let s="details",o=`/library/metadata/${e.ratingKey}`;switch(e.type){case gd.Clip:if(n){const t=e.grandparentRatingKey;o=t?`/library/metadata/${t}`:""}else o=null===(r=e.art)||void 0===r?void 0:r.replace(/\/art\/\d+$/,"");break;case gd.Playlist:o=`/playlists/${e.ratingKey}`,s="playlist";break;case gd.Track:{const t=e.parentRatingKey;o=t?`/library/metadata/${t}`:"";break}}return a&&o?`${a}/${s}?key=${encodeURIComponent(o)}`:""}getFileName(e=""){return e.split(/[/\\]/).pop()}getGenres(e){var t;return null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag))}getInLibrary(e){return"com.tidal"===e.attribution?e.saved:void 0}getMbid(e){const t=e.Guid;if(t){const e=t.map((e=>e.id)).find((e=>e.startsWith("mbid://")));return null==e?void 0:e.replace("mbid://","")}}getPlexAlbums(e){return em(this,void 0,void 0,(function*(){const t=e.filter((e=>"track"===e.type&&"com.tidal"!==e.attribution)),r=h(t.map((e=>e.parentRatingKey)));return r.length>0?Rd.getMetadata(r):[]}))}getRating(e){return"number"==typeof e?Math.round((e||0)/2):void 0}getSrc(e,t){return`${"com.tidal"===t.attribution?"plex-tidal":"plex"}:${e}:${t.ratingKey}`}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${vd.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${r}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:r}}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=this.createPager({path:r},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new pi([e]);return new Yi(t,n)}return n}createArtistAlbumsPager(e){if("com.tidal"===e.attribution){const t=this.createPager({path:e.key}),r=this.createArtistTopTracks(e),n=this.createArtistVideos(e),i=new Hi((()=>em(this,void 0,void 0,(function*(){try{return 0===(yield hi(n.pager,{keepAlive:!0})).length?[r]:[r,n]}catch(e){return tm.error(e),[r]}}))));return new Yi(i,t)}{const t=this.createPager({path:Od(),params:{"artist.id":e.ratingKey,type:Ed.Album,sort:"year:desc,originallyAvailableAt:desc,artist.titleSort:desc,album.titleSort,album.index"}}),r=this.createArtistVideos(e),n=new Hi((()=>em(this,void 0,void 0,(function*(){try{return 0===(yield hi(r.pager,{keepAlive:!0})).length?[]:[r]}catch(e){return tm.error(e),[]}})))),i=this.createArtistOtherTracks(e),a=new pi([i]);return new Yi(n,t,a)}}createArtistOtherTracks(e){return{itemType:ti.Album,src:this.getSrc("other-tracks",e),title:"Other Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createOtherTracksPager(e),synthetic:!0}}createArtistTopTracks(e){return{itemType:ti.Album,src:this.getSrc("top-tracks",e),title:"Top Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createTopTracksPager(e),synthetic:!0}}createArtistVideos(e){return{itemType:ti.Album,src:this.getSrc("videos",e),title:"Music Videos",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createVideosPager(e),synthetic:!0}}createOtherTracksPager(e){return this.createPager({params:{originalTitle:e.title,type:Ed.Track}})}createTopTracksPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/popular`},{maxSize:20})}createVideosPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/extras`})}createPager(e,t,r){return new rm(Object.assign(Object.assign(Object.assign(Object.assign({},this.request),{params:void 0}),e),{host:this.isTidal?Td:e.host}),Object.assign(Object.assign({},t),{serviceId:this.serviceId}),r)}fixTrackTitle(e){return e&&(e=(e=e.replace(/(\([^)]*\))\s*\1/g,"$1")).replace(/(\([^)]*\)\s*\[[^\]]*\]).*/g,"$1")),e}}rm.minPageSize=10,rm.plexMaxPageSize=1e3,rm.tidalMaxPageSize=100;const nm=rm;var im=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const am={view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},sm={view:"details",fields:["AlbumTrack","Artist","Title","Duration","PlayCount","Rate"]},om={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},lm={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]},cm={id:"plex/recently-added",title:"Recently Added",icon:"recently-added",itemType:ti.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","AddedAt"]},search:()=>new nm({path:Od(),params:{type:Ed.Track,"album.addedAt>>":"-6mon",sort:"album.addedAt:desc"}})},um={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new nm({path:Od(),params:{type:Ed.Track,"lastViewedAt>":"0",sort:"lastViewedAt:desc"}})},dm={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:ti.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new nm({path:Od(),params:{type:Ed.Track,"viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"}})},mm={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:ti.Media,lockActionsStore:!0,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new nm({path:Od(),params:{type:Ed.Track,"track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},hm={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:ti.Album,lockActionsStore:!0,layout:am,secondaryLayout:sm,search:()=>new nm({path:Od(),params:{type:Ed.Album,"album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},fm={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:ti.Artist,lockActionsStore:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:sm,search:()=>new nm({path:Od(),params:{type:Ed.Artist,"artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},pm={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,layout:om,secondaryLayout:lm,search:()=>($d(),new nm({path:"/playlists/all",params:{type:Ed.Playlist,playlistType:"audio",sort:"addedAt:desc"}}))},ym={id:"plex/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search:()=>($d(),new nm({path:"/playlists/all",params:{type:Ed.Playlist,playlistType:"audio",readOnly:"0",smart:"0"}}))},vm={id:"plex/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:ti.Album,viewType:ga.ByGenre,search:e=>e?new nm({path:Od(),params:{genre:e.id,type:Ed.Album}}):new pi},bm={id:"plex/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:ti.Artist,viewType:ga.ByGenre,defaultHidden:!0,search:e=>e?new nm({path:Od(),params:{genre:e.id,type:Ed.Artist}}):new pi},gm={id:"plex/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:ti.Album,viewType:ga.ByDecade,search:e=>e?new nm({path:Od(),params:{decade:e.id,type:Ed.Album}}):new pi},wm={id:"plex/random-tracks",title:"Random Tracks",icon:"shuffle",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new nm({path:Od(),params:{type:Ed.Track,sort:"random"}},{maxSize:100})},Em={id:"plex/random-albums",title:"Random Albums",icon:"shuffle",itemType:ti.Album,layout:am,secondaryLayout:sm,search:()=>new nm({path:Od(),params:{type:Ed.Album,sort:"random"}},{maxSize:100})},km={id:"plex/videos",title:"Music Videos",icon:"video",itemType:ti.Media,mediaType:ni.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search:({q:e=""}={})=>new nm({path:Od("extras/all"),params:{title:e,type:Ed.Artist,extraType:Ed.Episode}})},xm={id:"plex/folders",title:"Folders",icon:"folder",itemType:ti.Folder,viewType:ga.Folders,search(){const e={itemType:ti.Folder,src:"plex:folder:",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>im(this,void 0,void 0,(function*(){return vd.libraries.map((({id:t,title:r})=>{const n={itemType:ti.Folder,src:`plex:folder:/library/sections/${t}/folder`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new pi([i]),s=new nm({path:`library/sections/${t}/folder`,params:{includeCollections:"1"}},void 0,n);return n.pager=new Yi(a,s),n}))})))),e.pager}},Sm={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",serviceType:$n.PersonalMedia,defaultHidden:!0,get internetRequired(){return vd.internetRequired},roots:[Am(ti.Media,{title:"Tracks",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]}}),Am(ti.Album,{title:"Albums"}),Am(ti.Artist,{title:"Artists"}),Am(ti.Playlist,{title:"Playlists",layout:om,secondaryLayout:lm})],sources:[mm,hm,fm,dm,cm,um,pm,vm,bm,gm,wm,Em,km,xm],editablePlaylists:ym,get audioLibraries(){return vd.audioLibraries},get libraryId(){return vd.libraryId},set libraryId(e){vd.libraryId=e},get libraries(){return vd.libraries},set libraries(e){vd.libraries=e},observeLibraryId:()=>vd.observeLibraryId(),addToPlaylist:function(e,t){return im(this,void 0,void 0,(function*(){return Rd.addToPlaylist(e,t)}))},canRate:Pm,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return im(this,void 0,void 0,(function*(){return{src:`plex:playlist:${(yield Rd.createPlaylist(e,t,r)).ratingKey}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,id:e.src,icon:"pin",isPin:!0,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},search:()=>new nm({path:`/playlists/${Im(e)}`,params:{type:Ed.Playlist,playlistType:"audio"}})}},getFilters:function(e,t){return im(this,void 0,void 0,(function*(){return Rd.getFilters(e,t)}))},getMetadata:function(e){return im(this,void 0,void 0,(function*(){if(!Pm(e)||void 0!==e.rating)return e;const t=Qn.getRating(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const r=Im(e),[n]=yield Rd.getMetadata([r]);return Object.assign(Object.assign({},e),{rating:Math.round((n.userRating||0)/2)})}))},getPlayableUrl:function(e){return Rd.getPlayableUrl(e)},getPlaybackType:function(e){return im(this,void 0,void 0,(function*(){return Rd.getPlaybackType(e)}))},getThumbnailUrl:function(e){return e.replace("{plex-token}",vd.serverToken)},lookup:function(e,t,r=10,n){return im(this,void 0,void 0,(function*(){return e&&t?hi(new nm({path:"/library/search",params:{query:`${e} ${t}`,searchTypes:"music",limit:50,type:gd.Track}},{pageSize:r,maxSize:r,lookup:!0}),{timeout:n}):[]}))},rate:function(e,t){return im(this,void 0,void 0,(function*(){yield Rd.fetch({path:"/:/rate",method:"PUT",params:{key:Im(e),identifier:"com.plexapp.plugins.library",rating:2*t||-1}})}))},observeConnectionLogging:Kd,observeIsLoggedIn:Yd,isConnected:function(){return!!vd.server},isLoggedIn:qd,login:Wd,logout:Gd},Tm=Sm;function Pm(e,t){if(t||!e.src.startsWith("plex:"))return!1;switch(e.itemType){case ti.Album:return!e.synthetic;case ti.Artist:return!0;case ti.Media:return e.mediaType===ni.Audio;default:return!1}}function Am(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>function(e,t,r,n){$d();const i=e===ti.Playlist?"/playlists/all":Od(),a=Object.assign({},void 0);return t&&(a.title=t.trim()),a.type=jd(e),e===ti.Playlist&&(a.playlistType="audio"),new nm({path:i,params:a},void 0)}(e,t)})}function Im({src:e}){const[,,t]=e.split(":");return t}const Cm=new J("services"),Mm=Cm.getJson("hidden",{}),Om=new it(Mm),$m=ot()()||Cm.getBoolean("allowAll");function Nm(e){return!function(e){var t;return null!==(t=Om.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function zm(e){const t=Om.getValue(),r=Object.assign(Object.assign({},t),e);Cm.setJson("hidden",r),Om.next(r)}var jm=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Lm="plex-tidal",Dm={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Rm={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Fm={id:`${Lm}/library-tracks`,title:"My Tracks",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:Dm,search:()=>eh(Ed.Track)},_m={id:`${Lm}/library-albums`,title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search:()=>eh(Ed.Album)},Bm={id:`${Lm}/library-artists`,title:"My Artists",icon:"heart",itemType:ti.Artist,lockActionsStore:!0,search:()=>eh(Ed.Artist)},Vm={id:`${Lm}/library-playlists`,title:"My Playlists",icon:"heart",itemType:ti.Playlist,lockActionsStore:!0,layout:Rm,search:()=>(ih(),rh("/playlists/all",{sort:"addedAt:desc"}))},Um={id:`${Lm}/editable-playlists`,title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search:()=>rh("/playlists/all",{readOnly:"0",smart:"0"})},Hm={id:`${Lm}/library-videos`,title:"My Videos",icon:"heart",itemType:ti.Media,mediaType:ni.Video,defaultHidden:!0,layout:Dm,search:()=>eh(Ed.MusicVideo)},qm={id:`${Lm}/my-mixes`,title:"Recommended",icon:"playlist",itemType:ti.Playlist,layout:Rm,search:()=>(ih(),rh("/hubs/sections/tidal/myMixes"))},Ym={id:`${Lm}/plex-picks`,title:"Plex Picks",icon:"album",itemType:ti.Album,defaultHidden:!0,search:()=>rh("/hubs/sections/tidal/plexPicks")},Km={id:`${Lm}/new-playlists`,title:"New Playlists",icon:"playlist",itemType:ti.Playlist,defaultHidden:!0,layout:Rm,search:()=>rh("/hubs/sections/tidal/newPlaylists")},Wm={id:Lm,name:"TIDAL",icon:Lm,url:"https://tidal.com/",serviceType:$n.PublicMedia,primaryMediaType:ni.Audio,authService:Tm,internetRequired:!0,defaultHidden:!0,roots:[Zm(ti.Media,{title:"Tracks",layout:Dm}),Zm(ti.Album,{title:"Albums"}),Zm(ti.Artist,{title:"Artists"})],sources:[Fm,_m,Bm,Vm,Hm,qm,Km,Ym],icons:{[Zn.AddToLibrary]:"heart",[Zn.RemoveFromLibrary]:"heart-fill"},labels:{[Zn.AddToLibrary]:"Add to My TIDAL",[Zn.RemoveFromLibrary]:"Remove from My TIDAL"},editablePlaylists:Um,addToPlaylist:function(e,t){return jm(this,void 0,void 0,(function*(){return Rd.addToPlaylist(e,t,Td)}))},canRate:()=>!1,canStore:Qm,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return jm(this,void 0,void 0,(function*(){return{src:`plex-tidal:playlist:${(yield Rd.createPlaylist(e,t,r,Td)).ratingKey}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search:()=>rh(`/playlists/${nh(e)}`,{type:Ed.Playlist,playlistType:"audio"})}},getDrmInfo:function(e){if((null==e?void 0:e.playbackType)===jn.DASH){const t=vd.drm,r="fairplay"===t,n={type:t,keySystem:r?"com.apple.fps.1_0":B[t],license:Xm(e).replace(/\.(mpd|m3u8)/,"/license")};return r&&(n.certificate="https://resources.tidal.com/drm/fairplay/certificate"),n}},getMetadata:function(e){return jm(this,void 0,void 0,(function*(){if(!Qm(e)||void 0!==e.inLibrary)return e;const t=Qn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=nh(e),[n]=yield Rd.getMetadata([r],Td);return Object.assign(Object.assign({},e),{inLibrary:n.saved})}))},getPlayableUrl:Xm,getPlaybackType:function(e){return jm(this,void 0,void 0,(function*(){return e.mediaType===ni.Video?jn.HLS:jn.DASH}))},getThumbnailUrl:function(e){return Tm.getThumbnailUrl(e)},lookup:function(e,t,r=10,n){return jm(this,void 0,void 0,(function*(){if(!vd.hasTidal||!e||!t)return[];e=e.replace(/\s*([,;&|/x×]|(\b(feat\.?|ft\.?|featuring|with)\s))\s*/gi," ").trim();const i=e=>jm(this,void 0,void 0,(function*(){return hi(th(gd.Track,e,r,{pageSize:r,maxSize:r,lookup:!0}),{timeout:n})}));let a=yield i(`${e} ${t}`);return 0===a.length&&(a=yield i(t)),a}))},store:function(e,t){return jm(this,void 0,void 0,(function*(){yield Rd.fetch({host:Td,path:"/actions/"+(t?"save":"unsave"),method:"PUT",params:{ratingKey:nh(e)}})}))},observeIsLoggedIn:function(){return _n([Tm.observeIsLoggedIn(),(e=Wm,Om.pipe(Be((()=>Nm(e))),Vn()))]).pipe(Be((([e,t])=>e&&t)),Vn());var e},isConnected:function(){return Tm.isConnected()&&Nm(Wm)},isLoggedIn:Jm,login:Wd,logout:Gd},Gm=Wm;function Jm(){return Tm.isLoggedIn()&&Nm(Wm)}function Qm(e){switch(e.itemType){case ti.Album:return!e.synthetic;case ti.Artist:case ti.Media:return!0;default:return!1}}function Xm(e){const{userToken:t}=vd;if(t&&Jm()){const r=e.srcs||[];let n=r[0];switch(vd.streamingQuality){case fd.Lossless:n=r[0];break;case fd.High:n=r[1];break;case fd.Low:n=r[2]}if(n||(n=r[0]),!n)throw Error("No playable source");const i=Rd.getHeaders(t,vd.drm),a=new URLSearchParams(i);return`${Td}${n}?${a}`}throw Error("Not logged in")}function Zm(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`${Lm}/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>(t=t.trim())?th(function(e,t){switch(e){case ti.Album:return gd.Album;case ti.Artist:return gd.Artist;case ti.Playlist:return gd.Playlist;default:return void 0===ni.Video?gd.Clip:gd.Track}}(e),t):new pi})}function eh(e){return ih(),rh("/library/sections/saved/all",{type:e})}function th(e,t,r=100,n){return new nm({host:Pd,path:"/library/search",params:{query:t,limit:r,type:e,searchTypes:"music"}},Object.assign(Object.assign({},n),{serviceId:Lm}))}function rh(e,t,r){return new nm({host:Td,path:e,params:t},Object.assign(Object.assign({},r),{serviceId:Lm}))}function nh({src:e}){const[,,t]=e.split(":");return t}function ih(){if(!vd.hasTidal)throw new ci}var ah=r(1984);const sh=new(r.n(ah)()),oh=new J("spotify/auth"),lh=new J("spotify/user","memory"),ch={get clientId(){return gi||oh.getString("clientId")},set clientId(e){oh.setString("clientId",e)},get codeVerifier(){return oh.getString("code_verifier")},set codeVerifier(e){oh.setString("code_verifier",e)},get market(){return lh.getString("market")},set market(e){lh.setString("market",e)},get token(){return oh.getJson("token")},set token(e){oh.setJson("token",e)},get userId(){return lh.getString("userId")},set userId(e){lh.setString("userId",e)},clear(){oh.removeItem("token"),lh.clear()}};var uh=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const dh=new H("spotifyAuth"),mh=location.hostname,hh=("localhost"===mh?`http://${mh}:${location.port}`:`https://${mh}`)+"/auth/spotify/callback/",fh="https://accounts.spotify.com";let ph;const yh=new it("");function vh(){return yh.pipe(Vn())}function bh(){return!!ch.token}function gh(){return""!==yh.getValue()}function wh(){return uh(this,void 0,void 0,(function*(){dh.log("refreshToken");const e=ch.token,t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${fh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:ch.clientId,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw yield xh(),e;const r=yield e.json();return yield Eh(r),r.access_token}throw yield xh(),Error("No 'refresh_token'")}))}function Eh(e){return uh(this,void 0,void 0,(function*(){try{const{access_token:t}=e;ch.token=e,sh.setAccessToken(t),yield Sh(),kh(t)}catch(e){dh.error(e),yield xh()}}))}function kh(e){yh.next(e)}function xh(){return uh(this,void 0,void 0,(function*(){ch.clear(),yh.next(""),yield function(){return uh(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();ch.codeVerifier=e,ph=yield function(e){return uh(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}()}))}function Sh(){return uh(this,void 0,void 0,(function*(){if(!ch.userId){const e=yield sh.getMe();ch.userId=e.id,ch.market=e.country}}))}uh(void 0,void 0,void 0,(function*(){const e=ch.token;try{if(e){try{sh.setAccessToken(e.access_token),yield Sh(),bh()&&kh(e.access_token)}catch(e){if(401!==e.status||!bh())throw e;yield wh()}return}}catch(e){dh.error(e)}yield xh()}));var Th=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ph=new H("SpotifyPager");class Ah{constructor(e,t,r){this.defaultConfig={pageSize:Ah.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new Ui(((t=this.defaultConfig.pageSize)=>Th(this,void 0,void 0,(function*(){var n;const i=(this.pageNumber-1)*t,a=()=>Th(this,void 0,void 0,(function*(){const{items:n,total:a,next:s}=yield e(i,t);return this.pageNumber++,{items:n.map((e=>this.createMediaObject(e,r))),total:a,atEnd:!s}}));try{return yield a()}catch(e){if(401===e.status)return yield wh(),yield a();if(429===e.status){const t=Number(null===(n=e.headers)||void 0===n?void 0:n.get("Retry-After"));if(t&&t<=10)return yield A(1e3*t),yield a();throw e}throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>this.addUserData(e)))).subscribe(Ph)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:ti.Media,mediaType:ni.Audio,playbackType:jn.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable||void 0,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var r;return{itemType:ti.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(r=e.tracks)||void 0===r?void 0:r.total,pager:this.createAlbumPager(e),inLibrary:t}}createMediaArtist(e){return{itemType:ti.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createMediaPlaylist(e,t){const r=e.owner.id===ch.userId;return{itemType:ti.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?P(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistItemsPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:Qi.isPinned(e.uri),isOwn:r,inLibrary:!r&&t}}createMediaItemFromTrack(e,t){var r,n,i,a,s;const o=/album|compilation/i.test((null===(r=e.album)||void 0===r?void 0:r.album_type)||"")?e.album:void 0;return{itemType:ti.Media,mediaType:ni.Audio,playbackType:jn.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(n=e.artists)||void 0===n?void 0:n.map((e=>e.name)),albumArtist:null==o?void 0:o.artists.map((e=>e.name)).join(", "),album:null==o?void 0:o.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:e.disc_number,track:e.track_number,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(s=e.album)||void 0===s?void 0:s.images,unplayable:!1===e.is_playable||void 0,inLibrary:t}}createArtistAlbumsPager(e){const t=this.getMarket(),r=this.createArtistTopTracks(e),n=new pi([r]),i=new Ah(((r,n)=>Th(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield sh.getArtistAlbums(e.id,{offset:r,limit:n,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:s}}))));return new Yi(n,i)}createArtistTopTracks(e){return{itemType:ti.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){const t=this.getMarket();return new Ah(((r,n)=>Th(this,void 0,void 0,(function*(){const{tracks:i}=yield sh.getArtistTopTracks(e.id,t,{offset:r,limit:n,market:t});return{items:i,next:""}}))),{pageSize:30,maxSize:100})}createAlbumPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.total_tracks)return new Hi((()=>Th(this,void 0,void 0,(function*(){const t=r.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addUserData(t),t}))));{const t=this.getMarket();return new Ah(((r,n)=>Th(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield sh.getAlbumTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:s}}))))}}createPlaylistItemsPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.tracks.total)return new Hi((()=>Th(this,void 0,void 0,(function*(){const e=r.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addUserData(e),e}))));{const t=this.getMarket();return new Ah(((r,n)=>Th(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield sh.getPlaylistTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:s}}))))}}getMarket(){return ch.market}addUserData(e){return Th(this,void 0,void 0,(function*(){const t=e[0];if(t){const r=e.filter((e=>void 0===e.inLibrary&&Vh.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===r.length)return;let n=[];n=t.itemType===ti.Album?yield sh.containsMySavedAlbums(r):yield sh.containsMySavedTracks(r),Kn(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:n[t]}}))))}}))}}Ah.minPageSize=10,Ah.maxPageSize=50;const Ih=Ah;var Ch=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Mh={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Oh={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},$h={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new Ih(((e,t)=>Ch(this,void 0,void 0,(function*(){const{items:e,total:r}=yield sh.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:r,next:void 0}}))),{maxSize:50,pageSize:50})}},Nh={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:ti.Media,layout:Mh,search(){return new Ih(((e,t)=>Ch(this,void 0,void 0,(function*(){return sh.getMyTopTracks({offset:e,limit:t})}))))}},zh={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:ti.Artist,search(){return new Ih(((e,t)=>Ch(this,void 0,void 0,(function*(){return sh.getMyTopArtists({offset:e,limit:t})}))))}},jh={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:Mh,search(){const e=Kh();return new Ih(((t,r)=>Ch(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield sh.getMySavedTracks({offset:t,limit:r,market:e});return{items:n.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},Lh={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search(){const e=Kh();return new Ih(((t,r)=>Ch(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield sh.getMySavedAlbums({offset:t,limit:r,market:e});return{items:n.map((e=>e.album)),total:i,next:a}}))),{pageSize:20},!0)}},Dh={id:"spotify/playlists",title:"My Playlists",icon:"heart",itemType:ti.Playlist,lockActionsStore:!0,secondaryLayout:Oh,search(){const e=Kh();return new Ih(((t,r)=>Ch(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield sh.getUserPlaylists(ch.userId,{offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))),void 0,!0)}},Rh={id:"spotify/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:ti.Playlist,search(){const e=Kh(),t=ch.userId;let r=0;return new Ih(((n,i)=>Ch(this,void 0,void 0,(function*(){const{items:a,total:s,next:o}=yield sh.getUserPlaylists(t,{offset:n,limit:i,market:e}),[l,c]=m(a,(e=>e.owner.id===t));return r+=c.length,{items:l,total:s-r,next:o}}))),void 0,!0)}},Fh={id:"spotify/featured-playlists",title:"Recommended",icon:"playlist",itemType:ti.Playlist,secondaryLayout:Oh,search(){const e=Kh();return new Ih(((t,r)=>Ch(this,void 0,void 0,(function*(){const{playlists:{items:n,total:i,next:a}}=yield sh.getFeaturedPlaylists({offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))))}},_h={id:"spotify/new-albums",title:"New releases",icon:"album",itemType:ti.Album,secondaryLayout:Oh,defaultHidden:!0,search(){const e=Kh();return new Ih(((t,r)=>Ch(this,void 0,void 0,(function*(){const{albums:{items:n,total:i,next:a}}=yield sh.getNewReleases({offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))))}},Bh={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",serviceType:$n.PublicMedia,primaryMediaType:ni.Audio,defaultHidden:!0,internetRequired:!0,restrictedAccess:!0,editablePlaylists:Rh,roots:[qh(ti.Media,{title:"Songs",layout:Mh}),qh(ti.Album,{title:"Albums"}),qh(ti.Artist,{title:"Artists"}),qh(ti.Playlist,{title:"Playlists",secondaryLayout:Oh})],sources:[jh,Lh,Dh,$h,Nh,zh,Fh,_h],icons:{[Zn.AddToLibrary]:"heart",[Zn.RemoveFromLibrary]:"heart-fill"},labels:{[Zn.AddToLibrary]:"Add to Spotify Library",[Zn.RemoveFromLibrary]:"Remove from Spotify Library"},addToPlaylist:function(e,t){return Ch(this,void 0,void 0,(function*(){if(null==t?void 0:t.length){const[,,r]=e.src.split(":"),n=u(t,100);for(const e of n)yield sh.addTracksToPlaylist(r,e.map((e=>e.src)))}}))},canRate:()=>!1,canStore:Uh,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n}={}){return Ch(this,void 0,void 0,(function*(){const i=ch.userId,a=yield sh.createPlaylist(i,{name:e,description:t,public:r});if(null==n?void 0:n.length){const e=u(n,100);for(const t of e)yield sh.addTracksToPlaylist(a.id,t.map((e=>e.src)))}return{src:a.uri,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),r=Kh();return new Ih((()=>Ch(this,void 0,void 0,(function*(){return{items:[yield sh.getPlaylist(t,{market:r,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return Ch(this,void 0,void 0,(function*(){if(!Uh(e)||void 0!==e.inLibrary)return e;const t=Qn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,r]=e.src.split(":");switch(e.itemType){case ti.Album:{const[t]=yield sh.containsMySavedAlbums([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case ti.Media:{const[t]=yield sh.containsMySavedTracks([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case ti.Playlist:{const[t]=yield sh.areFollowingPlaylist(r,[ch.userId]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},getPlaybackType:function(){return Ch(this,void 0,void 0,(function*(){return jn.IFrame}))},getTracksById:function(e){return Ch(this,void 0,void 0,(function*(){const t=e.slice(0,50),r=Kh(),n=new Ih((()=>Ch(this,void 0,void 0,(function*(){const{tracks:e}=yield sh.getTracks(t,{market:r});return{items:e,total:e.length}}))),{maxSize:50,pageSize:50},!0);return hi(n)}))},lookup:function(e,t,r=10,n){return Ch(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," ");return hi(Yh(ti.Media,`${i(e)} ${i(t)}`,{pageSize:r,maxSize:r,lookup:!0}),{timeout:n})}))},lookupByISRC:function(e,t,r){return Ch(this,void 0,void 0,(function*(){if(0===e.length)return[];const n=Yh(ti.Media,e.map((e=>`isrc:${e}`)).join("+"),{pageSize:t,maxSize:t,lookup:!0});return(yield hi(n,{timeout:r})).filter((e=>!e.unplayable))}))},store:function(e,t){return Ch(this,void 0,void 0,(function*(){return Hh([e],t)}))},bulkStore:function(e,t){return Ch(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;let n=0;switch(r.itemType){case ti.Media:n=500;break;case ti.Album:n=200;break;case ti.Playlist:n=10}if(0===n)return;const i=u(e,n);for(const e of i)yield Hh(e,t)}))},observeIsLoggedIn:function(){return vh().pipe(Be((e=>""!==e)),Vn())},isConnected:bh,isLoggedIn:gh,login:function(){return uh(this,void 0,void 0,(function*(){if(!gh()){dh.log("connect");try{const e=yield function(){return uh(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let r=null;const n=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",n,!1),null==r||r.close(),r=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return uh(this,void 0,void 0,(function*(){const t=ch.codeVerifier,r=yield fetch(`${fh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:ch.clientId,grant_type:"authorization_code",code:e,redirect_uri:hh,code_verifier:t})});if(!r.ok)throw r;return yield r.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",n,!1);const i=new URLSearchParams({client_id:ch.clientId,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:hh,response_type:"code",code_challenge_method:"S256",code_challenge:ph});r=window.open(`${fh}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==r?void 0:r.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}();yield Eh(e)}catch(e){dh.error(e)}}}))},logout:function(){return uh(this,void 0,void 0,(function*(){dh.log("disconnect"),yield xh()}))}},Vh=Bh;function Uh(e,t){switch(e.itemType){case ti.Album:return!e.synthetic;case ti.Media:return!0;case ti.Playlist:return!e.isOwn&&!t;default:return!1}}function Hh(e,t){return Ch(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;const n=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>Ch(this,void 0,void 0,(function*(){switch(r.itemType){case ti.Album:t?yield Promise.all(u(n,20).map((e=>sh.addToMySavedAlbums(e)))):yield Promise.all(u(n,20).map((e=>sh.removeFromMySavedAlbums(e))));break;case ti.Media:t?yield Promise.all(u(n,50).map((e=>sh.addToMySavedTracks(e)))):yield Promise.all(u(n,50).map((e=>sh.removeFromMySavedTracks(e))));break;case ti.Playlist:t?yield Promise.all(n.map((e=>sh.followPlaylist(e)))):yield Promise.all(n.map((e=>sh.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield wh(),yield i()}}))}function qh(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Yh(e,t)})}function Yh(e,t,r){return t?new Ih(function(e,t){const r=Kh();switch(e){case ti.Media:return(e,n)=>Ch(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:s}}=yield sh.searchTracks(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case ti.Album:return(e,n)=>Ch(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:s}}=yield sh.searchAlbums(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case ti.Artist:return(e,n)=>Ch(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:s}}=yield sh.searchArtists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case ti.Playlist:return(e,n)=>Ch(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:s}}=yield sh.searchPlaylists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));default:throw TypeError("Search not supported for this type of media")}}(e,t),Object.assign({maxSize:250},r)):new pi}function Kh(){return ch.market}function Wh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Jr(e);return De((function(t,n){for(var i=e.length,a=new Array(i),s=e.map((function(){return!1})),o=!1,l=function(t){Qe(e[t]).subscribe(Re(n,(function(e){a[t]=e,o||s[t]||(s[t]=!0,(o=s.every(Ce))&&(s=null))}),pe))},c=0;c<i;c++)l(c);t.subscribe(Re(n,(function(e){if(o){var t=re([e],te(a));n.next(r?r.apply(void 0,re([],te(t))):t)}})))}))}function Gh(e){return _e((function(t,r){return e<=r}))}function Jh(e,t){return t?function(r){return rn(t.pipe(Di(1),De((function(e,t){e.subscribe(Re(t,pe))}))),r.pipe(Jh(e)))}:et((function(t,r){return Qe(e(t,r)).pipe(Di(1),function(e){return Be((function(){return e}))}(t))}))}function Qh(e,t){void 0===t&&(t=jr);var r=Rr(e,t);return Jh((function(){return r}))}var Xh,Zh,ef,tf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},rf=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},nf=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const af=new H("SpotifyPlayer"),sf="Spotify player not connected",of=(e,t)=>e.paused===t.paused&&e.position===t.position;Xh=new WeakMap,Zh=new WeakMap,ef=new WeakMap;const lf=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new it(!0),this.src$=new it(""),this.currentTrackSrc$=new it(""),this.error$=new Ne,this.playerReady$=new it(!1),this.playerStarted$=new it(!1),this.state$=new it(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,Xh.set(this,!1),Zh.set(this,!0),ef.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{af.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(_e((e=>""!==e)),et((e=>this.connect(e))),at((()=>this.playerReady$.next(!0))),Di(1)).subscribe(af)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe(et((()=>this.player.activateElement()))).subscribe(af),this.observeReady().pipe(et((()=>this.safeVolume(this.muted?0:this.volume)))).subscribe(af),this.observeReady().pipe(on((()=>this.observeIsLoggedIn())),on((e=>e?this.observePaused():an)),on((e=>e?an:this.observeSrc())),Wh(this.observeAccessToken()),on((([e,t])=>e&&e!==this.loadedSrc?pn(void 0).pipe(on((()=>this.loadError?this.reconnect(t):pn(void 0))),et((()=>this.addToQueue(e,t))),qn((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),an))),Di(1)):an))).subscribe(af),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe(at((e=>{var t,r;const n=null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri;n&&this.loadedSrc===this.src&&this.currentTrackSrc!==n&&this.currentTrackSrc$.next(n)}))).subscribe(af),this.currentTrackSrc$.pipe(_e((e=>!!e)),on((()=>this.observeCurrentTrackState().pipe(Gh(2),et((e=>!e.paused&&this.paused?(af.log("State mismatch: pausing..."),this.safePause()):e.paused&&!this.paused?(af.log("State mismatch: resuming..."),this.safePlay()):pn(void 0))),Di(1))))).subscribe(af),this.observeIsLoggedIn().pipe(Nn((e=>e===this.isLoggedIn)),at((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(sf))}))).subscribe(af),this.observeIsLoggedIn().pipe(_e((e=>e)),Di(1),et((()=>c("https://sdk.scdn.co/spotify-player.js")))).subscribe(af),this.observeError().subscribe(af.error)}get autoplay(){return rf(this,Xh,"f")}set autoplay(e){rf(this,Xh,"f")!==e&&(nf(this,Xh,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return rf(this,Zh,"f")}set muted(e){rf(this,Zh,"f")!==e&&(nf(this,Zh,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return rf(this,ef,"f")}set volume(e){rf(this,ef,"f")!==e&&(nf(this,ef,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return sn(this.observeCurrentTrackState(),this.observePaused().pipe(on((e=>e?this.getCurrentState():Fr(250).pipe(et((()=>this.getCurrentState()))))))).pipe(Be((e=>{var t,r;return(null===(r=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc?e.position/1e3:0})),Vn())}observeDuration(){return this.observeCurrentTrackState().pipe(Be((e=>e.duration/1e3)),Vn())}observeEnded(){return this.observePlaying().pipe(on((()=>this.observeCurrentTrackState())),Vn(of),Wh(this.observePaused()),Be((([e,t])=>!t&&e.paused&&0===e.position)),_e((e=>e)),Be((()=>{})))}observeError(){return this.error$}observePlaying(){return this.currentTrackSrc$.pipe(on((e=>e?this.observeCurrentTrackState().pipe(Vn(of),Wh(this.observePaused()),Be((([e,t])=>!t&&!e.paused)),Vn(),_e((e=>e)),Be((()=>{})),Di(1)):an)))}observeCurrentTrackState(){return this.observeState().pipe(_e((e=>{var t,r;return(null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc})))}appendTo(){}load({src:e}){af.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(sf))}play(){var e;af.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.isLoggedIn||this.error$.next(Error(sf))}pause(){af.log("pause"),this.paused$.next(!0),this.safePause()}stop(){af.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return tf(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(Be((e=>!!e)),Vn())}observePaused(){return this.paused$.pipe(Vn())}observeReady(){return _n([this.playerReady$,this.playerStarted$]).pipe(_e((([e,t])=>e&&t)),Be((()=>{})),Di(1))}observeSrc(){return this.src$.pipe(Vn())}observeState(){return this.state$.pipe(_e(l))}addToQueue(e,t,r=3){var n;return tf(this,void 0,void 0,(function*(){if(e!==this.src)return;if(!t)throw Error(sf);const i=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!i.ok){if(r>0)switch(i.status){case 401:{const t=yield wh();return this.addToQueue(e,t,--r)}case 429:{const r=Number(null===(n=i.headers)||void 0===n?void 0:n.get("Retry-After"));if(r&&r<=5)return yield A(1e3*r),this.addToQueue(e,t,0);throw i}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--r)}throw i}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return tf(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{let n=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>tf(this,void 0,void 0,(function*(){n&&(e=yield wh()),n=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",r),i.addListener("authentication_error",r),i.addListener("account_error",r),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{af.log("not_ready"),this.deviceId="",r("not_ready")})),i.addListener("ready",(({device_id:e})=>{af.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return tf(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return tf(this,void 0,void 0,(function*(){return af.log("reconnect"),Le(tn(this.disconnect()).pipe(Qh(1e3),et((()=>this.connect(e))),Qh(3e3),Be((()=>{}))))}))}safePause(){return tf(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){af.error(e)}}))}safePlay(){return tf(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return tf(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){af.error(e)}}))}safeVolume(e){var t;return tf(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){af.error(e)}}))}}(vh());var cf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const uf=new H("SubsonicLoginDialog");function df(e){const t=(0,n.useCallback)(((e,t,r)=>cf(this,void 0,void 0,(function*(){const n=r=>cf(this,void 0,void 0,(function*(){const n=new URLSearchParams(Object.assign(Object.assign({u:t},r),{c:"ampcast",f:"json"})).toString(),i=yield fetch(`${e}/rest/ping?${n}`);if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return JSON.stringify({userName:t,credentials:n})}));try{const e=xa(12),t=mo()(r+e);return yield n({t,s:e,v:"1.13.0"})}catch(e){if(40===e.code)throw e;return uf.log("Login failed. Attempting legacy login...."),yield n({p:r,v:"1.12.0"})}}))),[]);return n.createElement(ka,Object.assign({},e,{service:Lf,settings:vu,userName:vu.userName,login:t}))}var mf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const hf=new H("subsonicAuth"),ff=new it(""),pf=new it(!1);function yf(){return pf.getValue()}function vf(e){vu.credentials=e,ff.next(e)}ff.pipe(Vn()).pipe(_e((e=>""!==e)),et((()=>function(){return mf(this,void 0,void 0,(function*(){try{const e=yield Pu.getMusicLibraries();return vu.libraries=e,!0}catch(e){return 40===e.code?vu.credentials="":hf.error(e),ff.next(""),!1}}))}()))).subscribe(pf),ff.next(vu.credentials);var bf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class gf{constructor(e,t,r,n){this.parent=n,this.pageNumber=1,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new Ui((()=>bf(this,void 0,void 0,(function*(){const r=this.pageSize,n=(this.pageNumber-1)*r,{items:i,total:a,atEnd:s}=yield t(n,r);return this.pageNumber++,{items:i.map((t=>this.createMediaObject(e,t))),total:a,atEnd:s}}))),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e,t){let r;switch(e){case ti.Album:r=this.createMediaAlbum(t);break;case ti.Artist:r=this.createMediaArtist(t);break;case ti.Playlist:r=this.createMediaPlaylist(t);break;case ti.Folder:r=this.createFolderItem(t);break;default:r=this.createMediaItem(t)}return r}createMediaItem(e){return"video"===e.type?this.createMediaItemFromVideo(e):this.createMediaItemFromSong(e)}createFolderItem(e){return"type"in e?this.createMediaItem(e):this.createMediaFolder(e)}createMediaItemFromSong(e){return{itemType:ti.Media,mediaType:ni.Audio,playbackType:jn.Direct,src:`subsonic:audio:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,artists:[e.artist],album:e.album,duration:e.duration,track:e.track,disc:e.discNumber,year:e.year,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,thumbnails:this.createThumbnails(e.coverArt)}}createMediaItemFromVideo(e){return{itemType:ti.Media,mediaType:ni.Video,playbackType:jn.Direct,src:`subsonic:video:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,duration:e.duration,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,thumbnails:this.createThumbnails(e.id)}}createMediaAlbum(e){return{itemType:ti.Album,src:`subsonic:album:${e.id}`,title:e.name,addedAt:this.parseDate(e.created),artist:e.artist,year:e.year,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,pager:this.createAlbumTracksPager(e),thumbnails:this.createThumbnails(e.coverArt),subsonic:{isDir:e.isDir}}}createMediaArtist(e){return{itemType:ti.Artist,src:`subsonic:artist:${e.id}`,title:e.name,pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.coverArt),inLibrary:!!e.starred}}createMediaPlaylist(e){const t=`subsonic:playlist:${e.id}`;return{src:t,itemType:ti.Playlist,title:e.name,description:e.comment,addedAt:this.parseDate(e.created),duration:e.duration,trackCount:e.songCount,pager:this.createPlaylistItemsPager(e),thumbnails:this.createThumbnails(e.coverArt),isPinned:Qi.isPinned(t),isOwn:e.owner===vu.userName,owner:{name:e.owner}}}createMediaFolder(e){var t;const r=e.title||"[unknown]",n={itemType:ti.Folder,src:`subsonic:folder:${e.id}`,title:r,fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${vu.host}/rest/getCoverArt?id=${e}&size=${t}&{subsonic-credentials}`,width:t,height:r}}getFileName(e){return e.split(/[/\\]/).pop()}createAlbumTracksPager(e){return e.song?new pi(e.song.map((e=>this.createMediaObject(ti.Media,e)))):new gf(ti.Media,(()=>bf(this,void 0,void 0,(function*(){return{items:yield Pu.getAlbumTracks(e.id,e.isDir),atEnd:!0}}))))}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new pi([t]),n=e.album?new pi(e.album.map((e=>this.createMediaObject(ti.Album,e)))):new gf(ti.Album,(()=>bf(this,void 0,void 0,(function*(){return{items:yield Pu.getArtistAlbums(e.id),atEnd:!0}}))),void 0);return new Yi(r,n)}createArtistTopTracks(e){return{itemType:ti.Album,src:`subsonic:top-tracks:${e.id}`,title:"Top Songs",artist:e.name,thumbnails:this.createThumbnails(e.coverArt),pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){return new gf(ti.Media,(()=>bf(this,void 0,void 0,(function*(){return{items:yield Pu.getArtistTopTracks(e.name),atEnd:!0}}))))}createPlaylistItemsPager(e){return e.entry?new pi(e.entry.map((e=>this.createMediaObject(ti.Media,e)))):new gf(ti.Media,(()=>bf(this,void 0,void 0,(function*(){return{items:yield Pu.getPlaylistItems(e.id),atEnd:!0}}))))}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new gf(ti.Folder,(()=>bf(this,void 0,void 0,(function*(){return{items:yield Pu.getMusicDirectoryItems(r),atEnd:!0}}))),{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===ti.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new pi([e]);return new Yi(t,n)}return n}}gf.minPageSize=10,gf.maxPageSize=500;const wf=gf;var Ef=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const kf="subsonic",xf={id:"subsonic/liked-songs",title:"My Songs",icon:"heart",itemType:ti.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search(){return new wf(ti.Media,(()=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getLikedSongs(),atEnd:!0}}))))}},Sf={id:"subsonic/liked-albums",title:"My Albums",icon:"heart",itemType:ti.Album,lockActionsStore:!0,search(){return new wf(ti.Album,((e,t)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getLikedAlbums(e,t)}}))))}},Tf={id:"subsonic/recently-played",title:"Recently Played",icon:"clock",itemType:ti.Album,search(){return new wf(ti.Album,((e,t)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getRecentlyPlayed(e,t)}}))))}},Pf={id:"subsonic/most-played",title:"Most Played",icon:"most-played",itemType:ti.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},secondaryLayout:{view:"details",fields:["Index","Title","Artist","Duration","PlayCount"]},search(){return new wf(ti.Album,((e,t)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getMostPlayed(e,t)}}))))}},Af={id:"subsonic/playlists",title:"Playlists",icon:"playlist",itemType:ti.Playlist,layout:{view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},search(){return new wf(ti.Playlist,(()=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getPlaylists(),atEnd:!0}}))))}},If={id:"subsonic/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:ti.Media,viewType:ga.ByGenre,defaultHidden:!0,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},search(e){return e?new wf(ti.Media,((t,r)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getSongsByGenre(e.id,t,r),total:e.count}})))):new pi}},Cf={id:"subsonic/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:ti.Album,viewType:ga.ByGenre,search(e){return e?new wf(ti.Album,((t,r)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getAlbumsByGenre(e.id,t,r),total:e.count}})))):new pi}},Mf={id:"subsonic/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:ti.Album,viewType:ga.ByDecade,search(e){return e?new wf(ti.Album,((t,r)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getAlbumsByDecade(e.id,t,r)}})))):new pi}},Of={id:"subsonic/random-tracks",title:"Random Songs",icon:"shuffle",itemType:ti.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search(){return new wf(ti.Media,(()=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getRandomSongs(100),atEnd:!0}}))))}},$f={id:"subsonic/random-albums",title:"Random Albums",icon:"shuffle",itemType:ti.Album,search(){return new wf(ti.Album,(()=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getRandomAlbums(100),atEnd:!0}}))))}},Nf={id:"subsonic/videos",title:"Music Videos",icon:"video",itemType:ti.Media,mediaType:ni.Video,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Duration"]},search(){return new wf(ti.Media,(()=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.getVideos(),atEnd:!0}}))))}},zf={id:"subsonic/folders",title:"Folders",icon:"folder",itemType:ti.Folder,viewType:ga.Folders,search(){const e={itemType:ti.Folder,src:"",title:"Folders",fileName:"",path:""},t=(e,t)=>e.name.localeCompare(t.name);return e.pager=new Hi((()=>Ef(this,void 0,void 0,(function*(){return vu.libraries.filter((({id:e})=>!!e)).map((({id:r,title:n})=>{const i={itemType:ti.Folder,src:`subsonic:folder:${r}`,title:n,fileName:n,path:`/${n}`},a=Object.assign(Object.assign({},e),{fileName:"../"}),s=new pi([a]),o=new wf(ti.Folder,(()=>Ef(this,void 0,void 0,(function*(){return{items:(yield Pu.getIndexes(r)).map((e=>e.artist.map((({id:e,name:t})=>({id:e,name:t,title:t}))))).flat().sort(t),atEnd:!0}}))),void 0,i);return i.pager=new Yi(s,o),i}))})))),e.pager}},jf={id:kf,icon:kf,name:"Subsonic",url:"http://www.subsonic.org/",serviceType:$n.PersonalMedia,defaultHidden:!0,roots:[Rf(ti.Media,{title:"Songs"}),Rf(ti.Album,{title:"Albums"}),Rf(ti.Artist,{title:"Artists"})],sources:[xf,Sf,Tf,Pf,Af,If,Cf,Mf,Of,$f,Nf,zf],labels:{[Zn.AddToLibrary]:"Like on Subsonic",[Zn.RemoveFromLibrary]:"Unlike on Subsonic"},editablePlaylists:Af,get audioLibraries(){return vu.audioLibraries},get libraryId(){return vu.libraryId},set libraryId(e){vu.libraryId=e},get libraries(){return vu.libraries},set libraries(e){vu.libraries=e},observeLibraryId:()=>vu.observeLibraryId(),addToPlaylist:function(e,t){return Ef(this,void 0,void 0,(function*(){const r=_f(e);return Pu.addToPlaylist(r,t.map(_f))}))},canRate:()=>!1,canStore:Df,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n=[]}={}){return Ef(this,void 0,void 0,(function*(){return{src:`subsonic:playlist:${(yield Pu.createPlaylist(e,t,r,n.map(_f))).id}`,title:e,itemType:ti.Playlist,pager:new pi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:ti.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search(){const t=_f(e);return new wf(ti.Playlist,(()=>Ef(this,void 0,void 0,(function*(){return{items:[yield Pu.getPlaylist(t)],atEnd:!0}}))))}}},getFilters:function(e,t){return Ef(this,void 0,void 0,(function*(){return Pu.getFilters(e,t)}))},getMetadata:function(e){var t;return Ef(this,void 0,void 0,(function*(){const r=e.itemType,n=_f(e);if(r===ti.Album){if(e.synthetic)return e;if(void 0===e.description){const r=yield Pu.getAlbumInfo(n,null===(t=e.subsonic)||void 0===t?void 0:t.isDir);e=Object.assign(Object.assign({},e),{description:P(r.notes),release_mbid:r.musicBrainzId})}}else if(r===ti.Artist&&void 0===e.description){const t=yield Pu.getArtistInfo(n);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!Df(e)||void 0!==e.inLibrary)return e;const i=Qn.getInLibrary(e);if(void 0!==i)return Object.assign(Object.assign({},e),{inLibrary:i});if(r===ti.Album){const t=yield Ff(e),r=yield Pu.getMusicDirectory(t);return Object.assign(Object.assign({},e),{inLibrary:r.starred})}{const t=yield Pu.getSong(n);return Object.assign(Object.assign({},e),{inLibrary:t.starred})}}))},getPlayableUrl:function({src:e}){return Pu.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{subsonic-credentials}",vu.credentials)},lookup:function(e,t,r=10,n){return Ef(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return hi(new wf(ti.Media,((r,n)=>Ef(this,void 0,void 0,(function*(){return{items:yield Pu.searchSongs(`${e} ${t}`,r,n)}}))),i),{timeout:n})}))},store:function(e,t){return Ef(this,void 0,void 0,(function*(){const r=t?"star":"unstar";switch(e.itemType){case ti.Media:{const[,,t]=e.src.split(":");yield Pu.get(r,{id:t});break}case ti.Album:{const t=yield Ff(e);yield Pu.get(r,{id:t});break}}}))},observeIsLoggedIn:function(){return pf.pipe(Vn())},isConnected:function(){return!!vu.credentials},isLoggedIn:yf,login:function(){return mf(this,void 0,void 0,(function*(){if(!yf()){hf.log("connect");try{const e=yield function(){return cf(this,void 0,void 0,(function*(){return dr(df,!0)}))}();if(e){const{userName:t,credentials:r}=JSON.parse(e);vu.userName=t,vf(r)}}catch(e){hf.error(e)}}}))},logout:function(){return mf(this,void 0,void 0,(function*(){hf.log("disconnect"),vu.clear(),vf(""),pf.next(!1)}))}},Lf=jf;function Df(e){switch(e.itemType){case ti.Media:return!0;case ti.Album:return!e.synthetic;default:return!1}}function Rf(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`subsonic/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){return(t=t.trim())?new wf(e,((r,n)=>Ef(this,void 0,void 0,(function*(){switch(e){case ti.Media:return{items:yield Pu.searchSongs(t,r,n)};case ti.Album:return{items:yield Pu.searchAlbums(t,r,n)};case ti.Artist:return{items:yield Pu.searchArtists(t,r,n)};default:throw TypeError("Search not supported for this type of media")}})))):new pi}})}function Ff(e){var t;return Ef(this,void 0,void 0,(function*(){const r=_f(e);if(null===(t=e.subsonic)||void 0===t?void 0:t.isDir)return r;const[{parent:n}]=yield Pu.getAlbumTracks(r);return n||""}))}function _f({src:e}){const[,,t]=e.split(":");return t}const Bf=new H("mediaServices");function Vf(){return[ha,Vh,bs,no,cd,Tm,Gm,Lf,Uc,jo,du]}function Uf(){return Vf().filter((e=>!e.disabled))}function Hf(e){if(ep(e.src))return!0;const t=Xf(e);return!!(null==t?void 0:t.isLoggedIn())}function qf(){return Uf().filter(tp)}function Yf(){return Uf().filter((e=>!!e.lookup))}function Kf(){return Uf().filter(rp)}function Wf(){return Vf().filter((e=>!tp(e)))}function Gf(){return Uf().filter(ip)}function Jf(){return qf().filter((e=>e.canScrobble))}function Qf(e){return Vf().find((t=>t.id===e))}function Xf({src:e}={}){const[t]=String(e).split(":");return Qf(t)}function Zf(e){return!!e&&np(e.src)}function ep(e){const[t]=String(e).split(":");return/^(blob|file|https?|youtube)$/.test(t)}function tp(e){return ap(e,$n.DataService)}function rp(e){return ap(e,$n.PersonalMedia)}function np(e){if(ep(e))return!0;const[t,r,n]=String(e).split(":");return!!n&&!!r&&function(e){const t=Qf(e);return!!t&&t.serviceType!==$n.DataService}(t)}function ip(e){return ap(e,$n.PublicMedia)}function ap(e,t){return function(e){return!!e&&"serviceType"in e}(e)&&e.serviceType===t}if(Qn.registerServices(Uf()),!$m||Uc.disabled){let e=!1;const t={};if(Uc.disabled&&Nm(Uc)&&(t[Uc.id]=!0,e=!0),!$m){const r=Gf().filter(Nm);if(r.length>1){let n=r;if(vd.hasTidal||(n=S(n,(e=>e!==Gm))),n.length>1&&(n=S(n,(e=>e.isConnected())),n.length>1)){const e=[ha,Gm,Vh,Uc];for(;n.length>1&&e.length>0;){const t=e.pop();n=S(n,(e=>e!==t))}}const[i]=n;for(const e of r)e!==i&&(t[e.id]=!0,e.isConnected()&&!e.authService&&e.logout());e=!0}}e&&zm(t)}function sp({service:e,showConnectivity:t,showRestrictedAccess:r}){const i=e.authService||e,a=r&&ip(e)&&e.restrictedAccess;return n.createElement(kr,{className:"media-service-label",icon:e.icon,text:e===i?`${e.name}${a?" *":""}`:n.createElement(n.Fragment,null,e.name," ",n.createElement("span",{className:`auth-service auth-service-${i.id} ${t?"show-connectivity":""}`,title:`via ${i.name}`},i.name)),showConnectivity:t})}tn(Uf()).pipe(et((e=>e.observeIsLoggedIn().pipe(Nn((e=>!e)),at((t=>Bf.log(`${e.id} ${t?"":"dis"}connected`))))))).subscribe(Bf);var op=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function lp(e){var{id:t,item:r,index:i,selected:a}=e,s=op(e,["id","item","index","selected"]);const o=(0,n.useCallback)((e=>{e.target.focus()}),[]);return n.createElement("button",Object.assign({},s,{className:"tab",type:"button",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`,onMouseDown:o}),r.tab)}function cp({id:e,item:t,index:r,hidden:i}){return n.createElement("div",{className:"tab-panel",id:`${e}-panel-${r}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${r}`},t.panel)}function up({label:e,items:t,className:r=""}){const i=(0,n.useId)(),a=(0,n.useRef)(null),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(0);(0,n.useEffect)((()=>{o(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,n.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),s.length-1);const r=s[t];r&&!r.disabled&&r.focus()}),[l,s]),d=(0,n.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return n.createElement("div",{className:`tab-list ${r}`},n.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>n.createElement("li",{role:"presentation",key:t},n.createElement(lp,{id:i,item:e,index:t,selected:t===l}))))),n.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>n.createElement(cp,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}function dp(e,t){const[r,i]=(0,n.useState)(t);return(0,n.useEffect)((()=>{const t=e().subscribe(i);return()=>t.unsubscribe()}),[e]),r}function mp(){return dp((0,n.useMemo)((()=>()=>sn(Gt.observe(),Kt.observeUserThemes()).pipe(Be((()=>Object.assign({},Gt.current))))),[]),Gt.current)}function hp(){return dp((0,n.useMemo)((()=>()=>Kt.observeUserThemes()),[]),[])}var fp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function pp(e){var{icon:t,className:r=""}=e,i=fp(e,["icon","className"]);return n.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${r}`,type:"button",onMouseDown:E,onMouseUp:w}),n.createElement(rt,{name:t}))}var yp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function vp(e){var{colorName:t,onChange:r}=e,i=yp(e,["colorName","onChange"]);const a=(0,n.useCallback)((e=>{const n=e.target.value;Gt[t]=n,null==r||r(n)}),[t,r]);return n.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function bp({label:e,backgroundColorName:t,textColorName:r,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:s,nextSuggestion:o,trackingColor:l="frame"}){const c=mp(),u=i&&a,d=c[t],m=c[r],[h,f]=(0,n.useState)((()=>d||i||"")),[p,y]=(0,n.useState)((()=>m||a||"")),v=!d&&!m,b=(0,n.useCallback)((()=>{if(s&&o){const[e,n]=s;Gt[t]=e,Gt[r]=n,o()}}),[t,r,s,o]),g=(0,n.useCallback)((()=>{v?(Gt[t]=h,Gt[r]=p):(Gt[t]="",Gt[r]="")}),[v,t,r,h,p]),w=(0,n.useCallback)((()=>{const e=Gt[t],n=Gt[r];Gt[t]=n,Gt[r]=e}),[t,r]);return n.createElement("p",{className:"color-pair "+(v?"locked":"")},n.createElement("label",null,e,":"),n.createElement(vp,{colorName:t,value:d||i,title:`${e} background color`,disabled:v,onChange:f}),n.createElement(pp,{icon:"swap",title:"Swap",onClick:w,disabled:v}),n.createElement(vp,{colorName:r,value:m||a,title:`${e} text color`,disabled:v,onChange:y}),u?n.createElement(pp,{icon:v?"locked":"unlocked",title:v?"Allow editing":`Lock to ${l} color`,onClick:g}):null,s&&o?n.createElement("button",{className:"small",type:"button",onClick:b},"Suggest"):null)}function gp(e,t){const r=new Tt(e),n=new Tt(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)}function wp(e,t,r={includeFallbackColors:!1,level:"AA",size:"small"}){let n=null,i=0;const{includeFallbackColors:a,level:s,size:o}=r;for(const r of t){const t=gp(e,r);t>i&&(i=t,n=new Tt(r))}return function(e,t,r={level:"AA",size:"small"}){const n=gp(e,t);switch((r.level??"AA")+(r.size??"small")){case"AAsmall":case"AAAlarge":return n>=4.5;case"AAlarge":return n>=3;case"AAAsmall":return n>=7;default:return!1}}(e,n,{level:s,size:o})||!a?n:(r.includeFallbackColors=!1,wp(e,["#fff","#000"],r))}let Ep=null,kp="none";const xp="text/ampcast-items",Sp={get type(){return xp},set:function(e,t,r){e.dataTransfer.setData(xp,"#globalDrag"),e.dataTransfer.effectAllowed=r,Ep=t,kp=r},unset:function(){Ep=null,kp="none"},getData:function(e){return"#globalDrag"===e.dataTransfer.getData(xp)?Ep:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData(xp)?kp:"none"}};function Tp({style:e,title:t}){return n.createElement("div",{className:"list-view-cell",style:e},t)}function Pp({col:e,onResize:t}){const[r,i]=(0,n.useState)(-1),[a,s]=(0,n.useState)(0),o=-1!==r,{width:l,index:c}=e,u=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&(i(e.screenX),s(l))}),[l]);(0,n.useEffect)((()=>t(e.index,l)),[e.index,l,t]);const d=(0,n.useCallback)((e=>{t(c,Math.max(20,a+(e.screenX-r)))}),[r,a,c,t]),m=(0,n.useCallback)((()=>{i(-1),s(0)}),[]);return(0,n.useEffect)((()=>{if(o)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[o,d,m]),n.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+l-4+"px"}})}function Ap({width:e,height:t,cols:r,sizeable:i,onColumnResize:a}){const s=(0,n.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return n.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},n.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},r.map((e=>n.createElement(Tp,Object.assign({},e,{key:e.index}))))," ",i&&r.map((e=>n.createElement(Pp,{col:e,onResize:s,key:e.index})))))}function Ip({rowIndex:e,col:{className:t="",render:r,style:i},item:a}){return n.createElement("div",{className:`list-view-cell ${t}`,style:i},r(a,e))}function Cp({item:e,className:t,id:r,rowIndex:i,height:a,selected:s,cols:o,setSize:l,dragIndex:c}){const u=`${t} ${s?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return n.createElement("li",{role:"option",className:`list-view-row ${u}`,id:r,"aria-selected":s,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},o.map((t=>n.createElement(Ip,{rowIndex:i,col:t,item:e,key:t.index}))))}function Mp({listViewId:e,title:t,width:r,height:i,rowHeight:a,cols:s,items:o,itemKey:l,itemClassName:c,selectedId:u,selectedIds:d,scrollTop:m,overScan:h=2,draggable:f,dragIndex:p,multiple:y=!1}){const v=(0,n.useRef)(null),b=o.length,g=Math.floor(m/a),w=Math.floor(i/a),E=Math.max(0,g-h),k=Math.min(b,w+2*h),x=o.slice(E,E+k);return n.createElement("ol",{role:"listbox",className:"list-view-body",draggable:f,style:{width:r?`${r}px`:void 0},"aria-label":t,"aria-multiselectable":y,"aria-activedescendant":u,ref:v},x.map(((t,r)=>n.createElement(Cp,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+r,height:a,selected:!!t&&d.includes(t[l]),cols:s,item:t,setSize:b,dragIndex:p,key:t[l]}))))}const Op=[],$p=()=>"",Np=["ArrowUp","ArrowDown","PageUp","PageDown"];function zp({items:e=[],itemKey:t,title:r,itemClassName:i=$p,layout:a,className:s="",selectedIndex:o=-1,draggable:c,droppable:u,droppableTypes:d=[],multiple:m,reorderable:h,disabled:f,onClick:p,onDoubleClick:y,onContextMenu:v,onDrop:b,onDelete:g,onEnter:w,onInfo:E,onRowIndexChange:k,onScrollIndexChange:x,onPageSizeChange:S,onSelect:T,onMove:P,listViewRef:A}){const I=(0,n.useId)(),C=(0,n.useRef)(null),M=(0,n.useRef)(null),O=(0,n.useRef)(null),$=(0,n.useRef)(null),N=(0,n.useRef)(null),z="details"===a.view&&a.showTitles,L="details"===a.view&&a.sizeable,[D,R]=(0,n.useState)(-1),[F,_]=(0,n.useState)(0),[B,V]=(0,n.useState)(0),[U,H]=(0,n.useState)(0),[q,Y]=(0,n.useState)(0),[K,W]=function(e){const[t,r]=(0,n.useState)([]),i="details"===e.view&&e.sizeable;(0,n.useEffect)((()=>{const t="details"===e.view,n=t&&e.sizeable;r(e.cols.reduce(((e,r,i)=>{const a=e[i-1],s=a?a.left+a.width:0,{title:o="",className:l="",align:c="left",width:u=200}=r,d=n?{left:`${s}px`,width:`${u}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},r),{title:o,className:l,align:c,index:i,left:s,width:u,style:d})),e}),[]))}),[e]);const a=(0,n.useCallback)(((e,n)=>{i&&t[e].width!==n&&r(t.reduce(((t,r,i)=>{if(i>=e){const a=t[i-1],s=a?a.left+a.width:0,o=i===e?n:r.width,l={left:`${s}px`,width:`${o}px`,textAlign:r.align};t.push(Object.assign(Object.assign({},r),{left:s,width:o,style:l}))}else t.push(r);return t}),[]))}),[t,i]);return[t,a]}(a),G=(0,n.useMemo)((()=>K.reduce(((e,t)=>e+t.width),0)),[K]),J=q?Math.max(Math.floor(B/q),1)-(z?1:0):0,Q=e.length,{selectedItems:X,selectAll:Z,selectAt:ee,selectRange:te,toggleSelectionAt:re}=function(e,t,r){const[i,a]=(0,n.useState)([]),s=vn(e);(0,n.useEffect)((()=>{if(e!==s){const s=e.filter((e=>i.some((r=>r[t]===e[t]))));if(o=s,(n=i).length!==o.length||!n.every(((e,t)=>o[t]===e))){const t=e.length;if(t>0&&0===s.length)if(r<t){const t=e[r];a(t?[t]:[])}else{const r=e[t-1];a(r?[r]:[])}else a(s)}}var n,o}),[s,e,i,t,r]);const o=(0,n.useCallback)((()=>{a(e.filter(l))}),[e]),c=(0,n.useCallback)((t=>{const r=e[t];a(r?[r]:[])}),[e]),u=(0,n.useCallback)(((t,r)=>{const n=Math.min(t,r),i=Math.max(t,r),s=e.slice(n,i+1).filter(l);a(s)}),[e]),d=(0,n.useCallback)(((t,r)=>{const n=e[t],s=i.includes(n);s!==r&&a(s?i.filter((e=>e!==n)):e.filter((e=>i.includes(e)||e===n)))}),[e,i]);return{selectedItems:i,selectAll:o,selectAt:c,selectRange:u,toggleSelectionAt:d}}(e,t,D),ne=X.length>0,ie=Xt(),[ae,se]=(0,n.useState)(-1),[oe,le]=(0,n.useState)(-1),[ce,ue]=(0,n.useState)(-1),de=0===Q,me=-1!==ce,he=q?Math.floor(F/q):0,fe=yn(Np)&&!(0===D||D===Q-1),pe=vn(e),[ye,ve]=(0,n.useState)((()=>X)),[be,ge,we,Ee]=c||h?X:[],ke=e[D]?`${I}-${e[D][t]}`:"",xe=(0,n.useMemo)((()=>X.map((e=>e[t]))),[X,t]),Se=(0,n.useCallback)((()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.focus()}),[]),Te=(0,n.useCallback)((e=>{const t=O.current,r=Math.floor(F/q);if(e>=r+J-1){const r=(Q+(z?1:0))*q,n=Q-J-1,i=Math.min(Q-1,e+1)-J,a=i===n?r:i*q;t.scrollTo({top:a})}else if(e<=r){const r=Math.max(0,e-1)*q;t.scrollTo({top:r})}}),[F,q,J,z,Q]),Pe=(0,n.useCallback)((e=>{Te(e),ee(e),R(e)}),[Te,ee]);(0,n.useEffect)((()=>{C.current={focus:Se,scrollIntoView:Pe,scrollTo:Te,selectAll:Z,selectAt:ee},A&&(A.current=Object.assign(A.current||{},C.current))}),[A,Se,Pe,Te,Z,ee]),(0,n.useEffect)((()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView(o)}),[o]),(0,n.useEffect)((()=>null==k?void 0:k(D)),[D,k]),(0,n.useEffect)((()=>null==x?void 0:x(he)),[he,x]),(0,n.useEffect)((()=>null==S?void 0:S(J)),[J,S]),(0,n.useEffect)((()=>null==T?void 0:T(ye)),[ye,T]),(0,n.useEffect)((()=>R(Math.min(Q-1,D))),[Q,D]),(0,n.useEffect)((()=>{if(pe&&e.length!==pe.length){const r=pe[D];if(r){const n=e.findIndex((e=>e&&e[t]===r[t]));-1!==n&&R(n)}}}),[e,pe,D,t]),(0,n.useEffect)((()=>{fe||ve(X)}),[X,fe]),(0,n.useEffect)((()=>{de&&R(-1)}),[de]),(0,n.useEffect)((()=>{!m&&X.length>1&&ee(D)}),[m,D,X,ee]);const Ae=(0,n.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==w||w(X,t[j.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==g||g(X);break;case"KeyI":if(t[j.ctrlKey]&&!t.shiftKey){t.preventDefault(),t.stopPropagation(),t.repeat||null==E||E(X);break}break;case"KeyA":t[j.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||Z());break;case"ShiftLeft":case"ShiftRight":t.repeat||se(D);break;case"Space":t.preventDefault(),t.repeat||(t[j.ctrlKey]?(t.stopPropagation(),re(D)):X.includes(e[D])||(t.stopPropagation(),re(D,!0)));break;default:{const r=e.length,n=function(e,t,r,n){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=r-1;break;case"PageDown":t+=r-1;break;case"Home":t=0;break;case"End":t=n-1;break;default:return-1}return Math.min(Math.max(t,0),n-1)}(t.key,D,J,r);-1!==n&&(t.preventDefault(),n!==D&&(t.stopPropagation(),Te(n),R(n)),m&&t.shiftKey&&-1!==ae?te(ae,n):t[j.ctrlKey]||ee(n))}}}),[D,e,J,w,g,E,Te,Z,ee,te,re,X,m,ae]),Ie=(0,n.useCallback)((e=>{const t=jp(e);-1!==t&&(R(t),m&&e.shiftKey?-1===ae?te(t,D):te(ae,t):m&&e[j.ctrlKey]?re(t):function(e){const t=Lp(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||ee(t))}),[ee,re,te,D,ae,m]),Ce=(0,n.useCallback)((e=>{if(0===e.button){const t=jp(e);-1!==t&&(!m||e[j.ctrlKey]||e.shiftKey||ee(t))}}),[ee,m]),Me=(0,n.useCallback)((e=>{"Shift"===e.key&&se(-1)}),[]),Oe=(0,n.useCallback)((({clientWidth:e,clientHeight:t})=>{H(e),V(t)}),[]),$e=(0,n.useCallback)((({top:e})=>{_(e)}),[]);Jt($,(({height:e})=>Y(e)),"border-box"),(0,n.useEffect)((()=>{M.current.classList.toggle("thin",20*ie>U)}),[ie,U]);const Ne=(0,n.useCallback)((t=>{const r=jp(t);-1!==r&&(t.preventDefault(),null==p||p(e[r],r))}),[e,p]),ze=(0,n.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(M.current,D);if(t){const r=t.getBoundingClientRect();null==v||v(X,Math.min(r.left+U,r.right),r.bottom,D,e.button)}}else null==v||v(X,e.pageX,e.pageY,jp(e),e.button)}),[D,X,v,U]),je=(0,n.useCallback)((t=>{const r=jp(t);-1!==r&&(t.preventDefault(),null==y||y(e[r],r))}),[e,y]);(0,n.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(M.current.querySelectorAll(".list-view-body:not(.list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let r=0;r<t.length;r++){const n=t[r].cloneNode(!0);n.removeAttribute("id"),n.removeAttribute("role"),n.style.transform=`translateY(${q*r}px)`,e.appendChild(n)}}),[be,ge,we,Ee,q]);const Le=(0,n.useCallback)((e=>{const t=e.dataTransfer;if(c||h){t.setDragImage(N.current,-16,-16);let r="none";r=c&&h?"copyMove":c?"copy":"move",Sp.set(e,X,r),ue(D)}else t.effectAllowed="none"}),[c,h,X,D]),De=(0,n.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(u||h){let r=jp(e);-1===r&&(r=Q),me?h&&Dp(t,d)?(t.dropEffect="move",le(r)):(t.dropEffect="none",le(-1)):u&&Dp(t,d)?(t.dropEffect="copy",le(r)):(t.dropEffect="none",le(-1))}else me?t.dropEffect="copy":(t.dropEffect="none",le(-1))}),[Q,me,u,d,h]),Re=(0,n.useCallback)((e=>{if(u||h){let t=jp(e);-1===t&&(t=Q);const r=Sp.getEffect(e);if(!h||"move"!==r&&"copyMove"!==r){if(u){const r=function(e,t){const r=e.dataTransfer;switch(r.types[0]){case"Files":return Array.from(r.files).filter((e=>t.some((t=>Fp(t,e.type)))));case"text/ampcast-items":return Sp.getData(e);default:return Rp(r,t)}}(e,d);r&&(null==b||b(r,t))}}else{const e=ce<t?-1:0;null==P||P(X,t),R(t+e)}}le(-1),e.preventDefault(),e.stopPropagation()}),[Q,X,u,d,h,ce,b,P]),Fe=(0,n.useCallback)((()=>{Sp.unset(),ue(-1)}),[]),_e=(0,n.useCallback)((e=>{const t=e.dataTransfer;"copyMove"===t.effectAllowed&&(t.dropEffect="copy"),le(-1)}),[]),Be=(0,n.useCallback)((()=>{m||ne||ee(Math.max(D,0))}),[ne,D,m,ee]);return n.createElement("div",{className:`list-view list-view-${a.view} ${s}`,tabIndex:f?void 0:de?-1:0,onClick:Ne,onContextMenu:ze,onDoubleClick:je,onDragStart:Le,onDragEnter:De,onDragOver:De,onDragLeave:_e,onDragEnd:Fe,onDrop:Re,onFocus:Be,onKeyDown:Ae,onKeyUp:Me,onMouseDown:Ie,onMouseUp:Ce,ref:M},n.createElement(hn,{scrollWidth:L?G:void 0,scrollHeight:(Q+(u?1:0)+(z?1:0))*q,scrollAmount:q,droppable:u||h&&me,onResize:Oe,onScroll:$e,scrollableRef:O},z&&n.createElement(_r,null,n.createElement(Ap,{width:G,height:q,sizeable:L,cols:K,onColumnResize:W})),n.createElement(Mp,{title:r,width:L?G:void 0,height:B,rowHeight:q,cols:K,items:e,itemKey:t,itemClassName:i,listViewId:I,selectedId:ke,selectedIds:f?Op:xe,scrollTop:F,dragIndex:oe,draggable:!f&&(c||h),multiple:m}),n.createElement("div",{className:"list-view-cursor",style:{width:L?`${G}px`:void 0,transform:`translateY(${Math.max(D,0)*q}px)`},ref:$})),n.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function jp(e){let t=0;const r=Lp(e);return r&&(t=Number(r.getAttribute("aria-posinset"))||0),t-1}function Lp(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function Dp(e,t){return null!==Rp(e,t)}function Rp(e,t){const r=[Sp.type].concat(t),n=Array.from(e.items);for(const e of r)for(const t of n)if(Fp(e,t.type))return t;return null}function Fp(e,t){const[r,n]=e.split("/"),[i,a]=t.split("/");return r===i&&(n===a||"*"===n)}var _p=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Bp(e){var{renderItem:t=String,className:r=""}=e,i=_p(e,["renderItem","className"]);const a=(0,n.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return n.createElement(zp,Object.assign({},i,{className:`list-box ${r}`,layout:a}))}var Vp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Up(e){return Vp(this,void 0,void 0,(function*(){return!Kt.getUserTheme(e)||wr({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var Hp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function qp(e){var{suggestedName:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["suggestedName"]);const i=(0,n.useId)(),a=(0,n.useMemo)((()=>e=>e.name),[]),[s,o]=(0,n.useState)(t),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u=hp(),d=(0,n.useCallback)((e=>{o(e.target.value)}),[]),m=(0,n.useCallback)((([e])=>{e&&(c.current.value=e.name,o(e.name))}),[]),h=(0,n.useCallback)((()=>Hp(this,void 0,void 0,(function*(){s&&(yield Up(s))&&l.current.close(s)}))),[s]),f=(0,n.useCallback)((e=>Hp(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return n.createElement(cr,Object.assign({},r,{className:"save-theme-dialog",title:"Save Theme",onSubmit:f,ref:l}),n.createElement("form",{method:"dialog"},n.createElement("p",{className:"prompt-message"},n.createElement("label",{htmlFor:i},"Name: "),n.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),n.createElement(Bp,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),n.createElement(yr,{value:s,submitText:"Save"})))}var Yp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Kp=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=mp(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useMemo)((()=>Gt.fontSize),[]),o=(0,n.useMemo)((()=>Kt.getDefaultThemes()),[]),l=hp(),c=!!t.userTheme;(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Gt.fontSize)),()=>{Gt.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,n.useCallback)((()=>Gt.save()),[]),d=(0,n.useCallback)((()=>{const e=a.current.checked?Kt.getUserTheme(i.current.value):Kt.getDefaultTheme(r.current.value);e&&Gt.apply(e)}),[]),m=(0,n.useCallback)((e=>{Gt.fontSize=e.target.valueAsNumber}),[]);return n.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},n.createElement("fieldset",null,n.createElement("legend",null,"Theme"),n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),n.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),n.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:r},o.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))),n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),n.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),n.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))))),n.createElement("fieldset",null,n.createElement("legend",null,"Preferences"),n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"font-size"},n.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),n.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:s,onChange:m})))),n.createElement(yr,null))}),null)},{tab:"Theme Editor",panel:n.createElement((function(){const e=(0,n.useId)(),t=mp(),r=`${t.name}${Gt.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,s]=function(e){const[t,r]=(0,n.useState)([]),[i,a]=(0,n.useState)(-1);(0,n.useEffect)((()=>{const t=new Tt(e),n=h([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new Tt(e))),i=n.reverse().map((e=>[e.toHexString(),wp(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));r(p(i)),a(-1===i.length?-1:0)}),[e]);const s=(0,n.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],s]}(t.frameColor);(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Gt.fontSize)),()=>{Gt.restore(),e.removeProperty("--font-size")}}),[]);const o=(0,n.useCallback)((()=>{Gt.save()}),[]),l=(0,n.useCallback)((()=>{!function(e){var t,r,i,a;t=this,r=void 0,a=function*(){const t=yield dr((t=>n.createElement(qp,Object.assign({},t,{suggestedName:e}))),!0);t&&(Gt.name=t,Gt.userTheme=!0,yield Kt.save(Gt.current))},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,r||[])).next())}))}(t.name)}),[t]),c=(0,n.useCallback)((e=>{Gt.spacing=e.target.valueAsNumber}),[]),u=(0,n.useCallback)((e=>{Gt.roundness=e.target.valueAsNumber}),[]),d=(0,n.useCallback)((e=>{Gt.flat=e.target.checked}),[]);return n.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:o},n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"theme-name"},n.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),n.createElement("input",{type:"text",id:`${e}-theme-name`,value:r,spellCheck:!1,readOnly:!0,tabIndex:-1}),n.createElement("button",{className:"small",type:"button",onClick:l},"Save as…")),n.createElement(bp,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),n.createElement(bp,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),n.createElement(bp,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:s,key:`${i}/selection`}),n.createElement(bp,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:Gt.defaultMediaButtonColor,defaultTextColor:Gt.defaultMediaButtonTextColor,key:`${i}/media-button`}),n.createElement(bp,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:Gt.defaultButtonColor,defaultTextColor:Gt.defaultButtonTextColor,key:`${i}/button`}),n.createElement(bp,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:Gt.defaultScrollbarColor,defaultTextColor:Gt.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),n.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),n.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),n.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),n.createElement(yr,null))}),null)},{tab:"My Themes",panel:n.createElement((function(){const e=(0,n.useRef)(null),t=(0,n.useMemo)((()=>e=>e.name),[]),r=(0,n.useRef)(null),i=hp(),[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)([]),[c]=o;(0,n.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),s(""))}}),[i,a]);const u=(0,n.useCallback)((()=>Yp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield Ar({title:"My Themes",label:"Name",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield Up(t))&&(yield Kt.rename(e,t),s(t))}}))),[c]),d=(0,n.useCallback)((()=>Yp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=Kt.getUserTheme(e);if(t){const{userTheme:r}=t,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["userTheme"]);!function(e,t,r="text/json"){const n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:r})),n.download=e,n.type=r,n.click()}(`${e}.json`,JSON.stringify(n,void 0,4))}}}))),[c]),m=(0,n.useCallback)((()=>Yp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,r=void 0,i=function*(){return wr({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e);t&&(yield Kt.remove(e),l([]))}}))),[c]),h=(0,n.useCallback)((()=>{r.current.click()}),[]),f=(0,n.useCallback)((e=>Yp(this,void 0,void 0,(function*(){var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(yield function(e){return t=this,r=void 0,i=function*(){try{const t=yield e.text(),r=JSON.parse(t);if(!Gt.validate(r))return void(yield Sr("Not a valid theme.",!0));let n=r.name,i=!1;for(;n&&!i;)n=yield Ar({title:"Import theme",suggestedValue:n,okLabel:"Import",system:!0}),n&&(i=yield Up(n),i&&(yield Kt.save(Object.assign(Object.assign({},r),{name:n}))))}catch(e){console.error(e),yield Sr("Could not load theme.",!0)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(r),e.target.value="")}))),[]);return n.createElement("form",{className:"user-themes",method:"dialog"},n.createElement("h3",null,"My themes:"),n.createElement(Bp,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),n.createElement("p",{className:"user-themes-buttons"},n.createElement("button",{type:"button",onClick:u,disabled:!c},"Rename…"),n.createElement("button",{type:"button",onClick:d,disabled:!c},"Export…"),n.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),n.createElement("fieldset",{className:"user-themes-import"},n.createElement("legend",null,"Import themes"),n.createElement("p",null,n.createElement("input",{type:"file",accept:"text/json,.json",onChange:f,ref:r}),n.createElement("button",{type:"button",onClick:h},"Import…"))),n.createElement(yr,null))}),null)}];function Wp(){return n.createElement(up,{className:"appearance-settings",items:Kp,label:"Appearance"})}function Gp(){const e=(0,n.useRef)(null),t=(0,n.useId)(),r=(0,n.useCallback)((()=>{al.preferPersonalMedia=e.current.checked}),[]);return n.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:r},n.createElement("input",{id:`${t}-lookup-preference`,type:"checkbox",defaultChecked:al.preferPersonalMedia,ref:e}),n.createElement("label",{htmlFor:`${t}-lookup-preference`},"Prefer personal media"),n.createElement("div",{className:"note"},n.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),n.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from your preferred service is used. Otherwise your last played media service is used.")),n.createElement(yr,null))}function Jp({services:e,multiSelect:t}){const r=(0,n.useId)(),i=t?"checkbox":"radio";return n.createElement("ul",{className:"media-service-list checkbox-list"},t?null:n.createElement("li",{className:"no-icon",key:"none"},n.createElement("input",{id:`${r}-none`,type:i,name:r,value:"",defaultChecked:!e.some(Nm)}),n.createElement("label",{htmlFor:`${r}-none`},"None")),e.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${r}-${e.id}`,type:i,name:t?void 0:r,value:e.id,defaultChecked:Nm(e)}),n.createElement("label",{htmlFor:`${r}-${e.id}`},n.createElement(sp,{service:e,showRestrictedAccess:!0}))))))}var Qp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Xp=new H("confirmDisconnectServices");var Zp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function ey({serviceType:e,services:t}){const r=(0,n.useRef)(null),i=e===$n.PublicMedia,a=!i||$m,[s,o]=(0,n.useState)((()=>!!i&&t.filter(Nm).some(ty))),l=(0,n.useCallback)((()=>Zp(this,void 0,void 0,(function*(){const e=r.current.elements;let t=!1;for(const r of e){const e=r.value;e&&r.checked&&(t||(t=ty(Qf(e))))}o(t)}))),[]),c=(0,n.useCallback)((()=>Zp(this,void 0,void 0,(function*(){const e=r.current.elements,t={},i=[];for(const r of e){const e=r.value;if(e){const n=!r.checked;t[e]=n;const a=Qf(e);a&&n&&i.push(a)}}(yield function(e){return Qp(this,void 0,void 0,(function*(){let t=0===(e=e.filter((e=>e.isConnected()&&!function(e){return Uf().filter((t=>t.authService===e)).some(Nm)}(e)))).length;if(!t&&(t=yield wr({message:n.createElement("div",{className:"confirm-disconnect-services"},n.createElement("p",null,"You will be disconnected from the following services:"),n.createElement("ul",null,e.map((e=>n.createElement("li",{key:e.id},n.createElement(sp,{service:e})))))),okLabel:"Disconnect",system:!0}),t))try{yield Promise.all(e.filter((e=>!e.authService||!Nm(e.authService))).map((e=>e.logout())))}catch(e){Xp.error(e)}return t}))}(i))&&zm(t)}))),[]);return n.createElement("form",{method:"dialog",onSubmit:c},n.createElement("fieldset",{className:"media-services",onChange:i?l:void 0,ref:r},n.createElement("legend",null,"Enable"),n.createElement(Jp,{services:t,multiSelect:a})),s?n.createElement("p",{className:"restricted-access"},"*Access is restricted to approved users only."):null,n.createElement(yr,null))}function ty(e){return!!(null==e?void 0:e.restrictedAccess)}function ry({title:e,serviceType:t,services:r}){const i=(0,n.useMemo)((()=>{const e=[{tab:"General",panel:n.createElement(ey,{serviceType:t,services:r})}];return t===$n.DataService&&e.push({tab:"Lookup",panel:n.createElement(Gp,null)}),e}),[t,r]);return n.createElement(up,{className:"media-services-settings",items:i,label:e})}var ny=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function iy(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useCallback)((()=>ny(this,void 0,void 0,(function*(){const e=t.current.checked;xi.useMusicKitBeta!==e&&(xi.useMusicKitBeta=e,yield fr({title:"Reload required",message:"The app will now reload.",system:!0}),yield ha.logout(),location.reload())}))),[]);return n.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:r},n.createElement("fieldset",null,n.createElement("legend",null,"MusicKit*"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!xi.useMusicKitBeta}),n.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:xi.useMusicKitBeta,ref:t}),n.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),n.createElement("div",{className:"note"},n.createElement("p",null,"MusicKit beta enables playback of music videos."),n.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),n.createElement("p",null,"You will need to reload the page for changes to take effect. And you will need to log in again.")),n.createElement("p",null,n.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),n.createElement(yr,null))}var ay=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function sy(e){return ay(this,void 0,void 0,(function*(){const t=e.clientIdentifier;if(vd.serverId===t){const{connection:r,libraries:n}=vd;return{id:t,device:e,connection:r,libraries:n}}{const r=yield Jd(e);let n=[];if(r)try{n=yield Rd.getMusicLibraries(r.uri,e.accessToken)}catch(e){console.error(e)}return{id:t,device:e,connection:r,libraries:n}}}))}function oy(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=function(){const e=dp(Tm.observeIsLoggedIn,!1),[t,r]=(0,n.useState)((()=>{const{server:e,connection:t,libraries:r}=vd;return e?[{id:e.clientIdentifier,device:e,connection:t,libraries:r}]:[]}));return(0,n.useEffect)((()=>{if(e){const e=tn(function(){return ay(this,void 0,void 0,(function*(){const e=yield Rd.getServers();return Promise.all(e.map(sy))}))}()).subscribe(r);return()=>e.unsubscribe()}}),[e]),t}(),[a,s]=(0,n.useState)(null),[o,l]=(0,n.useState)([]),[c,u]=(0,n.useState)(vd.libraryId);(0,n.useEffect)((()=>{s(i.find((e=>e.id===vd.serverId))||i[0]||null)}),[i]),(0,n.useEffect)((()=>{l((null==a?void 0:a.libraries)||[])}),[a]);const d=(0,n.useCallback)((()=>{s(i.find((e=>e.id===t.current.value))||null)}),[i]),m=(0,n.useCallback)((()=>{u(r.current.value)}),[]),h=(0,n.useCallback)((()=>{a&&(vd.serverId!==a.id&&(vd.server=a.device,vd.connection=a.connection,vd.libraries=a.libraries,vd.libraryId===c&&(vd.libraryId="")),vd.libraryId=c)}),[a,c]);return n.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:h},n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-servers`},"Preferred Server:"),n.createElement("select",{id:`${e}-servers`,value:null==a?void 0:a.id,onChange:d,ref:t},i.map((({id:e,device:t,connection:r})=>n.createElement("option",{value:e,key:e},`${t.name}${r?"":" (offline)"}`))))),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-libraries`},"Preferred Library:"),n.createElement("select",{id:`${e}-libraries`,value:c,onChange:m,ref:r,key:null==a?void 0:a.id},o.map((({id:e,title:t})=>n.createElement("option",{value:e,key:e},t))))),n.createElement(yr,null))}function ly(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=vd.streamingQuality,i=(0,n.useCallback)((()=>{var e,r;vd.streamingQuality=null!==(r=null===(e=t.current["streaming-quality"])||void 0===e?void 0:e.value)&&void 0!==r?r:fd.Lossless}),[]);return n.createElement("form",{className:"plex-tidal-streaming-settings",method:"dialog",onSubmit:i,ref:t},n.createElement("fieldset",null,n.createElement("legend",null,"Quality"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-lossless`,value:fd.Lossless,defaultChecked:r===fd.Lossless}),n.createElement("label",{htmlFor:`${e}-lossless`},"Lossless")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-high`,value:fd.High,defaultChecked:r===fd.High}),n.createElement("label",{htmlFor:`${e}-high`},"High")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-low`,value:fd.Low,defaultChecked:r===fd.Low}),n.createElement("label",{htmlFor:`${e}-low`},"Low"))),n.createElement(yr,null))}var cy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function uy(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=!!gi,i="https://developer.spotify.com/dashboard/create",a=(0,n.useCallback)((()=>cy(this,void 0,void 0,(function*(){ch.clientId=t.current.value}))),[]);return n.createElement("form",{className:"spotify-credentials",method:"dialog",onSubmit:a},n.createElement("fieldset",null,n.createElement("legend",null,"Your App"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),n.createElement("input",{type:"text",name:"spotify-client-id",id:`${e}-client-id`,defaultValue:ch.clientId,readOnly:r,ref:t}))),n.createElement("fieldset",null,n.createElement("legend",null,"Registration"),n.createElement("p",{className:"spotify-link service-link"},n.createElement(Xl,{href:i},n.createElement(rt,{name:"spotify"}),i))),n.createElement("fieldset",{className:"spotify-credentials-requirements note"},n.createElement("legend",null,"Requirements"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-callback`},"Redirect URI:"),n.createElement("input",{type:"text",id:`${e}-callback`,value:`${location.origin}/auth/spotify/callback/`,readOnly:!0})),n.createElement("p",null,"APIs used:"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api1`},"Web API")),n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api2`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api2`},"Web Playback SDK")))),n.createElement(yr,null))}var dy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function my(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=!!Ei,a="https://console.cloud.google.com/apis/credentials",s=(0,n.useCallback)((()=>dy(this,void 0,void 0,(function*(){dc.apiKey=t.current.value,dc.clientId=r.current.value}))),[]);return n.createElement("form",{className:"youtube-credentials",method:"dialog",onSubmit:s},n.createElement("fieldset",null,n.createElement("legend",null,"Your App"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-api-key`},"API Key:"),n.createElement("input",{type:"text",name:"youtube-api-key",id:`${e}-api-key`,defaultValue:dc.apiKey,readOnly:i,ref:t})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),n.createElement("input",{type:"text",name:"youtube-client-id",id:`${e}-client-id`,defaultValue:dc.clientId,readOnly:i,ref:r}))),n.createElement("fieldset",null,n.createElement("legend",null,"Registration"),n.createElement("p",{className:"youtube-link service-link"},n.createElement(Xl,{href:a},n.createElement(rt,{name:"youtube"}),a))),n.createElement("fieldset",{className:"youtube-credentials-requirements note"},n.createElement("legend",null,"Requirements"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-origin`},"Authorized JavaScript origin:"),n.createElement("input",{type:"text",id:`${e}-origin`,value:location.origin,readOnly:!0})),n.createElement("p",null,"Selected APIs:"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api1`},"YouTube Data API v3")))),n.createElement(yr,null))}var hy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function fy({service:e}){const t=e.authService||e,[r,i]=(0,n.useState)((()=>t.isConnected())),a=(0,n.useCallback)((()=>hy(this,void 0,void 0,(function*(){yield t.logout(),i(t.isConnected())}))),[t]);return n.createElement("p",null,n.createElement("button",{type:"button",className:"disconnect-button",onClick:a,disabled:!r},r?`Disconnect from ${t.name}…`:"Not connected"))}function py({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=(0,n.useCallback)((()=>{const e=r.current.elements,t={};for(const r of e)t[r.value]=!r.checked;zm(t)}),[]);return n.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:i},n.createElement(fy,{service:e}),n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Display"),n.createElement("ul",{className:"checkbox-list"},e.sources.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:Nm(e)}),n.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),n.createElement(yr,null))}function yy({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=e.libraryId,a=function(e){const t=dp(e.observeIsLoggedIn,!1),[r,i]=(0,n.useState)((()=>e.audioLibraries||[]));return(0,n.useEffect)((()=>{if(t&&e.getLibraries){const t=tn(e.getLibraries()).subscribe((t=>{e.libraries=t,i(e.audioLibraries||[])}));return()=>t.unsubscribe()}}),[e,t]),r}(e),s=(0,n.useCallback)((()=>{e.libraryId=r.current.value}),[e]);return n.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:s},n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-libraries`},"Preferred Library:"),n.createElement("select",{id:`${t}-libraries`,defaultValue:i,ref:r},a.map((({id:e,title:t})=>n.createElement("option",{value:e,key:e},t))))),n.createElement(yr,null))}var vy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function by({service:e}){const t=(0,n.useMemo)((()=>e=>e.title),[]),[r,i]=(0,n.useState)((()=>Qi.getPinsForService(e.id))),[a,s]=(0,n.useState)([]),o=(0,n.useCallback)((()=>vy(this,void 0,void 0,(function*(){const t=Qi.getPinsForService(e.id);yield Qi.unpin(t.filter((e=>-1===r.findIndex((t=>t.src===e.src)))))}))),[e,r]),l=(0,n.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),s([])}),[a]);return n.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:o},n.createElement("h3",null,"Pinned playlists:"),n.createElement(Bp,{title:"Pinned playlists",items:r,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:s}),n.createElement("p",{className:"pinned-settings-buttons"},n.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),n.createElement(yr,null))}const gy=new J("scrobbling"),wy=new it(gy.getJson("noScrobble",{})),Ey=new it(gy.getJson("options",{}));function ky(e,t){var r;const n=wy.getValue()[e.id];return!(null!==(r=null==n?void 0:n[t.id])&&void 0!==r?r:t.defaultNoScrobble)}function xy(e,t){const r=wy.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});gy.setJson("noScrobble",a),wy.next(a)}function Sy(e){var t;return!!(null===(t=Ey.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function Ty(e,t){const r=Ey.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});gy.setJson("options",a),Ey.next(a)}const Py={canScrobble:ky,setNoScrobble:xy,canUpdateNowPlaying:Sy,updateOptions:Ty};function Ay({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useMemo)(Wf,[]),s=(0,n.useCallback)((()=>{const t=r.current.elements,n={};for(const e of t)n[e.value]=!e.checked;xy(e,n);const a=i.current.elements,s={};for(const e of a)s[e.value]=e.checked;Ty(e,s)}),[e]);return n.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:s},n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Scrobble"),n.createElement("ul",null,a.map((r=>n.createElement("li",{key:r.id},n.createElement("input",{id:`${t}-${r.id}`,type:"checkbox",value:r.id,defaultChecked:ky(e,r),disabled:"youtube"===r.id}),n.createElement("label",{htmlFor:`${t}-${r.id}`},r.name)))))),n.createElement("fieldset",{ref:i},n.createElement("legend",null,"Options"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:Sy(e)}),n.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),n.createElement(yr,null))}function Iy({service:e}){const t=(0,n.useMemo)((()=>{const t=[{tab:"General",panel:n.createElement(py,{service:e})}];return"spotify"!==e.id||gi||t.push({tab:"Credentials",panel:n.createElement(uy,null)}),"youtube"!==e.id||Ei||t.push({tab:"Credentials",panel:n.createElement(my,null)}),"libraryId"in e&&t.push({tab:"Library",panel:"plex"===e.id?n.createElement(oy,null):n.createElement(yy,{service:e})}),e.serviceType===$n.DataService&&e.canScrobble&&t.push({tab:"Scrobbling",panel:n.createElement(Ay,{service:e})}),"plex-tidal"===e.id&&t.push({tab:"Streaming",panel:n.createElement(ly,null)}),e.createSourceFromPin&&t.push({tab:"Pinned",panel:n.createElement(by,{service:e})}),"apple"===e.id&&t.push({tab:"Beta",panel:n.createElement(iy,null)}),t}),[e]);return n.createElement(up,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}const Cy=new J("playlist"),My=new it(Cy.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Oy={observe:function(){return My},get:function(){return My.getValue()},set:function(e){Cy.setJson("settings",e),My.next(e)}},$y=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=(0,n.useMemo)((()=>Oy.get()),[]),r=dp(Oy.observe,t),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useCallback)((()=>{Oy.set(t)}),[t]),c=(0,n.useCallback)((()=>{Oy.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:s.current.checked,showSourceIcons:o.current.checked})}),[]);return n.createElement("form",{className:"playlist-settings-general",method:"dialog"},n.createElement("fieldset",null,n.createElement("legend",null,"Content"),n.createElement("p",null,n.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:r.allowDuplicates,onChange:c,ref:i}),n.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),n.createElement("fieldset",null,n.createElement("legend",null,"Display"),n.createElement("p",null,n.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:r.showLineNumbers,onChange:c,ref:a}),n.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:r.zeroPadLineNumbers,disabled:!r.showLineNumbers,onChange:c,ref:s}),n.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:r.showSourceIcons,onChange:c,ref:o}),n.createElement("label",{htmlFor:`${e}-source-icons`},"Show media service icons"))),n.createElement(yr,{onCancel:l}))}),null)}];function Ny(){return n.createElement(up,{className:"playlist-settings",items:$y,label:"Playlist Settings"})}const zy=new J("visualizer/settings"),jy={get ambientVideoEnabled(){return zy.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(zy.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&zy.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&zy.removeItem("lockedVisualizer")),Ly.next(this))},get ambientVideoSource(){return zy.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(zy.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&zy.removeItem("lockedVisualizer"),Ly.next(this))},get ambientVideoBeats(){return zy.getBoolean("ambientVideoBeats",!0)},set ambientVideoBeats(e){e!==this.ambientVideoBeats&&(zy.setBoolean("ambientVideoBeats",e),Ly.next(this))},get useAmbientVideoSource(){return zy.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(zy.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&zy.removeItem("lockedVisualizer"),Ly.next(this))},get coverArtAnimatedBackground(){return zy.getBoolean("coverArtAnimatedBackground")},set coverArtAnimatedBackground(e){e!==this.coverArtAnimatedBackground&&(zy.setBoolean("coverArtAnimatedBackground",e),Ly.next(this))},get coverArtBeats(){return zy.getBoolean("coverArtBeats",!0)},set coverArtBeats(e){e!==this.coverArtBeats&&(zy.setBoolean("coverArtBeats",e),Ly.next(this))},get fullscreenProgress(){return zy.getBoolean("fullscreenProgress")},set fullscreenProgress(e){e!==this.fullscreenProgress&&(zy.setBoolean("fullscreenProgress",e),Ly.next(this))},get lockedVisualizer(){return zy.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:r}=e;zy.setJson("lockedVisualizer",{providerId:t,name:r})}else zy.removeItem("lockedVisualizer");Ly.next(this)},get provider(){return zy.getString("provider")},set provider(e){var t;e!==this.provider&&(zy.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&zy.removeItem("lockedVisualizer"),Ly.next(this))}},Ly=new it(jy),Dy=jy;function Ry(){return Ly}function Fy(){return Ry().pipe(Be((e=>e.fullscreenProgress)),Vn())}var _y;_y=new WeakMap;const By=class{constructor(){_y.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,_y,"f")}set autoplay(e){!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,_y,e,"f")}observeCurrentTime(){return an}observeDuration(){return an}observeEnded(){return an}observeError(){return an}observePlaying(){return an}seek(){}};var Vy,Uy,Hy=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},qy=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};Vy=new WeakMap,Uy=new WeakMap;const Yy=class{constructor(e,t){this.type=e,this.name=t,this.logger=new H(`HTML5Player/${this.type}/${this.name}`),this.element$=new it(document.createElement(this.type)),this.error$=new Ne,this.playing$=new Ne,this.item=null,this.stopped=!0,this.autoplay=!1,Vy.set(this,!0),Uy.set(this,1);const r=this.element;r.hidden=!0,r.muted="video"===e,r.volume=1,r.autoplay=!1,r.className=`html5-${e} html5-${e}-${t}`,r.id=`ampcast-${e}-${t}`,r.crossOrigin="anonymous",this.element$.pipe(on((e=>Yr(e,"error").pipe(Be((()=>e.error)),_e((e=>null!==e&&!("fatal"in e))))))).subscribe(this.error$),this.element$.pipe(on((e=>Yr(e,"playing"))),Be((()=>{}))).subscribe(this.playing$),this.error$.subscribe((e=>{this.stopped?this.logger.warn({err:e}):this.logger.error(e)}))}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return Hy(this,Vy,"f")}set muted(e){qy(this,Vy,e,"f"),"video"===this.type&&(this.element.muted=e)}get volume(){return Hy(this,Uy,"f")}set volume(e){qy(this,Uy,e,"f"),"video"===this.type&&(this.element.volume=e)}observeCurrentTime(){return this.element$.pipe(on((e=>Yr(e,"timeupdate").pipe(nn(e),Be((()=>e.currentTime)),Be((e=>isFinite(e)?e:0))))))}observeDuration(){return this.element$.pipe(on((e=>Yr(e,"durationchange").pipe(nn(e),Be((()=>e.duration)),_e((e=>isFinite(e)))))))}observeEnded(){return this.element$.pipe(on((e=>Yr(e,"ended"))),Be((()=>{})))}observeError(){return this.error$.pipe(_e((()=>!this.stopped)))}observePlaying(){return this.playing$.pipe(_e((()=>!this.stopped)))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.item=e,this.autoplay&&this.safePlay(e)}play(){this.logger.log("play"),this.safePlay(this.item)}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.stopped=!0,this.element.pause(),this.element.currentTime=0,this.element.removeAttribute("src")}seek(e){this.element.currentTime=e}resize(e,t){"video"===this.type&&(this.element.style.width=`${e}px`,this.element.style.height=`${t}px`)}get element(){return this.element$.getValue()}getMediaSrc(e){var t,r;if(e){const n=Xf(e);return null!==(r=null===(t=null==n?void 0:n.getPlayableUrl)||void 0===t?void 0:t.call(n,e))&&void 0!==r?r:e.src}throw Error("No playable item")}safePlay(e){return t=this,r=void 0,i=function*(){this.stopped=!1;try{if(!e)throw Error("Player not loaded");const t=this.getMediaSrc(e);this.element.getAttribute("src")!==t&&this.element.setAttribute("src",t),yield this.element.play()}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}};var Ky,Wy,Gy=r(2940),Jy=r.n(Gy),Qy=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Xy=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const Zy=(e,t)=>e.width===t.width&&e.height===t.height,ev=16/9,tv={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,origin:location.origin,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var rv;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(rv||(rv={})),Ky=new WeakMap,Wy=new WeakMap;const nv=class{constructor(e){this.player=null,this.src$=new it(""),this.size$=new it({width:0,height:0}),this.error$=new Ne,this.ready$=new Ne,this.state$=new Ne,this.videoId$=new it(""),this.playerLoading=!1,Ky.set(this,!0),Wy.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div"),i=this.logger=new H(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",r.className="youtube-video-wrapper",n.id=this.targetId,r.append(n),t.append(r),this.observeReady().pipe(et((()=>this.observeSrc())),Nn((e=>!e)),at((e=>{const t=this.player,[,r,n,i="0"]=e.split(":"),a=Number(i)||0;if(n){if("playlist"===r){const e={list:n,listType:r,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(n,a):t.cueVideoById(n,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(et((()=>this.observeVideoSize())),at((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(_e((e=>e===rv.ENDED&&this.loop)),at((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(_e((e=>e===rv.PLAYING)),at((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(Be((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),at((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return Qy(this,Ky,"f")}set muted(e){Qy(this,Ky,"f")!==e&&(Xy(this,Ky,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return Qy(this,Wy,"f")}set volume(e){Qy(this,Wy,"f")!==e&&(Xy(this,Wy,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(on((e=>{var t;return e===rv.PLAYING?Rr(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(Be((()=>this.player.getCurrentTime())),ln(this.observeState())):pn((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(Be((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),_e((e=>0!==e)),Vn())}observeEnded(){return this.observeState().pipe(_e((e=>e===rv.ENDED&&!this.loop)),Be((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(_e((e=>e===rv.PLAYING)),Be((()=>{})))}observeVideoId(){return this.videoId$.pipe(Vn())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load({src:e}){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.playerLoading||this.error$.next(Error("YouTube player not loaded"))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(on((e=>e?this.getAspectRatio(e):pn(ev))),Vn())}observeReady(){return this.ready$.pipe(Di(1))}observeSize(){return this.size$.pipe(Vn(Zy),_e((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(Vn())}observeState(){return this.state$}observeVideoSize(){return _n([this.observeSize(),this.observeAspectRatio()]).pipe(Be((([{width:e,height:t},r])=>{const n=Math.max(Math.round(e/r),t);return{width:Math.max(Math.round(n*r),e),height:n}})),Vn(Zy))}createPlayer(){if(!this.player&&this.element.isConnected){this.playerLoading=!0;const e=Jy()(this.targetId,{playerVars:tv,host:"https://www.youtube-nocookie.com"});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.playerLoading=!1,this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return tn(Bc(e)).pipe(ln(Rr(3e3)),ln(this.observeVideoId().pipe(Gh(1))),Be((({aspectRatio:e})=>e||ev)),qn((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),pn(ev)))))}getPlayerState(){return this.player?this.player.getPlayerState():rv.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return lc()(e)||""}};var iv,av,sv,ov,lv,cv,uv,dv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},mv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};iv=new WeakMap,av=new WeakMap,sv=new WeakMap,ov=new WeakMap,lv=new WeakMap,cv=new WeakMap,uv=new WeakMap;const hv=class{constructor(e,t,r,n){this.selectPlayer=t,this.loadPlayer=r,this.audio=n,this.element=document.createElement("div"),this.players=[],this.player$=new it(null),this.error$=new Ne,this.stopped=!0,iv.set(this,null),av.set(this,!1),sv.set(this,!1),ov.set(this,!1),lv.set(this,1),cv.set(this,0),uv.set(this,0),this.element.className=e}get autoplay(){return dv(this,av,"f")}set autoplay(e){mv(this,av,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return dv(this,sv,"f")}set loop(e){mv(this,sv,e,"f"),this.players.forEach((t=>t.loop=e))}get muted(){return dv(this,ov,"f")}set muted(e){mv(this,ov,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e),this.audio&&(this.audio.volume=e?0:this.volume)}get volume(){return dv(this,lv,"f")}set volume(e){mv(this,lv,e,"f"),this.players.forEach((t=>t.volume=e)),this.audio&&(this.audio.volume=this.muted?0:e)}observeCurrentTime(){return this.observeCurrentPlayer().pipe(on((e=>e?e.observeCurrentTime():pn(0))),Vn())}observeDuration(){return this.observeCurrentPlayer().pipe(on((e=>e?e.observeDuration():an)),Vn())}observeEnded(){return this.observeCurrentPlayer().pipe(on((e=>e?e.observeEnded():an)))}observeError(){return this.observeCurrentPlayer().pipe(on((e=>e?sn(this.error$,e.observeError()):an)),_e((()=>!this.stopped)))}observePlaying(){return this.observeCurrentPlayer().pipe(on((e=>e?e.observePlaying():an)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,r=this.selectPlayer(e);if(this.player$.next(null),t&&t!==r&&(t.autoplay=!1,t.muted=!0,t.hidden=!0,t.stop()),this.autoplay&&(this.stopped=!1),this.loadError=null,!r||this.players.includes(r))if(this.player$.next(r),r)try{r.autoplay=this.autoplay,this.loadPlayer(r,e),r.muted=this.muted,r.hidden=this.hidden}catch(e){this.loadError=Error((null==e?void 0:e.message)||"Failed to load")}else this.loadError=Error("No player found");else this.loadError=Error("Player not registered")}play(){var e;this.stopped=!1,this.autoplay=!0,this.loadError?this.error$.next(this.loadError):null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.stopped=!0,this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){mv(this,cv,e,"f"),mv(this,uv,t,"f"),e*t>0&&this.players.forEach((r=>r.resize(e,t)))}registerPlayers(e){e.filter((e=>!this.players.includes(e))).forEach((e=>{e.muted=!0,e.hidden=!0,e.autoplay=this.autoplay,e.loop=this.loop,e.volume=this.volume,dv(this,cv,"f")*dv(this,uv,"f")>0&&e.resize(dv(this,cv,"f"),dv(this,uv,"f")),e.appendTo(this.element),this.players.push(e)}))}unregisterPlayers(e){const t=e.filter((e=>this.players.includes(e))),[r,n]=m(this.players,(e=>t.includes(e)));r.forEach((e=>e.stop())),this.players.length=0,this.players.push(...n)}get currentPlayer(){return this.player$.getValue()}get loadError(){return dv(this,iv,"f")}set loadError(e){mv(this,iv,e,"f"),e&&this.error$.next(e)}observeCurrentPlayer(){return this.player$.pipe(Vn())}};class fv extends By{constructor({context:e,source:t},r){super(),this.name=r,this.logger=new H(`WaveformPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className=`visualizer visualizer-waveform visualizer-waveform-${r}`}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}var pv;pv=new WeakMap;const yv=class extends fv{constructor(e){super(e,"beats"),pv.set(this,""),this.visualizer={providerId:"waveform",name:"beats",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i);n.getByteFrequencyData(a),e.clearRect(0,0,t,r),e.fillStyle=this.color,e.strokeStyle="rgba(0, 0, 0, .9)",e.lineWidth=document.fullscreenElement?2:1;const s=(t-48)/12,o=.0075*r,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const n=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*n,e.fillRect(u,r-c/2,s,c/2+4),e.strokeRect(u,r-c/2,s,c/2+4),u+=s+4}}}}}get color(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,pv,"f")||`rgba(255, 255, 255, ${document.fullscreenElement?.4:.6})`}set color(e){!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,pv,e,"f")}load(){super.load(this.visualizer)}resize(e){const t=Math.min(Math.max(e/3,9*Gt.fontSize),360);super.resize(t,.225*t)}},vv=new H("AmbientVideoPlayer");class bv extends By{constructor(e){super(),this.storage=new J("ambientVideoPlayer"),this.beatsPlayer=new yv(e),this.videoPlayer=this.createVideoPlayer(this.beatsPlayer),Ry().pipe(Be((e=>e.ambientVideoBeats)),Vn(),at((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(vv),Ry().pipe(Be((e=>e.ambientVideoSource)),Vn(),Gh(1),at((()=>this.storage.removeItem("user-progress")))).subscribe(vv)}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!Dy.ambientVideoBeats}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.beatsPlayer.load()}play(){vv.log("play"),this.videoPlayer.play(),Dy.ambientVideoBeats&&this.beatsPlayer.play()}pause(){vv.log("pause"),this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){vv.log("stop"),this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t),this.beatsPlayer.resize(e)}createVideoPlayer(e){const t=new Yy("video","ambient"),r=this.createYouTubePlayer(),n=new hv("ambient-video-player",(e=>e?e.src.startsWith("youtube:")?r:t:null),((e,t)=>{const r=t.src;if(r.startsWith("youtube:")){const[,,t]=r.split(":"),n=this.getProgressKey(),i=this.storage.getJson(n,{})[t]||("progress"===n?120:0);e.load({src:`${r}:${i}`})}else e.load({src:r})}));return n.loop=!0,n.volume=0,n.hidden=!0,n.registerPlayers([t,r,e]),n.unregisterPlayers([e]),n}createYouTubePlayer(){const e=new nv("ambient");return e.observeVideoId().pipe(on((t=>t?e.observeCurrentTime().pipe(Be(Math.round),Vn(),_e((e=>e>0&&e%20==0)),Wh(e.observeDuration()),_e((([,e])=>e>120)),at((([e])=>{const r=this.getProgressKey(),n=this.storage.getJson(r,{});n[t]=e,this.storage.setJson(r,n)}))):an))).subscribe(vv),e}getProgressKey(){return Dy.useAmbientVideoSource&&Dy.ambientVideoSource?"user-progress":"progress"}}function gv(e,t){return void 0===t&&(t=jr),De((function(r,n){var i=null,a=null,s=null,o=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,n.next(e)}};function l(){var r=s+e,a=t.now();if(a<r)return i=this.schedule(void 0,r-a),void n.add(i);o()}r.subscribe(Re(n,(function(r){a=r,s=t.now(),i||(i=t.schedule(l,e),n.add(i))}),(function(){o(),n.complete()}),void 0,(function(){a=i=null})))}))}var wv=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};let Ev=0;class kv extends nv{constructor(e){super("loader-"+Ev++),this.load({src:e})}loadPlaylist(){return wv(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return an}loadDuration(){return wv(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const r=this.observeCued(),n=sn(this.observeError(),Rr(3e3).pipe(Be((()=>Error("timeout")))));r.pipe(ln(n),Di(1)).subscribe({next:e}),n.pipe(ln(r),Di(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(_e((e=>e===rv.CUED)),Be((()=>{})),Di(1))}}const xv="\n9HI3UVKoesg rOSUaprXqiY etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw SDxtzBm5vD4\nA1m0SEqmmbE 9uZ8CCa0t4Y 35CTu7dWzo8 wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY QxE5VqaQ6oE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nQxS6PpMArMU IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\ntOWGsyt40t8 QLbPYQcUcgM xwf7EssFnXU -Pail6FITXc vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c VWHTlq5Fcr8 ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE OiRqM-4c14Y\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k fVRSSNkq3Bk\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\n9IENFNxy5i8 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 hg2FDCmqNkg tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM 3F4l-6GwkKM F399teRPBaY 2jw2eAIW8sU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk JFMT1tU17TM FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs fmsTHHtxAug l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc eXcbc2gmDsA rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E TX9U62sj5nM\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 KPV1hFJIXrg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bWG0rEB6gmc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\nvuLm2t58qIQ FDqQlAUDZyk R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU fd8spJiYS0k 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI MntPfBulD2o _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow 2FE1_YK5OPI pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE RKWLu6UHryQ\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI wjMf_bEfqIc hNC6-bxHJac\nJBm1ainuk-c PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg 8quqk2FPRgQ p7G1lkYIFTM RzE9pczkYU4 7TML_MTQdg4\nFGCIBbg0IYk oaQ8UXlKDiw 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\nD4mdWvVONyg eQIzdzSTH08 tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 sYYMBV68hmE 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY dY-bDp_3krs 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 OdsIYD9F6Og _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y fWnlQnposC4 pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY xR7RK3QGmfY\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo 5bwHtF7fR94 IXSTdSv-Jlo mf5E3FDZ6rY 7JsOhtl_zG4 vr5dCRHAgb0 Di9jRVy7WHk cVdfUy_VMTY\nLD_jcIQGl0Q ZXas8NdyLsE JptSD1Jdhyw --qCu9yL5H8 74wsGjTZzGg Wey4zHA4nPg VArhsYKbKzk t76IJmQKzKA\nl1RxmWxXQcM 7HagxwgIRcY gJgwJwg6Deg 1mD8V2trqcw i5ZbYQ1Nok4 YE3iWysmcBQ vdycBdIx-do UE-J2Dt8LNs\nx_dVi_PC_sc z3oaQlq9weg gvusDEF3eh4 0wb-OBF3LOo tKC1zBZf8NM Moz3NHnVXog s7v0c2nKKGE cV9kT-xcQZw\napwA8UQ_xeE 6BcYV3gqcFA TaWhAJGUK-w oHrnBcYW6U0 iXI8oo8KpMA 4Qdd8khODKc KVKtVyhCMQ8 6h3zxMYjAwI\njMaWecFnC_8 XS3p0GDnLF4 CCc2EYQchpE Oj0l4QlC-JE pENN3OPwydk 6q81M5Xd5X8 IqS4kWK6aV0 8OUQ7eCqt50\ngdAbs95GIm4 j800SVeiS5I bZIuALduxQU UyFoYkj8dAc q5hHF9Ofu3g UrKl1h8wWpg SNpXK6omAdQ 9D53rJslwak\n91q_XSSDCDE ufUfa_wS6cc O87EBwZaC_U J_Qs64FctiA yP64H8aLEE8 Ml_PEaEBKi0 SolQqtVQ7vA al7T6Y6CoUo\nnmm0zfspmos wUtgReo4pDM 7HDlompCs58 ZsMlXu09ghs iO_Me1wspYM jHyItjAKRdY F18YfQD3s28 RgzTvK84LHo\nDOVsgCZoFLI kBbaAJMJC_k iyhP3voUf_s Ek7MAukn5P0 RpKLilRfFNE 7eN7zRJdfkM kk7tTjPOzt4 ryuJGfYs5VE\nt4NKrOr9lAY IL3990sA0ZE fVoMdt5MZKg eKWntyoSuzc kN3VMkM79c0 B6WFz8Zb9Oo avSd8c-m3Wc M3u4Mus9y_g\nPd4H-TFjSkQ jMWKm-g5V3w ZR9YaU4EYjk nVcxbSw6o5k crgLdtAGgIQ D223br7vnpk HRIczsM6bIc\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));const Sv=new H("ambientvideo/visualizers");Sv.log(`default (total=${xv.length})`);const Tv=new it([]);Ry().pipe(gv(1),Be((e=>!!e.ambientVideoEnabled)),Vn(),on((e=>e?Ry().pipe(Be((e=>!!e.useAmbientVideoSource)),Vn(),on((e=>e?Ry().pipe(Be((e=>e.ambientVideoSource||"")),Vn(),on((e=>e?function(e){return t=this,r=void 0,i=function*(){const t=Fc(e),[,r,n]=t.split(":");let i=[n];return"playlist"===r&&(i=yield function(e){return wv(this,void 0,void 0,(function*(){const t=new kv(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e):pn([])))):pn(xv)))):pn([]))),qn((e=>(Sv.error(e),pn([]))))).subscribe(Tv);const Pv={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,get visualizers(){return Tv.getValue()},observeVisualizers:function(){return Tv},createPlayer(e){return this.player||(this.player=new bv(e)),this.player}},Av=Pv;var Iv,Cv,Mv=r(5864),Ov=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},$v=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};Iv=new WeakMap,Cv=new WeakMap;const Nv=class extends By{constructor({context:e,source:t},r){super(),this.name=r,this.logger=new H(`AmpShaderPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.animationFrameId=0,this.fragFrameColor=null,this.fragBackgroundColor=null,this.fragColor=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.startTime=performance.now(),this.currentVisualizer="",Iv.set(this,""),Cv.set(this,""),this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader",this.outputGl=this.canvas.getContext("2d"),window.OffscreenCanvas?this.offscreenCanvas=new OffscreenCanvas(200,200):this.offscreenCanvas=document.createElement("canvas");const n=this.gl=this.offscreenCanvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1}),i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.R8,512,2,0,n.RED,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);const a=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,a);const s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.createShader(`#version 300 es\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n#ifdef GL_ES\r\nprecision highp float;\r\nprecision highp int;\r\nprecision mediump sampler3D;\r\n#endif\r\nuniform vec3 iFrameColor;\r\nuniform vec3 iBackgroundColor;\r\nuniform vec3 iColor;\r\nuniform float iTime;\r\nuniform float iChannelTime[4];\r\nuniform vec4 iDate;\r\nuniform vec2 iResolution;\r\nuniform sampler2D iChannel0;\r\nuniform sampler2D iChannel1;\r\nuniform sampler2D iChannel2;\r\nuniform sampler2D iChannel3;\r\nuniform float iSampleRate;\r\nuniform float iTimeDelta;\r\nuniform float iChannelResolution[4];\r\nvec3 iMouse = vec3(0., 0., 0.);\r\n#define iFrame (floor(iTime / 60))\r\n\n${e.shader}\nout vec4 as_FragColor;\r\nvoid main() {\r\n    vec4 color = vec4(1e20);\r\n    mainImage(color, gl_FragCoord.xy);\r\n    as_FragColor = color;\r\n}\r\n`)),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){const r=this.gl;if(e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,r.viewport(0,0,e,t),this.program){const n=r.getUniformLocation(this.program,"iResolution");r.uniform2f(n,e,t),this.renderFrame()}}get backgroundColor(){return Ov(this,Iv,"f")||Gt.backgroundColor}set backgroundColor(e){$v(this,Iv,e,"f")}get color(){return Ov(this,Cv,"f")||Gt.textColor}set color(e){$v(this,Cv,e,"f")}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get frameColor(){return Gt.frameColor}clear(){const{width:e,height:t}=this.canvas;this.outputGl.clearRect(0,0,e,t)}createShader(e){const t=this.gl;this.program&&(t.detachShader(this.program,this.vertexShader),t.detachShader(this.program,this.fragmentShader),t.deleteProgram(this.program),this.program=null,this.vertexShader=null,this.fragmentShader=null);const r=this.vertexShader=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,"#version 300 es\nin vec4 as_Position;void main(void){gl_Position=as_Position;}"),t.compileShader(r);const n=this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e),t.compileShader(n);const i=t.createProgram();if(t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw Error(`Link failed: ${t.getProgramInfoLog(i)}`);t.useProgram(i);const a=t.getAttribLocation(i,"as_Position");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.startTime=performance.now(),this.fragFrameColor=t.getUniformLocation(i,"iFrameColor"),this.fragBackgroundColor=t.getUniformLocation(i,"iBackgroundColor"),this.fragColor=t.getUniformLocation(i,"iColor"),this.fragTime=t.getUniformLocation(i,"iTime"),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),this.fragDate=t.getUniformLocation(i,"iDate");const s=t.getUniformLocation(i,"iResolution");t.uniform2f(s,this.canvas.width,this.canvas.height),this.program=i}render(){this.renderFrame(),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.program){const e=this.gl,t=this.analyser.frequencyBinCount,r=new Uint8Array(t),n=new Uint8Array(t);this.analyser.getByteFrequencyData(r),this.analyser.getByteTimeDomainData(n);const i=this.currentTime;e.uniform1f(this.fragTime,i),e.uniform1fv(this.fragChannelTime,new Float32Array([i,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform3f(this.fragFrameColor,...this.toRgb(this.frameColor)),e.uniform3f(this.fragBackgroundColor,...this.toRgb(this.backgroundColor)),e.uniform3f(this.fragColor,...this.toRgb(this.color)),e.texSubImage2D(e.TEXTURE_2D,0,0,0,512,1,e.RED,e.UNSIGNED_BYTE,r),e.texSubImage2D(e.TEXTURE_2D,0,0,1,512,1,e.RED,e.UNSIGNED_BYTE,n),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.outputGl.drawImage(this.offscreenCanvas,0,0)}}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}toRgb(e){const[t,r,n]=new Mv.c(e).srgb;return[t,r,n]}};const zv=new it([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield r.e(700).then(r.bind(r,8488));e&&zv.next(e)},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const jv={id:"ampshader",name:"ampshader",get visualizers(){return zv.getValue()},observeVisualizers:function(){return zv},createPlayer(e){return this.player||(this.player=new Nv(e,"main")),this.player}},Lv=jv;var Dv=r(6984);const Rv=new H("AudioMotionPlayer");class Fv extends By{constructor({context:e,source:t}){super(),this.element=document.createElement("div"),this.currentVisualizer="",this.source=t,this.element.className="visualizer visualizer-audiomotion",this.element.hidden=!0,this.visualizer=new Dv.c(this.element,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1}),Gt.observe().pipe(at((()=>this.registerGradients()))).subscribe(Rv)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?(Rv.log("disconnect"),this.visualizer.disconnectInput()):(Rv.log("connect"),this.visualizer.connectInput(this.source)))}appendTo(e){e.append(this.element)}load(e){Rv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.visualizer.setOptions(e.options)),this.autoplay&&this.visualizer.toggleAnalyzer(!0)}play(){Rv.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Rv.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){Rv.log("stop"),this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new Tt(Gt.isMediaButtonLight?Gt.mediaButtonColor:Gt.defaultMediaButtonColor),t=[new Tt(Gt.mediaButtonColor),new Tt(Gt.defaultMediaButtonColor),new Tt(Gt.frameColor),new Tt(Gt.frameTextColor),new Tt(Gt.backgroundColor),new Tt(Gt.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,r=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:Gt.black,colorStops:[r[0],{pos:.6,color:r[1]},r[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:Gt.black,colorStops:Gt.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:Gt.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}const _v="audiomotion",Bv=[{providerId:_v,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:_v,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:_v,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:_v,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:_v,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}],Vv={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",visualizers:Bv,observeVisualizers:()=>pn(Bv),createPlayer(e){return this.player||(this.player=new Fv(e)),this.player}},Uv=Vv;var Hv=r(9480),qv=r.n(Hv);const Yv=new H("ButterchurnPlayer");class Kv extends By{constructor({context:e,source:t}){super(),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.error$=new Ne,this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.canvas.className="visualizer visualizer-butterchurn",this.canvas.hidden=!0,this.visualizer=qv().createVisualizer(e,this.canvas,{width:400,height:200})}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(Yv.log("disconnect"),this.visualizer.disconnectAudio(this.source)):(Yv.log("connect"),this.visualizer.connectAudio(this.source),this.animationFrameId||this.render()))}observeError(){return this.error$}appendTo(e){e.append(this.canvas)}load(e){Yv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.visualizer.loadPreset(e.data,.5)),this.autoplay&&!this.animationFrameId&&this.render()}play(){Yv.log("play"),this.animationFrameId||this.render()}pause(){Yv.log("pause"),this.cancelAnimation()}stop(){Yv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const{width:e,height:t}=this.canvas;this.context2D.clearRect(0,0,e,t)}render(){if(this.animationFrameId)this.visualizer.render();else try{this.visualizer.render()}catch(e){Yv.error(e),this.error$.next(e)}this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}const Wv=new it([]);function Gv(){return Wv.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield r.e(332).then(r.t.bind(r,5148,23));if(t){Wv.next(Object.keys(t).map((r=>({providerId:e,name:r,data:t[r]}))));const{default:n}=yield r.e(820).then(r.t.bind(r,8976,23));n&&Wv.next(Gv().concat(Object.keys(n).map((t=>({providerId:e,name:t,data:n[t]})))))}},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const Jv={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",get visualizers(){return Gv()},observeVisualizers:function(){return Wv},createPlayer(e){return this.player||(this.player=new Kv(e)),this.player}},Qv=Jv;class Xv extends Nv{constructor(e){super(e,"animated-background"),this.visualizer={providerId:"ampshader",name:"Foamy water by k_mouse",shader:"// https://www.shadertoy.com/view/llcXW7\r\n// Made by k-mouse (2016-11-23)\r\n// Modified from David Hoskins (2013-07-07) and joltz0r (2013-07-04)\r\n\r\n#define TAU 6.28318530718\r\n\r\n#define TILING_FACTOR 1.0\r\n#define MAX_ITER 24\r\n\r\nfloat waterHighlight(vec2 p, float time, float foaminess)\r\n{\r\n    vec2 i = vec2(p);\r\n\tfloat c = 0.0;\r\n    float foaminess_factor = mix(1.0, 6.0, foaminess);\r\n\tfloat inten = .005 * foaminess_factor;\r\n\r\n\tfor (int n = 0; n < MAX_ITER; n++)\r\n\t{\r\n\t\tfloat t = time * (1.0 - (3.5 / float(n+1)));\r\n\t\ti = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\r\n\t\tc += 1.0/length(vec2(p.x / (sin(i.x+t)),p.y / (cos(i.y+t))));\r\n\t}\r\n\tc = 0.2 + c / (inten * float(MAX_ITER));\r\n\tc = 1.17-pow(c, 1.4);\r\n    c = pow(abs(c), 8.0);\r\n\treturn c / sqrt(foaminess_factor);\r\n}\r\n\r\nfloat sampleMusic() {\r\n\treturn clamp(0.5 * (\r\n        texture( iChannel0, vec2( 0.15, 0.25 ) ).x +\r\n        texture( iChannel0, vec2( 0.30, 0.25 ) ).x\r\n    ), 0.15, 1.0);\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\r\n\tfloat time = iTime * 0.1+23.0;\r\n\tvec2 uv = fragCoord.xy / iResolution.xy;\r\n\tvec2 uv_square = vec2(uv.x * iResolution.x / iResolution.y, uv.y);\r\n    float dist_center = pow(1.2*length(uv - 0.5), 2.0);\r\n\r\n    float foaminess = smoothstep(0.4, 1.4, dist_center);\r\n    float clearness = 0.1 + 0.9*smoothstep(0.1, 0.5, dist_center);\r\n\r\n\tvec2 p = mod(uv_square*TAU*TILING_FACTOR, TAU)-250.0;\r\n\r\n    float c = waterHighlight(p, time, foaminess);\r\n\tvec3 color = vec3(c * sampleMusic());\r\n\r\n    color = clamp(iBackgroundColor - color, 0.0, 1.0);\r\n    color = mix(iBackgroundColor, color, -clearness);\r\n\r\n\tfragColor = vec4(color, 1.0);\r\n}\r\n",externalUrl:"https://www.shadertoy.com/view/llcXW7"}}load(){super.load(this.visualizer)}}var Zv;const eb=new H("CovertArtPlayer");Zv=new WeakMap;const tb=class extends By{constructor(e){super(),this.element=null,Zv.set(this,!0),this.animatedBackground=new Xv(e),this.beatsPlayer=new yv(e),Ry().pipe(Be((e=>e.coverArtAnimatedBackground)),Vn(),at((e=>{this.animatedBackground.hidden=this.hidden||!e}))).subscribe(eb),Ry().pipe(Be((e=>e.coverArtBeats)),Vn(),at((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(eb)}get autoplay(){return this.beatsPlayer.autoplay}set autoplay(e){this.animatedBackground.autoplay=e,this.beatsPlayer.autoplay=e}get backgroundColor(){return this.animatedBackground.backgroundColor}set backgroundColor(e){this.animatedBackground.backgroundColor=e}get beatsColor(){return this.beatsPlayer.color}set beatsColor(e){this.beatsPlayer.color=e}get hidden(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Zv,"f")}set hidden(e){(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)})(this,Zv,e,"f"),this.animatedBackground.hidden=e||!Dy.coverArtAnimatedBackground,this.beatsPlayer.hidden=e||!Dy.coverArtBeats,this.element&&(this.element.hidden=e)}appendTo(e){const t=e.querySelector(".beats-player");t&&(e.hidden=this.hidden,this.element=e,this.beatsPlayer.appendTo(t),this.animatedBackground.appendTo(e.querySelector(".animated-background")))}load(){this.animatedBackground.load(),this.beatsPlayer.load()}play(){eb.log("play"),Dy.coverArtAnimatedBackground&&this.animatedBackground.play(),Dy.coverArtBeats&&this.beatsPlayer.play()}pause(){eb.log("pause"),this.animatedBackground.pause(),this.beatsPlayer.pause()}stop(){eb.log("stop"),this.animatedBackground.stop(),this.beatsPlayer.stop()}resize(e,t){this.animatedBackground.resize(e,t),this.beatsPlayer.resize(e)}},rb=[{providerId:"coverart",name:""}],nb={id:"coverart",name:"Cover Art",visualizers:rb,observeVisualizers:()=>pn(rb),createPlayer(e){return this.player||(this.player=new tb(e)),this.player}},ib=nb;function ab(e,t,r,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*r+(1+3*e+3*a-3*s)*n+s*i)/6}function sb(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,o=n<t-1?e[n+2]:2*a-i;return ab((r-n/t)*t,s,i,a,o)}}function ob(e,t){let r;if(void 0===t)for(const t of e)null!=t&&(r>t||void 0===r&&t>=t)&&(r=t);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(r>i||void 0===r&&i>=i)&&(r=i)}return r}const lb=Math.sqrt(50),cb=Math.sqrt(10),ub=Math.sqrt(2);function db(e,t,r){const n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),a=n/Math.pow(10,i),s=a>=lb?10:a>=cb?5:a>=ub?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=r&&r<2?db(e,t,2*r):[o,l,c]}function mb(e,t,r){if(!((r=+r)>0))return[];if((e=+e)==(t=+t))return[e];const n=t<e,[i,a,s]=n?db(t,e,r):db(e,t,r);if(!(a>=i))return[];const o=a-i+1,l=new Array(o);if(n)if(s<0)for(let e=0;e<o;++e)l[e]=(a-e)/-s;else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=(i+e)/-s;else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}var hb,fb=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pb(e){if(!(t=fb.exec(e)))throw new Error("invalid format: "+e);var t;return new yb({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function yb(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function vb(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function bb(e,t){var r=vb(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}pb.prototype=yb.prototype,yb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const gb={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bb(100*e,t),r:bb,s:function(e,t){var r=vb(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(hb=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+vb(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function wb(e){return e}var Eb,kb,xb=Array.prototype.map,Sb=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Tb(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Pb(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ab(e){let t,r,n;function i(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=Tb,r=(t,r)=>Tb(e(t),r),n=(t,r)=>e(t)-r):(t=e===Tb||e===Pb?e:Ib,r=e,n=e),{left:i,center:function(e,t,r=0,a=e.length){const s=i(e,t,r,a-1);return s>r&&n(e[s-1],t)>-n(e[s],t)?s-1:s},right:function(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<=0?i=t+1:a=t}while(i<a)}return i}}}function Ib(){return 0}Eb=function(e){var t,r,n=void 0===e.grouping||void 0===e.thousands?wb:(t=xb.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>n&&(o=Math.max(1,n-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>n));)o=t[s=(s+1)%t.length];return a.reverse().join(r)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?wb:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(xb.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=pb(e)).fill,r=e.align,d=e.sign,m=e.symbol,h=e.zero,f=e.width,p=e.comma,y=e.precision,v=e.trim,b=e.type;"n"===b?(p=!0,b="g"):gb[b]||(void 0===y&&(y=12),v=!0,b="g"),(h||"0"===t&&"="===r)&&(h=!0,t="0",r="=");var g="$"===m?i:"#"===m&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===m?a:/[%p]/.test(b)?l:"",E=gb[b],k=/[defgprs%]/.test(b);function x(e){var i,a,l,m=g,x=w;if("c"===b)x=E(e)+x,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),y),v&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,x=("s"===b?Sb[8+hb/3]:"")+x+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}p&&!h&&(e=n(e,1/0));var T=m.length+e.length+x.length,P=T<f?new Array(f-T+1).join(t):"";switch(p&&h&&(e=n(P+e,P.length?f-x.length:1/0),P=""),r){case"<":e=m+e+x+P;break;case"=":e=m+P+e+x;break;case"^":e=P.slice(0,T=P.length>>1)+m+e+x+P.slice(T);break;default:e=P+m+e+x}return o(e)}return y=void 0===y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),x.toString=function(){return e+""},x}return{format:d,formatPrefix:function(e,t){var r,n=d(((e=pb(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((r=t,((r=vb(Math.abs(r)))?r[1]:NaN)/3)))),a=Math.pow(10,-i),s=Sb[8+i/3];return function(e){return n(a*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),kb=Eb.format,Eb.formatPrefix;const Cb=Ab(Tb),Mb=Cb.right,Ob=(Cb.left,Ab((function(e){return null===e?NaN:+e})).center,Mb);function $b(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Nb(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function zb(){}var jb=.7,Lb=1/jb,Db="\\s*([+-]?\\d+)\\s*",Rb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_b=/^#([0-9a-f]{3,8})$/,Bb=new RegExp(`^rgb\\(${Db},${Db},${Db}\\)$`),Vb=new RegExp(`^rgb\\(${Fb},${Fb},${Fb}\\)$`),Ub=new RegExp(`^rgba\\(${Db},${Db},${Db},${Rb}\\)$`),Hb=new RegExp(`^rgba\\(${Fb},${Fb},${Fb},${Rb}\\)$`),qb=new RegExp(`^hsl\\(${Rb},${Fb},${Fb}\\)$`),Yb=new RegExp(`^hsla\\(${Rb},${Fb},${Fb},${Rb}\\)$`),Kb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Wb(){return this.rgb().formatHex()}function Gb(){return this.rgb().formatRgb()}function Jb(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=_b.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?Qb(t):3===r?new eg(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?Xb(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?Xb(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Bb.exec(e))?new eg(t[1],t[2],t[3],1):(t=Vb.exec(e))?new eg(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ub.exec(e))?Xb(t[1],t[2],t[3],t[4]):(t=Hb.exec(e))?Xb(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=qb.exec(e))?sg(t[1],t[2]/100,t[3]/100,1):(t=Yb.exec(e))?sg(t[1],t[2]/100,t[3]/100,t[4]):Kb.hasOwnProperty(e)?Qb(Kb[e]):"transparent"===e?new eg(NaN,NaN,NaN,0):null}function Qb(e){return new eg(e>>16&255,e>>8&255,255&e,1)}function Xb(e,t,r,n){return n<=0&&(e=t=r=NaN),new eg(e,t,r,n)}function Zb(e,t,r,n){return 1===arguments.length?((i=e)instanceof zb||(i=Jb(i)),i?new eg((i=i.rgb()).r,i.g,i.b,i.opacity):new eg):new eg(e,t,r,null==n?1:n);var i}function eg(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function tg(){return`#${ag(this.r)}${ag(this.g)}${ag(this.b)}`}function rg(){const e=ng(this.opacity);return`${1===e?"rgb(":"rgba("}${ig(this.r)}, ${ig(this.g)}, ${ig(this.b)}${1===e?")":`, ${e})`}`}function ng(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ig(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ag(e){return((e=ig(e))<16?"0":"")+e.toString(16)}function sg(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new lg(e,t,r,n)}function og(e){if(e instanceof lg)return new lg(e.h,e.s,e.l,e.opacity);if(e instanceof zb||(e=Jb(e)),!e)return new lg;if(e instanceof lg)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(r-n)/o+6*(r<n):r===a?(n-t)/o+2:(t-r)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new lg(s,o,l,e.opacity)}function lg(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function cg(e){return(e=(e||0)%360)<0?e+360:e}function ug(e){return Math.max(0,Math.min(1,e||0))}function dg(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}$b(zb,Jb,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Wb,formatHex:Wb,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return og(this).formatHsl()},formatRgb:Gb,toString:Gb}),$b(eg,Zb,Nb(zb,{brighter(e){return e=null==e?Lb:Math.pow(Lb,e),new eg(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?jb:Math.pow(jb,e),new eg(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new eg(ig(this.r),ig(this.g),ig(this.b),ng(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tg,formatHex:tg,formatHex8:function(){return`#${ag(this.r)}${ag(this.g)}${ag(this.b)}${ag(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:rg,toString:rg})),$b(lg,(function(e,t,r,n){return 1===arguments.length?og(e):new lg(e,t,r,null==n?1:n)}),Nb(zb,{brighter(e){return e=null==e?Lb:Math.pow(Lb,e),new lg(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?jb:Math.pow(jb,e),new lg(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new eg(dg(e>=240?e-240:e+120,i,n),dg(e,i,n),dg(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new lg(cg(this.h),ug(this.s),ug(this.l),ng(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ng(this.opacity);return`${1===e?"hsl(":"hsla("}${cg(this.h)}, ${100*ug(this.s)}%, ${100*ug(this.l)}%${1===e?")":`, ${e})`}`}}));const mg=e=>()=>e;function hg(e,t){var r=t-e;return r?function(e,t){return function(r){return e+r*t}}(e,r):mg(isNaN(e)?t:e)}const fg=function e(t){var r=function(e){return 1==(e=+e)?hg:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):mg(isNaN(t)?r:t)}}(t);function n(e,t){var n=r((e=Zb(e)).r,(t=Zb(t)).r),i=r(e.g,t.g),a=r(e.b,t.b),s=hg(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return n.gamma=e,n}(1);function pg(e){return function(t){var r,n,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(r=0;r<i;++r)n=Zb(t[r]),a[r]=n.r||0,s[r]=n.g||0,o[r]=n.b||0;return a=e(a),s=e(s),o=e(o),n.opacity=1,function(e){return n.r=a(e),n.g=s(e),n.b=o(e),n+""}}}function yg(e,t){var r,n=t?t.length:0,i=e?Math.min(n,e.length):0,a=new Array(i),s=new Array(n);for(r=0;r<i;++r)a[r]=Sg(e[r],t[r]);for(;r<n;++r)s[r]=t[r];return function(e){for(r=0;r<i;++r)s[r]=a[r](e);return s}}function vg(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function bg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function gg(e,t){var r,n={},i={};for(r in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)r in e?n[r]=Sg(e[r],t[r]):i[r]=t[r];return function(e){for(r in n)i[r]=n[r](e);return i}}pg(sb),pg((function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],a=e[n%t],s=e[(n+1)%t],o=e[(n+2)%t];return ab((r-n/t)*t,i,a,s,o)}}));var wg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Eg=new RegExp(wg.source,"g");function kg(e,t){var r,n,i,a=wg.lastIndex=Eg.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(r=wg.exec(e))&&(n=Eg.exec(t));)(i=n.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:bg(r,n)})),a=Eg.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var r,n=0;n<t;++n)o[(r=l[n]).i]=r.x(e);return o.join("")})}function xg(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function Sg(e,t){var r,n,i=typeof t;return null==t||"boolean"===i?mg(t):("number"===i?bg:"string"===i?(r=Jb(t))?(t=r,fg):kg:t instanceof Jb?fg:t instanceof Date?vg:(n=t,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(t)?yg:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?gg:bg:xg))(e,t)}function Tg(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Pg(e){return+e}var Ag=[0,1];function Ig(e){return e}function Cg(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function Mg(e,t,r){var n=e[0],i=e[1],a=t[0],s=t[1];return i<n?(n=Cg(i,n),a=r(s,a)):(n=Cg(n,i),a=r(a,s)),function(e){return a(n(e))}}function Og(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=Cg(e[s],e[s+1]),a[s]=r(t[s],t[s+1]);return function(t){var r=Ob(e,t,1,n)-1;return a[r](i[r](t))}}function $g(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Ng(e){return Math.log(e)}function zg(e){return Math.exp(e)}function jg(e){return-Math.log(-e)}function Lg(e){return-Math.exp(-e)}function Dg(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Rg(e){return(t,r)=>-e(-t,r)}function Fg(){const e=function(e){const t=e(Ng,zg),r=t.domain;let n,i,a=10;function s(){return n=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?Dg:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),r()[0]<0?(n=Rg(n),i=Rg(i),e(jg,Lg)):e(Ng,zg),t}return t.base=function(e){return arguments.length?(a=+e,s()):a},t.domain=function(e){return arguments.length?(r(e),s()):r()},t.ticks=e=>{const t=r();let s=t[0],o=t[t.length-1];const l=o<s;l&&([s,o]=[o,s]);let c,u,d=n(s),m=n(o);const h=null==e?10:+e;let f=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),s>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}2*f.length<h&&(f=mb(s,o,h))}else f=mb(d,m,Math.min(m-d,h)).map(i);return l?f.reverse():f},t.tickFormat=(e,r)=>{if(null==e&&(e=10),null==r&&(r=10===a?"s":","),"function"!=typeof r&&(a%1||null!=(r=pb(r)).precision||(r.trim=!0),r=kb(r)),e===1/0)return r;const s=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(n(e)));return t*a<a-.5&&(t*=a),t<=s?r(e):""}},t.nice=()=>r(function(e,t){var r,n=0,i=(e=e.slice()).length-1,a=e[n],s=e[i];return s<a&&(r=n,n=i,i=r,r=a,a=s,s=r),e[n]=t.floor(a),e[i]=t.ceil(s),e}(r(),{floor:e=>i(Math.floor(n(e))),ceil:e=>i(Math.ceil(n(e)))})),t}(function(){var e,t,r,n,i,a,s=Ag,o=Ag,l=Sg,c=Ig;function u(){var e=Math.min(s.length,o.length);return c!==Ig&&(c=function(e,t){var r;return e>t&&(r=e,e=t,t=r),function(r){return Math.max(e,Math.min(t,r))}}(s[0],s[e-1])),n=e>2?Og:Mg,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?r:(i||(i=n(s.map(e),o,l)))(e(c(t)))}return d.invert=function(r){return c(t((a||(a=n(o,s.map(e),bg)))(r)))},d.domain=function(e){return arguments.length?(s=Array.from(e,Pg),u()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),l=Tg,u()},d.clamp=function(e){return arguments.length?(c=!!e||Ig,u()):c!==Ig},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(r=e,d):r},function(r,n){return e=r,t=n,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,r=Fg(),r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,r},$g.apply(e,arguments),e}var _g=r(3208);function Bg(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function Vg(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Bg(r);return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}let Ug;function Hg(){return Ug||(Ug=Vg("keyval-store","keyval")),Ug}function qg(e,t=Hg()){return t("readonly",(t=>Bg(t.get(e))))}function Yg(e,t,r=Hg()){return r("readwrite",(r=>(r.put(t,e),Bg(r.transaction))))}var Kg;!function(e){e.Looking="looking",e.NotFound="not-found"}(Kg||(Kg={}));const Wg=Kg;var Gg=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Jg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Qg=new H("playlist"),Xg=Vg("ampcast/playlist","keyval"),Zg=[],ew=new it(Zg),tw=new it("");function rw(){return ew.getValue()}function nw(e){e=e.concat(),ew.next(e),0===e.length?aw(""):sw()||aw(e[0].id)}function iw(){return tw.getValue()}function aw(e){tw.next(e)}function sw(){const e=rw(),t=iw();return e.find((e=>e.id===t))||null}function ow(e){aw(e.id)}function lw(){return _n([ew,tw]).pipe(Be((([e,t])=>{var r;return null!==(r=e.find((e=>e.id===t)))&&void 0!==r?r:null})),Vn())}function cw(){return _n([ew,tw]).pipe(Be((([e,t])=>e.findIndex((e=>e.id===t)))),Vn())}function uw(){const e=ew.getValue(),t=iw();return e.findIndex((e=>e.id===t))}function dw(){return ew.pipe(Be((e=>e.length)),Vn())}function mw(){return ew.getValue().length}function hw(e){const t=iw();if(t){const r=rw(),n=r.findIndex((e=>e.id===t));if(-1!==n){const t=r[n+e];t&&ow(t)}}}function fw(e,t){return Gg(this,void 0,void 0,(function*(){const r=rw(),n=Oy.get().allowDuplicates;let i=yield function(e){return Gg(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===ti.Album;let r=[];return r=Array.isArray(e)?t(e[0])?(yield Promise.all(e.map((e=>yw(e))))).flat():e:t(e)?yield yw(e):[e],r.filter(l)}))}(e);if(n||(i=i.filter((e=>-1===r.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},D(e)),{id:xa()})));t>=0&&t<r.length?(r.splice(t,0,...e),nw(r)):nw(r.concat(e))}}))}function pw(e){const t=rw(),r=Array.isArray(e)?e:[e],n=t.filter((e=>!r.includes(e)));if(n.length!==t.length){const e=uw(),t=iw(),r=n.findIndex((e=>e.id===t));if(-1===r)if(-1===e)aw("");else{const t=n[e]||n.at(-1);aw((null==t?void 0:t.id)||"")}nw(n)}}function yw(e){return Gg(this,void 0,void 0,(function*(){return hi(e.pager,{keepAlive:!0})}))}const vw={get atEnd(){return uw()===mw()-1},get atStart(){return 0===mw()||0===uw()},observe:function(){return ew.pipe(_e((e=>e!==Zg)))},observeCurrentIndex:cw,observeCurrentItem:lw,observeNextItem:function(){return _n([ew,tw]).pipe(Be((([e,t])=>{const r=e.findIndex((e=>e.id===t));return-1===r?null:e[r+1]||null})),Vn())},observeSize:dw,getCurrentIndex:uw,getCurrentItem:sw,setCurrentItem:ow,getItems:rw,add:function(e){return Gg(this,void 0,void 0,(function*(){return fw(e,-1)}))},clear:function(){nw([])},eject:function(){const e=sw();e&&pw(e)},inject:function(e){return Gg(this,void 0,void 0,(function*(){return fw(e,uw()+1)}))},injectAt:fw,moveSelection:function(e,t){return Gg(this,void 0,void 0,(function*(){const r=rw(),n=r[t];if(e.includes(n))return;const i=r.filter((t=>!e.includes(t))),a=i.indexOf(n);a>=0?(i.splice(a,0,...e),nw(i)):nw(i.concat(e))}))},next:function(){hw(1)},prev:function(){hw(-1)},remove:pw,removeAt:function(e){const t=function(e){var t;return null!==(t=rw()[e])&&void 0!==t?t:null}(e);t&&pw(t)},reverseAt:function(e,t){const r=rw(),n=r.slice(e,e+t).reverse();r.splice(e,t,...n),nw(r)},shuffle:function(e){const t=rw().slice();if(t.length>0){const r=sw();if(e&&r){const e=p(t.filter((e=>e!==r)));e.unshift(r),nw(e)}else{const e=p(t);nw(e),ow(e[0])}}}},bw=vw;Gg(void 0,void 0,void 0,(function*(){const[e=[],t=""]=yield Promise.all([qg("items",Xg),qg("currently-playing-id",Xg)]);aw(t),nw(e.map((e=>{var t;if(null===(t=e.plex)||void 0===t?void 0:t.ratingKey){const[,t,r]=e.src.split(":");e.src=`plex:${t}:${e.plex.ratingKey}`,e.srcs=[r],delete e.plex.ratingKey}return e})))})),ew.pipe(Gh(2),gv(200),et((e=>Yg("items",e=e.map((e=>{if("lookupStatus"in e){const{lookupStatus:t}=e;return Jg(e,["lookupStatus"])}return e})),Xg)))).subscribe(Qg),tw.pipe(Gh(2),gv(200),et((e=>Yg("currently-playing-id",e,Xg)))).subscribe(Qg),Zo.pipe(at((({lookupItem:e})=>{const t=rw(),r=t.findIndex((t=>t.id===e.id));-1!==r&&(t[r]=Object.assign(Object.assign({},e),{lookupStatus:Wg.Looking}),nw(t))}))).subscribe(Qg),el.pipe(at((({lookupItem:e,foundItem:t})=>{const r=rw(),n=r.findIndex((t=>t.id===e.id));-1!==n&&(r[n]=t?Object.assign(Object.assign({},x(t,e)),{id:e.id}):Object.assign(Object.assign({},e),{lookupStatus:Wg.NotFound}),nw(r))}))).subscribe(Qg),tl.pipe(at((({lookupItem:e})=>{const t=rw(),r=t.findIndex((t=>t.id===e.id));if(-1!==r){const{lookupStatus:n}=e,i=Jg(e,["lookupStatus"]);t[r]=i,nw(t)}}))).subscribe(Qg),Wn().pipe(at((e=>{let t=!1;const r=rw().map((r=>{for(const{match:n,values:i}of e)if(n(r)){const e=D(i);if(Object.keys(e).length>0)return t=!0,Object.assign(Object.assign({},r),e)}return r}));t&&nw(r)}))).subscribe(Qg);const gw=new it(!1),ww=new it({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function Ew(){return gw.pipe(_e((e=>e)),Di(1),Be((()=>{})))}function kw(){return ww}function xw(){return kw().pipe(_e((e=>0!==e.startedAt)),Vn(((e,t)=>e.startedAt===t.startedAt)))}function Sw(){return kw().pipe(_e((e=>0!==e.endedAt)),Vn(((e,t)=>e.endedAt===t.endedAt)))}function Tw(e=1e4){return xw().pipe(on((()=>kw().pipe(Ha(e,void 0,{trailing:!0}),ln(Sw())))))}function Pw(){return kw().pipe(Be((e=>e.currentTime)),Vn())}function Aw(){return kw().pipe(Be((e=>e.duration)),Vn())}function Iw(){return kw().pipe(Be((e=>e.paused)),Vn())}function Cw(){const e=ww.getValue();e.startedAt&&(e.endedAt||ww.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),ww.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}lw().subscribe((e=>{var t;const r=ww.getValue();(null==e?void 0:e.id)===(null===(t=r.currentItem)||void 0===t?void 0:t.id)?ww.next(Object.assign(Object.assign({},r),{currentItem:e})):(Cw(),ww.next(Object.assign(Object.assign({},r),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0})))}));const Mw={get paused(){return ww.getValue().paused},observePlaybackReady:Ew,observePlaybackState:kw,observePlaybackStart:xw,observePlaybackEnd:Sw,observePlaybackProgress:Tw,observeCurrentTime:Pw,observeDuration:Aw,observePaused:Iw,getCurrentTime:function(){return ww.getValue().currentTime},setCurrentTime:function(e){const t=ww.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&ww.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return ww.getValue().duration},setDuration:function(e){const t=ww.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const r=Math.min(t.currentTime,e);ww.next(Object.assign(Object.assign({},t),{duration:e,currentTime:r}))}},play:function(){const e=ww.getValue();e.currentItem&&e.paused&&ww.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=ww.getValue();e.paused||ww.next(Object.assign(Object.assign({},e),{paused:!0}))},ready:function(){gw.next(!0)},stop:function(){const e=ww.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});ww.next(t),e.startedAt&&ww.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=ww.getValue();e.startedAt||ww.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:Cw},Ow=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const r=[{index:t,value:e}];for(let n=1;n<12;n++)r[n]={index:t,value:e*Math.pow(2,n)};return r})).flat().sort(((e,t)=>e.value-t.value));function $w(e,t,r){return function(e,t){const r=e*t,n=r+t,i=Ow.filter((e=>e.value>=r&&e.value<n));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<Ow.length;e++){const t=Ow[e];if(t.value>n){const i=Ow[e-1],a=t.value-i.value;return[{index:i.index,value:1-(n-i.value)/a},{index:t.index,value:1-(t.value-r)/a}]}}return[]}(t,r).map((({index:t,value:r})=>e[t]*r)).reduce(((e,t)=>e+t),0)}var Nw,zw=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Nw=new WeakMap;const jw=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new it({bars:{},beats:{},sections:{},segments:{},tatums:{}}),Nw.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,e.observeCurrentTrackState().subscribe((t=>zw(this,void 0,void 0,(function*(){var r,n;const i=null===(n=null===(r=null==t?void 0:t.track_window)||void 0===r?void 0:r.current_track)||void 0===n?void 0:n.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield sh.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Nw,"f")}observeBar(){return this.observeActiveIntervals().pipe(Be((e=>e.bars)),Vn())}observeBeat(){return this.observeActiveIntervals().pipe(Be((e=>e.beats)),Vn())}observeSection(){return this.observeActiveIntervals().pipe(Be((e=>e.sections)),Vn())}observeSegment(){return this.observeActiveIntervals().pipe(Be((e=>e.segments)),Vn())}observeTatum(){return this.observeActiveIntervals().pipe(Be((e=>e.tatums)),Vn())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const r=sb([.5,1,.5])(this.beat.progress)*this.volume,n=(this.segment.timbre[1]-180)/360,i=this.frequencyBinCount;for(let a=0;a<i;a++){let s=(a-i/2-n*i)/i+1;(s<0||s>2)&&(s=0);const o=Math.sin(s*(Math.PI/2)),l=$w(t,a,this.sampleSize);e[a]=(l+o)/2*255*r}}else e.fill(0)}getFloatFrequencyData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Uint8Array(t);this.getByteFrequencyData(r);for(let n=0;n<t;n++)e[n]=r[n]-128}getByteTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatTimeDomainData(r);const n=Uint8Array.from(r);for(let r=0;r<t;r++)e[r]=n[r]}getFloatTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatFrequencyData(r);const{real:n,imag:i}=(0,_g.MF)(r);for(let r=0;r<t;r++)e[r]=Math.sqrt(n[r]*n[r]+i[r]*i[r])-128}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return Iw().pipe(on((e=>e?an:this.activeIntervals$)),_e((()=>this.active)))}updateState(e){return zw(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],r=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<r&&r<t[e+1].start)return e}return 0};this.intervalTypes.forEach((r=>{const n=t(r);null!=e[r].start&&n===e[r].index||(e[r]=Object.assign(Object.assign({},this.trackAnalysis[r][n]),{index:n}));const{start:i,duration:a}=e[r],s=this.trackProgress-i;e[r].elapsed=s,e[r].progress=this.easeOutQuart(s/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:r,duration:n,elapsed:i,start:a,index:s}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[s+1])return 0;const o=this.trackAnalysis.segments[s+1].loudness_start,l=a+i;if(i<r){const n=Math.min(1,i/r);return this.interpolate(t,e)(n)}{const t=l-(a+r),i=n-r,s=Math.min(1,t/i);return this.interpolate(e,o)(s)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),r=this.queues;function n(e){return e.reduce(((e,t)=>e+t))/e.length}r.volume.unshift(t),r.volume.length>400&&r.volume.pop(),r.beat.unshift(t),r.beat.length>this.volumeSmoothing&&r.beat.pop();const i=Fg().domain([ob(r.volume),n(r.volume)]).range([0,1]),a=n(r.beat);!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Nw,i(a)||0,"f")}interpolate(e,t){return r=>e*(1-r)+t*r}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(lf),Lw=new H("SpotifyVizPlayer");class Dw extends By{constructor(){super(),this.analyser=jw,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz";const e=this.analyser;e.observeBar().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===r||r.call(t,e)})),e.observeBeat().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===r||r.call(t,e)})),e.observeSection().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===r||r.call(t,e)})),e.observeSegment().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===r||r.call(t,e)})),e.observeTatum().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===r||r.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.cancelAnimation():this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){var t,r;Lw.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.analyser.volumeSmoothing=null!==(r=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==r?r:100),this.autoplay&&!this.animationFrameId&&this.render()}play(){Lw.log("play"),this.animationFrameId||this.render()}pause(){Lw.log("pause"),this.cancelAnimation()}stop(){Lw.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}let Rw="",Fw="";const _w={volumeSmoothing:10,onBar(){const e=Gt.getVisualizerColors();Rw=Fw||k(e),Fw=k(e.filter((e=>e!==Fw)))},onPaint({context2D:e,height:t,width:r,now:n,analyser:i}){const a=sb([0,10*i.volume,0])(i.bar.progress),s=sb([0,300*i.volume,0])(i.beat.progress),{r:o,g:l,b:c}=new Tt(Gt.black).toRgb(),u=`${o},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,r,t),e.lineWidth=a,e.strokeStyle=fg(Rw,Fw)(i.bar.progress),function(e,t,r,n,i,a=5){const s=e=>n*Math.sin(e/i+t)+r,{width:o}=e.canvas;e.beginPath();for(let t=-50;t<o+50;t+=a)-50===t?e.moveTo(t,s(t)):e.lineTo(t,s(t))}(e,n/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=s,function(e,t,r,n,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,r,n,i,a),e.closePath()}(e,r/2,t/2,i.volume*t/5+s/10),e.stroke(),e.fill()}},Bw=[{providerId:"spotifyviz",name:"example by zachwinter",config:_w,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],Vw={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",visualizers:Bw,observeVisualizers:()=>pn(Bw),createPlayer(){return this.player||(this.player=new Dw),this.player}};function Uw(){return Gt.isLight&&Gt.isFrameLight?Gt.frameColor:Gt.isTextLight?Gt.textColor:Gt.frameTextColor}const Hw=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i),s=t/i;let o=0;e.lineWidth=Math.round(Gt.fontSize/(document.fullscreenElement?2:4)),e.clearRect(0,0,t,r),e.strokeStyle=Uw(),e.beginPath(),n.getByteTimeDomainData(a);for(let t=0;t<i;t++){const n=a[t]/128*r/2;0===t?e.moveTo(o,n):e.lineTo(o,n),o+=s}e.lineTo(t,r/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=document.fullscreenElement?8:4,a=n.frequencyBinCount,s=new Uint8Array(a);n.getByteFrequencyData(s),e.clearRect(0,0,t,r),e.fillStyle=Uw();const o=(t-15*i)/16,l=.0075*r,c=a/16;let u,d=0;for(let t=0;t<a;t+=c){const n=s.slice(t,t+c).reduce(((e,t)=>e+t),0)/c;u=l*n,e.fillRect(d,r-u/2,o,u/2),d+=o+i}}}}],qw=Hw,Yw={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",visualizers:qw,observeVisualizers:()=>pn(qw),createPlayer(e){return this.player||(this.player=new fv(e,"main")),this.player}},Kw=Yw,Ww=new H("visualizerProviders");function Gw(){return[Av,Lv,Uv,Qv,ib,Vw,Kw]}function Jw(e){return Gw().find((t=>t.id===e))}function Qw(e){var t;return(null===(t=Jw(e))||void 0===t?void 0:t.visualizers)||[]}function Xw({providerRef:e,fullscreenProgressRef:t,ambientVideoEnabled:r,onSubmit:i}){const a=(0,n.useId)(),s=Dy.provider,o=(0,n.useMemo)(Gw,[]);return n.createElement("form",{className:"visualizer-settings-general",method:"dialog"},n.createElement("p",null,n.createElement("label",{htmlFor:`${a}-visualizer-provider`},"Provider:"),n.createElement("select",{id:`${a}-visualizer-provider`,defaultValue:s,ref:e},n.createElement("option",{value:"none"},"(none)"),o.length>1?n.createElement("option",{value:""},"(random)"):null,o.filter((e=>"ambientvideo"!==e.id||r)).map((e=>n.createElement("option",{value:e.id,key:e.id},e.name))))),n.createElement("fieldset",null,n.createElement("legend",null,"Fullscreen"),n.createElement("p",null,n.createElement("input",{type:"checkbox",id:`${a}-fullscreen-progress`,defaultChecked:Dy.fullscreenProgress,ref:t}),n.createElement("label",{htmlFor:`${a}-fullscreen-progress`},"Show progress bar"))),n.createElement(yr,{onSubmit:i}))}function Zw({ambientVideoEnabledRef:e,ambientVideoSourceRef:t,useAmbientVideoSourceRef:r,beatsOverlayEnabledRef:i,onAmbientVideoEnabledChange:a,onSubmit:s}){const o=(0,n.useId)(),[l,c]=(0,n.useState)((()=>!!Dy.useAmbientVideoSource)),u=(0,n.useCallback)((()=>{t.current.validity.valid||r.current.checked||(t.current.value=""),c(r.current.checked)}),[t,r]),d=(0,n.useCallback)((()=>{const e=t.current.value;let r="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(r="Not a YouTube video or playlist.",Fc(e)&&(r="")),t.current.setCustomValidity(r)}),[t]),m=(0,n.useCallback)((()=>{a(e.current.checked)}),[e,a]);return n.createElement("form",{className:"ambient-video-settings",method:"dialog"},n.createElement("p",null,n.createElement("input",{id:`${o}-ambient-video-enabled`,type:"checkbox",defaultChecked:Dy.ambientVideoEnabled,onChange:m,ref:e}),n.createElement("label",{htmlFor:`${o}-ambient-video-enabled`},"Enable ambient video")),n.createElement("fieldset",null,n.createElement("legend",null,"Source"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-default`,defaultChecked:!Dy.useAmbientVideoSource,onChange:u}),n.createElement("label",{htmlFor:`${o}-source-default`},"Default videos")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-youtube`,defaultChecked:Dy.useAmbientVideoSource,onChange:u,ref:r}),n.createElement("label",{htmlFor:`${o}-source-youtube`},"YouTube video or playlist:")),n.createElement("p",null,n.createElement("input",{type:"url",defaultValue:Dy.ambientVideoSource,disabled:!l,required:l,onInput:d,"aria-labelledby":`${o}-source-youtube-label`,ref:t}))),n.createElement("p",null,n.createElement("input",{id:`${o}-beats-overlay`,type:"checkbox",defaultChecked:Dy.ambientVideoBeats,ref:i}),n.createElement("label",{htmlFor:`${o}-beats-overlay`},'Show "beats" overlay')),n.createElement(yr,{onSubmit:s}))}function eE({animatedBackgroundEnabledRef:e,beatsOverlayEnabledRef:t,onSubmit:r}){const i=(0,n.useId)();return n.createElement("form",{className:"cover-art-settings",method:"dialog"},n.createElement("p",null,n.createElement("input",{id:`${i}-beats-overlay`,type:"checkbox",defaultChecked:Dy.coverArtBeats,ref:t}),n.createElement("label",{htmlFor:`${i}-beats-overlay`},'Show "beats" overlay')),n.createElement("p",null,n.createElement("input",{id:`${i}-animated-background`,type:"checkbox",defaultChecked:Dy.coverArtAnimatedBackground,ref:e}),n.createElement("label",{htmlFor:`${i}-animated-background`},"Animated background (experimental)")),n.createElement(yr,{onSubmit:r}))}function tE(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useRef)(null),[c,u]=(0,n.useState)(Dy.ambientVideoEnabled),d=(0,n.useCallback)((()=>{Dy.provider=e.current.value,Dy.ambientVideoEnabled=t.current.checked,Dy.useAmbientVideoSource=i.current.checked,Dy.ambientVideoSource=r.current.value,Dy.ambientVideoBeats=a.current.checked,Dy.coverArtAnimatedBackground=s.current.checked,Dy.coverArtBeats=o.current.checked,Dy.fullscreenProgress=l.current.checked}),[]),m=(0,n.useMemo)((()=>[{tab:"General",panel:n.createElement(Xw,{providerRef:e,fullscreenProgressRef:l,ambientVideoEnabled:c,onSubmit:d})},{tab:"Ambient Video",panel:n.createElement(Zw,{ambientVideoEnabledRef:t,ambientVideoSourceRef:r,useAmbientVideoSourceRef:i,beatsOverlayEnabledRef:a,onAmbientVideoEnabledChange:u,onSubmit:d})},{tab:"Cover Art",panel:n.createElement(eE,{animatedBackgroundEnabledRef:s,beatsOverlayEnabledRef:o,onSubmit:d})}]),[c,d]);return n.createElement(up,{className:"visualizer-settings",items:m,label:"Visualizers"})}function rE(e){return n.createElement(cr,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),n.createElement(tE,null))}tn(Gw()).pipe(et((e=>e.observeVisualizers().pipe(Be((e=>e.length)),Nn((e=>0===e)),at((t=>Ww.log(`${e.id} (total=${t})`))))))).subscribe(Ww);const nE=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useCallback)((e=>{e.preventDefault(),function(){var e,t,r,i;e=this,t=void 0,i=function*(){if(yield wr({title:"Factory Reset",message:n.createElement("p",null,"This will delete all of your current settings",n.createElement("br",null),"and disconnect you from all services."),okLabel:"Continue",system:!0})){try{yield Promise.all(Uf().filter((e=>e.isConnected())).map((e=>e.logout())))}catch(e){console.error(e)}localStorage.clear(),sessionStorage.clear();try{const e=yield indexedDB.databases();yield Promise.all(e.map((e=>e.name)).filter(l).map((e=>indexedDB.deleteDatabase(e))))}catch(e){console.error(e)}location.reload()}},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}))}()}),[]);return n.createElement("form",{className:"advanced-settings-general",method:"dialog"},n.createElement("p",null,n.createElement("button",{onClick:e},"Factory Reset…")),n.createElement(yr,null))}),null)}];function iE(){return n.createElement(up,{className:"advanced-settings",items:nE,label:"Advanced Settings"})}const aE=new J("settings-sources");function sE(e){const t=(0,n.useMemo)((()=>[{id:"streaming-media",label:n.createElement(kr,{text:"Streaming Media",icon:"globe"}),value:n.createElement(ry,{title:"Streaming Media Settings",serviceType:$n.PublicMedia,services:Gf(),key:$n.PublicMedia}),startExpanded:!0,children:Gf().filter(Nm).map((e=>({id:e.id,label:n.createElement(sp,{service:e}),value:n.createElement(Iy,{service:e,key:e.id})})))},{id:"personal-media",label:n.createElement(kr,{text:"Personal Media",icon:"network"}),value:n.createElement(ry,{title:"Personal Media Settings",serviceType:$n.PersonalMedia,services:Kf(),key:$n.PersonalMedia}),startExpanded:!0,children:Kf().filter(Nm).map((e=>({id:e.id,label:n.createElement(sp,{service:e}),value:n.createElement(Iy,{service:e,key:e.id})})))},{id:"data-services",label:n.createElement(kr,{text:"Data Services",icon:"data"}),value:n.createElement(ry,{title:"Data Services Settings",serviceType:$n.DataService,services:qf(),key:$n.DataService}),startExpanded:!0,children:qf().filter(Nm).map((e=>({id:e.id,label:n.createElement(sp,{service:e}),value:n.createElement(Iy,{service:e,key:e.id})})))},{id:"visualizer",label:n.createElement(kr,{text:"Visualizer",icon:"visualizer"}),value:n.createElement(tE,null)},{id:"playlist",label:n.createElement(kr,{text:"Playlist",icon:"playlist"}),value:n.createElement(Ny,null)},{id:"appearance",label:n.createElement(kr,{text:"Appearance",icon:"palette"}),value:n.createElement(Wp,null)},{id:"advanced",label:n.createElement(kr,{text:"Advanced",icon:"settings"}),value:n.createElement(iE,null)}]),[]),[r,i]=(0,n.useState)(null);return n.createElement(cr,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),n.createElement(An,{className:"settings-dialog-sources",roots:t,storageId:aE.id,onSelect:i}),n.createElement("div",{className:"settings-dialog-source"},r))}function oE(){return n.createElement("div",{className:"app-drag-region",onContextMenu:g})}var lE=r(9128),cE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function uE(e){var{service:t,onClick:r=t.login}=e,i=cE(e,["service","onClick"]);return n.createElement("p",null,n.createElement("button",Object.assign({},i,{className:"branded login",onClick:r}),"Connect to ",t.name,"…"))}function dE({service:e}){return n.createElement("p",null,"You need to be logged in to"," ",e.serviceType===$n.DataService?"access your data":"play music"," from"," ",e.name,".")}function mE({service:e}){return n.createElement("p",{className:`service-link service-link-${e.id}`},n.createElement(rt,{name:e.icon}),n.createElement(Xl,{href:e.url}))}function hE({service:e}){const{musicKit:t,error:r}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=tn(ji()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{musicKit:e,error:r}}();return n.createElement(n.Fragment,null,n.createElement(dE,{service:e}),n.createElement(uE,{service:e,disabled:!t}),r?n.createElement("p",{className:"error"},"Could not load Apple MusicKit library."):null,n.createElement(mE,{service:e}))}function fE({service:{observeConnectionLogging:e}}){const[t,r]=(0,n.useState)([]);return(0,n.useEffect)((()=>{if(e){const t=e().subscribe((e=>{r(e?t=>t.concat(e):[])}));return()=>t.unsubscribe()}r([])}),[e]),e?n.createElement("div",{className:"connection-logging"},t.map(((e,t)=>n.createElement("p",{key:t},e)))):null}function pE({service:e}){return n.createElement(n.Fragment,null,n.createElement(dE,{service:e}),n.createElement(uE,{service:e}),n.createElement(mE,{service:e}),n.createElement(fE,{service:e}))}function yE(){(0,n.useEffect)((()=>{const e=new Ne,t=e.pipe(et((e=>Rr(e))),et((()=>function(){return Fd(this,void 0,void 0,(function*(){return Hd=yield Rd.fetchJSON({host:Sd,path:"/pins",method:"POST",params:{strong:"true"}}),Hd}))}())),Be((e=>1e3*e.expiresIn)),at((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()}))}function vE({service:e}){return yE(),n.createElement(pE,{service:e})}function bE({service:e}){const t=e.authService;return yE(),n.createElement(n.Fragment,null,n.createElement(dE,{service:e}),n.createElement(uE,{service:t}),n.createElement(mE,{service:t}),n.createElement(mE,{service:e}),n.createElement(fE,{service:t}))}function gE({service:e}){return n.createElement("div",{className:"dev-mode note"},n.createElement("p",null,"This application is in ",n.createElement("strong",null,"development mode"),"."),n.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function wE(e){return n.createElement(cr,Object.assign({},e,{className:"settings-dialog spotify-credentials-dialog",title:"Spotify Credentials"}),n.createElement(uy,null))}var EE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function kE({service:e}){const t=(0,n.useCallback)((()=>EE(this,void 0,void 0,(function*(){ch.clientId||(yield dr(wE)),ch.clientId&&(yield e.login())}))),[e]);return n.createElement(n.Fragment,null,n.createElement(gE,{service:e}),n.createElement("p",null,"You need to be logged in to play music from Spotify.*"),n.createElement(uE,{service:e,onClick:t}),n.createElement("p",null,n.createElement("small",null,"*Spotify Premium required.")),n.createElement(mE,{service:e}))}function xE(e){return n.createElement(cr,Object.assign({},e,{className:"settings-dialog youtube-credentials-dialog",title:"YouTube Credentials"}),n.createElement(my,null))}var SE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function TE({service:e}){const{client:t,error:r}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=tn(Sc()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{client:e,error:r}}(),i=(0,n.useCallback)((()=>SE(this,void 0,void 0,(function*(){dc.apiKey&&dc.clientId||(yield dr(xE)),dc.apiKey&&dc.clientId&&(yield e.login())}))),[e]);return n.createElement(n.Fragment,null,n.createElement(gE,{service:e}),n.createElement("p",null,"You can still play YouTube videos without being logged in.",n.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),n.createElement(uE,{service:e,disabled:!t,onClick:i}),r?n.createElement("p",{className:"error"},"Could not load Google client library."):null,n.createElement(mE,{service:e}))}function PE({service:e}){return n.createElement("div",{className:"panel"},n.createElement("div",{className:`page login login-${e.id}`},n.createElement(AE,{service:e})))}function AE({service:e}){switch(e.id){case"apple":return n.createElement(hE,{service:e});case"plex":return n.createElement(vE,{service:e});case"plex-tidal":return n.createElement(bE,{service:e});case"spotify":return n.createElement(kE,{service:e});case"youtube":return n.createElement(TE,{service:e});default:return n.createElement(pE,{service:e})}}const IE=new it(ME());function CE(){return IE.pipe(Vn())}function ME(){return navigator.onLine}function OE(){return dp(CE,ME())}function $E(){return n.createElement("div",{className:"panel"},n.createElement("div",{className:"page login"},n.createElement("div",{className:"note"},n.createElement("p",null,"Internet connection required."))))}function NE({children:e}){return n.createElement("div",{className:"panel empty-screen"},e)}function zE({error:e,children:t}){return n.createElement("div",{className:"panel error-screen"},n.createElement("div",{className:"error-screen-content"},n.createElement("h2",null,"Error"),n.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function jE({icon:e,children:t}){return n.createElement("h2",{className:"page-header"},n.createElement(kr,{icon:e,text:t}))}function LE({min:e="1970",max:t=DE(),value:r=t,onSelect:i}){const[a,s]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),o=function(e,t){const[r,i]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const r=[],n=new Date(e),a=new Date(t),s=n.getFullYear();let o=a.getFullYear();for(;o>=s;)r.push(o),o--;i(r)}),[e,t]),r}(e,t);(0,n.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement("span",{className:"year-picker"},n.createElement("select",{defaultValue:a,onChange:l},o.map((e=>n.createElement("option",{value:e,key:e},e)))))}function DE(){const e=new Date;return String(e.getFullYear())}sn(Yr(window,"online").pipe(Be((()=>!0))),Yr(window,"offline").pipe(Be((()=>!1)))).subscribe(IE);const RE=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function FE({min:e="1970-01",max:t=v(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),[l,c]=(0,n.useState)((()=>new Date(r).getMonth())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===s.getFullYear()?s.getMonth():11;for(;l>=o;)n.push(l),l--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{-1!==l&&(null==i||i(`${s}-${String(l+1).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(-1),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"month-picker"},n.createElement(LE,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},RE[e])))))}function _E({min:e="1970-01-01",max:t=y(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>v(r))),[l,c]=(0,n.useState)((()=>new Date(r).getDate())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=e.split("-").map(Number),l=o[0],c=o[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===s.getFullYear()&&c===s.getMonth()?s.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)n.push(d),d--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{l&&(null==i||i(`${s}-${String(l).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(0),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"date-picker"},n.createElement(FE,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},e)))))}function BE(){return dp(lw,null)}var VE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function UE(e){var{className:t="",children:r}=e,i=VE(e,["className","children"]);return n.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`,onDoubleClick:w}),r)}var HE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},qE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const YE=new J("recentPlaylists"),KE=4;function WE(e){const{pager:t}=e,r=qE(e,["pager"]),[n]=r.src.split(":"),i=YE.getJson("all",[]),a=i.findIndex((t=>t.src===e.src));-1!==a&&i.splice(a,1);const s=e=>e.src.startsWith(`${n}:`);if(i.filter(s).length===KE){const e=i.findLastIndex(s);i.splice(e,1)}i.unshift(r),YE.setJson("all",i)}function GE(e){const t=e.map((e=>e.id));return YE.getJson("all",[]).filter((e=>{const[r]=e.src.split(":");return t.includes(r)})).slice(0,KE).map((e=>Object.assign(Object.assign({},e),{pager:new pi})))}function JE(e){const t=d(e,(e=>{const t=Xf(e);return(null==t?void 0:t.id)||""})),r=t.plex,n=t["plex-tidal"];n&&(t.plex=(null==r?void 0:r.concat(n))||n);const i=Object.keys(t).filter((e=>""!==e&&"listenbrainz"!==e)).map((e=>({service:Qf(e),items:t[e]}))).filter((({service:e})=>!!(null==e?void 0:e.editablePlaylists)));i.sort(((e,t)=>t.items.length-e.items.length));const a=Qf("listenbrainz");if(a){const t=e.filter((({recording_mbid:e,track_mbid:t,isrc:r})=>e||t||r));t.length>0&&i.push({service:a,items:t})}return i.filter((({service:e})=>e.isLoggedIn()))}function QE({id:e,children:t,onClose:r,x:i,y:a,align:s="left",autoFocus:o,hidden:l,popupRef:c}){const u=(0,n.useRef)(null),d=(0,n.useRef)(document.activeElement),[m,h]=(0,n.useState)({visibility:"hidden"}),[f,p]=(0,n.useState)([]),[y,v]=(0,n.useState)("");c&&(c.current=u.current),(0,n.useEffect)((()=>{const e={},t=u.current,r=Array.from(t.querySelectorAll(":scope > li > button"));"right"===s||i+t.offsetWidth>document.body.clientWidth?e.left=i-t.offsetWidth+"px":e.left=`${i}px`,a+t.offsetHeight>document.body.clientHeight?e.top=a-t.offsetHeight+"px":e.top=`${a}px`,l&&(e.visibility="hidden"),p(r),h(e)}),[s,i,a,l]),(0,n.useEffect)((()=>{const e=f.find((e=>!e.disabled));v((null==e?void 0:e.id)||""),o&&e&&e.focus()}),[f,o]),(0,n.useEffect)((()=>{if(r){const e=sn(Rr(0).pipe(on((()=>Yr(document,"mousedown",{capture:!0}).pipe(_e((e=>!u.current.contains(e.target))))))),Yr(document,"keydown",{capture:!0}).pipe(_e((e=>"Escape"===e.code||"Tab"===e.code))),Yr(window,"blur")).subscribe((()=>{var e;null===(e=d.current)||void 0===e||e.focus(),null==r||r()}));return()=>e.unsubscribe()}}),[r]);const b=(0,n.useCallback)((e=>{var t;if(r){let n=e.target;for(;n&&"BUTTON"!==n.nodeName;)n=n.parentElement;(null==n?void 0:n.value)&&!n.disabled&&(null===(t=d.current)||void 0===t||t.focus(),r(n.value))}}),[r]),w=(0,n.useCallback)((e=>{let t=f.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),f.length-1);const r=f[t];r&&!r.disabled&&(r.focus(),v(r.id))}),[f]),E=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),v(t.id))}),[]);return n.createElement("ul",{className:"popup-menu",id:e,tabIndex:-1,hidden:l,role:"menu","aria-label":"Actions","aria-activedescendant":y,style:m,onClick:b,onContextMenu:g,onKeyDown:w,onMouseOver:E,ref:u},t)}var XE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function ZE(e){var{className:t="",label:r,acceleratorKey:i="",children:a,role:s="menuitem"}=e,o=XE(e,["className","label","acceleratorKey","children","role"]);const l=(0,n.useId)(),c=(0,n.useRef)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=!!a,[h,f]=(0,n.useState)(!0),[{x:p,y},v]=(0,n.useState)({x:0,y:0}),[b,g]=(0,n.useState)("left"),k=(0,n.useCallback)((()=>{if(m){const e=c.current,t=d.current;if(e&&t){const{left:r,right:n,top:i}=e.getBoundingClientRect(),{width:a}=t.getBoundingClientRect();n+a+1>=document.body.clientWidth?(g("right"),v({x:r,y:i-1})):(g("left"),v({x:n,y:i-1}))}}}),[m]);Jt(c,k);const x=(0,n.useCallback)((()=>{f(!0)}),[]),S=(0,n.useCallback)((()=>{k(),f(!1)}),[k]),T=(0,n.useCallback)((e=>{const t=e.code;if("Enter"===t||"Space"===t)e.stopPropagation();else if("left"===b&&"ArrowLeft"===t||"right"===b&&"ArrowRight"===t)e.stopPropagation(),u.current.focus();else if("left"===b&&"ArrowRight"===t||"right"===b&&"ArrowLeft"===t){e.stopPropagation();const t=Array.from(d.current.querySelectorAll(":scope > li > button")).find((e=>!e.disabled));null==t||t.focus()}}),[b]);return n.createElement("li",{className:`popup-menu-item ${t} ${m?"has-popup has-popup-"+b:""}`,role:"presentation",onBlur:m?x:void 0,onFocus:m?S:void 0,onKeyDown:h?void 0:T,ref:c},n.createElement("button",Object.assign({},o,{id:l,role:m?void 0:s,tabIndex:-1,"aria-haspopup":m?"true":void 0,"aria-controls":m?`${l}-popup`:void 0,onMouseDown:m?w:E,onMouseUp:w,onClick:m?w:void 0,ref:u}),n.createElement("span",{className:"popup-menu-item-label"},r),i&&!m?n.createElement("span",{className:"popup-menu-item-accelerator-key"},i):null),m?n.createElement(QE,{id:`${l}-popup`,x:p,y,align:b,hidden:h,popupRef:d},a):null)}var ek=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function tk(e){var{className:t="",checked:r=!1}=e,i=ek(e,["className","checked"]);return n.createElement(ZE,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":r}))}function rk(){return n.createElement("li",{className:"popup-menu-separator",role:"separator"})}var nk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function ik(e,t,r,a){return nk(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.C)(c);try{const i=e=>{u.unmount(),c.remove(),s(e)};l.append(c),u.render(n.createElement(e,{x:t,y:r,align:a,onClose:i,autoFocus:!0}))}catch(e){u.unmount(),c.remove(),o(e)}}))}))}function ak(e){const[t,r]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const t=JE(e).slice(),n=t.findIndex((e=>"listenbrainz"===e.service.id));if(-1!==n){const e=t[n],i=tn(zl(e.items,!1)).subscribe((i=>{if(0===(i=i.filter((e=>e.recording_mbid))).length)t.splice(n,1);else{const r=e.service;t[n]={service:r,items:i}}r(t)}));return()=>i.unsubscribe()}r(t)}),[e]),t}function sk({items:e}){const t=ak((0,n.useMemo)((()=>e.filter((e=>e.itemType===ti.Media))),[e])),r=GE(t.map((e=>e.service)));return 0===t.length?null:n.createElement(ZE,{label:"Add to playlist"},n.createElement(ZE,{label:"New playlist…",value:Zn.AddToNewPlaylist,key:Zn.AddToNewPlaylist}),n.createElement(rk,null),r.map(((e,r)=>n.createElement(ok,{playlist:e,itemsByService:t,index:r+1,key:e.src}))),n.createElement(rk,null),n.createElement(ZE,{label:"Other…",value:Zn.AddToPlaylist,key:Zn.AddToPlaylist}))}function ok({playlist:e,itemsByService:t,index:r}){var i;const a=Xf(e),s=(null===(i=t.find((e=>e.service===a)))||void 0===i?void 0:i.items)||[];return a?n.createElement(ZE,{label:n.createElement(kr,{icon:a.icon,text:`${e.title} (${s.length})`}),value:`add-to-recent-playlist-${r}`}):null}var lk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ck=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function uk(e,t,r,i,a="left"){return lk(this,void 0,void 0,(function*(){return ik((r=>n.createElement(dk,Object.assign({},r,{items:e,isContextMenu:t}))),r,i,a)}))}function dk(e){var{items:t,isContextMenu:r}=e,i=ck(e,["items","isContextMenu"]);const a=t[0],s=1===t.length&&!!a,o=t.every((e=>e.itemType===ti.Media||e.itemType===ti.Album));return n.createElement(QE,Object.assign({},i),o?n.createElement(mk,null):null,r&&s?n.createElement(hk,{item:a}):null,n.createElement(sk,{items:t}),n.createElement(rk,null),s?n.createElement(ZE,{label:"Info…",value:Zn.Info,acceleratorKey:`${j.ctrlKeyStr}+I`,key:Zn.Info}):null)}function mk(){return n.createElement(n.Fragment,null,n.createElement(ZE,{label:"Queue",value:Zn.Queue,acceleratorKey:"Enter",key:Zn.Queue}),n.createElement(ZE,{label:"Play next",value:Zn.PlayNext,acceleratorKey:"Shift+Enter",key:Zn.PlayNext}),n.createElement(ZE,{label:"Play now",value:Zn.PlayNow,acceleratorKey:`${j.ctrlKeyStr}+Enter`,key:Zn.PlayNow}),n.createElement(rk,null))}function hk({item:e}){const t=Xf(e);return n.createElement(n.Fragment,null,e.itemType===ti.Playlist&&(null==t?void 0:t.createSourceFromPin)?n.createElement(ZE,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?Zn.Unpin:Zn.Pin,key:e.isPinned?Zn.Unpin:Zn.Pin}):null,void 0!==e.rating&&(null==t?void 0:t.canRate(e,!0))?n.createElement(ZE,{label:e.rating?qS(t,Zn.Unlike):qS(t,Zn.Like),value:e.rating?Zn.Unlike:Zn.Like,key:e.rating?Zn.Unlike:Zn.Like}):null,!1===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(ZE,{label:qS(t,Zn.AddToLibrary),value:Zn.AddToLibrary,key:Zn.AddToLibrary}):null,"apple"!==(null==t?void 0:t.id)&&!0===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(ZE,{label:qS(t,Zn.RemoveFromLibrary),value:Zn.RemoveFromLibrary,key:Zn.RemoveFromLibrary}):null,n.createElement(rk,null))}function fk({value:e=0,tabIndex:t=0,onChange:r}){const[i,a]=(0,n.useState)((()=>Math.max(e-1,0))),[s,o]=(0,n.useState)(-1),[l,c]=(0,n.useState)(!1),u=(0,n.useCallback)((t=>{switch(t.key){case"ArrowLeft":if(0===i&&1===e)null==r||r(0);else if(i>0){const e=i-1;a(e),null==r||r(e+1)}break;case"ArrowRight":if(0===i&&0===e)null==r||r(1);else if(i<4){const e=i+1;a(e),null==r||r(e+1)}}}),[i,e,r]);return n.createElement("div",{className:"star-rating",tabIndex:t,onKeyDown:u,onMouseDown:E,onMouseUp:w,onMouseLeave:()=>o(-1)},n.createElement("button",{className:"star-rating-button "+(0===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(0),1===e?(c(!0),null==r||r(0)):null==r||r(1)},onMouseEnter:()=>{o(0),c(!1)}},-1===s&&e>0||0===s&&!l||s>0?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(1===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(1),2===e?null==r||r(1):null==r||r(2)},onMouseEnter:()=>o(1)},-1===s&&e>1||s>=1?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(2===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(2),3===e?null==r||r(2):null==r||r(3)},onMouseEnter:()=>o(2)},-1===s&&e>2||s>=2?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(3===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(3),4===e?null==r||r(3):null==r||r(4)},onMouseEnter:()=>o(3)},-1===s&&e>3||s>=3?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(4===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(4),5===e?null==r||r(4):null==r||r(5)},onMouseEnter:()=>o(4)},-1===s&&e>4||4===s?"★":"☆"))}class pk extends AnalyserNode{constructor(e,t){super(e,t),this.isPlayingSpotify=!1,xw().subscribe((({currentItem:e})=>{this.isPlayingSpotify=!!(null==e?void 0:e.src.startsWith("spotify:"))}))}getByteFrequencyData(e){this.isPlayingSpotify?jw.getByteFrequencyData(e):super.getByteFrequencyData(e)}getFloatFrequencyData(e){this.isPlayingSpotify?jw.getFloatFrequencyData(e):super.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.isPlayingSpotify?jw.getByteTimeDomainData(e):super.getByteTimeDomainData(e)}getFloatTimeDomainData(e){this.isPlayingSpotify?jw.getFloatTimeDomainData(e):super.getFloatTimeDomainData(e)}}class yk extends AudioContext{createAnalyser(){return new pk(this)}}var vk,bk,gk,wk,Ek=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},kk=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const xk=new H("audio");vk=new WeakMap,bk=new WeakMap,gk=new WeakMap,wk=new WeakMap;const Sk=new class{constructor(){this.ready$=new it(!1),this.sourceNodes=new WeakMap,this.sourceNode$=new it(void 0),vk.set(this,void 0),bk.set(this,void 0),gk.set(this,void 0),wk.set(this,1),this.streamingSupported="safari"!==j.name,Ew().pipe(at((()=>{const e=new yk;Ek(this,vk,e,"f"),Ek(this,bk,e.createDelay(),"f"),Ek(this,gk,e.createGain(),"f"),kk(this,gk,"f").gain.value=kk(this,wk,"f"),kk(this,bk,"f").connect(kk(this,gk,"f")),kk(this,gk,"f").connect(e.destination),this.ready$.next(!0)}))).subscribe(xk),xw().pipe(Be((e=>e.currentItem)),_e(l),Be((e=>this.getSourceNode(e)))).subscribe(this.sourceNode$),this.observeReady().pipe(on((()=>this.sourceNode$)),Vn(),De((function(e,t){var r,n=!1;e.subscribe(Re(t,(function(e){var i=r;r=e,n&&t.next([i,e]),n=!0})))})),at((([e,t])=>{null==e||e.disconnect(kk(this,bk,"f")),null==t||t.connect(kk(this,bk,"f"))}))).subscribe(xk)}get context(){return kk(this,vk,"f")}get source(){return kk(this,bk,"f")}get volume(){return kk(this,wk,"f")}set volume(e){Ek(this,wk,e,"f"),kk(this,gk,"f")&&(kk(this,gk,"f").gain.value=e)}observeReady(){return this.ready$.pipe(_e((e=>e)),Di(1),Be((()=>this)))}getSourceNode(e){const t=this.getAudioElement(e);if(t){if(!this.sourceNodes.has(t)){const e=this.context.createMediaElementSource(t);this.sourceNodes.set(t,e)}return this.sourceNodes.get(t)}}getAudioElement(e){if(this.canUseWebAudio(e)){const t=this.getAudioElementId(e);if(t)return document.querySelector(`audio#${t}`)}return null}canUseWebAudio(e){return e.mediaType===ni.Audio&&e.playbackType!==jn.IFrame&&(this.streamingSupported||!this.isStreamed(e))}getAudioElementId(e){if(e.src.startsWith("apple:"))return"apple-music-player";switch(e.playbackType){case jn.DASH:return"ampcast-audio-dash";case jn.HLS:return"ampcast-audio-hls";default:return"ampcast-audio-main"}}isStreamed(e){if(e.src.startsWith("apple:"))return!0;switch(e.playbackType){case jn.DASH:case jn.HLS:return!0;default:return!1}}},Tk=new H("visualizerPlayer"),Pk=new hv("visualizer-player",(function(e){return function(e){var t;return null===(t=Jw(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));Pk.loop=!0,Pk.muted=!0,Pk.volume=.07,Pk.observeError().subscribe(Tk.error),Sk.observeReady().pipe(at((e=>Pk.registerPlayers(Gw().map((t=>t.createPlayer(e))))))).subscribe(Tk);const Ak=Pk;var Ik=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Ck extends Yy{constructor(e,t="hls"){super(e,t),this.maxFatalErrors=3,this.hasNativeSupport=!1,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.errorCount=0,(this.element.canPlayType("application/x-mpegURL").replace("no","")||this.element.canPlayType("application/vnd.apple.mpegURL").replace("no",""))&&(this.logger.log("Using native HLS."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||Sk.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||Sk.streamingSupported||(this.element.volume=e)}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0,this.loadedSrc&&(this.loadedSrc="",this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src")))}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return Ik(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);this.loadedSrc!==t&&(this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src"),this.player.loadSource(t),this.player.attachMedia(this.element),this.loadedSrc=t)}this.errorCount=0,yield this.element.play()}catch(e){this.error$.next(e)}}))}loadScript(){return Ik(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield r.e(316).then(r.bind(r,3836));this.scriptLoading=!1,this.scriptLoaded=!0,e.isSupported()&&(this.player=new e,this.player.on(e.Events.ERROR,((t,r)=>{r.fatal?r.type===e.ErrorTypes.MEDIA_ERROR&&this.errorCount<this.maxFatalErrors?(this.errorCount++,this.logger.warn("Fatal media error encountered, trying to recover..."),this.player.recoverMediaError()):this.error$.next(r):this.errorCount<this.maxFatalErrors&&(this.logger.warn("Non-fatal media error:"),this.logger.warn(r))}))),this.autoplay&&this.item&&this.safePlay(this.item)}))}}var Mk,Ok,$k=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Nk=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},zk=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const jk=new H("MusicKitPlayer"),Lk="Apple Music player not connected";Mk=new WeakMap,Ok=new WeakMap;const Dk=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new it(!0),this.duration$=new Ne,this.currentTime$=new Ne,this.ended$=new Ne,this.playing$=new Ne,this.error$=new Ne,this.playerLoaded$=new Ne,this.playerActivated$=new it(!1),this.src$=new it(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,Mk.set(this,!0),Ok.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.hasPlayed&&this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(_e((e=>e)),at((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;this.synchVolume(),e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),this.playerLoaded$.next(void 0)})),Di(1)).subscribe(jk),this.observeReady().pipe(on((()=>this.observeIsLoggedIn())),on((e=>e?this.observePaused():an)),on((e=>e?an:this.observeSrc())),on((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(this.getUnplayableReason(e))),an;const[,t,r]=e.split(":"),n=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return tn(this.player.setQueue({[n]:r})).pipe(on((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():an))),qn((e=>(this.loadedSrc="",this.error$.next(e),an))))}return an}))).subscribe(jk),this.observeIsLoggedIn().pipe(Nn((e=>e===this.isLoggedIn)),at((e=>{var t;this.isLoggedIn=e,e||(this.loadedSrc="",this.paused&&!(null===(t=this.player)||void 0===t?void 0:t.isPlaying)||(this.stop(),this.error$.next(Error(Lk))))}))).subscribe(jk),this.observeError().subscribe(jk.error),this.observeError().pipe(_e((()=>{var e;return!1===(null===(e=this.player)||void 0===e?void 0:e.isAuthorized)})),on((()=>Ni())),qn((()=>an))).subscribe(jk)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return Nk(this,Mk,"f")}set muted(e){zk(this,Mk,e,"f"),this.synchVolume()}get volume(){return Nk(this,Ok,"f")}set volume(e){zk(this,Ok,e,"f"),this.synchVolume()}observeCurrentTime(){return this.currentTime$.pipe(Vn())}observeDuration(){return this.duration$.pipe(Vn())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load({src:e}){jk.log("load",{src:e}),this.autoplay&&this.playerActivated$.next(!0),this.src$.next(e),this.synchVolume(),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(this.getUnplayableReason(e)))):this.autoplay&&this.error$.next(Error(Lk))}play(){jk.log("play"),this.playerActivated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(this.getUnplayableReason(this.src))):this.isLoggedIn||this.error$.next(Error(Lk))}pause(){var e;jk.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){jk.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(Vn())}observeReady(){return this.playerLoaded$.pipe(on((()=>this.playerActivated$)),_e((e=>e)),Be((()=>{})),Di(1))}observeSrc(){return this.src$.pipe(Vn())}canPlay(e){return!this.getUnplayableReason(e)}getUnplayableReason(e){var t;const[,r]=e.split(":");return/video/i.test(r)&&(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))?"Video playback not supported":""}safePlay(){var e,t,r,n,i;return t=this,r=void 0,i=function*(){try{this.src&&this.src===this.loadedSrc&&!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed||(this.hasPlayed=!0,this.player.isPlaying&&this.playing$.next(void 0)))}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}))}synchVolume(){if(this.player){const[,e]=this.src.split(":");this.player.volume=!Sk.streamingSupported||/video/i.test(e)?this.muted?0:this.volume:1}}}(Oi()),Rk=new class extends Yy{constructor(e,t="shaka"){super(e,t),this.hasNativeSupport=!1,this.shaka=null,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.hasPlayed=!1,this.onError=e=>{this.error$.next(e)},this.element.canPlayType("application/dash+xml").replace("no","")&&(this.logger.log("Using native DASH."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||Sk.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||Sk.streamingSupported||(this.element.volume=e)}observePlaying(){return super.observePlaying().pipe(_e((()=>this.hasPlayed)))}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0)}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return $k(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);if(this.loadedSrc!==t){this.loadedSrc&&(yield this.recreatePlayer());const r=this.getDrmConfig(e),n=this.getStreamingConfig();this.player.configure({drm:r,streaming:n}),yield this.player.load(t),this.loadedSrc=t}}this.autoplay&&this.item===e&&(yield this.element.play(),this.hasPlayed||this.item!==e||(this.hasPlayed=!0,this.playing$.next(void 0)))}catch(t){"AbortError"===t.name||this.item!==e?this.logger.warn(t):this.error$.next(t)}}))}getDrmConfig(e){var t;if(e){const r={},n=Xf(e),i=null===(t=null==n?void 0:n.getDrmInfo)||void 0===t?void 0:t.call(n,e);return i&&(r.servers={[i.keySystem]:i.license},"fairplay"===i.type&&(r.advanced={[i.keySystem]:{serverCertificateUri:i.certificate}},r.initDataTransform=(e,t,r)=>{if("skd"!==t)return e;const n=this.shaka.util,i=n.StringUtils.fromBytesAutoDetect(e).replace("skd://","");return n.FairPlayUtils.initDataTransform(e,i,r.serverCertificate)})),r}throw Error("No playable item")}getStreamingConfig(){return{bufferingGoal:10,jumpLargeGaps:!0,retryParameters:{maxAttempts:1/0,timeout:1e4},stallSkip:.1}}loadScript(){return $k(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield r.e(864).then(r.t.bind(r,7636,23));this.scriptLoading=!1,this.scriptLoaded=!0,e.polyfill.installAll(),e.Player.isBrowserSupported()&&(this.shaka=e,this.player=new e.Player,yield this.player.attach(this.element),this.player.addEventListener("error",this.onError)),this.autoplay&&this.item&&this.safePlay(this.item)}))}recreatePlayer(){var e,t,r;return $k(this,void 0,void 0,(function*(){const{hidden:n,loop:i,muted:a,volume:s}=this.element,o=this.element.cloneNode();o.removeAttribute("src"),Object.assign(o,{hidden:n,loop:i,muted:a,volume:s}),null===(e=this.player)||void 0===e||e.removeEventListener("error",this.onError),yield null===(t=this.player)||void 0===t?void 0:t.unload(),yield null===(r=this.player)||void 0===r?void 0:r.destroy(),this.player=new this.shaka.Player,yield this.player.attach(o),this.player.addEventListener("error",this.onError),this.loadedSrc="",this.hasPlayed=!1,this.element.replaceWith(o),this.element$.next(o)}))}}("audio","dash"),Fk=new Ck("audio","hls"),_k=new Ck("video","hls"),Bk=new Yy("audio","main"),Vk=new Yy("video","main"),Uk=new nv("main"),Hk=new hv("media-player",(function(e){if(!e)return null;if(e.src.startsWith("youtube:"))return Uk;if(e.src.startsWith("apple:"))return Dk;if(e.src.startsWith("spotify:"))return lf;{const t=e.mediaType===ni.Video;switch(e.playbackType){case jn.DASH:return t?Vk:Rk;case jn.HLS:return t?_k:Fk;default:return t?Vk:Bk}}}),(function(e,t){e.load(function(e){if(e){if(e.unplayable)throw Error("Unplayable");return e.blob?{src:URL.createObjectURL(e.blob)}:e}throw Error("No source")}(t))}),Sk);Hk.registerPlayers([Rk,Fk,_k,Bk,Vk,Uk,Dk,lf]);const qk=Hk;var Yk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Kk=new H("embyReporting");function Wk(e,t,r,n,i){return Yk(this,void 0,void 0,(function*(){try{const[,,a]=e.src.split(":");yield Da.post("Sessions/Playing/Progress",{ItemId:a,IsPaused:r,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:n},i)}catch(e){Kk.error(e)}}))}function Gk(e,t){const r=new H(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(on((e=>e?xw():an)),_e(n),et((({currentItem:e})=>function(e,t){return Yk(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield Da.post("Sessions/Playing",{ItemId:r,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"},t)}catch(e){Kk.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(on((e=>e?Sw():an)),_e(n),et((({currentItem:e,currentTime:r})=>function(e,t,r){return Yk(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");if(yield Da.post("Sessions/Playing/Stopped",{ItemId:n,IsPaused:!1,PositionTicks:Math.floor(1e7*t)},r),e.mediaType===ni.Video){const{deviceId:t,sessionId:n}=r,[,,i]=e.src.split(":");yield Da.delete("Videos/ActiveEncodings",{DeviceId:t,PlaySessionId:`${n}-${i}`},r)}}catch(e){Kk.error(e)}}))}(e,r,t)))).subscribe(r),e.observeIsLoggedIn().pipe(on((e=>e?Tw(1e4):an)),_e(n),_e((({currentTime:e})=>e>0)),et((({currentItem:e,currentTime:r,paused:n})=>Wk(e,r,n,"timeupdate",t)))).subscribe(r),e.observeIsLoggedIn().pipe(on((e=>e?xw():an)),on((e=>n(e)?kw().pipe(Vn(((e,t)=>e.paused===t.paused)),Gh(1),ln(Sw())):an)),et((({currentItem:e,currentTime:r,paused:n})=>Wk(e,r,n,n?"pause":"unpause",t)))).subscribe(r)}Gk(bs,Ta),Gk(no,Ts);const Jk=new H("lastfmScrobbler");function Qk(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=Xf(e);return!t||Py.canScrobble(jo,t)}return!1}To().pipe(on((e=>e?xw():an)),_e((()=>Py.canUpdateNowPlaying(jo))),Be((({currentItem:e})=>e)),_e(l),_e((e=>Qk(e))),et((e=>bo.updateNowPlaying(e)))).subscribe(Jk),To().pipe(on((e=>e?Ho():an)),Be((e=>e.filter((e=>!e.lastfmScrobbledAt)))),gv(1e4),et((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new Io({from:r-30,to:t+30,limit:Io.maxPageSize}),i=yield hi(n),a=i.map((e=>Ko(e,30))),[s,o]=m(e,(e=>!Qk(e)||a.includes(Ko(e,30))||!!Wo(i,e)));if(yield Yo(s.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield bo.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Yo(o.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){Jk.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(Jk);const Xk=new H("listenbrainzScrobbler");function Zk(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=Xf(e);return!t||Py.canScrobble(du,t)}return!1}sc().pipe(on((e=>e?xw():an)),_e((()=>Py.canUpdateNowPlaying(du))),Be((({currentItem:e})=>e)),_e(l),_e((e=>Zk(e))),et((e=>Jl.updateNowPlaying(e)))).subscribe(Xk),sc().pipe(on((e=>e?Ho():an)),Be((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),gv(1e4),et((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new Yc({min_ts:r-30,max_ts:t+30,count:Yc.maxPageSize}),i=yield hi(n),a=i.map((e=>Ko(e,30))),[s,o]=m(e,(e=>!Zk(e)||a.includes(Ko(e,30))||!!Wo(i,e)));if(yield Yo(s.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield Jl.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Yo(o.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){Xk.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(Xk);var ex=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const tx=new H("subsonicReporting");function rx(e,t){const r=new H(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(on((e=>e?xw():an)),_e(n),et((({currentItem:e})=>function(e,t){return ex(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield Pu.scrobble({id:r,submission:!1},t)}catch(e){tx.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(on((e=>e?Sw():an)),_e(n),et((({currentItem:e,startedAt:r})=>function(e,t,r){return ex(this,void 0,void 0,(function*(){try{if(qo(e.duration,t,Date.now())){const[,,n]=e.src.split(":");yield Pu.scrobble({id:n,time:t,submission:!0},r)}}catch(e){tx.error(e)}}))}(e,r,t)))).subscribe(r)}rx(cd,Iu);var nx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ix=new H("plexReporting");let ax="";function sx(e,t,r){return nx(this,void 0,void 0,(function*(){try{yield ox(e,t,r)}catch(e){ix.error(e)}}))}function ox(e,t,r,n){return nx(this,void 0,void 0,(function*(){ax||ix.warn("reportState: `playQueueItemID` not defined",{state:r});const[i,,a]=e.src.split(":"),s="plex-tidal"===i;yield Rd.fetch({host:s?Td:void 0,path:s?"/timeline":"/:/timeline",params:{key:`/library/metadata/${a}`,ratingKey:a,playQueueItemID:ax,state:r,time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:n})}))}const lx=new H("plexScrobbler"),cx=e=>{var t;return/^(plex(-tidal)?):/.test(null===(t=e.currentItem)||void 0===t?void 0:t.src)};Yd().pipe(on((e=>e?xw():an)),_e(cx),et((({currentItem:e})=>function(e){return nx(this,void 0,void 0,(function*(){try{ax="",ax=yield function(e){return nx(this,void 0,void 0,(function*(){const[t,,r]=e.src.split(":"),n=`/library/metadata/${r}`,i="plex-tidal"===t,{MediaContainer:a}=yield Rd.fetchJSON({host:i?"https://play.provider.plex.tv":void 0,path:"/playQueues",method:"POST",params:{key:n,type:"music",uri:i?`provider://tv.plex.provider.music${n}`:`server://${vd.serverId}/com.plexapp.plugins.library${n}`,continuous:"0",repeat:"0",own:"1"}});return String(a.playQueueSelectedItemID)}))}(e),yield ox(e,0,"playing")}catch(e){ix.error(e)}}))}(e)))).subscribe(lx),Yd().pipe(on((e=>e?Sw():an)),_e(cx),et((({currentItem:e})=>function(e){return nx(this,void 0,void 0,(function*(){try{yield ox(e,0,"stopped",!0)}catch(e){ix.error(e)}}))}(e)))).subscribe(lx),Yd().pipe(on((e=>e?Tw(1e4):an)),_e(cx),_e((({currentTime:e})=>e>0)),et((({currentItem:e,currentTime:t,paused:r})=>sx(e,t,r?"paused":"playing")))).subscribe(lx),Yd().pipe(on((e=>e?xw():an)),on((e=>cx(e)?kw().pipe(Vn(((e,t)=>e.paused===t.paused)),Gh(1),ln(Sw())):an)),et((({currentItem:e,currentTime:t,paused:r})=>sx(e,t,r?"paused":"playing")))).subscribe(lx),rx(Lf,vu);const ux=new H("mediaPlayback/scrobbler");Sw().pipe(et((e=>function(e){return Ro(this,void 0,void 0,(function*(){try{let t=e.currentItem;if(!t||!e.startedAt||!e.endedAt)throw Error("Invalid playback state");if(qo(t.duration,e.startedAt,e.endedAt)){try{t=yield zl(t,!0)}catch(e){Fo.error(e)}const{id:r,lookupStatus:n,blob:i}=t,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["id","lookupStatus","blob"]);Fo.log("add",{listen:a}),yield Uo.items.add(Object.assign(Object.assign({},a),{playedAt:Math.floor(e.startedAt/1e3),lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}catch(e){Fo.error(e)}}))}(e)))).subscribe(ux);const dx=new H("mediaPlayback"),mx=new J("mediaPlayback"),hx=new J("mediaPlayback","session"),fx=new it(!0),px=new Ne;let yx="forward";function vx(){return bw.observeCurrentItem()}function bx(){return Mw.observeCurrentTime()}function gx(){return Mw.observeDuration()}function wx(){return qk.observeEnded()}function Ex(){return qk.observeError()}function kx(){return Mw.observePaused()}function xx(){return Mw.observePlaybackStart()}function Sx(){return Mw.observePlaybackEnd()}function Tx(){return qk.observePlaying()}function Px(e){dx.log("load",{item:e}),qk.autoplay&&Mw.ready(),qk.load(e),qk.autoplay&&Mw.play()}function Ax(){dx.log("play"),Mw.ready(),yx="forward",Lx(),Mw.play(),Mw.paused||(qk.play(),Ak.play())}function Ix(){dx.log("pause"),Rx.stopAfterCurrent=!1,Lx(),Mw.pause(),qk.pause(),Ak.pause()}function Cx(e){dx.log("seek",{time:b(e)}),qk.seek(e)}function Mx(){dx.log("stop"),Rx.stopAfterCurrent=!1,Lx(),Mw.stop(),qk.stop(),Ak.stop()}function Ox(){dx.log("prev"),yx="backward",bw.atStart||(Rx.stopAfterCurrent=!1,jx(),bw.prev())}function $x(){dx.log("next"),yx="forward",bw.atEnd||(Rx.stopAfterCurrent=!1,jx(),bw.next())}function Nx(){Rx.stopAfterCurrent=!1,jx(),bw.eject()}function zx(){return _n([bw.observeCurrentIndex(),bw.observeSize()]).pipe(Be((([e,t])=>e===t-1)),Vn())}function jx(){Mw.paused||!1!==fx.getValue()||(Mw.stop(),qk.stop(),Mw.play()),fx.next(!0)}function Lx(){fx.next(!1)}function Dx(e){return t=this,r=void 0,i=function*(){if(!Zf(e)){const t=yield function(e){return Tl(this,void 0,void 0,(function*(){if(!e)return;if(Zf(e))return e;const t=Il.current;return(null==t?void 0:t.item.id)===e.id?t.promise:new Il(e).find()}))}(e);if(!t)return e;e=Object.assign(Object.assign({},e),t)}if(void 0===e.playbackType){const t=yield function(e){return t=this,r=void 0,i=function*(){let t=e.playbackType;if(void 0===t){const r=Xf(e);t=(null==r?void 0:r.getPlaybackType)?yield r.getPlaybackType(e):jn.Direct,Kn({match:t=>t.src===e.src,values:{playbackType:t}})}return t},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e);e=Object.assign(Object.assign({},e),{playbackType:t})}return e},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}const Rx={stopAfterCurrent:!1,get autoplay(){return qk.autoplay},set autoplay(e){qk.autoplay=e,Ak.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return qk.muted},set muted(e){hx.setBoolean("muted",e),qk.muted=e},get paused(){return Mw.paused},get volume(){return qk.volume},set volume(e){mx.setNumber("volume",e),qk.volume=e},observeCurrentItem:vx,observeCurrentTime:bx,observeDuration:gx,observeEnded:wx,observeError:Ex,observePaused:kx,observePlaying:Tx,observePlaybackStart:xx,observePlaybackEnd:Sx,observePlaybackProgress:function(e){return Mw.observePlaybackProgress(e)},observePlaybackState:function(){return Mw.observePlaybackState()},appendTo:function(e){qk.appendTo(e),Ak.appendTo(e)},load:Px,play:Ax,pause:Ix,stop:Mx,seek:Cx,resize:function(e,t){qk.resize(e,t),Ak.resize(e,t)},next:$x,prev:Ox,shuffle:function(e){bw.shuffle(e)}},Fx=Rx;Rx.muted=hx.getBoolean("muted"),Rx.volume=mx.getNumber("volume",1),qk.observeCurrentTime().subscribe((e=>Mw.setCurrentTime(e))),qk.observeDuration().subscribe((e=>Mw.setDuration(e))),qk.observePlaying().subscribe((()=>Mw.started())),qk.observeEnded().subscribe((()=>Mw.ended())),qk.observePlaying().subscribe((()=>yx="forward")),qk.observeEnded().pipe(Wh(zx()),ln(px)).subscribe((([,e])=>{e||Rx.stopAfterCurrent?Mx():bw.next()})),qk.observeError().pipe(gv(2e3),Wh(kx(),bw.observeCurrentIndex().pipe(Be((e=>0===e)),Vn()),zx()),ln(px)).subscribe((([,e,t,r])=>{e||(r||t&&"backward"===yx?Mx():"backward"===yx?bw.prev():bw.next())})),bw.observeSize().pipe(Be((e=>0===e)),Vn(),Nn((e=>e)),_e((e=>e))).subscribe(Mx),vx().pipe(on((e=>0===(null==e?void 0:e.duration)?gx().pipe(_e((e=>0!==e)),Di(1),at((t=>Kn({match:t=>t.src===e.src,values:{duration:t}})))):an))).subscribe(dx),fx.pipe(gv(300),_e((e=>e))).subscribe((()=>{Rx.autoplay=!Mw.paused,fx.next(!1)})),fx.pipe(Vn(),on((e=>e?an:vx())),Vn(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),on((e=>e?Dx(e):pn(null))),Nn((e=>!e)),at(Px)).subscribe(dx),bw.observeNextItem().pipe(Vn(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),gv(3e3),Hn((e=>e?Dx(e):pn(null)))).subscribe(dx),Yr(window,"pagehide").subscribe((function(){px.next(void 0),Mx()})),Ew().subscribe(dx.rx("playbackReady")),xx().subscribe(dx.rx("playbackStart")),Sx().subscribe(dx.rx("playbackEnd")),Tx().subscribe(dx.rx("playing")),wx().subscribe(dx.rx("ended")),Ex().subscribe(dx.error),gx().pipe(Nn((e=>!e)),Be(b),Vn()).subscribe(dx.rx("duration")),bx().pipe(_e((e=>Math.round(e)%30==0)),Be(b)).subscribe(dx.rx("currentTime"));var _x=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Bx=new H("musicbrainz/coverart");class Vx extends Ut.cp{constructor(){super("ampcast/musicbrainz/coverart"),this.version(2).stores({items:"&mbid, [album+artist], thumbnails"})}}const Ux=new Vx;function Hx(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}var qx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Yx=new H("CoverArt");function Kx({item:e,size:t,className:r="",onLoad:i,onError:a}){const[s,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)((()=>e.thumbnails)),u=!!(null==l?void 0:l.length),d=u?function(e,t=240){if(1===e.length)return e[0];let r=e.filter((e=>Jx(e)<1.34));return 0===r.length&&(r=e.filter((e=>Jx(e)<1.5)),0===r.length&&(r=e)),t*=window.devicePixelRatio||1,r.sort(((e,r)=>Math.abs(e.height-t)-Math.abs(r.height-t))),r[0]}(l,t):void 0,m=d?Wx(d):"",h=function(e){switch(e.itemType){case ti.Artist:return"artist";case ti.Album:{const t=Gx(e);return t&&"audio"!==t?t:"album"}case ti.Media:return e.mediaType===ni.Video?"video":"audio";case ti.Playlist:return"playlist";case ti.Folder:return"folder"}}(e),f=e.itemType===ti.Album&&Gx(e);(0,n.useEffect)((()=>{o(!1),c(e.thumbnails)}),[e.thumbnails]),(0,n.useEffect)((()=>{var t;if(!u){if(e.itemType===ti.Media){const r=Go(e);if(null===(t=null==r?void 0:r.thumbnails)||void 0===t?void 0:t[0])return void c(r.thumbnails)}const r=tn(function(e){var t,r;return qx(this,void 0,void 0,(function*(){if(e.itemType===ti.Media&&(null===(t=e.link)||void 0===t?void 0:t.externalUrl)){const t=lc()(null===(r=e.link)||void 0===r?void 0:r.externalUrl);if(t)try{return(yield Bc(t)).thumbnails}catch(e){return void Yx.error(e)}}return function(e){var t;return _x(this,void 0,void 0,(function*(){if(!e||e.itemType!==ti.Album&&e.itemType!==ti.Media)return;let r=!1;const n=e.release_mbid;if(n){const e=yield Ux.items.get(n);if(r=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===ti.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield Ux.items.get({album:i,artist:a});if(e)return e.thumbnails}if(n&&!r)try{const e=yield function(e){return _x(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(n),t=e.images.filter((e=>e.front&&e.approved))[0],r=t?Object.keys(t.thumbnails).filter((e=>0!==Hx(e))).map((e=>({url:t.thumbnails[e],width:Hx(e),height:Hx(e)}))):[];return yield Ux.items.put(0===r.length?{mbid:n}:{mbid:n,album:i,artist:a,thumbnails:r}),r}catch(e){404===e.status?yield Ux.items.put({mbid:n}):Bx.error(e)}}))}(e)}))}(e)).subscribe((e=>{(null==e?void 0:e[0])?c(e):(o(!0),null==a||a())}));return()=>r.unsubscribe()}}),[u,e,a]);const p=(0,n.useCallback)((()=>{o(!0),null==a||a()}),[a]),y=(0,n.useCallback)((()=>{o(!1),null==i||i(m)}),[i,m]);return n.createElement("figure",{className:`cover-art ${r} ${f?"cover-art-"+f:""}`,key:e.src},m&&!s?n.createElement(n.Fragment,null,n.createElement("img",{className:"cover-art-image",src:m,alt:`${e.title}: Cover art`,onError:p,onLoad:y}),f?n.createElement("div",{className:"cover-art-icon-overlay"},n.createElement(rt,{className:"cover-art-icon",name:f})):null):h?n.createElement(rt,{className:"cover-art-image",name:h}):null)}function Wx(e){return Uf().reduce(((e,t)=>{var r,n;return null!==(n=null===(r=null==t?void 0:t.getThumbnailUrl)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e}),(null==e?void 0:e.url)||"")}function Gx(e){if(!e.synthetic)return"";const[,t]=e.src.split(":");switch(t){case"top-tracks":return"star";case"videos":return"video";default:return"audio"}}function Jx({width:e,height:t}){return e/t}function Qx({className:e,children:t}){const r=(0,n.useRef)(null),[i,a]=(0,n.useState)(0),s=(0,n.useCallback)((({scrollHeight:e})=>a(e)),[]);return n.createElement("div",{className:`text-box ${e}`,style:{height:`${i}px`},ref:r},n.createElement("div",{style:{position:"relative",height:"100%"}},n.createElement(hn,{onResize:s},t)))}function Xx(e){const[t,r]=(0,n.useState)(e);return(0,n.useEffect)((()=>{null==t&&null!=e&&r(e)}),[t,e]),t}const Zx=new H("Media/useCurrentItem");var eS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function tS(e){const t=function(e){const[t,r]=(0,n.useState)(e),[i,a]=(0,n.useState)("");return(0,n.useEffect)((()=>{if(i!==e.src){const t=Xf(e);if(null==t?void 0:t.getMetadata){const n=tn(t.getMetadata(e)).pipe(at((t=>{a(e.src),r(Object.assign(Object.assign({},e),t))}))).subscribe(Zx);return()=>n.unsubscribe()}a(e.src)}}),[e,i]),(0,n.useEffect)((()=>{const e=Wn().pipe(at((e=>{for(const{match:n,values:i}of e)if(n(t)){r(Object.assign(Object.assign({},t),i));break}}))).subscribe(Zx);return()=>e.unsubscribe()}),[t]),t}(e.item),r=Xx(t);if(e.debug)return n.createElement(bS,{item:r});switch(t.itemType){case ti.Media:return n.createElement(rS,{item:t});case ti.Artist:return n.createElement(iS,{item:t});case ti.Album:return n.createElement(nS,{item:t});case ti.Playlist:return n.createElement(aS,{item:t});case ti.Folder:return n.createElement(sS,{item:t})}}function rS({item:e}){var t;return n.createElement("article",{className:"media-info media-item-info"},n.createElement("div",{className:"media-info-main"},n.createElement(vS,{item:e}),n.createElement(oS,{title:e.title}),n.createElement(cS,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),n.createElement(mS,{album:e.album,year:e.year}),n.createElement(hS,{album:e.album,disc:e.disc,track:e.track}),n.createElement(uS,{owner:e.owner,src:e.src}),n.createElement(US,{item:e})),n.createElement(lS,{description:e.description}),n.createElement(dS,{url:e.externalUrl,src:e.src}))}function nS({item:e}){return n.createElement("article",{className:"media-info album-info"},n.createElement("div",{className:"media-info-main"},n.createElement(vS,{item:e}),n.createElement(oS,{title:e.title}),n.createElement(cS,{artist:e.artist}),n.createElement(fS,{year:e.year}),n.createElement(US,{item:e})),n.createElement(lS,{description:e.description}),n.createElement(dS,{url:e.externalUrl,src:e.src}))}function iS({item:e}){return n.createElement("article",{className:"media-info artist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(vS,{item:e}),n.createElement(oS,{title:e.title}),n.createElement(pS,{genres:e.genres}),n.createElement(yS,{country:e.country}),n.createElement(US,{item:e})),n.createElement(lS,{description:e.description}),n.createElement(dS,{url:e.externalUrl,src:e.src}))}function aS({item:e}){return n.createElement("article",{className:"media-info playlist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(vS,{item:e}),n.createElement(oS,{title:e.title}),n.createElement(uS,{owner:e.owner,src:e.src}),n.createElement(pS,{genres:e.genres}),n.createElement(US,{item:e})),n.createElement(lS,{description:e.description}),n.createElement(dS,{url:e.externalUrl,src:e.src}))}function sS({item:e}){return n.createElement("article",{className:"media-info folder-info"},n.createElement("div",{className:"media-info-main"},n.createElement(vS,{item:e}),n.createElement(oS,{title:e.title})))}function oS({title:e}){return n.createElement("h3",{className:"title"},e||"(no title)")}function lS({description:e}){const t=null==e?void 0:e.trim().split(/[\n\r]+/);return(null==t?void 0:t.length)?n.createElement(Qx,{className:"blurb"},t.map(((e,t)=>n.createElement("p",{key:t},e)))):null}function cS({artist:e}){return e?n.createElement("h4",{className:"artist"},n.createElement("span",{className:"by"},"By: "),e):null}function uS({src:e,owner:t}){if(!t||!t.name)return null;const[r]=e.split(":"),i="youtube"===r?"Channel":"Curator";return n.createElement("p",{className:"owner"},i,":"," ",t.url?n.createElement(Xl,{href:t.url},t.name):t.name)}function dS({src:e,url:t=""}){let[r]=e.split(":"),i=r;switch(r){case"musicbrainz":i="MusicBrainz";break;case"plex-tidal":i="Plex";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",r="musicbrainz"):i="ListenBrainz";break;case"blob":case"file":i="local file system";break;case"http":case"https":i="external source";break;default:{const e=Qf(r);e&&(i=e.name)}}return n.createElement("p",{className:"external-view"},n.createElement(rt,{name:r}),t?n.createElement(Xl,{href:t},"View on ",i):n.createElement("span",{className:"external-provider"},"Provided by ","plex-tidal"===r?"TIDAL":i))}function mS({album:e,year:t}){return e&&t?n.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?n.createElement("h4",{className:"album"},"From: ",e):t?n.createElement("h4",{className:"album"},"Year: ",t):null}function hS({album:e,disc:t=1,track:r}){return e&&r?n.createElement("p",{className:"track"},"Track: ",r,t>1?` (Disc ${t})`:""):null}function fS({year:e}){return e?n.createElement("p",{className:"year"},"Year: ",e):null}function pS({genres:e}){return e?n.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function yS({country:e}){return e?n.createElement("p",{className:"country"},"Country: ",e):null}function vS(e){return n.createElement("div",{className:"thumbnail"},n.createElement(Kx,Object.assign({},e)))}function bS(e){const t=e.item,{pager:r,parent:i}=t,a=eS(t,["pager","parent"]);return n.createElement("article",{className:"media-info debug"},n.createElement("pre",null,JSON.stringify(a,void 0,2)),n.createElement(dS,{url:a.externalUrl,src:a.src}))}function gS(e){const[t,r]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=Yr(document,"keydown",{capture:!0}).subscribe((t=>{var n;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?r((e=>!e)):t[j.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(t.preventDefault(),null===(n=e.current)||void 0===n||n.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var wS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ES=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function kS(e){return wS(this,void 0,void 0,(function*(){yield dr((t=>n.createElement(xS,Object.assign({},t,{item:e}))))}))}function xS(e){var{item:t}=e,r=ES(e,["item"]);const i=(0,n.useRef)(null),{debug:a}=gS(i),s=function(e){switch(e.itemType){case ti.Playlist:return"Playlist info";case ti.Album:return"Album info";case ti.Artist:return"Artist info";case ti.Folder:return"Folder info";default:return"Media info"}}(t);return n.createElement(cr,Object.assign({},r,{className:"media-info-dialog",title:s,ref:i}),n.createElement("form",{method:"dialog"},n.createElement(tS,{item:t,debug:a}),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}var SS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const TS={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function PS(e){var{className:t="",layout:r=TS}=e,i=SS(e,["className","layout"]);return n.createElement(lT,Object.assign({},i,{className:`playlists ${t}`,layout:r}))}function AS(e,t){const[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const r=(null==e?void 0:e.search(t))||null;return i(r),()=>null==r?void 0:r.disconnect()}),[e,t]),r}var IS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},CS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const MS={view:"card minimal",fields:["Thumbnail","Title","TrackCount"]};function OS(e){var{items:t}=e,r=CS(e,["items"]);const i=(0,n.useId)(),a=(0,n.useRef)(null),s=ak(t),[o,l]=(0,n.useState)(null),c=AS((null==(u=o)?void 0:u.editablePlaylists)||null);var u;const[d,m]=(0,n.useState)(null),h=t.length;(0,n.useEffect)((()=>{l((e=>{var t;return e||(null===(t=s[0])||void 0===t?void 0:t.service)||null}))}),[s]);const f=(0,n.useCallback)((()=>IS(this,void 0,void 0,(function*(){if((null==o?void 0:o.addToPlaylist)&&d){const e=s.find((e=>e.service===o)),t=null==e?void 0:e.items;try{yield o.addToPlaylist(d,t),WE(d)}catch(e){console.error(e),yield Sr("An error occurred while updating your playlist.")}}}))),[o,d,s]),p=(0,n.useCallback)((()=>{const e=Qf(a.current.value);l(e)}),[]),y=(0,n.useCallback)((([e])=>{m(e)}),[]);return n.createElement(cr,Object.assign({},r,{className:`add-to-playlist-dialog service-${(null==o?void 0:o.id)||""}`,title:"Add to playlist"}),n.createElement("form",{method:"dialog",onSubmit:f},n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-service`},"Save to:"),n.createElement("select",{id:`${i}-service`,required:!0,onChange:p,ref:a},s.map((({service:e,items:t})=>n.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",h,")"))))),n.createElement(PS,{title:o?`${null==o?void 0:o.name}: Playlists`:"",pager:c,layout:MS,onContextMenu:()=>{},onSelect:y}),n.createElement(yr,{submitText:"Add",disabled:!d})))}var $S=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},NS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function zS(e){return $S(this,void 0,void 0,(function*(){yield dr((t=>n.createElement(jS,Object.assign({},t,{items:e}))))}))}function jS(e){var{items:t}=e,r=NS(e,["items"]);const i=(0,n.useId)(),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=ak(t),[u,d]=(0,n.useState)((()=>{var e;return null===(e=c[0])||void 0===e?void 0:e.service.id})),m=t.length,h=(0,n.useCallback)((()=>$S(this,void 0,void 0,(function*(){const e=Qf(a.current.value);if(null==e?void 0:e.createPlaylist){const t=s.current.value,r=o.current.value,i=l.current.checked,a=c.find((t=>t.service===e)),u=null==a?void 0:a.items;try{const a=yield e.createPlaylist(t,{description:r,isPublic:i,items:u});yield fr({title:n.createElement(kr,{icon:e.id,text:e.name}),message:"Your playlist has been created."}),WE(a)}catch(e){console.error(e),yield Sr("An error occurred while creating your playlist.")}}}))),[c]),f=(0,n.useCallback)((()=>{const e=a.current.value;d(e)}),[]);return n.createElement(cr,Object.assign({},r,{className:`create-playlist-dialog service-${u||""}`,title:"Create Playlist"}),n.createElement("form",{method:"dialog",onSubmit:h},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-service`},"Save to:"),n.createElement("select",{id:`${i}-service`,required:!0,onChange:f,ref:a},c.map((({service:e,items:t})=>n.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",m,")"))))),n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-name`},"Name:"),n.createElement("input",{type:"text",id:`${i}-name`,required:!0,ref:s})),n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-description`},"Description:"),n.createElement("textarea",{id:`${i}-description`,rows:2,cols:40,ref:o})),n.createElement("p",{className:"save-playlist-dialog-public"},n.createElement("label",{htmlFor:`${i}-public`},"Public:"),n.createElement("input",{type:"checkbox",id:`${i}-public`,ref:l,disabled:LS(u)}))),n.createElement(yr,{submitText:"Save"})))}function LS(e){switch(e){case"emby":case"jellyfin":case"plex":case"plex-tidal":return!0;default:return!1}}var DS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const RS=new H("ampcast/performAction");function FS(e,t,r){return DS(this,void 0,void 0,(function*(){const i=t[0];if(!i)return;const a=i.itemType;switch(e){case Zn.PlayNow:case Zn.PlayNext:case Zn.Queue:!function(e,t){DS(this,void 0,void 0,(function*(){const r=t[0];if(!r)return;const n=r.itemType;if(n===ti.Media||n===ti.Album)switch(e){case Zn.PlayNow:case Zn.PlayNext:e===Zn.PlayNow&&(Fx.autoplay=!0),n===ti.Media?yield bw.inject(t):yield bw.inject(r),e===Zn.PlayNow&&bw.next();break;case Zn.Queue:n===ti.Media?yield bw.add(t):yield bw.add(r)}}))}(e,t);break;case Zn.Like:case Zn.Unlike:case Zn.Rate:case Zn.AddToLibrary:case Zn.RemoveFromLibrary:!function(e,t,r){DS(this,void 0,void 0,(function*(){if(t)try{switch(e){case Zn.Like:yield Qn.rate(t,1);break;case Zn.Unlike:yield Qn.rate(t,0);break;case Zn.Rate:"number"==typeof r&&(yield Qn.rate(t,r));break;case Zn.AddToLibrary:yield Qn.store(t,!0);break;case Zn.RemoveFromLibrary:yield Qn.store(t,!1)}}catch(n){RS.warn("Failed to perform action:",{action:e,item:t,payload:r}),RS.error(n)}}))}(e,i,r);break;case Zn.Pin:a===ti.Playlist&&(yield Qi.pin(t));break;case Zn.Unpin:a===ti.Playlist&&(yield Qi.unpin(t));break;case Zn.Info:yield kS(i);break;case Zn.AddToPlaylist:yield function(e){return IS(this,void 0,void 0,(function*(){yield dr((t=>n.createElement(OS,Object.assign({},t,{items:e}))))}))}(t);break;case Zn.AddToNewPlaylist:yield zS(t);break;case Zn.AddToRecentPlaylist1:case Zn.AddToRecentPlaylist2:case Zn.AddToRecentPlaylist3:case Zn.AddToRecentPlaylist4:try{yield function(e,t){var r;return HE(this,void 0,void 0,(function*(){const n=JE(t),i=GE(n.map((e=>e.service))),a=i[e],s=Xf(a),o=(null===(r=n.find((e=>e.service===s)))||void 0===r?void 0:r.items)||[];yield s.addToPlaylist(a,o),WE(a)}))}(Number(e.slice(-1))-1,t)}catch(e){RS.error(e),yield Sr("An error occurred while updating your playlist.")}}}))}var _S=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const BS={[Zn.AddToLibrary]:"heart",[Zn.RemoveFromLibrary]:"heart-fill",[Zn.Rate]:"star",[Zn.Like]:"heart",[Zn.Unlike]:"heart-fill"},VS={[Zn.AddToLibrary]:"Add to library",[Zn.RemoveFromLibrary]:"Remove from library",[Zn.Rate]:"Rate",[Zn.Like]:"Like",[Zn.Unlike]:"Unlike"};function US({item:e,inline:t}){const r=Xf(e),i=t?-1:void 0,a=(0,n.useCallback)((()=>_S(this,void 0,void 0,(function*(){e.itemType===ti.Playlist&&(e.isPinned?yield FS(Zn.Unpin,[e]):yield FS(Zn.Pin,[e]))}))),[e]),s=(0,n.useCallback)((()=>_S(this,void 0,void 0,(function*(){e.rating?yield FS(Zn.Unlike,[e]):yield FS(Zn.Like,[e])}))),[e]),o=(0,n.useCallback)((()=>_S(this,void 0,void 0,(function*(){e.inLibrary?yield FS(Zn.RemoveFromLibrary,[e]):yield FS(Zn.AddToLibrary,[e])}))),[e]),l=(0,n.useCallback)((t=>_S(this,void 0,void 0,(function*(){const r=t.target.getBoundingClientRect(),n=yield uk([e],!1,r.right,r.bottom,"right");n&&(yield FS(n,[e]))}))),[e]),c=(0,n.useCallback)((t=>_S(this,void 0,void 0,(function*(){yield FS(Zn.Rate,[e],t)}))),[e]);return n.createElement(UE,null,t?n.createElement(pp,{icon:"menu",title:"More…",tabIndex:i,onClick:l,key:"menu"}):null,e.itemType===ti.Playlist&&(null==r?void 0:r.createSourceFromPin)?n.createElement(pp,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:i,onClick:a,key:"pin"}):null,r?n.createElement(n.Fragment,null,void 0!==e.rating&&(null==r?void 0:r.canRate(e,t))?"plex"===r.id?n.createElement(fk,{value:e.rating,tabIndex:i,onChange:c}):n.createElement(pp,{icon:e.rating?HS(r,Zn.Unlike):HS(r,Zn.Like),title:e.rating?qS(r,Zn.Unlike):qS(r,Zn.Like),tabIndex:i,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==r?void 0:r.canStore(e,t))?n.createElement(pp,{icon:e.inLibrary?HS(r,Zn.RemoveFromLibrary):HS(r,Zn.AddToLibrary),title:e.inLibrary?qS(r,Zn.RemoveFromLibrary):qS(r,Zn.AddToLibrary),tabIndex:i,disabled:"apple"===r.id&&e.inLibrary,onClick:o,key:"store"}):null):null)}function HS(e,t){var r;return(null===(r=e.icons)||void 0===r?void 0:r[t])||BS[t]}function qS(e,t){var r;return(null===(r=e.labels)||void 0===r?void 0:r[t])||VS[t]}function YS({children:e}){return n.createElement("footer",{className:"status-bar"},e)}function KS({items:e,size:t,maxSize:r,error:i,loading:a,loadingText:s="Loading",selectedCount:o,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=n.createElement("span",{className:"message"},s,"…");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=n.createElement("span",{className:"selected"},"(",WS(o)," selected)"),s=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${WS(i)} of ${void 0===t?r||`${WS(e.length)}+`:WS(r?Math.min(t,r):t)} ${c}`;u=n.createElement("span",{className:"message"},s," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||GS[e.status]||e.status||"")}(i);u=n.createElement(n.Fragment,null,n.createElement(rt,{name:"error"}),n.createElement("span",{className:"message error"},e?`Error: ${e}`:"Error"))}else u=n.createElement("span",{className:"message"},"0 ",c);return n.createElement(YS,null,u)}function WS(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const GS={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"},JS=(0,n.memo)((function({time:e}){const t=100/6,r=new Date(e);let i=r.getHours()+r.getMinutes()/60,a=Math.min(i,6),s=i-a;return i>12&&(i=24-i,s=Math.min(i,6),a=i-s),n.createElement("span",{role:"presentation",className:"sun-clock",title:r.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":s*t+"%"}})}));function QS({time:e,className:t}){return n.createElement("time",{className:t},b(e))}const XS={view:"details",fields:["Title","Genre","Owner"]};const ZS=e=>n.createElement(QS,{className:"text",time:e.duration||0});function eT({value:e=""}){return""===e?null:n.createElement("span",{className:"text"},e)}const tT={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return n.createElement(eT,{value:e.itemType===ti.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>n.createElement(eT,{value:e.albumArtist}),className:"artist"},AlbumTrack:{title:"#",render:e=>n.createElement("span",{className:"text"},e.track?n.createElement(n.Fragment,null,n.createElement("span",{className:"disc"},e.disc||"?","."),e.track):"-"),align:"right",width:60,className:"index"},Title:{title:"Title",render:e=>n.createElement(eT,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const t=Xf(e);return t?n.createElement(kr,{icon:t.icon,text:e.title}):n.createElement(eT,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>n.createElement(eT,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>n.createElement(eT,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>n.createElement(eT,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>n.createElement(eT,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:ZS,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const r=e.itemType===ti.Media?e.mediaType===ni.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return n.createElement("figure",{className:"cover-art"},n.createElement(rt,{className:"cover-art-image",name:r}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>n.createElement(eT,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>n.createElement(eT,{value:rT(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>n.createElement(eT,{value:rT(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>n.createElement(eT,{value:e.year||""}),width:120,className:"year"},Views:{title:"Views",render:e=>null==e.globalPlayCount?null:n.createElement(eT,{value:iT(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return n.createElement(eT,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return n.createElement(eT,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},AddedAt:{title:"Date Added",render:e=>{if(!e.addedAt)return null;const t=new Date(1e3*e.addedAt),r=nT(t.valueOf());return n.createElement("time",{className:"text added-at",title:t.toLocaleString()},r)},className:"added-at"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return n.createElement("span",{className:"text last-played"},"unplayed");const t=new Date(1e3*e.playedAt),r=nT(t.valueOf());return n.createElement("time",{className:"text last-played",title:t.toLocaleString()},r)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt,r=new Date(t);return n.createElement("time",{className:"text",title:r.toLocaleString()},n.createElement(JS,{time:t}),n.createElement("span",{className:"date"},r.toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>n.createElement(Kx,{item:e}),className:"thumbnail"},Rate:{title:n.createElement(fk,{value:0,tabIndex:-1}),render:e=>n.createElement(fk,{value:e.rating,tabIndex:-1,onChange:t=>{return r=void 0,n=void 0,a=function*(){yield FS(Zn.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}}),align:"right",width:120,className:"rate"}};function rT(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function nT(e){const t=Date.now()-e;if(t<12e4)return"just now";const r=36e5;if(t<54e5)return`${Math.round(t/6e4)} mins ago`;const n=24*r;if(t<1.5*n)return`${Math.round(t/r)} hours ago`;if(t<12*n)return`${Math.round(t/n)} days ago`;const i=7*n;if(t<10*i)return`${Math.round(t/i)} weeks ago`;const a=365*n;return t<a?`${Math.round(t/2592e6)} months ago`:t<2*a?"1 year ago":`${Math.floor(t/a)} years ago`}function iT(e=0,t="listen",r=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${r}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${r}`:e<1e6?`${Math.round(e/1e3)}K  ${r}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${r}`:e<1e9?`${Math.round(e/1e6)}M  ${r}`:`${(e/1e9).toFixed(1).replace(".0","")}B  ${r}`}function aT(e){return(0,n.useCallback)((t=>{const r=e.filter((e=>e.src.startsWith("spotify:track:")));if(r.length>0){const e=r.map((e=>e.src));t.dataTransfer.setData("text/x-spotify-tracks",e.join("\n")),t.dataTransfer.effectAllowed="copyMove"}}),[e])}var sT=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},oT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function lT(e){var{className:t="",pager:r=null,statusBar:i=!0,loadingText:a,onContextMenu:s,onDoubleClick:o,onEnter:l,onError:c,onLoad:u,onNoContent:d,onSelect:m}=e,h=oT(e,["className","pager","statusBar","loadingText","onContextMenu","onDoubleClick","onEnter","onError","onLoad","onNoContent","onSelect"]);const f=function(e=XS){return(0,n.useMemo)((()=>function(e){if("none"===e.view)return{view:"details",cols:[]};const{view:t,fields:r}=e,i=r.map((e=>tT[e]));return i.push({title:n.createElement(rt,{name:"menu"}),render:e=>n.createElement(US,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(h.layout),[p,y]=(0,n.useState)(0),[v,b]=(0,n.useState)(0),[{items:g,loaded:w,error:E,size:k,maxSize:x},S]=function(e){const[t,r]=function(){const e=(0,n.useRef)(null);null===e.current&&(e.current=new Ne);const t=(0,n.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[i,a]=(0,n.useState)([]),[s,o]=(0,n.useState)(void 0),[l,c]=(0,n.useState)(void 0),[u,d]=(0,n.useState)(),[m,h]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>({items:i,size:s,maxSize:l,error:u,loaded:m})),[i,s,l,u,m]),p=(0,n.useCallback)(((e,t)=>{r([e,t])}),[r]);return(0,n.useEffect)((()=>{if(a([]),o(void 0),c(void 0),d(void 0),h(!1),!e)return;const r=e.observeItems(),n=e.observeSize(),i=e.observeError(),s=sn(r,i).pipe(Di(1),Be((()=>!0))),l=rn(pn([]),pn([]).pipe(Qh(0))),u=new le;return u.add(rn(l,r).subscribe(a)),u.add(n.subscribe(o)),u.add(i.subscribe(d)),u.add(s.subscribe(h)),u.add(t.subscribe((([t,r])=>{e.fetchAt(t,r)}))),c(e.maxSize),()=>u.unsubscribe()}),[e,t]),[f,p]}(r),[T,P]=(0,n.useState)([]),A=BE(),I=null==A?void 0:A.src,C=function(e){const[t,r]=(0,n.useState)("");return(0,n.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at|added-at|rate/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),r(t?`clip-${t}`:"")}),[e]),t}(f),M=w?g.length>0:void 0,O=aT(T);(0,n.useEffect)((()=>{E&&c&&c(E)}),[E,c]),(0,n.useEffect)((()=>{w&&u&&u()}),[w,u]),(0,n.useEffect)((()=>{!1===M&&d&&d()}),[M,d]),(0,n.useEffect)((()=>{p>=0&&v>0&&S(p,v)}),[S,p,v,r]);const $=(0,n.useCallback)((e=>{P(e),null==m||m(e)}),[m]),N=(0,n.useCallback)(((e,t,r,n,i)=>sT(this,void 0,void 0,(function*(){if(0===e.length)return;const n=yield uk(e,!0,t,r,-1===i?"right":"left");n&&(yield FS(n,e))}))),[]),z=(0,n.useCallback)(((e,t)=>sT(this,void 0,void 0,(function*(){cT(e)?yield FS(Zn.Queue,[e]):null==o||o(e,t)}))),[o]),j=(0,n.useCallback)(((e,t,r)=>sT(this,void 0,void 0,(function*(){e.every(cT)?t||r?t&&!r?yield FS(Zn.PlayNow,e):r&&!t&&(yield FS(Zn.PlayNext,e)):yield FS(Zn.Queue,e):null==l||l(e,t,r)}))),[l]),L=(0,n.useCallback)((e=>sT(this,void 0,void 0,(function*(){yield FS(Zn.Info,e)}))),[]),D=(0,n.useCallback)((e=>{if((null==e?void 0:e.itemType)===ti.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===I?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[I]);return n.createElement("div",{className:`panel ${t} ${C}`,onDragStart:O},n.createElement(zp,Object.assign({},h,{className:"media-list",layout:f,items:g,itemClassName:D,itemKey:"src",selectedIndex:0===g.length?-1:0,onContextMenu:s||N,onDoubleClick:z,onEnter:j,onInfo:L,onPageSizeChange:b,onScrollIndexChange:y,onSelect:$})),i?n.createElement(KS,{items:g,error:E,size:k,maxSize:x,loading:!!r&&!w,loadingText:a,selectedCount:T.length}):null)}function cT(e){return e.itemType===ti.Media||e.itemType===ti.Album}var uT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const dT={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function mT(e){var{className:t="",layout:r=dT,draggable:i=!0}=e,a=uT(e,["className","layout","draggable"]);return n.createElement(lT,Object.assign({},a,{className:`albums ${t}`,layout:r,draggable:i}))}var hT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const fT={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function pT(e){var{className:t="",layout:r=fT,multiple:i=!0,draggable:a=!0}=e,s=hT(e,["className","layout","multiple","draggable"]);return n.createElement(lT,Object.assign({},s,{className:`media-items ${t}`,layout:r,multiple:i,draggable:a}))}const yT={view:"details",fields:["AlbumTrack","Title","Artist","Duration"]},vT={view:"card compact",fields:["Thumbnail","Title","Artist","Duration"]};function bT(e,t=yT){const[r,i]=(0,n.useState)(t);return(0,n.useEffect)((()=>{if((null==e?void 0:e.synthetic)&&"details"===t.view){const[,r]=e.src.split(":");if("videos"===r)i(vT);else{const e=t.fields.slice();"Track"!==e[0]&&"AlbumTrack"!==e[0]||(e[0]="Index");const r=e.indexOf("Duration");-1!==r&&e.splice(r+1,0,"Album","Year"),i({view:"details",fields:h(e)})}}else i(t)}),[e,t]),r}var gT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function wT(e){var t,{source:r}=e,i=gT(e,["source"]);const[a,s]=(0,n.useState)(null),o=bT(a,r.secondaryLayout),l=(null==a?void 0:a.pager)||null,c=(0,n.useCallback)((([e])=>{s(e||null)}),[]),u=n.createElement(mT,Object.assign({},i,{title:r.title,onSelect:c})),d=n.createElement(pT,{title:a?`${a.title}: Tracks`:"",className:"album-tracks "+((null==a?void 0:a.multiDisc)?"multi-disc":""),pager:l,layout:o,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?u:n.createElement(sr,{id:"album-browser-layout",arrange:"rows",primaryIndex:0},u,d))}var ET=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const kT={view:"card compact",fields:["Thumbnail","Title","Genre"]};function xT(e){var{className:t="",layout:r=kT}=e,i=ET(e,["className","layout"]);return n.createElement(lT,Object.assign({},i,{className:`artists ${t}`,layout:r}))}var ST=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const TT={view:"card compact",fields:["Thumbnail","Title","Year"]};function PT(e){var t,r,{source:i}=e,a=ST(e,["source"]);const[s,o]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),u=bT(l,i.tertiaryLayout),d=(null==s?void 0:s.pager)||null,m=(null==l?void 0:l.pager)||null,h=(0,n.useCallback)((([e])=>{o(e||null)}),[]),f=(0,n.useCallback)((([e])=>{c(e||null)}),[]),p=n.createElement(xT,Object.assign({},a,{title:i.title,onSelect:h})),y=n.createElement(mT,{title:s?`${s.title}: Albums`:"",className:"artist-albums",pager:d,layout:i.secondaryLayout||TT,onSelect:f,key:null==s?void 0:s.src}),v=n.createElement(pT,{title:l?`${l.title}: Tracks`:"",className:"album-tracks "+((null==l?void 0:l.multiDisc)?"multi-disc":""),pager:m,layout:u,key:null==l?void 0:l.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=i.secondaryLayout)||void 0===t?void 0:t.view)?p:"none"===(null===(r=i.tertiaryLayout)||void 0===r?void 0:r.view)?n.createElement(sr,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},p,y):n.createElement(sr,{id:"artist-browser-layout",arrange:"columns",primaryIndex:1},p,n.createElement(sr,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},y,v)))}var AT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function IT(e){var{source:t}=e,r=AT(e,["source"]);return n.createElement("div",{className:"panel"},n.createElement(pT,Object.assign({},r,{title:t.title})),";")}var CT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const MT={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},OT={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function $T(e){var{source:t}=e,r=CT(e,["source"]);const[i,a]=(0,n.useState)(),[s,o]=(0,n.useState)(null),l=(null==s?void 0:s.pager)||null;(0,n.useEffect)((()=>()=>Qi.unlock()),[t]),(0,n.useEffect)((()=>{s&&Qi.lock(s)}),[s]);const c=(0,n.useCallback)((([e])=>{o(e||null)}),[]),u=(0,n.useCallback)((()=>{a(Error("Not found"))}),[]);return n.createElement("div",{className:"panel pinned-playlist"},i?n.createElement(NT,{src:t.id}):n.createElement(PS,Object.assign({},r,{title:t.title,layout:t.layout||MT,onError:a,onNoContent:u,onSelect:c,statusBar:!1,disabled:!0})),n.createElement(pT,{title:`${t.title}: Tracks`,className:"playlist-items",pager:l,layout:t.secondaryLayout||OT,onError:a}))}function NT({src:e}){const t=(0,n.useCallback)((()=>{Qi.unlock(),Qi.unpin({src:e})}),[e]);return n.createElement("div",{className:"playlists playlists-error"},n.createElement("p",{className:"message"},n.createElement(rt,{name:"error"}),n.createElement("span",{className:"text"},"Failed to load playlist.")),n.createElement("p",{className:"buttons"},n.createElement("button",{onClick:t},"Unpin")))}var zT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const jT={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function LT(e){var t,{source:r}=e,i=zT(e,["source"]);const[a,s]=(0,n.useState)(null),o=(null==a?void 0:a.pager)||null,l=(0,n.useCallback)((([e])=>{s(e||null)}),[]),c=n.createElement(PS,Object.assign({},i,{title:r.title,onSelect:l})),u=n.createElement(pT,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:o,layout:r.secondaryLayout||jT,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?c:n.createElement(sr,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:0},c,u))}function DT(e){return fa()?n.createElement(IT,Object.assign({},e,{service:ha})):n.createElement(RT,null)}function RT(){return n.createElement(NE,null,n.createElement("div",{className:"note"},n.createElement("p",null,n.createElement("strong",null,"Apple MusicKit beta required.")),n.createElement("p",null,"You need to enable ",n.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from ",ha.name,".")))}function FT(e){return"apple"===e.service.id?n.createElement(DT,Object.assign({},e)):n.createElement(IT,Object.assign({},e))}function _T(e){switch(e.source.itemType){case ti.Artist:return n.createElement(PT,Object.assign({},e));case ti.Album:return n.createElement(wT,Object.assign({},e));case ti.Playlist:return e.source.isPin?n.createElement($T,Object.assign({},e)):n.createElement(LT,Object.assign({},e));default:return e.source.mediaType===ni.Video?n.createElement(FT,Object.assign({},e)):n.createElement(IT,Object.assign({},e))}}var BT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const VT={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function UT(e){var{service:t,source:r,minDate:i="2010-01-01"}=e,a=BT(e,["service","source","minDate"]);const[s,o]=(0,n.useState)(0),l=function(e,t=0){return AS(e,(0,n.useMemo)((()=>({startAt:t})),[t]))}(r,s),c=(0,n.useCallback)((e=>{const t=new Date,r=new Date(e);r.getFullYear()===t.getFullYear()&&r.getMonth()===t.getMonth()&&r.getDate()===t.getDate()?o(0):o(Math.floor(r.valueOf()/1e3))}),[]);return n.createElement(n.Fragment,null,n.createElement(jE,{icon:t.icon},t.name,":",n.createElement(_E,{min:i,onSelect:c})),n.createElement(_T,Object.assign({},a,{service:t,source:r,pager:l,layout:r.layout||VT})))}const HT="2002-11-20",qT=new H("lastfm/useHistoryStart");function YT(){const e=function(){const[e,t]=(0,n.useState)((()=>fo.firstScrobbledAt)),r=""===e||e===HT;return(0,n.useEffect)((()=>{if(r){t(HT);const e=tn(bo.getUserInfo()).pipe(Be((e=>Number(e.user.playcount))),et((e=>{return e?pn(e):(r=ie(t=()=>Error("No history."))?t:function(){return t},new Me((function(e){return e.error(r())})));var t,r})),Be((e=>Math.floor(e/50))),Be((e=>new Io({page:e},{pageSize:50}))),et((e=>hi(e))),Be((e=>e.at(-1))),_e(l),Be((e=>new Date(1e3*e.playedAt))),Be(y),at((e=>fo.firstScrobbledAt=e)),at(t)).subscribe(qT);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(UT,{service:jo,source:Oo,minDate:e})}var KT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const WT={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function GT(e){var{service:t,source:r,total:i}=e,a=KT(e,["service","source","total"]);const[,s]=(0,n.useReducer)((e=>e++),0);return(0,n.useEffect)((()=>{const e=tn(Fr(6e4)).subscribe(s);return()=>e.unsubscribe()}),[]),n.createElement(n.Fragment,null,n.createElement(jE,{icon:t.icon},void 0===i?t.name:n.createElement(n.Fragment,null,t.name,": ",i.toLocaleString()," ",function(e){return tp(e)&&!!e.canScrobble}(t)?"scrobbles":"plays")),n.createElement(_T,Object.assign({},a,{service:t,source:r,layout:r.layout||WT})))}class JT extends Bi{fetchAt(){}next(e){this.disconnected||(this.connect(),this.size=e.length,this.items=e)}}var QT=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const XT=new H("useRecentlyPlayedPager");function ZT(e){const t=(0,n.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{const r=new JT,n=e(void 0,t),a=new Yi(r,n),o=sn(Ho().pipe(Gh(1),Qh(2e4)),Fr(3e5)),l=new le,c=t=>QT(this,void 0,void 0,(function*(){const r=e(t);return yield hi(r)}));return l.add(n.observeItems().pipe(Nn((e=>0===e.length)),Di(1),Be((e=>e[0].playedAt)),on((e=>o.pipe(et((()=>c(e+1))),at((e=>r.next(e))))))).subscribe(XT)),l.add(a.observeSize().pipe(at(s)).subscribe(XT)),r.next([]),i(a),()=>l.unsubscribe()}),[t,e]),{pager:r,total:a}}function eP(){const e=(0,n.useCallback)(((e,t)=>new Io(e?{from:e}:{to:t})),[]),{pager:t,total:r}=ZT(e);return n.createElement(GT,{service:jo,source:$o,pager:t,total:r})}var tP=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const rP=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function nP(e){var{source:t}=e,r=tP(e,["source"]);const i=(0,n.useId)(),[a,s]=(0,n.useState)(),o=function(e,t="overall"){return AS(e,(0,n.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(jE,{icon:jo.icon},jo.name,": ",t.title),n.createElement("div",{className:"lastfm-period-selector options"},n.createElement("ul",{className:"lastfm-periods"},rP.map((({value:e,text:t})=>n.createElement("li",{className:"lastfm-period",key:e},n.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),n.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),n.createElement(_T,Object.assign({},r,{service:jo,source:t,pager:o,layout:t.layout})))}const iP="2015-09-17";function aP(){const e=function(){const[e,t]=(0,n.useState)(Yl.firstScrobbledAt),r=""===e||e===iP;return(0,n.useEffect)((()=>{if(r){t(iP);const e=tn(Jl.getListeningActivity()).pipe(Be((e=>e.find((e=>e.listen_count>0)))),_e(l),Be((e=>y(1e3*Number(e.from_ts)))),at((e=>Yl.firstScrobbledAt=e)),Di(1)).subscribe(t);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(UT,{service:du,source:ru,minDate:e})}function sP(){const e=(0,n.useCallback)(((e,t)=>new Yc(e?{min_ts:e}:{max_ts:t},!0)),[]),{pager:t,total:r}=ZT(e);return n.createElement(GT,{service:du,source:nu,pager:t,total:r})}const oP=[{value:"all_time",text:"All time"},{value:"this_year",text:"Year"},{value:"this_month",text:"Month"},{value:"this_week",text:"Week"}];function lP({source:e}){const t=(0,n.useId)(),[r,i]=(0,n.useState)(),a=function(e,t="all_time"){return AS(e,(0,n.useMemo)((()=>({range:t})),[t]))}(e,r),s=(0,n.useCallback)((e=>{i(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(jE,{icon:du.icon},du.name,": ",e.title),n.createElement("div",{className:"listenbrainz-range-selector options"},n.createElement("ul",{className:"listenbrainz-ranges"},oP.map((({value:e,text:r})=>n.createElement("li",{className:"listenbrainz-range",key:e},n.createElement("input",{id:`${t}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),n.createElement("label",{htmlFor:`${t}-range-${e}`},r)))))),n.createElement(_T,{service:du,source:e,pager:a,layout:e.layout}))}function cP({icon:e,placeholder:t="Search",onSubmit:r}){const i=(0,n.useRef)(null),a=(0,n.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==r||r(t)}),[r]);return n.createElement("form",{className:"search-bar",onSubmit:a},n.createElement("p",{className:"text-with-button"},e?n.createElement(rt,{name:e}):null,n.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),n.createElement("button",{type:"submit",title:"Search"},n.createElement(rt,{name:"search"}))))}function uP({sources:e,onSourceChange:t}){const r=(0,n.useId)(),i=(0,n.useCallback)((r=>{const n=Number(r.target.value),i=e[n];null==t||t(i)}),[e,t]);return n.createElement("div",{className:"media-source-selector options"},n.createElement("ul",{className:"media-sources"},e.map(((e,t)=>n.createElement("li",{className:"media-source",key:e.id},n.createElement("input",{id:`${r}-${e.id}`,type:"radio",name:r,value:t,defaultChecked:0===t,onChange:i}),n.createElement("label",{htmlFor:`${r}-${e.id}`},e.title))))))}function dP({service:e,sources:t}){const[r,i]=(0,n.useState)((()=>t[0])),[a,s]=(0,n.useState)(""),o=function(e,t=""){return AS(e,(0,n.useMemo)((()=>({q:t})),[t]))}(r,a),l=!!r.searchable,c=!l&&!r.isPin;return n.createElement(n.Fragment,null,c?n.createElement(jE,{icon:e.icon},e.name,": ",r.title):null,l?n.createElement(cP,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:s}):null,t.length>1?n.createElement(uP,{sources:t,onSourceChange:i}):null,n.createElement(_T,{service:e,source:r,pager:o,layout:r.layout,loadingText:a?"Searching":void 0}))}function mP({service:e,viewType:t,itemType:r,onSelect:i}){const a=(0,n.useId)(),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(),u=t===ga.ByDecade?"Decade":"Genre";(0,n.useEffect)((()=>{l&&i&&i(l)}),[l,i]),(0,n.useEffect)((()=>{const n=tn(e.getFilters(t,r)).subscribe(o);return()=>n.unsubscribe()}),[e,t,r]),(0,n.useEffect)((()=>{l||c(s[0])}),[s,l]);const d=(0,n.useCallback)((e=>{c(s[Number(e.target.value)])}),[s]);return n.createElement("div",{className:"filter-selector"},n.createElement("label",{htmlFor:a},u,":"),n.createElement("select",{id:a,onChange:d},s.map(((e,t)=>n.createElement("option",{value:t,key:e.id},e.title)))))}function hP({service:e,source:t}){const[r,i]=(0,n.useState)(),a=AS(t,r);return n.createElement(n.Fragment,null,n.createElement(jE,{icon:e.icon},e.name,": ",t.title),n.createElement(mP,{service:e,viewType:t.viewType,itemType:t.itemType,onSelect:i}),n.createElement(_T,{service:e,source:t,pager:a,layout:t.layout}))}var fP=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const pP={view:"card minimal",fields:["FileIcon","FileName"]};function yP(e){var{className:t="",layout:r=pP,multiple:i=!0,draggable:a=!0,onSelect:s}=e,o=fP(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,n.useState)([]),u=l.every((e=>e.itemType===ti.Media)),d=i&&u,m=a&&u,h=(0,n.useCallback)((e=>{c(e),null==s||s(e)}),[s]);return n.createElement(lT,Object.assign({},o,{className:`folder-items ${t}`,layout:r,multiple:d,draggable:m,onSelect:h}))}var vP=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function bP({service:e,source:t}){const[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)("/");(0,n.useEffect)((()=>{const e=t.search();return i(e),s("/"),()=>e.disconnect()}),[t]);const o=(0,n.useCallback)((e=>vP(this,void 0,void 0,(function*(){e.itemType===ti.Folder&&(i(e.pager),s(e.path||"/"))}))),[]),l=(0,n.useCallback)((e=>vP(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===ti.Folder&&(i(t.pager),s(t.path||"/"))}}))),[]);return n.createElement(n.Fragment,null,n.createElement(jE,{icon:e.icon},e.name,": ",a),n.createElement("div",{className:"panel"},n.createElement(yP,{title:`Path: ${a}`,pager:r,onEnter:l,onDoubleClick:o})))}function gP({service:e,sources:t}){const r=1===t.length?t[0]:null;switch((0,n.useEffect)((()=>{(null==r?void 0:r.lockActionsStore)?Qn.lock(e.id,r.itemType):Qn.unlock()}),[e,r]),(0,n.useEffect)((()=>()=>Qn.unlock()),[e]),null==r?void 0:r.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return n.createElement(nP,{source:r});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return n.createElement(lP,{source:r});case"lastfm/history":return n.createElement(YT,null);case"listenbrainz/history":return n.createElement(aP,null);case"lastfm/recently-played":return n.createElement(eP,null);case"listenbrainz/recently-played":return n.createElement(sP,null);default:switch(null==r?void 0:r.viewType){case ga.ByDecade:case ga.ByGenre:return n.createElement(hP,{service:e,source:r});case ga.Folders:return n.createElement(bP,{service:e,source:r});default:return n.createElement(dP,{service:e,sources:t})}}}function wP({service:e,sources:t}){const r=OE(),i=dp(e.observeIsLoggedIn,e.isLoggedIn()),a=function(e,t){return(0,n.useMemo)((()=>function({error:r}){return r instanceof si?n.createElement(n.Fragment,null,n.createElement(jE,{icon:e.icon},1===t.length?`${e.name}: ${t[0].title}`:e.name),n.createElement(NE,null,n.createElement("div",{className:"note"},n.createElement("p",null,(null==r?void 0:r.message)||String(r))))):n.createElement(zE,{error:r},e&&n.createElement("p",{className:"buttons"},n.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e,t])}(e,t);return n.createElement("div",{className:`media-browser ${e.id}-browser`},n.createElement(lE.Ou,{fallbackRender:a},e.internetRequired&&!r?n.createElement($E,null):i?n.createElement(gP,{service:e,sources:t}):n.createElement(PE,{service:e})))}function EP(e){return e.sources.filter(Nm).map((t=>({id:t.id,label:n.createElement(kr,{icon:t.icon,text:t.title}),value:n.createElement(wP,{service:e,sources:[t],key:`${xP(e)}/${t.id}`})})))}function kP(e){return Qi.getPinsForService(e.id).map((t=>{var r;return null===(r=e.createSourceFromPin)||void 0===r?void 0:r.call(e,t)})).filter(l).map((t=>({id:t.id,label:n.createElement(kr,{icon:t.icon,text:t.title}),value:n.createElement(wP,{service:e,sources:[t],key:t.id})})))}function xP(e){return rp(e)?`${e.id}/${e.libraryId||""}`:e.id}var SP=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function TP(e){const[t,r]=(0,n.useState)(0),i=(0,n.useMemo)((()=>[n.createElement(PP,{key:0}),n.createElement(IP,{key:1}),n.createElement(AP,{key:2})]),[]),a=(0,n.useCallback)((()=>{r((e=>e-1))}),[]),s=(0,n.useCallback)((()=>{r((e=>e+1))}),[]);return n.createElement(cr,Object.assign({},e,{className:"settings-dialog startup-wizard",title:"Media Services"}),n.createElement("form",{method:"dialog"},i[t],n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",{type:"button",disabled:0===t,onClick:a},"« Prev"),n.createElement("button",{type:"button",disabled:t>=i.length-1,onClick:s},"Next »"),n.createElement("button",{className:"dialog-button-submit"},"Finish"))))}function PP(){const e=(0,n.useMemo)(Gf,[]);return n.createElement(CP,{icon:"globe",title:"Streaming Media",services:e,multiSelect:$m})}function AP(){const e=(0,n.useMemo)(Kf,[]);return n.createElement(CP,{icon:"network",title:"Personal Media Servers",services:e})}function IP(){const e=(0,n.useMemo)(Jf,[]);return n.createElement(CP,{icon:"data",title:"Listening History",services:e,multiSelect:!0})}function CP({icon:e,title:t,multiSelect:r,services:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>i.filter(Nm).some(MP))),l=(0,n.useCallback)((()=>SP(this,void 0,void 0,(function*(){const e=a.current.elements,t={};let r=!1;for(const n of e){const e=n.value;if(e){const i=!n.checked;t[e]=i,i||r||(r=MP(Qf(e)))}}zm(t),o(r)}))),[]);return n.createElement("div",{className:"startup-wizard-services"},n.createElement("h3",null,n.createElement(kr,{icon:e,text:t})),n.createElement("fieldset",{className:"media-services",onChange:l,ref:a},n.createElement("legend",null,"Enable"),n.createElement(Jp,{services:i,multiSelect:r})),s?n.createElement("p",{className:"restricted-access"},"*Access is restricted to approved users only."):null)}function MP(e){return!!(null==e?void 0:e.restrictedAccess)}const OP=new J("sources");function $P({onSelect:e}){const t=(0,n.useRef)(null),r=function(){const[e,t]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=sn(Om.pipe(Nn((e=>e===Mm)),Be((()=>{}))),sn(...Kf().filter((e=>!!e.observeLibraryId)).map((e=>e.observeLibraryId()))).pipe(Be((()=>{}))),Qi.observe()),r=Qi.observe().pipe(Di(1),on((()=>e)),Be((()=>Uf().filter(Nm).map((e=>function(e){return{id:e.id,label:n.createElement(sp,{service:e,showConnectivity:!0}),value:n.createElement(wP,{service:e,sources:e.roots,key:xP(e)}),startExpanded:!0,children:[...EP(e),...kP(e)]}}(e)))))).subscribe(t);return()=>r.unsubscribe()}),[]),e}(),[i,a]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{t.current.focus()}),[]),(0,n.useEffect)((()=>{if(r){const e=0===r.length&&!i;a(!0),e&&dr(TP,!0)}}),[r,i]),n.createElement("div",{className:"panel media-sources"},n.createElement(An,{roots:r||[],onSelect:e,storageId:OP.id,treeViewRef:t}))}const NP=(0,n.memo)((function(){const[e,t]=(0,n.useState)(null),r=(0,n.useCallback)((()=>{dr(sE,!0)}),[]);return n.createElement("div",{className:"media-library"},n.createElement("header",{className:"media-library-head"},n.createElement(nt,null),n.createElement(oE,null),n.createElement(pp,{icon:"settings",className:"in-frame",title:"Settings",onClick:r})),n.createElement("div",{className:"media-library-body"},n.createElement(sr,{id:"media-library-layout",arrange:"columns",primaryIndex:1},n.createElement($P,{onSelect:t}),e||n.createElement(NE,null))))})),zP=new H("visualizer"),jP={providerId:"none",name:""},LP=new it(jP),DP=new Ne,RP=[...Array(74).fill("butterchurn"),...Array(10).fill("ampshader"),...Array(4).fill("audiomotion"),...Array(1).fill("coverart"),...Array(1).fill("waveform")],FP=[...Array(58).fill("ampshader"),...Array(10).fill("butterchurn"),...Array(10).fill("spotifyviz"),...Array(2).fill("coverart")],_P=Array(10).fill("ambientvideo"),BP=Array(20).fill("ambientvideo");function VP(){return LP}function UP(){return qP().pipe(Be((e=>Jw(e))),on((e=>e?e.observeVisualizers():pn([]))))}function HP(){return Ry().pipe(Be((e=>!!e.lockedVisualizer)),Vn())}function qP(){return Ry().pipe(Be((e=>e.provider||"")),Vn())}function YP(e){DP.next(e)}function KP(){Dy.lockedVisualizer=GP()}function WP(){Dy.lockedVisualizer=null}function GP(){return LP.getValue()}function JP(e,t){const r=Jw(e);return{providerId:"none",name:(null==r?void 0:r.name)||e,reason:t}}function QP(e,t=1){var r;null===(r=Jw(e))||void 0===r||r.observeVisualizers().pipe(Nn((e=>0===e.length)),Wh(VP()),at((([,e])=>{e===jP&&YP("sync")})),Di(t)).subscribe(zP)}function XP(){const[e,t]=(0,n.useState)("searching"),r=BE(),i=null==r?void 0:r.id,a=null==r?void 0:r.src,s=null==r?void 0:r.lookupStatus;return(0,n.useEffect)((()=>t("searching")),[i]),(0,n.useEffect)((()=>{switch(s){case Wg.Looking:t("searching");break;case Wg.NotFound:t("error");break;default:if(a){if(np(a)){t("loading");const e=new le;return e.add(Tx().pipe(Di(1)).subscribe((()=>t("loaded")))),e.add(Ex().pipe(Di(1)).subscribe((()=>t("error")))),()=>e.unsubscribe()}t("searching")}else t("loaded")}}),[i,a,s]),e}Ew().pipe(on((()=>lw())),Vn(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),gv(200)).subscribe((()=>YP("item"))),Ak.observeError().subscribe((()=>YP("error"))),UP().subscribe((()=>YP("provider"))),DP.pipe(fn((e=>"click"===e?Rr(50):pn(void 0)))).pipe(Wh(lw(),Ry()),Be((([e,t,r])=>function(e,t,r){if(!t||t.mediaType===ni.Video)return jP;const n="error"===e,i=t.src.startsWith("spotify:"),a=r.lockedVisualizer;let s=(null==a?void 0:a.providerId)||r.provider;switch(s){case"spotifyviz":if(!i)return JP(s,"not supported");break;case"audiomotion":if(i)return JP(s,"not supported");break;case"none":return jP}if(a)return n?JP(s,"error"):function(e,t){return Qw(e).find((e=>e.name===t))}(a.providerId,a.name)||JP(s,"not found");const o=GP();if(s=r.provider,!s){let t=i?FP:RP;r.ambientVideoEnabled&&(t=t.concat(i?BP:_P)),s=k(t,n?o.providerId:void 0),"click"===e&&s===o.providerId&&1===Qw(s).length&&(s=k(t,s))}if("ambientvideo"!==s&&!Sk.streamingSupported&&(t.playbackType===jn.DASH||t.playbackType===jn.HLS))return JP(s,"not supported");const l=Qw(s);return n&&r.provider&&1===l.length?JP(s,"error"):k(l,o)||jP}(e,t,r)))).subscribe(LP),VP().pipe(at((e=>Ak.load(e)))).subscribe(zP),QP("ampshader"),QP("butterchurn",2);var ZP=r(4752);function eA(){return dp(Iw,!0)}function tA(){const e=XP(),t=eA();return n.createElement("p",{className:"media-state playback-state"},"error"===e?e:t?"":`${"loaded"===e?"playing":e}…`)}function rA(){const e=dp(Aw,0),t=dp(Pw,0);return n.createElement("progress",{className:"progress-bar",max:e,value:t})}const nA=["#3e3e3e","#ebebeb"];function iA({item:e,hidden:t,onPaletteChange:r}){var i;const a=dp(Fy,!1),[s,o]=(0,n.useState)(nA),[l,c]=(0,n.useState)("dark"),[u,d]=(0,n.useState)("light"),[m,f]=(0,n.useState)({}),p=(0,n.useCallback)((e=>{const t=new ZP.c,r=new Image,n=e=>{console.warn("Could not load image.",{err:e}),o(nA)},i=e=>{var r,i;try{const n=e=>`rgb(${e.map(Number)})`,a=e=>new Tt(n(e)).toHexString(),s=a(t.getColor(e)),l=new Tt(s).isDark(),c=(null===(r=t.getPalette(e))||void 0===r?void 0:r.map(a))||nA,u=(null===(i=wp(s,c,{includeFallbackColors:!0,level:"AA",size:"large"}))||void 0===i?void 0:i.toHexString())||(l?"#ffffff":"#000000");o(h([s,u,...c]))}catch(e){n(e)}};r.crossOrigin="anonymous",r.src=e,r.complete?i(r):(r.onload=()=>i(r),r.onerror=()=>{const t=new Image;t.crossOrigin="anonymous",t.src=`${e}${e.includes("?")?"&":"?"}ampcast_ts=${Date.now()}`,t.complete?i(t):(t.onerror=n,t.onload=()=>i(t))})}),[]),y=(0,n.useCallback)((()=>{o(nA)}),[]);return(0,n.useEffect)((()=>{const[e,t]=s.slice(0,2).map((e=>new Tt(e))),{h:n,s:i,l:a}=t.toHsl();f({"--background-color":e.toHexString(),"--text-color-h":`${n}`,"--text-color-s":100*Number(i)+"%","--text-color-l":100*Number(a)+"%"}),c(e.isDark()?"dark":"light"),d(t.isDark()?"dark":"light"),null==r||r(s)}),[s,r]),n.createElement("div",{className:`currently-playing themed ${l} text-${u}`,hidden:t,style:m},e?n.createElement(n.Fragment,null,n.createElement("div",{className:"currently-playing-thumbnail"},n.createElement(vS,{item:e,size:800,onLoad:p,onError:y,key:e.id}),n.createElement(aA,{item:e})),n.createElement("div",{className:"currently-playing-text"},n.createElement(oS,{title:e.title}),n.createElement(cS,{artist:null===(i=e.artists)||void 0===i?void 0:i.join(", ")}))):null,n.createElement(tA,null),a?n.createElement(rA,null):null)}function aA({item:e}){const t=Xf(e);return t&&ip(t)?n.createElement(kr,{icon:t.icon,text:`Provided by ${t.name}`}):null}const sA=()=>Ry().pipe(Be((e=>e.coverArtAnimatedBackground)),Vn());function oA(){const e=(0,n.useRef)(null),t=dp(sA,!1),[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)("row"),[o,l]=(0,n.useState)(["#000000"]),c=o[0],[u,d]=(0,n.useState)(0),[m,h]=(0,n.useState)(0),[f,p]=(0,n.useState)(0),y=Xt(),v=BE(),b=(null==v?void 0:v.mediaType)===ni.Video?null:v,g=vn(b),w=(null==b?void 0:b.id)||"",E=(0,n.useRef)(-1),[k,x]=(0,n.useState)(null),[T,P]=(0,n.useState)(null),A=XP(),[I,C]=(0,n.useState)(!1),M=(null==k?void 0:k.id)===w,O=(null==T?void 0:T.id)===w;return(0,n.useEffect)((()=>{if("error"===A)C(!0);else if(C(!1),"loaded"===A){const e=setTimeout((()=>C(!0)),4500);return()=>clearTimeout(e)}}),[A]),(0,n.useEffect)((()=>{const t=Sk.observeReady().subscribe((t=>{const r=ib.createPlayer(t);r.appendTo(e.current),i(r)}));return()=>t.unsubscribe()}),[]),(0,n.useEffect)((()=>{if(u>m){const e=m-5*y;p(Math.min(Math.floor(.45*u),e)),s("row")}else{const e=u-3*y;p(Math.min(Math.floor(.45*m),e)),s("column")}}),[u,m,y]),Jt(e,(({width:e,height:t})=>{d(e),h(t)})),(0,n.useEffect)((()=>{let e=E.current?1:0;(null==b?void 0:b.id)!==(null==g?void 0:g.id)&&(e=E.current?0:1),0===e?x(b):P(b),E.current=e}),[b,g]),(0,n.useEffect)((()=>{if(r){const[e,t]=o.slice(0,2).map((e=>new Mv.c(e)));let[,,...n]=o;n=S(n,(t=>(t=new Mv.c(t),e.deltaE2000(t)>10))),n=S(n,(e=>(e=new Mv.c(e),t.deltaE2000(e)>10))),r.backgroundColor=e.toString({format:"hex"}),r.beatsColor=n[0]}}),[r,o]),n.createElement("div",{className:`visualizer visualizer-coverart arrange-${a} ${I?"ready":""} ${t?"animated-background-enabled":""}`,style:{"--thumbnail-size":`${f}px`},ref:e},n.createElement("div",{className:"animated-background",style:{"--background-color":c}}),n.createElement(iA,{item:k,hidden:!M,onPaletteChange:M?l:void 0,key:"item0"}),n.createElement(iA,{item:T,hidden:!O,onPaletteChange:O?l:void 0,key:"item1"}),n.createElement("div",{className:"beats-player"}))}function lA(){return dp(VP,null)}function cA({visualizer:e}){return n.createElement("article",{className:"visualizer-info"},n.createElement(uA,{visualizer:e}),n.createElement(dA,{visualizer:e}))}function uA({visualizer:e}){return n.createElement("h3",null,"Visualizer: ",function(e){if(e){if(hA(e))return e.name||"none";{const t=Jw(e.providerId);if(t)return t.name}}return"none"}(e))}function dA({visualizer:e}){var t;if(e){if(hA(e))return n.createElement("p",{className:"no-visualizer-reason"},function(e){if(hA(e))switch(e.reason){case"not supported":return"Visualizer not supported for this media";case"not found":return"Visualizer not found";case"error":return"Visualizer error"}return""}(e));{const r="ambientvideo"===e.providerId&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=Jw(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return r?n.createElement(mA,{visualizer:e}):e.name?n.createElement(n.Fragment,null,n.createElement("h4",null,"Name: ",e.name),i?n.createElement("p",{className:"external-view"},n.createElement("span",null,"Url:")," ",n.createElement(Xl,{href:i})):null):null}}}function mA({visualizer:e}){const t=function(e){const[t,,r]=e.split(":"),[i,a]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(a(null),"youtube"===t&&r){const e=tn(Bc(r)).subscribe(a);return()=>e.unsubscribe()}}),[t,r]),i}(e.src);return t?n.createElement("div",{className:"youtube-video-info"},n.createElement("h4",null,"Title: ",t.title),n.createElement(uS,{owner:t.owner,src:t.src}),n.createElement("p",{className:"external-view"},"View on YouTube: ",n.createElement(rt,{name:"youtube"})," ",n.createElement(Xl,{href:t.externalUrl}))):null}function hA(e){return"none"===(null==e?void 0:e.providerId)}function fA(e){const t=(0,n.useRef)(null),{debug:r}=gS(t),i=BE(),a=lA(),s=Xx(i),o=Xx(a);return n.createElement(cr,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),n.createElement("form",{method:"dialog"},s?n.createElement(tS,{item:s,debug:r}):n.createElement("p",null,"The playlist is empty."),s&&s.mediaType!==ni.Video?n.createElement(cA,{visualizer:o}):null,n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}var pA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function yA(){const e=BE(),t=eA(),r=(0,n.useCallback)((()=>pA(this,void 0,void 0,(function*(){bw.atStart||Fx.prev()}))),[]),i=(0,n.useCallback)((()=>pA(this,void 0,void 0,(function*(){bw.atEnd||Fx.next()}))),[]);return e?n.createElement(UE,{className:"media-buttons"},n.createElement(pp,{className:"with-overlay","aria-label":"Previous track",icon:"prev",tabIndex:-1,onClick:r}),n.createElement(pp,{className:"with-overlay","aria-label":t?"Play":"Pause",icon:t?"play":"pause",tabIndex:-1,onClick:t?Ax:Ix}),n.createElement(pp,{className:"with-overlay","aria-label":"Stop",icon:"stop",onClick:Mx}),n.createElement(pp,{className:"with-overlay","aria-label":"Next track",icon:"next",tabIndex:-1,onClick:i})):null}function vA(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const e=()=>{const n=t.current,i=n.getContext("2d"),a=i.createImageData(n.width,n.height),s=new Uint32Array(a.data.buffer);for(let e=0;e<s.length;e++)s[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),r=requestAnimationFrame(e)};let r=0;return e(),()=>cancelAnimationFrame(r)}),[]),Jt(e,(({width:e,height:r})=>{const n=t.current;n.width=Math.ceil(e),n.height=Math.ceil(r)})),n.createElement("div",{className:"static",ref:e},n.createElement("canvas",{ref:t}))}const bA=(0,n.memo)((function(){var e;const t=dp(UP,[]),r=lA(),i=dp(HP,!1),a=dp(qP,""),s=vn(a),o="none"!==a,l=!a||t.length>1,c=l&&!i,u=function(){const e=BE(),t=lA(),[r,i]=(0,n.useState)("");return(0,n.useEffect)((()=>{if((null==e?void 0:e.mediaType)===ni.Video){const t=Xf(e);(null==t?void 0:t.serviceType)===$n.PublicMedia?i("apple"===t.id?"apple-logo":t.icon):i("")}else"ambientvideo"===(null==t?void 0:t.providerId)&&t.src.startsWith("youtube:")?i("youtube"):i("")}),[e,t]),r}(),[d,m]=(0,n.useState)(0),h=eA(),f=(null===(e=BE())||void 0===e?void 0:e.mediaType)===ni.Video,p="none"===(null==(g=r)?void 0:g.providerId)&&g.reason?`visualizer ${g.reason}`:"",y=(0,n.useCallback)((()=>{dr(fA)}),[]),v=(0,n.useCallback)((()=>{dr(rE,!0)}),[]),b=(0,n.useCallback)((()=>{m(d+1),0===d&&setTimeout((()=>YP("click")))}),[d]);var g;return(0,n.useEffect)((()=>{s&&s!==a&&!f&&m((e=>e+1))}),[s,a,f]),(0,n.useEffect)((()=>{if(d){const e=Rr(500).subscribe((()=>m(0)));return()=>e.unsubscribe()}}),[d]),n.createElement("div",{className:"visualizer-controls",style:d?{opacity:"1"}:void 0},o&&d&&!h?n.createElement(vA,null):null,n.createElement(UE,{className:"visualizer-buttons visualizer-controls-settings"},n.createElement(pp,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:y}),n.createElement(pp,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:v})),o?n.createElement(UE,{className:"visualizer-buttons visualizer-controls-selector"},l?n.createElement(pp,{className:"with-overlay",icon:i?"locked":"unlocked",title:i?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:i?WP:KP}):null,c?n.createElement(pp,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:b}):null):null,n.createElement(yA,null),u?n.createElement(rt,{className:"video-source-icon",name:u}):null,n.createElement("p",{className:"media-state no-visualizer-reason"},p),n.createElement(rA,null))}));function gA(){var e;const t=BE(),r=function(){var e,t;const[r,i]=(0,n.useState)("show"),a=dp(kw,null),s=null===(e=null==a?void 0:a.paused)||void 0===e||e,o=null==a?void 0:a.currentItem,l=(null==a?void 0:a.currentTime)||0,c=(null==o?void 0:o.mediaType)===ni.Video,u=(null===(t=lA())||void 0===t?void 0:t.providerId)||"none",[d,m]=(0,n.useState)(!0),h=l>0;return(0,n.useEffect)((()=>{if(m(!0),h){const e=setTimeout((()=>m(!1)),1e4);return()=>clearTimeout(e)}}),[h]),(0,n.useEffect)((()=>{i(s?"show":"coverart"!==u||c?("none"!==u||c)&&h?d?"fade-out":"hide":"show":"hide")}),[s,u,c,h,d]),r}();return n.createElement("div",{className:`interstitial ${r}`},n.createElement("div",{className:"currently-playing"},t?n.createElement(n.Fragment,null,n.createElement("h2",null,t.title),(null===(e=t.artists)||void 0===e?void 0:e.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"by"},"by"),n.createElement("h3",null,t.artists.join(", "))):null):n.createElement("p",null,"The playlist is empty.")),n.createElement(tA,null))}r(4784);const wA=(0,n.memo)((function(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=dp(Fy,!1),[i,a]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),l=BE(),c=null==l?void 0:l.id,u=(null==l?void 0:l.mediaType)===ni.Video,d=lA(),m=!d||"none"===d.providerId,h=!u&&"coverart"===(null==d?void 0:d.providerId),f=!function(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e){const r=t=>Yr(e,t),n=sn(r("mousemove"),r("mousedown"),r("mouseup")).pipe(at((()=>i(!0))),gv(t),at((()=>i(!1)))).subscribe();return()=>n.unsubscribe()}i(!1)}),[e,t]),r}(e.current,4e3),p=XP();(0,n.useEffect)((()=>{const e=setTimeout((()=>o(!1)),1e4);return o(!0),()=>clearTimeout(e)}),[c]),(0,n.useEffect)((()=>{Fx.appendTo(t.current)}),[]),(0,n.useEffect)((()=>{const t=Yr(document,"fullscreenchange").pipe(Be((()=>document.fullscreenElement===e.current))).subscribe(a);return()=>t.unsubscribe()}),[]),Jt(e,(({width:e,height:t})=>{Fx.resize(e,t)}));const y=(0,n.useCallback)((()=>{i?document.exitFullscreen():e.current.requestFullscreen()}),[i]);return n.createElement("div",{className:`panel media ${p} ${u?"is-playing-video":"is-playing-audio"} ${m?"no-visualizer":""}  ${h?"is-showing-cover-art":""} ${f?"idle":""} ${s?"is-new-item":""}`,onDoubleClick:y,ref:e},n.createElement("div",{className:"players",ref:t}),n.createElement(oA,null),n.createElement(gA,null),r&&i?n.createElement(rA,null):null,n.createElement(bA,null))}));var EA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const kA={duration:!0,skipCovers:!0,skipPostHeaders:!0};function xA(e,t,r,n){var i,a,s;const{common:o}=n,l=(e=0)=>Math.floor(Number(e))||0;return{itemType:ti.Media,mediaType:e,playbackType:jn.Direct,src:t,externalUrl:"",title:o.title||r,artists:o.artist?[o.artist]:o.artists,albumArtist:o.album&&o.albumartist||"",album:o.album||"",genres:o.genre,duration:0,track:l(null===(i=o.track)||void 0===i?void 0:i.no),disc:l(null===(a=o.disk)||void 0===a?void 0:a.no),year:l(o.year),mood:o.mood||"",rating:Number(o.rating)||0,isrc:null===(s=o.isrc)||void 0===s?void 0:s[0],recording_mbid:o.musicbrainz_recordingid,playedAt:0,noScrobble:!o.title}}var SA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const TA=new H("usePlaylistInject"),PA={items:fw,files:function(e,t){return SA(this,void 0,void 0,(function*(){try{e instanceof FileList&&(e=Array.from(e));const n=yield Promise.all(e.map((e=>function(e){return EA(this,void 0,void 0,(function*(){const{parseBlob:t}=yield Promise.all([r.e(552),r.e(88)]).then(r.bind(r,1552)),n=yield t(e,kA),{format:i}=n,a=e.type.startsWith("video"),s=i.duration||0,o=xA(a?ni.Video:ni.Audio,`blob:${xa()}`,e.name.replace(/\.\w+$/,""),n);return Object.assign(Object.assign({},o),{duration:s?Number(s.toFixed(3)):0,blob:e})}))}(e))));yield fw(n,t)}catch(e){yield IA(e)}}))},urls:function(e,t){return SA(this,void 0,void 0,(function*(){const[n,i]=m(e,(e=>!!lc()(e))),a=n.map((e=>lc()(e)));try{const e=yield Promise.all([Promise.all(a.map((e=>Bc(e)))),Promise.all(i.map((e=>function(e){return EA(this,void 0,void 0,(function*(){const t=yield function(e,t){var n;return EA(this,void 0,void 0,(function*(){const{parseBlob:i,parseReadableStream:a}=yield Promise.all([r.e(552),r.e(88)]).then(r.bind(r,1552)),s=yield fetch(e,{signal:AbortSignal.timeout(3e3)});if(s.ok){if(s.body){const e=s.headers.get("Content-Length"),r={size:e?parseInt(e,10):void 0,mimeType:null!==(n=s.headers.get("Content-Type"))&&void 0!==n?n:void 0},i=yield a(s.body,r,t);return s.body.locked||(yield s.body.cancel()),i}return i(yield s.blob(),t)}throw Error(s.statusText||"Could not load media")}))}(e,kA),{format:n}=t,i=n.duration||0,a=xA(ni.Audio,e,e,t);return Object.assign(Object.assign({},a),{duration:i?Number(i.toFixed(3)):0})}))}(e))))]);yield fw(e.flat(),t)}catch(e){yield IA(e)}}))},spotifyTracks:function(e,t){return SA(this,void 0,void 0,(function*(){try{const r=Qf("spotify");if(null==r?void 0:r.isConnected()){const n=yield r.getTracksById(e);yield fw(n,t)}else yield IA(Error("Not connected to Spotify."))}catch(e){yield IA(Error("Failed to load Spotify tracks."))}}))}};function AA(){return PA}function IA(e){return SA(this,void 0,void 0,(function*(){TA.error(e);const t="Media could not be loaded.",r=e instanceof TypeError?t:e.message||t;yield Sr(r)}))}var CA=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function MA(e){var{icon:t,className:r=""}=e,i=CA(e,["icon","className"]);const a=(0,n.useRef)(null),s=(0,n.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return n.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${r}`,type:"button",onMouseDown:s,ref:a}),n.createElement(rt,{name:t}))}const OA=(0,n.memo)((function(){const[e,t]=(0,n.useState)((()=>Fx.muted)),[r,i]=(0,n.useState)((()=>Fx.volume)),a=r<=.33?"low":r<=.67?"medium":"high";(0,n.useEffect)((()=>{Fx.muted=e}),[e]),(0,n.useEffect)((()=>{Fx.volume=r}),[r]);const s=(0,n.useCallback)((e=>{const r=e.target.valueAsNumber;i(r),t(0===r)}),[]),o=(0,n.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return n.createElement("div",{className:`volume-control volume-${a}`},n.createElement(pp,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:o}),n.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:r,onChange:s}))}));function $A(e){const t=0===dp(dw,0),r=eA();return n.createElement(QE,Object.assign({},e),n.createElement(tk,{label:"Stop after current",value:"stop-after-current",checked:Fx.stopAfterCurrent,disabled:r,key:"stop-after-current"}),n.createElement(ZE,{label:"Jump to current",value:"jump-to-current",disabled:t,key:"jump-to-current"}),n.createElement(rk,null),n.createElement(ZE,{label:"Shuffle",value:"shuffle",disabled:t,key:"shuffle"}),n.createElement(rk,null),n.createElement(ZE,{label:"Save as playlist…",value:"save-as-playlist",disabled:t,key:"save-as-playlist"}),n.createElement(rk,null),n.createElement(ZE,{label:"Add from file…",value:"add-from-file",key:"add-from-file"}),n.createElement(ZE,{label:"Add from url…",value:"add-from-url",key:"add-from-url"}),n.createElement(rk,null),n.createElement(ZE,{label:"Clear",value:"clear",disabled:t,key:"clear"}))}var NA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function zA({listViewRef:e}){const t=(0,n.useRef)(null),r=dp(cw,-1),i=dp(Pw,0),a=dp(Aw,0),s=eA(),{showPlaylistMenu:o}=function(e,t){const r=AA();return{showPlaylistMenu:(0,n.useCallback)(((i,a)=>{return s=this,o=void 0,c=function*(){const s=e.current;switch(yield ik((e=>n.createElement($A,Object.assign({},e))),i,a)){case"jump-to-current":s.scrollIntoView(bw.getCurrentIndex()),s.focus();break;case"stop-after-current":Fx.stopAfterCurrent=!Fx.stopAfterCurrent;break;case"clear":bw.clear();break;case"shuffle":bw.shuffle(!Fx.paused),s.scrollIntoView(0);break;case"add-from-file":t.current.click();break;case"add-from-url":{const e=yield Ar({title:"External Media",type:"url",label:"Url",okLabel:"Add"});e&&(yield r.urls([e],-1));break}case"save-as-playlist":yield zS(bw.getItems())}},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(r,n)}i((c=c.apply(s,o||[])).next())}));var s,o,l,c}),[e,t,r])}}(e,t),l=AA(),c=(0,n.useCallback)((e=>{Cx(e.target.valueAsNumber)}),[]),u=(0,n.useCallback)((e=>NA(this,void 0,void 0,(function*(){const{right:t,bottom:r}=e.target.getBoundingClientRect();yield o(t,r+4)}))),[o]),d=(0,n.useCallback)((()=>NA(this,void 0,void 0,(function*(){bw.atStart||(Fx.prev(),e.current.scrollIntoView(r-1))}))),[e,r]),m=(0,n.useCallback)((()=>NA(this,void 0,void 0,(function*(){bw.atEnd||(Fx.next(),e.current.scrollIntoView(r+1))}))),[e,r]),h=(0,n.useCallback)((e=>NA(this,void 0,void 0,(function*(){const t=e.target.files;t&&(yield l.files(t,-1),e.target.value="")}))),[l]);return n.createElement("div",{className:"media-controls"},n.createElement("div",{className:"current-time-control"},n.createElement(QS,{time:i}),n.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:a,step:1,value:i,disabled:s,onChange:c})),n.createElement("div",{className:"playback-control"},n.createElement(OA,null),n.createElement("div",{className:"media-buttons"},n.createElement(MA,{"aria-label":"Previous track",icon:"prev",onClick:d}),n.createElement(MA,{"aria-label":s?"Play":"Pause",icon:s?"play":"pause",onClick:s?Ax:Ix}),n.createElement(MA,{"aria-label":"Stop",icon:"stop",onClick:Mx}),n.createElement(MA,{"aria-label":"Next track",icon:"next",onClick:m})),n.createElement("div",{className:"media-buttons-more"},n.createElement(MA,{title:"More…",icon:"menu",onClick:u}),n.createElement("input",{type:"file",accept:"audio/*,video/*",multiple:!0,onChange:h,ref:t}))))}var jA=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function LA(e){var{items:t,selectedItems:r,rowIndex:i}=e,a=jA(e,["items","selectedItems","rowIndex"]);const s=t.length,o=r.length,l=o===s,c=1===o;return n.createElement(QE,Object.assign({},a),-1===i?null:n.createElement(n.Fragment,null,c?n.createElement(ZE,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,n.createElement(ZE,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"})),n.createElement(rk,null),l?null:n.createElement(ZE,{label:"Select all",value:"select-all",acceleratorKey:`${j.ctrlKeyStr}+A`,key:"select-all"}),!c&&function(e,t){const r=e.findIndex((e=>e===t[0]));return t.every(((t,n)=>t===e[r+n]))}(t,r)?n.createElement(ZE,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,n.createElement(rk,null),n.createElement(sk,{items:r}),n.createElement(rk,null),c?n.createElement(ZE,{label:"Info…",value:"info",acceleratorKey:`${j.ctrlKeyStr}+I`,key:"info"}):null)}const DA={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[r]=e.split(":");let i;switch(t){case Wg.Looking:i="lookup-looking";break;case Wg.NotFound:i="lookup-not-found";break;default:i=np(e)?r:"lookup-pending"}return n.createElement(rt,{name:i,className:"youtube"===r?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return(null==t?void 0:t.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"artist-text"},t.join("/")),n.createElement("span",{role:"separator"},"-"),n.createElement("span",{className:"title-text"},e)):n.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:ZS,align:"right",className:"duration"}]};var RA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const FA=["audio/*","video/*","text/x-spotify-tracks","text/uri-list"];function _A(e){var{onSelect:t,onPlay:r,onEject:i,listViewRef:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["onSelect","onPlay","onEject","listViewRef"]);const o=dp(bw.observe,[]),l=function(e){const t=BE(),r=null==t?void 0:t.id,i=eA(),a=String(e).length,{zeroPadLineNumbers:s,showLineNumbers:o,showSourceIcons:l}=dp(Oy.observe,Oy.get());return(0,n.useMemo)((()=>Object.assign(Object.assign({},DA),{cols:DA.cols.filter((e=>{switch(e.className){case"index":return o;case"source":return l;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,t)=>{const o=function(e,t=0){return n.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(t,s?a:0);return e.id===r?n.createElement(n.Fragment,null,n.createElement(rt,{name:i?"pause":"play"}),o):o}}):e))})),[s,o,l,a,r,i])}(o.length),c=BE(),u=null==c?void 0:c.id,[d,m]=(0,n.useState)([]),h=aT(d),f=AA(),p=(0,n.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===u?"playing":""} ${e.unplayable||e.lookupStatus===Wg.NotFound?"unplayable":""}`}),[u]),y=(0,n.useCallback)((e=>{m(e),null==t||t(e)}),[t]),v=(0,n.useCallback)((e=>{null==r||r(e)}),[r]),b=(0,n.useCallback)((e=>{1===e.length&&(null==r||r(e[0]))}),[r]),g=(0,n.useCallback)((e=>{1===e.length&&e[0].id===u?null==i||i():bw.remove(e)}),[i,u]),w=(0,n.useCallback)((([e])=>RA(this,void 0,void 0,(function*(){e&&(yield kS(e))}))),[]),E=(0,n.useCallback)(((e,t,i,s,l)=>RA(this,void 0,void 0,(function*(){if(0===o.length)return;const c=yield function(e,t,r,i,a,s="left"){return o=this,l=void 0,u=function*(){return ik((i=>n.createElement(LA,Object.assign({},i,{items:e,selectedItems:t,rowIndex:r}))),i,a,s)},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(r,n)}i((u=u.apply(o,l||[])).next())}));var o,l,c,u}(o,e,s,t,i,-1===l?"right":"left");switch(c){case"play":null==r||r(e[0]);break;case"remove":bw.remove(e);break;case"info":yield kS(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=o.findIndex((t=>t===e[0]));bw.reverseAt(t,e.length);break}default:yield FS(c,e)}}))),[r,o,a]),k=(0,n.useCallback)(((e,t)=>RA(this,void 0,void 0,(function*(){if(e instanceof DataTransferItem)switch(e.type){case"text/x-spotify-tracks":e.getAsString((e=>RA(this,void 0,void 0,(function*(){const r=e.split(/\s+/).map((e=>e.split(":")[2]));yield f.spotifyTracks(r,t)}))));break;case"text/uri-list":e.getAsString((e=>RA(this,void 0,void 0,(function*(){const r=e.split(/\s+/);yield f.urls(r,t)}))))}else e[0]instanceof File?yield f.files(e,t):yield f.items(e,t)}))),[f]);return n.createElement("div",{className:"playlist",onDragStart:h},n.createElement(zp,Object.assign({},s,{title:"Playlist",className:"media-list",layout:l,items:o,itemKey:"id",itemClassName:p,selectedIndex:0===o.length?-1:0,draggable:!0,droppable:!0,droppableTypes:FA,multiple:!0,reorderable:!0,onContextMenu:E,onDelete:g,onDoubleClick:v,onDrop:k,onEnter:b,onInfo:w,onMove:bw.moveSelection,onSelect:y,listViewRef:a})),n.createElement(KS,{items:o,size:o.length,selectedCount:d.length}))}const BA=(0,n.memo)((function(){const e=(0,n.useRef)(null),t=BE(),r=null==t?void 0:t.id,i=eA(),a=(0,n.useCallback)((e=>{e.id===r?Fx.play():(Fx.load(null),Fx.autoplay=!0,bw.setCurrentItem(e))}),[r]);return n.createElement("div",{className:"media-playback "+(i?"paused":"")},n.createElement(oE,null),n.createElement(sr,{id:"media-playback-layout",arrange:"rows"},n.createElement("div",{className:"panel playback"},n.createElement(zA,{listViewRef:e}),n.createElement(_A,{onPlay:a,onEject:Nx,listViewRef:e})),n.createElement(wA,null)))}));function VA(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function UA(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),HA());break;case"MediaPlayPause":e.preventDefault(),HA();break;case"MediaStop":e.preventDefault(),Fx.stop();break;case"MediaTrackPrevious":e.preventDefault(),Fx.prev();break;case"MediaTrackNext":e.preventDefault(),Fx.next()}}function HA(){Fx.paused?Fx.play():Fx.pause()}function qA(){return(0,n.useEffect)((()=>{document.body.classList.add(`browser-${j.name.replace(/\s+/g,"-")}`),ot()()&&document.body.classList.add("electron")}),[]),(0,n.useEffect)((()=>{const e=new le,t=CE();return Uf().forEach((r=>{const n=_n([t,r.observeIsLoggedIn()]).subscribe((([e,t])=>{const n=r.internetRequired?e&&t:t;document.body.classList.toggle(`${r.id}-connected`,n),document.body.classList.toggle(`${r.id}-not-connected`,!n)}));e.add(n)})),()=>e.unsubscribe()}),[]),(0,n.useEffect)((()=>{let e=!1;const t=document.getElementById("app"),r=document.getElementById("system"),n=new le,i=e=>Yr(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return document.activeElement.classList.toggle("focus",!0),n.add(Yr(document,"keydown",{capture:!0}).subscribe((()=>{e=!0}))),n.add(Yr(document,"mousedown",{capture:!0}).subscribe((()=>{e=!1}))),n.add(Yr(document,"focusin").subscribe((()=>{document.body.classList.toggle("focus-visible",e)}))),n.add(Yr(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?r:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),n.add(Yr(document,"mouseup",{capture:!0}).subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),n.add(Yr(r,"mousedown").subscribe(w)),n.add(i(t)),n.add(i(r)),()=>n.unsubscribe()}),[]),(0,n.useEffect)((()=>{const e=Yr(document,"dragenter"),t=Yr(document,"dragover"),r=Yr(document,"drop"),n=sn(e,t).pipe(at(VA)),i=sn(n,r.pipe(at(g))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=dp(kw,void 0);(0,n.useEffect)((()=>function({currentItem:e,currentTime:t=0,duration:r=0,paused:n=!0}={}){var i,a;const s=navigator.mediaSession;s.playbackState=n?t?"paused":"none":"playing",s.setPositionState({duration:r,position:t,playbackRate:1}),s.metadata=new MediaMetadata({title:null==e?void 0:e.title,artist:null===(i=null==e?void 0:e.artists)||void 0===i?void 0:i.join(", "),album:null==e?void 0:e.album,artwork:null===(a=null==e?void 0:e.thumbnails)||void 0===a?void 0:a.map((e=>({src:Wx(e),sizes:`${e.width}x${e.height}`})))}),s.setActionHandler("play",Ax),s.setActionHandler("pause",Ix),s.setActionHandler("stop",Mx),s.setActionHandler("previoustrack",Ox),s.setActionHandler("nexttrack",$x),s.setActionHandler("seekto",(e=>{null!=e.seekTime&&Cx(e.seekTime)}))}(e)),[e])}(),(0,n.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",w),document.getElementById("popup").addEventListener("keydown",w),document.body.addEventListener("keydown",UA)}),[]),n.createElement(sr,{id:"main-layout",arrange:"columns"},n.createElement(NP,null),n.createElement(BA,null))}function YA({onDismiss:e}){return n.createElement("div",{className:"desktop-warning"},n.createElement(nt,null),n.createElement("p",null,"This application is intended for a desktop browser."),n.createElement("p",null,n.createElement("button",{onClick:e},"Proceed")))}const KA=new J("desktopWarning");"https:"===location.protocol&&window.addEventListener("load",(()=>{var e;null===(e=navigator.serviceWorker)||void 0===e||e.register("/service-worker.js")})),(0,i.C)(document.getElementById("app")).render(n.createElement(n.StrictMode,null,n.createElement((function(){const[e,t]=(0,n.useState)((()=>j.desktop||KA.getBoolean("dismissed"))),r=(0,n.useCallback)((()=>{KA.setBoolean("dismissed",!0),t(!0)}),[]);return n.createElement(n.Fragment,null,n.createElement(tt,null),n.createElement("main",null,e?n.createElement(qA,null):n.createElement(YA,{onDismiss:r})))}),null)))}},e=>{e.O(0,[872,776,712],(()=>(1680,e(e.s=1680)))),e.O()}]);