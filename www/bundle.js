(globalThis.webpackChunkampcast=globalThis.webpackChunkampcast||[]).push([[296],{6998:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var r,n=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(r=0;r<n.length;++r)if(n[r].test(e))return n[r].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(r=0;r<i.length;++r)if(/^[^#\&\?]{11}$/.test(i[r]))return i[r]}}return null}},745:(e,t,r)=>{"use strict";var n=r(3935);t.s=n.createRoot,n.hydrateRoot},6819:(e,t,r)=>{"use strict";var n=r(7294),i=r(745),a=r(6657),s=r.n(a),o=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(n))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(n,""),t()})),i.addEventListener("error",(()=>r(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const r=[],n=[...e];for(;n.length;)r.push(n.splice(0,t));return r}function d(e,t){const r="function"==typeof t?t:e=>e[t];return e.reduce(((e,t)=>{const n=r(t);return e[n]||(e[n]=[]),e[n].push(t),e}),{})}function m(e,t){const r=[],n=[];for(const i of e)t(i)?r.push(i):n.push(i);return[r,n]}function h(e){return[...new Set(e)]}function f(e,t){return e.filter(((e,r,n)=>r===n.findIndex((r=>e[t]===r[t]))))}function p(e){let t=e.length;for(;t>0;){const r=Math.floor(Math.random()*t);t--;const n=e[t];e[t]=e[r],e[r]=n}return e}function y(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function v(e){return y(e).slice(0,7)}function b(e){return new Date(Math.floor(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function g(e){e.preventDefault()}function w(e){e.stopPropagation()}function E(e){e.preventDefault(),e.stopPropagation()}function k(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function x(e,t={}){return h(Object.keys(e).concat(Object.keys(t))).reduce(((r,n)=>(void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n]),r)),{})}function S(e,t,r){const n=e.filter(t,r);return 0===n.length?e.slice():n}function T(e,t,r=.9){return Math.max(s()(e,t,.99),s()(t,e,.99))>=r}function P(e=""){const t=document.createElement("p"),r=String(null!=e?e:"").trim().split(/[\n\r]+/);return null==r?void 0:r.map((e=>(t.innerHTML=e,t.textContent))).join("\n")}function A(e){return new Promise((t=>setTimeout(t,e)))}const I=(0,r(3631).qY)(),C=(null==I?void 0:I.name)||"unknown",M=/^edge/.test(C)?"Microsoft Edge":C.replace(/^\w/,(e=>e.toUpperCase())),O=(null==I?void 0:I.version)||"0",$=(null==I?void 0:I.os)||"unknown",N="Mac OS"===$?"metaKey":"ctrlKey",z="Mac OS"===$?"⌘":"Ctrl",j={name:C,displayName:M,version:O,os:$,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test($),ctrlKey:N,ctrlKeyStr:z};const L=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function D(e){return Object.keys(e).reduce(((t,r)=>(void 0===e[r]||L.includes(r)||(t[r]=e[r]),t)),{})}function R(e){return/m[uú][sz](i|ie)[ckq]/i.test(e)}const F="Mac OS"===j.os||"iOS"===j.os?"fairplay":"widevine";let _="";const B={widevine:"com.widevine.alpha",fairplay:"com.apple.fairplay",playready:"com.microsoft.playready"};function V(e,t){return new Promise((r=>{const n=document.createElement(e),i=e=>()=>{n.removeAttribute("src"),clearTimeout(o),r(e)},a=i(!1),s=i(!0),o=setTimeout(s,1e3);try{n.muted=!0,n.crossOrigin="anonymous",n.onerror=a,n.oncanplay=s,n.onplaying=s,n.ontimeupdate=s,n.setAttribute("src",t),n.play().then(void 0,a)}catch(e){a()}}))}class U{constructor(e="",t=!1,r=window.console){const n=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(U.only)&&r.log(...t)};this.log=(...e)=>a(`##${n}`,...e),this.warn=(...e)=>a(`###${n}`,...e),this.error=t=>{e.startsWith(U.only)&&(a(`####${n} ERROR`),r.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=n=>new U(i(e,n),t,r),this.rx=t=>new U(i(e,t),!0,r),this.only=()=>this}}U.only="";const H=U,Y=new Map,q={get length(){return Y.size},clear(){Y.clear()},key(e){var t;return null!==(t=[...Y.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=Y.get(String(e)))&&void 0!==t?t:null},setItem(e,t){Y.set(String(e),String(t))},removeItem(e){Y.delete(String(e))}},K=q,W=new H("LiteStorage");class G{constructor(e,t="local"){const r=`${t}-${e}`;if(G.ids.includes(r))throw Error(`Duplicate storageId: ${r}`);switch(G.ids.push(r),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=K}}getBoolean(e,t=!1){var r;const n=null!==(r=this.getItem(e))&&void 0!==r?r:t;return!!n&&"false"!==n}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const r=this.getItem(e);try{return r?JSON.parse(r):t}catch(e){W.error(e)}return t}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){W.error(e)}}getNumber(e,t=0){var r;const n=Number(null!==(r=this.getItem(e))&&void 0!==r?r:t);return isNaN(n)?t:n}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var r;return String(null!==(r=this.getItem(e))&&void 0!==r?r:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}hasItem(e){return null!==this.getItem(e)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let r=0;r<this.storage.length;r++){const n=this.storage.key(r);n.startsWith(e)&&t.push(n)}t.forEach((e=>this.storage.removeItem(e)))}}G.ids=[];const J=G;var Q=function(e,t){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Q(e,t)};function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Q(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Z(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function ee(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return s}function re(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function ne(e){return this instanceof ne?(this.v=e,this):new ne(e)}function ie(e){return"function"==typeof e}function ae(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var se=ae((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function oe(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var le=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=ee(a),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(ie(l))try{l()}catch(e){i=e instanceof se?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=ee(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{de(m)}catch(e){i=null!=i?i:[],e instanceof se?i=re(re([],te(i)),te(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(i)throw new se(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)de(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&oe(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&oe(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),ce=le.EMPTY;function ue(e){return e instanceof le||e&&"closed"in e&&ie(e.remove)&&ie(e.add)&&ie(e.unsubscribe)}function de(e){ie(e)?e():e.unsubscribe()}var me={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},he={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=he.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,re([e,t],te(r))):setTimeout.apply(void 0,re([e,t],te(r)))},clearTimeout:function(e){var t=he.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function fe(e){he.setTimeout((function(){var t=me.onUnhandledError;if(!t)throw e;t(e)}))}function pe(){}var ye=ve("C",void 0,void 0);function ve(e,t,r){return{kind:e,value:t,error:r}}var be=null;function ge(e){if(me.useDeprecatedSynchronousErrorHandling){var t=!be;if(t&&(be={errorThrown:!1,error:null}),e(),t){var r=be,n=r.errorThrown,i=r.error;if(be=null,n)throw i}}else e()}var we=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,ue(t)&&t.add(r)):r.destination=Ae,r}return X(t,e),t.create=function(e,t,r){return new Se(e,t,r)},t.prototype.next=function(e){this.isStopped?Pe(function(e){return ve("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Pe(function(e){return ve("E",void 0,e)}(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Pe(ye,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(le),Ee=Function.prototype.bind;function ke(e,t){return Ee.call(e,t)}var xe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Te(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Te(e)}else Te(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Te(e)}},e}(),Se=function(e){function t(t,r,n){var i,a,s=e.call(this)||this;return ie(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&me.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&ke(t.next,a),error:t.error&&ke(t.error,a),complete:t.complete&&ke(t.complete,a)}):i=t,s.destination=new xe(i),s}return X(t,e),t}(we);function Te(e){var t;me.useDeprecatedSynchronousErrorHandling?(t=e,me.useDeprecatedSynchronousErrorHandling&&be&&(be.errorThrown=!0,be.error=t)):fe(e)}function Pe(e,t){var r=me.onStoppedNotification;r&&he.setTimeout((function(){return r(e,t)}))}var Ae={closed:!0,next:pe,error:function(e){throw e},complete:pe},Ie="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ce(e){return e}var Me=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this,i=function(e){return e&&e instanceof we||function(e){return e&&ie(e.next)&&ie(e.error)&&ie(e.complete)}(e)&&ue(e)}(e)?e:new Se(e,t,r);return ge((function(){var e=n,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?n._subscribe(i):n._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Oe(t))((function(t,n){var i=new Se({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ie]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?Ce:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=Oe(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Oe(e){var t;return null!==(t=null!=e?e:me.Promise)&&void 0!==t?t:Promise}var $e=ae((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ne=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return X(t,e),t.prototype.lift=function(e){var t=new ze(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new $e},t.prototype.next=function(e){var t=this;ge((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=ee(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;ge((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ge((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,a=r.observers;return n||i?ce:(this.currentObservers=null,a.push(e),new le((function(){t.currentObservers=null,oe(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},t.prototype.asObservable=function(){var e=new Me;return e.source=this,e},t.create=function(e,t){return new ze(e,t)},t}(Me),ze=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return X(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:ce},t}(Ne),je=ae((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Le(e,t){var r="object"==typeof t;return new Promise((function(n,i){var a=new Se({next:function(e){n(e),a.unsubscribe()},error:i,complete:function(){r?n(t.defaultValue):i(new je)}});e.subscribe(a)}))}function De(e){return function(t){if(function(e){return ie(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Re(e,t,r,n,i){return new Fe(e,t,r,n,i)}var Fe=function(e){function t(t,r,n,i,a,s){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=s,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return X(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(we);function _e(e,t){return De((function(r,n){var i=0;r.subscribe(Re(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}function Be(e,t){return De((function(r,n){var i=0;r.subscribe(Re(n,(function(r){n.next(e.call(t,r,i++))})))}))}var Ve=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ue(e){return ie(null==e?void 0:e.then)}function He(e){return ie(e[Ie])}function Ye(e){return Symbol.asyncIterator&&ie(null==e?void 0:e[Symbol.asyncIterator])}function qe(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Ke="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function We(e){return ie(null==e?void 0:e[Ke])}function Ge(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof ne?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}var r}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return Z(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,ne(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,ne(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,ne(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Je(e){return ie(null==e?void 0:e.getReader)}function Qe(e){if(e instanceof Me)return e;if(null!=e){if(He(e))return i=e,new Me((function(e){var t=i[Ie]();if(ie(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ve(e))return t=e,new Me((function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()}));if(Ue(e))return n=e,new Me((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,fe)}));if(Ye(e))return Xe(e);if(We(e))return r=e,new Me((function(e){var t,n;try{for(var i=ee(r),a=i.next();!a.done;a=i.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()}));if(Je(e))return Xe(Ge(e))}var t,r,n,i;throw qe(e)}function Xe(e){return new Me((function(t){(function(e,t){var r,n,i,a,s,o,l,c;return s=this,o=void 0,c=function(){var s,o;return Z(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=ee(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,r.next()];case 2:if((n=l.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(r,n)}i((c=c.apply(s,o||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ze(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var a=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(a),!i)return a}function et(e,t,r){return void 0===r&&(r=1/0),ie(t)?et((function(r,n){return Be((function(e,i){return t(r,e,n,i)}))(Qe(e(r,n)))}),r):("number"==typeof t&&(r=t),De((function(t,n){return function(e,t,r,n,i,a,s,o){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<n?f(e):l.push(e)},f=function(e){c++;var i=!1;Qe(r(e,u++)).subscribe(Re(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<n;)e=void 0,e=l.shift(),f(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(Re(t,h,(function(){d=!0,m()}))),function(){}}(t,n,e,r)})))}const tt=(0,n.memo)((function(){return n.createElement("svg",{className:"svg-defs",width:"0",height:"0"},n.createElement("defs",null,n.createElement("linearGradient",{id:"apple-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"36",y1:"2.2858",x2:"36",y2:"72.455",gradientTransform:"matrix(1 0 0 -1 0 74.0068)"},n.createElement("stop",{offset:"0",style:{stopColor:"#fa233b"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#fb5c74"}})),n.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},n.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))))}));function rt({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),n.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),n.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"calendar":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"}));case"shuffle":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z"}));case"info":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},n.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},n.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return n.createElement("svg",{className:t,viewBox:"0 0 64 64"},n.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"genre":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"m12 2-5.5 9h11z"}),n.createElement("circle",{stroke:"none",cx:"17.5",cy:"17.5",r:"4.5"}),n.createElement("path",{stroke:"none",d:"M3 13.5h8v8H3z"}));case"star":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),n.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return n.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M4 8h5v5h-5v-5z"}),n.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),n.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"http":case"https":case"globe":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"network":return n.createElement("svg",{className:t,viewBox:"0 0 640 512"},n.createElement("path",{d:"M256 64H384v64H256V64zM240 0c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48h48v32H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96v32H80c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H240c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H192V288H448v32H400c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H560c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H512V288h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V192h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48H240zM96 448V384H224v64H96zm320-64H544v64H416V384z"}));case"data":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{d:"M19.88 18.47c.44-.7.7-1.51.7-2.39 0-2.49-2.01-4.5-4.5-4.5s-4.5 2.01-4.5 4.5 2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21.58 23 23 21.58l-3.12-3.11zm-3.8.11c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zm-.36-8.5c-.74.02-1.45.18-2.1.45l-.55-.83-3.8 6.18-3.01-3.52-3.63 5.81L1 17l5-8 3 3.5L13 6l2.72 4.08zm2.59.5c-.64-.28-1.33-.45-2.05-.49L21.38 2 23 3.18l-4.69 7.4z"}));case"visualizer":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),n.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},n.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125) translate(0 1)"},n.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},n.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return n.createElement("svg",{className:t,viewBox:"0 0 384 512"},n.createElement("path",{stroke:"none",d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),n.createElement("rect",{x:"177",y:"220",width:"40",height:"210",stroke:"none"}),n.createElement("rect",{x:"87",y:"310",width:"210",height:"40",stroke:"none"}));case"playlist":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},n.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return n.createElement("svg",{className:t,viewBox:"0 0 73 73"},n.createElement("rect",{className:"icon-apple-inner",x:"10",y:"10",width:"53",height:"53"}),n.createElement("path",{className:"icon-apple-outer",fillRule:"evenodd",clipRule:"evenodd",stroke:"none",d:"M72,19.94c0-0.72-0.01-1.45-0.03-2.17c-0.04-1.58-0.14-3.17-0.42-4.73c-0.28-1.58-0.75-3.06-1.48-4.5\r\n\t\t\tc-0.72-1.41-1.66-2.71-2.78-3.83c-1.12-1.12-2.42-2.06-3.83-2.78c-1.44-0.73-2.91-1.2-4.49-1.48c-1.56-0.28-3.15-0.37-4.73-0.42\r\n\t\t\tC53.51,0.02,52.78,0.01,52.06,0c-0.86,0-1.72,0-2.58,0H22.52c-0.86,0-1.72,0-2.58,0c-0.72,0-1.45,0.01-2.17,0.03\r\n\t\t\tc-1.58,0.04-3.17,0.14-4.73,0.42C11.46,0.74,9.98,1.2,8.55,1.94C7.13,2.66,5.84,3.6,4.72,4.72S2.65,7.13,1.93,8.55\r\n\t\t\tc-0.73,1.44-1.2,2.91-1.48,4.5c-0.28,1.56-0.37,3.15-0.42,4.73C0.02,18.5,0.01,19.22,0,19.94c0,0.86,0,1.72,0,2.58v26.95\r\n\t\t\tc0,0.86,0,1.72,0,2.58c0,0.72,0.01,1.45,0.03,2.17c0.04,1.58,0.14,3.17,0.42,4.73c0.28,1.58,0.75,3.06,1.48,4.5\r\n\t\t\tc0.72,1.41,1.66,2.71,2.78,3.83s2.42,2.06,3.83,2.78c1.44,0.73,2.91,1.2,4.49,1.48c1.56,0.28,3.15,0.37,4.73,0.42\r\n\t\t\tc0.72,0.02,1.45,0.03,2.17,0.03c0.86,0.01,1.72,0,2.58,0h26.95c0.86,0,1.72,0,2.58,0c0.72,0,1.45-0.01,2.17-0.03\r\n\t\t\tc1.58-0.04,3.17-0.14,4.73-0.42c1.58-0.28,3.06-0.75,4.49-1.48c1.41-0.72,2.71-1.66,3.83-2.78c1.12-1.12,2.06-2.41,2.78-3.83\r\n\t\t\tc0.73-1.44,1.2-2.91,1.48-4.5c0.28-1.56,0.37-3.15,0.42-4.73c0.02-0.72,0.03-1.45,0.03-2.17c0.01-0.86,0-1.72,0-2.58V22.52\r\n\t\t\tC72,21.66,72,20.8,72,19.94z M52.71,46.85c0,0.91-0.01,1.74-0.2,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.73-2.5,0.91c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.68-2.6-1.32\r\n\t\t\tc-1.03-0.95-1.68-2.23-1.82-3.56c-0.16-1.57,0.36-3.24,1.53-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.43-0.52,0.43-1.16,0.43-1.78V24.32c0-1.21-0.54-1.54-1.7-1.32\r\n\t\t\tc-0.83,0.16-18.62,3.75-18.62,3.75c-1,0.24-1.36,0.57-1.36,1.82v23.23c0,0.91-0.05,1.74-0.24,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.74-2.5,0.92c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.69-2.6-1.33\r\n\t\t\tc-1.03-0.95-1.63-2.23-1.78-3.56c-0.16-1.57,0.31-3.24,1.49-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.42-0.52,0.47-1.13,0.47-1.75c0-4.92,0-26.78,0-26.78\r\n\t\t\tc0-0.36,0.03-0.6,0.05-0.72c0.09-0.56,0.31-1.05,0.72-1.39c0.34-0.28,0.78-0.48,1.33-0.6l0.01,0L49,11.33\r\n\t\t\tc0.19-0.04,1.73-0.31,1.91-0.33c1.16-0.1,1.81,0.66,1.81,1.89L52.71,46.85L52.71,46.85z"}));case"emby":return n.createElement("svg",{className:t,viewBox:"0 0 48 48"},n.createElement("path",{className:"icon-emby-outer",stroke:"none",d:"m9.104 12.415 2.482 2.482L0 26.484l12.414 12.414 2.483-2.483 11.586 11.586L39.725 34.76l-2.483-2.483L48 21.518 35.587 9.104l-2.483 2.483L21.517 0z"}),n.createElement("path",{className:"icon-emby-inner",stroke:"none",d:"M18.45 32.929v-18.1l15.86 9.05-7.93 4.525z"}));case"plex":return n.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},n.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),n.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"plex-tidal":case"tidal":return n.createElement("svg",{className:t,viewBox:"0 0 560 560"},n.createElement("path",{className:"icon-tidal-inner",d:"M373.331 186.32l-93.324 93.332-93.337-93.341L280.007 93l93.332 93.309L466.67 93 560 186.318l-93.33 93.341-93.339-93.339zm.01 186.669l-93.334 93.34-93.337-93.34 93.337-93.337 93.334 93.337zm-186.67-186.67l-93.338 93.34L0 186.32 93.333 93l93.337 93.318z",fillRule:"nonzero"}));case"jellyfin":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),n.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return n.createElement("svg",{className:t,viewBox:"0 0 168 168"},n.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return n.createElement("svg",{className:t,viewBox:"0 0 455 455"},n.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),n.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return n.createElement("svg",{className:t,viewBox:"0 0 27 30"},n.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),n.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"navidrome":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 10.449C120.275 10.449 10.449 120.276 10.449 256c0 135.725 109.826 245.551 245.551 245.551S501.551 391.725 501.551 256C501.551 120.276 391.725 10.449 256 10.449z"}),n.createElement("path",{fill:"#fff",d:"M256 168.229c-48.515.0-87.771 39.257-87.771 87.771s39.257 87.771 87.771 87.771 87.771-39.257 87.771-87.771S304.515 168.229 256 168.229z"}),n.createElement("path",{fill:"black",d:"M437.061 74.94C388.735 26.615 324.434.0 256 0S123.265 26.615 74.939 74.94.0 187.566.0 256s26.614 132.735 74.939 181.061S187.566 512 256 512s132.735-26.614 181.061-74.939S512 324.434 512 256 485.386 123.266 437.061 74.94zM256 491.102C126.365 491.102 20.898 385.635 20.898 256S126.365 20.898 256 20.898 491.102 126.365 491.102 256 385.635 491.102 256 491.102z"}),n.createElement("path",{fill:"black",d:"M354.22 256c0-54.158-44.061-98.22-98.22-98.22s-98.22 44.062-98.22 98.22 44.062 98.22 98.22 98.22 98.22-44.061 98.22-98.22zm-175.542.0c0-42.636 34.686-77.322 77.322-77.322s77.322 34.686 77.322 77.322S298.636 333.322 256 333.322 178.678 298.636 178.678 256z"}),n.createElement("path",{fill:"black",d:"M285.257 256c0-16.132-13.124-29.257-29.257-29.257S226.743 239.868 226.743 256s13.125 29.257 29.257 29.257S285.257 272.133 285.257 256zm-37.616.0c0-4.609 3.75-8.359 8.359-8.359 4.609.0 8.359 3.75 8.359 8.359.0 4.609-3.75 8.359-8.359 8.359C251.391 264.359 247.641 260.609 247.641 256z"}),n.createElement("path",{fill:"black",d:"M256 391.837c-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c41.897.0 81.265-16.294 110.853-45.883 29.587-29.587 45.881-68.955 45.881-110.852.0-5.771-4.678-10.449-10.449-10.449s-10.449 4.678-10.449 10.449C391.837 330.9 330.9 391.837 256 391.837z"}),n.createElement("path",{fill:"black",d:"M449.306 245.551c-5.771.0-10.449 4.678-10.449 10.449.0 1.481-.018 2.958-.052 4.43-.136 5.769 4.43 10.557 10.199 10.692.085.002.168.003.252.003 5.656.0 10.307-4.517 10.442-10.202.039-1.637.059-3.279.059-4.925C459.755 250.229 455.077 245.551 449.306 245.551z"}),n.createElement("path",{fill:"black",d:"M447.55 284.239c-5.656-1.145-11.168 2.52-12.308 8.178-17.107 84.854-92.489 146.44-179.242 146.44-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c47.353.0 93.467-16.573 129.847-46.668 35.9-29.697 60.717-71.084 69.881-116.54C456.868 290.891 453.207 285.38 447.55 284.239z"}),n.createElement("path",{fill:"black",d:"M256 120.163c5.771.0 10.449-4.678 10.449-10.449S261.771 99.265 256 99.265c-41.897.0-81.265 16.294-110.853 45.883C115.559 174.735 99.265 214.103 99.265 256c0 5.771 4.678 10.449 10.449 10.449s10.449-4.678 10.449-10.449c0-74.9 60.937-135.837 135.837-135.837z"}),n.createElement("path",{fill:"black",d:"M62.996 240.876c-5.759-.14-10.557 4.43-10.692 10.199-.039 1.637-.059 3.279-.059 4.925.0 5.771 4.678 10.449 10.449 10.449S73.143 261.771 73.143 256c0-1.481.018-2.958.052-4.43C73.331 245.8 68.765 241.013 62.996 240.876z"}),n.createElement("path",{fill:"black",d:"M256 73.143c5.771.0 10.449-4.678 10.449-10.449S261.771 52.245 256 52.245c-47.353.0-93.467 16.573-129.847 46.668-35.9 29.697-60.717 71.084-69.881 116.54-1.14 5.657 2.521 11.168 8.178 12.308.697.141 1.392.208 2.076.208 4.872.0 9.232-3.426 10.232-8.386C93.864 134.729 169.247 73.143 256 73.143z"}));case"subsonic":return n.createElement("svg",{className:t,viewBox:"0 0 700 700",transform:"scale(1.125) translate(0 -1)"},n.createElement("path",{d:"M202 108.1c-7 1.1-8.5 1.6-12.3 4.1-2.7 1.7-3.6 3.1-3.9 5.7-.5 3.8-.1 54.1.6 75.1.2 7.4.5 19.3.6 26.4l.2 12.8-5.8 6-5.9 5.9.2 26.8.2 26.8-20.7 10-20.7 10-5-1.9c-8.5-3.4-21.9-6.6-30.1-7.3-4.4-.4-8.2-.9-8.5-1.1-1.4-.8-1.8 2.8-1.9 16.7-.2 15.1-.2 15.7-1.4 22.9-1.1 5.9-19.2 61.8-21.1 64.6-.7 1.1-4 3.1-7.2 4.3-14.4 5.6-18.6 7.5-21.3 10.1-1.9 1.8-2.8 3.4-2.4 4.4.3.9 5.2 4.2 10.8 7.3 15.6 8.7 17.2 10.2 19.7 18.6 5.3 18.1 9.5 26.3 18.9 37.2 3.3 3.8 6 7.2 6 7.5-.1.3-4 5.5-8.8 11.7-12.8 16.4-17.5 26.8-15.8 35.5 2.9 15.5 33.8 17.4 61.6 3.8 3-1.5 8.6-4.4 12.3-6.5 8.2-4.5 10.7-4.5 26.7.9 15.8 5.2 42 13 55.5 16.5 12.7 3.3 48 11.6 53.3 12.6 1.8.3 7.6 1.4 12.9 2.4 5.4 1.1 11.8 2.2 14.3 2.6 2.5.3 5.2.8 6 1 .8.3 4.7.9 8.5 1.5 3.9.5 7.9 1.1 9 1.4 2.2.4 12.8 1.8 16 2.1 1.1.1 4.7.5 8 .9s8 .9 10.5 1.2c2.5.2 6.5.6 9 .8 26.9 3 67.6 3.5 94.5 1.1 5.6-.5 7.7-.8 18-1.9 33.3-3.9 71.6-15.5 96.4-29.3 29.7-16.4 55.6-43.4 71.2-74 5.5-11 10.6-25.6 11.4-33.3.2-1.4.6-5.1 1-8.3l.8-5.7-9.9.5c-15.4.8-22.7 1.6-30.4 3-8.1 1.5-18.5 3.9-28 6.5-18.5 4.9-45.6 11.8-48.6 12.4-25.6 4.6-31 5.4-49.9 7.1-33.9 3-91.7 2.2-110.2-1.6-5.7-1.1-7.1-2.8-2.5-3 1.5 0 6.3-.2 10.7-.4 4.4-.2 19.3-.6 33-1 13.8-.3 26.8-.7 29-.9 2.2-.2 8-.7 12.9-1.1 4.9-.4 9.7-.8 10.6-1 .9-.2 4.1-.6 7.1-1 25.9-3.2 56.5-10.2 86.5-19.9 27.8-8.9 29.5-9.4 42.4-12 11.9-2.4 28.3-2.8 42.9-1.1l6.4.7-.7-3.3c-5.5-26.1-11.7-40.2-24.9-56.6-8.1-10.2-23-25.1-33.7-33.6-7.6-6.1-24.8-17.9-40.6-27.7-3.6-2.2-6.3-4.8-7.5-7.2-2.9-5.6-4.6-6.1-18.1-5.5-6.5.4-12.2.8-12.6 1.1-.4.2-3.9.7-7.9 1-4 .4-7.8.8-8.5 1.1-.7.2-3.1.6-5.3.9-9.3 1.2-39 5.7-46.5 7.1-1.4.2-5 .7-8 1.1-3 .3-6.6.7-8 .9-12.7 1.8-124.9 2.7-145 1.2-4.1-.3-8.6-.6-10-.6-4.3-.2-.8-1.9 5-2.6 3-.3 7.3-.8 9.5-1 2.2-.2 8.1-.7 13-1 5-.4 11.5-.8 14.5-1 3-.2 10.2-.7 16-1 5.8-.3 12.6-.8 15.2-1 2.5-.2 9-.6 14.5-1 5.4-.3 11.4-.8 13.3-.9 2-.2 7.6-.7 12.5-1.1 4.9-.4 9.6-.8 10.4-1 .9-.1 4.3-.6 7.6-.9 8.5-1 11.9-1.5 21.5-3.3 4.7-.8 9.6-1.7 10.9-2 1.4-.2 2.8-.6 3.1-.8.4-.2 2.1-.7 3.9-1 3.5-.6 17.4-5.2 25.6-8.4l5-1.9-.3-15.4c-.2-8.4-.5-15.4-.7-15.6-.1-.2-4-1.2-8.6-2.3-4.6-1.1-9.1-2.2-9.9-2.4-28.8-7-45.7-10.2-53-9.9-6.2.1-11.3.9-32.1 4.9-.9.2-4 .6-6.9 1-2.9.4-6.2.9-7.4 1.1-12.1 2.3-54.6 2.2-66.8-.1-1.3-.3-4.5-.9-7.3-1.4-6-1.1-10.1-2.6-10.9-4-1.2-1.9-1.3-1.9 28.4-3.6 4.7-.3 11.9-.7 16-1 4.1-.3 11.8-.7 17-1 9.9-.6 17.6-1.2 24.5-2 2.2-.3 6-.7 8.5-.9 6.9-.8 14.4-2.4 18.1-3.9l3.3-1.3-4.8-3.6c-5.2-4-13-6.9-24.6-9.2-7-1.4-9.5-1.7-22.5-3.2-24.4-2.8-62.6-1.6-81.7 2.6-10.8 2.3-15.4 4.7-22.9 11.6-3.2 3-6.5 5.4-7.3 5.4-1 0-1.7-3-2.6-11.3-.7-6.1-1.4-12.3-1.5-13.7-.2-1.4-.6-6.1-.9-10.5-.4-4.4-.8-9.6-1.1-11.5-.2-1.9-.7-6.7-1-10.5-.8-10.5-2.1-24.4-3.1-32.5-2.1-18.3-2.6-19.4-9.6-21.4-7.1-2-10.5-2.3-15.8-1.5zm-82.2 305.3c6.5 4 7.5 42.2 1.5 54.3-2.7 5.4-4.5 6.1-8.1 3.2-6.2-5-6.6-6.7-6.8-26.2-.2-21.4.4-25.1 5.1-29.4 3.3-3.2 5.5-3.7 8.3-1.9zm75.2 3.1c7.6 3.9 12.1 14.6 12.5 29.5.6 19.9-4.7 34.4-13.7 37.9-2.1.8-3.5.5-7-1.2-8.2-4.2-12.1-13.8-12.2-30.7-.1-13.6 1.2-20.2 5.8-27.9 2.3-4.1 3.2-5 6.6-7.4 3-2.1 4.3-2.1 8-.2zm106.7 1.7c14 7 21.7 24.1 20.9 46.8-.3 8.1-1 12.3-3 18.4-4.9 14.4-11.3 20.8-22 22-10.9 1.3-20.2-7.4-25.9-24.4-7.9-23.4.8-54.6 17.5-62.9 5.4-2.6 7-2.6 12.5.1z"}));case"youtube":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},n.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),n.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},n.createElement("title",null,"Lookup scheduled"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},n.createElement("title",null,"Searching…"),n.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},n.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},n.createElement("title",null,"Not found"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"apple-logo":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{fillRule:"nonzero",d:"M11.624 7.222c-.876 0-2.232-.996-3.66-.96-1.884.024-3.612 1.092-4.584 2.784-1.956 3.396-.504 8.412 1.404 11.172.936 1.344 2.04 2.856 3.504 2.808 1.404-.06 1.932-.912 3.636-.912 1.692 0 2.172.912 3.66.876 1.512-.024 2.472-1.368 3.396-2.724 1.068-1.56 1.512-3.072 1.536-3.156-.036-.012-2.94-1.128-2.976-4.488-.024-2.808 2.292-4.152 2.4-4.212-1.32-1.932-3.348-2.148-4.056-2.196-1.848-.144-3.396 1.008-4.26 1.008zm3.12-2.832c.78-.936 1.296-2.244 1.152-3.54-1.116.048-2.46.744-3.264 1.68-.72.828-1.344 2.16-1.176 3.432 1.236.096 2.508-.636 3.288-1.572z"}));case"error":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"11"}),n.createElement("circle",{cx:"12",cy:"12",r:"6",stroke:"none",fill:"white"}),n.createElement("path",{stroke:"none",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))}}function nt(){return n.createElement("h1",{className:"app-title"},n.createElement("span",{className:"app-name"},n.createElement(rt,{className:"app-icon",name:"ampcast"}),n.createElement("span",{className:"app-text"},"ampcast"))," ",n.createElement("span",{className:"app-version"},"0.9.5"))}var it=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return X(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Ne);function at(e,t,r){var n=ie(e)||t||r?{next:e,error:t,complete:r}:e;return n?De((function(e,t){var r;null===(r=n.subscribe)||void 0===r||r.call(n);var i=!0;e.subscribe(Re(t,(function(e){var r;null===(r=n.next)||void 0===r||r.call(n,e),t.next(e)}),(function(){var e;i=!1,null===(e=n.complete)||void 0===e||e.call(n),t.complete()}),(function(e){var r;i=!1,null===(r=n.error)||void 0===r||r.call(n,e),t.error(e)}),(function(){var e,t;i&&(null===(e=n.unsubscribe)||void 0===e||e.call(n)),null===(t=n.finalize)||void 0===t||t.call(n)})))})):Ce}function st(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");const r=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function ot(e){return Math.min(1,Math.max(0,e))}function lt(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function ct(e){return Number(e)<=1?100*Number(e)+"%":e}function ut(e){return 1===e.length?"0"+e:String(e)}function dt(e,t,r){e=st(e,255),t=st(t,255),r=st(r,255);const n=Math.max(e,t,r),i=Math.min(e,t,r);let a=0,s=0;const o=(n+i)/2;if(n===i)s=0,a=0;else{const l=n-i;switch(s=o>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{h:a,s,l:o}}function mt(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*r*(t-e):r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ht(e,t,r){e=st(e,255),t=st(t,255),r=st(r,255);const n=Math.max(e,t,r),i=Math.min(e,t,r);let a=0;const s=n,o=n-i,l=0===n?0:o/n;if(n===i)a=0;else{switch(n){case e:a=(t-r)/o+(t<r?6:0);break;case t:a=(r-e)/o+2;break;case r:a=(e-t)/o+4}a/=6}return{h:a,s:l,v:s}}function ft(e,t,r,n){const i=[ut(Math.round(e).toString(16)),ut(Math.round(t).toString(16)),ut(Math.round(r).toString(16))];return n&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function pt(e){return yt(e)/255}function yt(e){return parseInt(e,16)}const vt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};const bt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",gt="[\\s|\\(]+("+bt+")[,|\\s]+("+bt+")[,|\\s]+("+bt+")\\s*\\)?",wt="[\\s|\\(]+("+bt+")[,|\\s]+("+bt+")[,|\\s]+("+bt+")[,|\\s]+("+bt+")\\s*\\)?",Et={CSS_UNIT:new RegExp(bt),rgb:new RegExp("rgb"+gt),rgba:new RegExp("rgba"+wt),hsl:new RegExp("hsl"+gt),hsla:new RegExp("hsla"+wt),hsv:new RegExp("hsv"+gt),hsva:new RegExp("hsva"+wt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function kt(e){return Boolean(Et.CSS_UNIT.exec(String(e)))}class xt{constructor(e="",t={}){if(e instanceof xt)return e;"number"==typeof e&&(e=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(e)),this.originalInput=e;const r=function(e){let t={r:0,g:0,b:0},r=1,n=null,i=null,a=null,s=!1,o=!1;var l,c,u;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;let t=!1;if(vt[e])e=vt[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};let r=Et.rgb.exec(e);return r?{r:r[1],g:r[2],b:r[3]}:(r=Et.rgba.exec(e),r?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=Et.hsl.exec(e),r?{h:r[1],s:r[2],l:r[3]}:(r=Et.hsla.exec(e),r?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=Et.hsv.exec(e),r?{h:r[1],s:r[2],v:r[3]}:(r=Et.hsva.exec(e),r?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=Et.hex8.exec(e),r?{r:yt(r[1]),g:yt(r[2]),b:yt(r[3]),a:pt(r[4]),format:t?"name":"hex8"}:(r=Et.hex6.exec(e),r?{r:yt(r[1]),g:yt(r[2]),b:yt(r[3]),format:t?"name":"hex"}:(r=Et.hex4.exec(e),r?{r:yt(r[1]+r[1]),g:yt(r[2]+r[2]),b:yt(r[3]+r[3]),a:pt(r[4]+r[4]),format:t?"name":"hex8"}:(r=Et.hex3.exec(e),!!r&&{r:yt(r[1]+r[1]),g:yt(r[2]+r[2]),b:yt(r[3]+r[3]),format:t?"name":"hex"})))))))))}(e)),"object"==typeof e&&(kt(e.r)&&kt(e.g)&&kt(e.b)?(l=e.r,c=e.g,u=e.b,t={r:255*st(l,255),g:255*st(c,255),b:255*st(u,255)},s=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):kt(e.h)&&kt(e.s)&&kt(e.v)?(n=ct(e.s),i=ct(e.v),t=function(e,t,r){e=6*st(e,360),t=st(t,100),r=st(r,100);const n=Math.floor(e),i=e-n,a=r*(1-t),s=r*(1-i*t),o=r*(1-(1-i)*t),l=n%6;return{r:255*[r,s,a,a,o,r][l],g:255*[o,r,r,s,a,a][l],b:255*[a,a,o,r,r,s][l]}}(e.h,n,i),s=!0,o="hsv"):kt(e.h)&&kt(e.s)&&kt(e.l)&&(n=ct(e.s),a=ct(e.l),t=function(e,t,r){let n,i,a;if(e=st(e,360),t=st(t,100),r=st(r,100),0===t)i=r,a=r,n=r;else{const s=r<.5?r*(1+t):r+t-r*t,o=2*r-s;n=mt(o,s,e+1/3),i=mt(o,s,e),a=mt(o,s,e-1/3)}return{r:255*n,g:255*i,b:255*a}}(e.h,n,a),s=!0,o="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(r=e.a)),r=lt(r),{ok:s,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}(e);this.originalInput=e,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=t.format??r.format,this.gradientType=t.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3}getLuminance(){const e=this.toRgb();let t,r,n;const i=e.r/255,a=e.g/255,s=e.b/255;return t=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),r=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),n=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),.2126*t+.7152*r+.0722*n}getAlpha(){return this.a}setAlpha(e){return this.a=lt(e),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:e}=this.toHsl();return 0===e}toHsv(){const e=ht(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}}toHsvString(){const e=ht(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.v);return 1===this.a?`hsv(${t}, ${r}%, ${n}%)`:`hsva(${t}, ${r}%, ${n}%, ${this.roundA})`}toHsl(){const e=dt(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}}toHslString(){const e=dt(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.l);return 1===this.a?`hsl(${t}, ${r}%, ${n}%)`:`hsla(${t}, ${r}%, ${n}%, ${this.roundA})`}toHex(e=!1){return ft(this.r,this.g,this.b,e)}toHexString(e=!1){return"#"+this.toHex(e)}toHex8(e=!1){return function(e,t,r,n,i){const a=[ut(Math.round(e).toString(16)),ut(Math.round(t).toString(16)),ut(Math.round(r).toString(16)),ut((s=n,Math.round(255*parseFloat(s)).toString(16)))];var s;return i&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))&&a[3].startsWith(a[3].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}(this.r,this.g,this.b,this.a,e)}toHex8String(e=!1){return"#"+this.toHex8(e)}toHexShortString(e=!1){return 1===this.a?this.toHexString(e):this.toHex8String(e)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),r=Math.round(this.b);return 1===this.a?`rgb(${e}, ${t}, ${r})`:`rgba(${e}, ${t}, ${r}, ${this.roundA})`}toPercentageRgb(){const e=e=>`${Math.round(100*st(e,255))}%`;return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}}toPercentageRgbString(){const e=e=>Math.round(100*st(e,255));return 1===this.a?`rgb(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%)`:`rgba(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%, ${this.roundA})`}toName(){if(0===this.a)return"transparent";if(this.a<1)return!1;const e="#"+ft(this.r,this.g,this.b,!1);for(const[t,r]of Object.entries(vt))if(e===r)return t;return!1}toString(e){const t=Boolean(e);e=e??this.format;let r=!1;const n=this.a<1&&this.a>=0;return t||!n||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex4"===e&&(r=this.toHex8String(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new xt(this.toString())}lighten(e=10){const t=this.toHsl();return t.l+=e/100,t.l=ot(t.l),new xt(t)}brighten(e=10){const t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(-e/100*255))),t.g=Math.max(0,Math.min(255,t.g-Math.round(-e/100*255))),t.b=Math.max(0,Math.min(255,t.b-Math.round(-e/100*255))),new xt(t)}darken(e=10){const t=this.toHsl();return t.l-=e/100,t.l=ot(t.l),new xt(t)}tint(e=10){return this.mix("white",e)}shade(e=10){return this.mix("black",e)}desaturate(e=10){const t=this.toHsl();return t.s-=e/100,t.s=ot(t.s),new xt(t)}saturate(e=10){const t=this.toHsl();return t.s+=e/100,t.s=ot(t.s),new xt(t)}greyscale(){return this.desaturate(100)}spin(e){const t=this.toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,new xt(t)}mix(e,t=50){const r=this.toRgb(),n=new xt(e).toRgb(),i=t/100,a={r:(n.r-r.r)*i+r.r,g:(n.g-r.g)*i+r.g,b:(n.b-r.b)*i+r.b,a:(n.a-r.a)*i+r.a};return new xt(a)}analogous(e=6,t=30){const r=this.toHsl(),n=360/t,i=[this];for(r.h=(r.h-(n*e>>1)+720)%360;--e;)r.h=(r.h+n)%360,i.push(new xt(r));return i}complement(){const e=this.toHsl();return e.h=(e.h+180)%360,new xt(e)}monochromatic(e=6){const t=this.toHsv(),{h:r}=t,{s:n}=t;let{v:i}=t;const a=[],s=1/e;for(;e--;)a.push(new xt({h:r,s:n,v:i})),i=(i+s)%1;return a}splitcomplement(){const e=this.toHsl(),{h:t}=e;return[this,new xt({h:(t+72)%360,s:e.s,l:e.l}),new xt({h:(t+216)%360,s:e.s,l:e.l})]}onBackground(e){const t=this.toRgb(),r=new xt(e).toRgb(),n=t.a+r.a*(1-t.a);return new xt({r:(t.r*t.a+r.r*r.a*(1-t.a))/n,g:(t.g*t.a+r.g*r.a*(1-t.a))/n,b:(t.b*t.a+r.b*r.a*(1-t.a))/n,a:n})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(e){const t=this.toHsl(),{h:r}=t,n=[this],i=360/e;for(let a=1;a<e;a++)n.push(new xt({h:(r+a*i)%360,s:t.s,l:t.l}));return n}equals(e){return this.toRgbString()===new xt(e).toRgbString()}}const St=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),Tt=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),Pt=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),At=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),It=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),Ct=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),Mt=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),Ot=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),$t=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),Nt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),zt=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),jt=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),Lt=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),Dt=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),Rt={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},Ft=Object.assign(Object.assign({},Rt),Pt),_t=[Ft,St,Tt,It,Ct,Mt,Ot,$t,Nt,zt,jt,Lt,Dt,At];var Bt=r(9520),Vt=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ut=new H("themeStore");class Ht extends Bt.ZP{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(_t.map((e=>[e.name,e]))),this.themes$=new it([]),this.version(1).stores({themes:"&name"}),(0,Bt.Y1)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return Vt(this,void 0,void 0,(function*(){try{Ut.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){Ut.error(e)}}))}remove(e){return Vt(this,void 0,void 0,(function*(){try{Ut.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){Ut.error(e)}}))}rename(e,t){return Vt(this,void 0,void 0,(function*(){try{const r=yield this.themes.get(e);if(!r)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},r),{name:t,userTheme:!0}))}catch(e){Ut.error(e)}}))}}const Yt=new Ht,qt=new H("theme"),Kt=new class{constructor(){this.defaultFontSize=17.2,this.storage=new J("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new it(Ft),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe(at((()=>this.applyAppStyles()))).subscribe(qt)}observe(){return this.theme$.pipe(_e((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new xt(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new xt(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new xt(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new xt(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new xt(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?Yt.getUserTheme(this.name):Yt.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new xt(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new xt(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){var t;this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley(),null===(t=window.ampcastElectron)||void 0===t||t.setFontSize(e)}get frameColor(){return this.current.frameColor}set frameColor(e){var t;this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor,null===(t=window.ampcastElectron)||void 0===t||t.setFrameColor(e)}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){var t;this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor,null===(t=window.ampcastElectron)||void 0===t||t.setFrameTextColor(e)}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new xt(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new xt(this.backgroundColor).isDark()}get isLight(){return new xt(this.backgroundColor).isLight()}get isButtonDark(){return new xt(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new xt(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new xt(this.frameColor).isDark()}get isFrameLight(){return new xt(this.frameColor).isLight()}get isFrameTextDark(){return new xt(this.frameTextColor).isDark()}get isFrameTextLight(){return new xt(this.frameTextColor).isLight()}get isMediaButtonLight(){return new xt(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new xt(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new xt(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new xt(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new xt(this.selectedBackgroundColor).isLight()}get isTextDark(){return new xt(this.textColor).isDark()}get isTextLight(){return new xt(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new xt(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){var t;this.applyingUpdate=!0;const r=Object.assign(Object.assign(Object.assign({},Rt),{userTheme:void 0}),e);this.frameColor=r.frameColor,this.frameTextColor=r.frameTextColor,Object.assign(this,r),this.applyingUpdate=!1,this.theme$.next(this.current),null===(t=window.ampcastElectron)||void 0===t||t.setTheme(this.current)}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",Ft);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},r={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((r=>r in e&&typeof e[r]===t[r]))&&Object.keys(e).every((n=>n in t||typeof e[n]===r[n]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,r){const n=this.toDashName(e);let i=t||r;if(i){"string"==typeof i&&(i=new xt(i));const r=i.toHsl();this.setProperty(`${n}-h`,String(r.h)),this.setProperty(`${n}-s`,100*r.s+"%"),this.setProperty(`${n}-l`,100*r.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${n}-h`,null),this.setProperty(`${n}-s`,null),this.setProperty(`${n}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new xt(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),r=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",r),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,r){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${r}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:r}){return t=Math.min(Math.max(t,0),1),r=Math.min(Math.max(r,0),1),new xt({h:e,s:t,l:r}).toHexString()}};function Wt(e,t,r="content-box"){const i=(0,n.useRef)(t);(0,n.useEffect)((()=>{i.current=t}),[t]),(0,n.useEffect)((()=>{const t=e.current;if(t){const n=new ResizeObserver((t=>{const n=e.current;if(n){const e=t.find((e=>e.target===n));if(e){const[{inlineSize:t=0,blockSize:n=0}={}]="border-box"===r?e.borderBoxSize:e.contentBoxSize;i.current({width:t,height:n})}}}));return n.observe(t,{box:r}),()=>n.disconnect()}}),[e,r])}const Gt=document.createElement("div");function Jt(){const e=(0,n.useRef)(Gt),[t,r]=(0,n.useState)(0);return(0,n.useEffect)((()=>{Gt.parentElement||(document.body.append(Gt),r(Qt()))}),[]),Wt(e,(()=>r(Qt()))),t}function Qt(){return parseFloat(getComputedStyle(Gt).fontSize)||Kt.defaultFontSize}function Xt({vertical:e,primary:t,size:r,children:i}){const a={};return t||(e?a.height=`${r}px`:a.width=`${r}px`),n.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}Gt.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n    z-index: -1;\n";const Zt=new J("layout"),er={get:(e,t=0)=>Zt.getNumber(e,t),set(e,t){Zt.setNumber(e,t)}};function tr(e,t){switch(t.type){case"setContainerSize":{const r=Math.max(t.containerSize,0);if(r!==e.containerSize){const{primaryMinSize:t,secondaryMinSize:n,secondaryPaneSize:i,splitterSize:a}=e;return Object.assign(Object.assign({},e),{containerSize:r,secondaryPaneSize:rr(t,n,i,a,r)})}return e}case"setSecondaryPaneSize":{const{primaryMinSize:r,secondaryMinSize:n,splitterSize:i,containerSize:a}=e,s=rr(r,n,Math.max(t.secondaryPaneSize,0),i,a);return s!==e.secondaryPaneSize?Object.assign(Object.assign({},e),{secondaryPaneSize:s}):e}case"setMinSizes":{const r=Math.max(t.primaryMinSize,0),n=Math.max(t.secondaryMinSize,0),i=Math.max(t.splitterSize,0);return r!==e.primaryMinSize||n!==e.secondaryMinSize||i!==e.splitterSize?Object.assign(Object.assign({},e),{primaryMinSize:r,secondaryMinSize:n,splitterSize:i,secondaryPaneSize:rr(r,n,e.secondaryPaneSize,i,e.containerSize)}):e}default:return e}}function rr(e,t,r,n,i){if(i>0){const a=i-n-r;if(a<e)return Math.max(r-(e-a),0);if(r<t)return Math.min(i-n-e,t)}return r}const nr={primaryMinSize:0,secondaryMinSize:0,secondaryPaneSize:0,splitterSize:0,containerSize:0};function ir({id:e,arrange:t="columns",primaryIndex:r=0,children:i}){const a=(0,n.useRef)(null),{secondaryPaneSize:s,setContainerSize:o,setSecondaryPaneSize:l,setMinSizes:c}=function(e){const t=(0,n.useMemo)((()=>Object.assign(Object.assign({},nr),{secondaryPaneSize:e?er.get(e):0})),[e]),[{secondaryPaneSize:r},i]=(0,n.useReducer)(tr,t);(0,n.useEffect)((()=>{e&&r&&er.set(e,r)}),[e,r]);const a=(0,n.useCallback)((e=>i({type:"setContainerSize",containerSize:e})),[]),s=(0,n.useCallback)((e=>i({type:"setSecondaryPaneSize",secondaryPaneSize:e})),[]),o=(0,n.useCallback)(((e,t,r)=>i({type:"setMinSizes",primaryMinSize:e,secondaryMinSize:t,splitterSize:r})),[]);return{secondaryPaneSize:r,setContainerSize:a,setSecondaryPaneSize:s,setMinSizes:o}}(e),[u,d]=(0,n.useState)(-1),[m,h]=(0,n.useState)(0),f=-1!==u,p=Jt(),y="rows"===t;(0,n.useEffect)((()=>{var e;if(p>0){let t=0,r=0,n=0;const i=a.current,s=y?"minHeight":"minWidth",o=i.querySelector(":scope > .layout-pane-primary");o&&(t=parseInt(getComputedStyle(o)[s],10)||0);const l=i.querySelector(":scope > .layout-pane-secondary");if(l){l.style[s]="",r=parseInt(getComputedStyle(l)[s],10)||0,l.style[s]="unset";const t=y?"offsetHeight":"offsetWidth",a=i.querySelector(":scope > .layout-splitter");n=null!==(e=null==a?void 0:a[t])&&void 0!==e?e:4}c(t,r,n)}}),[y,p,c]);const v=(0,n.useCallback)((e=>{if(0===e.button){const t=y?e.screenY:e.screenX;d(t),h(s),e.preventDefault()}}),[y,s]),b=(0,n.useCallback)((e=>{const t=(y?e.screenY:e.screenX)-u;l(0===r?m-t:m+t)}),[y,r,u,m,l]),g=(0,n.useCallback)((()=>{d(-1),h(0)}),[]);return(0,n.useEffect)((()=>{if(f)return document.documentElement.style.cursor=y?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",g),document.addEventListener("mousemove",b),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",g),document.removeEventListener("mousemove",b)}}),[y,f,b,g]),Wt(a,(({width:e,height:t})=>{o(y?t:e)})),n.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},n.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===r,a=i?0:s,o=[];return 1===t&&o.push(n.createElement("div",{className:"layout-splitter "+(f?"active":""),role:"separator",onMouseDown:v,key:"splitter"})),o.push(n.createElement(Xt,{vertical:y,primary:i,size:a,key:t},e)),o})))}var ar=r(3121);const sr={left:0,top:0},or=(0,n.forwardRef)((function(e,t){var{title:r,className:i="",children:a,onClose:s}=e,o=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["title","className","children","onClose"]);const l=(0,n.useRef)(null),[c,u]=(0,n.useState)(sr),[d,m]=(0,n.useState)(null),[h,f]=(0,n.useState)(sr);(0,n.useImperativeHandle)(t,(()=>({close:e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.open)&&l.current.close(e)}}))),(0,n.useEffect)((()=>{const e=l.current;ar.Z.registerDialog(e),e.showModal()}),[]);const p=(0,n.useCallback)((()=>{l.current.close()}),[]),y=(0,n.useCallback)((()=>{s(l.current.returnValue)}),[s]),v=(0,n.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l.current.close())}),[]),b=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),g=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),E=(0,n.useCallback)((e=>{f({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),k=(0,n.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),f(sr),m(null)}),[c,d]);return(0,n.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",k),document.addEventListener("mousemove",E),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",E)}}),[d,E,k]),n.createElement("dialog",Object.assign({},o,{className:`dialog ${i}`,onClose:y,onKeyDown:v,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),n.createElement("header",{className:"dialog-head",onMouseDown:g},n.createElement("h2",null,r),n.createElement("div",{className:"dialog-close",role:"button",onClick:p,onMouseDown:w,"aria-label":"Close"},n.createElement(rt,{name:"close"}))),n.createElement("div",{className:"dialog-body",onClick:b},a))}));var lr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function cr(e,t=!1){return lr(this,void 0,void 0,(function*(){return new Promise(((r,a)=>{const s=document.createElement("div"),o=(0,i.s)(s);try{const i=e=>{o.unmount(),s.remove(),r(e)};document.getElementById(document.fullscreenElement?"fullscreen-popup":t?"system":"popup").append(s),o.render(n.createElement(e,{onClose:i}))}catch(e){o.unmount(),s.remove(),a(e)}}))}))}var ur=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},dr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function mr({title:e,message:t,system:r=!1}){return ur(this,void 0,void 0,(function*(){"string"==typeof t&&(t=n.createElement("p",null,t)),yield cr((r=>n.createElement(hr,Object.assign({},r,{title:e,message:t}))),r)}))}function hr(e){var{message:t,title:r="Message"}=e,i=dr(e,["message","title"]);return n.createElement(or,Object.assign({},i,{className:"alert-dialog",title:r}),n.createElement("form",{method:"dialog"},n.createElement("div",{className:"alert-message"},t),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"OK"))))}function fr({value:e="",disabled:t,submitText:r="Confirm",onCancel:i,onSubmit:a}){return n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",{className:"dialog-button-cancel",type:"button",value:"#cancel",onClick:i},"Cancel"),n.createElement("button",{className:"dialog-button-submit",value:e,disabled:t,onClick:a},r))}var pr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},yr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const vr=new J("confirm");function br({title:e,message:t,okLabel:r,storageId:i,system:a=!1}){return pr(this,void 0,void 0,(function*(){return!(!i||!vr.getBoolean(i))||("string"==typeof t&&(t=n.createElement("p",null,t)),"confirmed"===(yield cr((a=>n.createElement(gr,Object.assign({},a,{title:e,message:t,okLabel:r,storageId:i}))),a)))}))}function gr(e){var{title:t="Confirm",message:r,okLabel:i="OK",storageId:a}=e,s=yr(e,["title","message","okLabel","storageId"]);const o=(0,n.useId)(),l=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{a&&l.current.checked&&vr.setBoolean(a,!0)}),[a]);return n.createElement(or,Object.assign({},s,{className:"confirm-dialog",title:t}),n.createElement("form",{method:"dialog",onSubmit:c},n.createElement("div",{className:"confirm-message"},r),n.createElement(fr,{value:"confirmed",submitText:i}),a?n.createElement("footer",{className:"confirm-dialog-storage"},n.createElement("input",{id:o,type:"checkbox",ref:l}),n.createElement("label",{htmlFor:o},"Don't show this message again.")):null))}function wr({icon:e,text:t,className:r="",showConnectivity:i}){return n.createElement("span",{className:`media-source-label ${r}`},n.createElement(rt,{name:e,className:i?"show-connectivity":""}),n.createElement("span",{className:"text"},t))}var Er=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function kr(e,t){return Er(this,void 0,void 0,(function*(){yield mr({title:n.createElement(wr,{icon:"error",text:"Error"}),message:e,system:t})}))}var xr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Sr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Tr(e){var{system:t=!1}=e,r=Sr(e,["system"]);return xr(this,void 0,void 0,(function*(){return cr((e=>n.createElement(Pr,Object.assign({},e,r))),t)}))}function Pr(e){var{title:t="Input",type:r="text",placeholder:i="",label:a,suggestedValue:s="",okLabel:o="OK"}=e,l=Sr(e,["title","type","placeholder","label","suggestedValue","okLabel"]);const c=(0,n.useId)(),[u,d]=(0,n.useState)(s),m=(0,n.useCallback)((e=>{d(e.target.value)}),[]);return n.createElement(or,Object.assign({},l,{className:"prompt-dialog",title:t}),n.createElement("form",{method:"dialog"},n.createElement("p",null,a?n.createElement("label",{htmlFor:c},a,": "):null,n.createElement("input",{type:r,id:c,defaultValue:s,placeholder:i,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:m})),n.createElement(fr,{value:u,submitText:o})))}var Ar=function(e){function t(t,r){return e.call(this)||this}return X(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(le),Ir={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Ir.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,re([e,t],te(r))):setInterval.apply(void 0,re([e,t],te(r)))},clearInterval:function(e){var t=Ir.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Cr=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return X(t,e),t.prototype.schedule=function(e,t){var r;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),Ir.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&Ir.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,oe(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Ar),Mr={now:function(){return(Mr.delegate||Date).now()},delegate:void 0},Or=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=Mr.now,e}(),$r=function(e){function t(t,r){void 0===r&&(r=Or.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return X(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(Or),Nr=new $r(Cr),zr=Nr;function jr(e){return e&&ie(e.schedule)}function Lr(e,t,r){void 0===e&&(e=0),void 0===r&&(r=zr);var n=-1;return null!=t&&(jr(t)?r=t:n=t),new Me((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;i<0&&(i=0);var a=0;return r.schedule((function(){t.closed||(t.next(a++),0<=n?this.schedule(void 0,n):t.complete())}),i)}))}function Dr(e,t){return void 0===e&&(e=0),void 0===t&&(t=Nr),e<0&&(e=0),Lr(e,e,t)}function Rr({children:e}){return n.createElement(n.Fragment,null,e)}var Fr=Array.isArray;function _r(e){return Be((function(t){return function(e,t){return Fr(t)?e.apply(void 0,re([],te(t))):e(t)}(e,t)}))}var Br=["addListener","removeListener"],Vr=["addEventListener","removeEventListener"],Ur=["on","off"];function Hr(e,t,r,n){if(ie(r)&&(n=r,r=void 0),n)return Hr(e,t,r).pipe(_r(n));var i=te(function(e){return ie(e.addEventListener)&&ie(e.removeEventListener)}(e)?Vr.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return ie(e.addListener)&&ie(e.removeListener)}(e)?Br.map(Yr(e,t)):function(e){return ie(e.on)&&ie(e.off)}(e)?Ur.map(Yr(e,t)):[],2),a=i[0],s=i[1];if(!a&&Ve(e))return et((function(e){return Hr(e,t,r)}))(Qe(e));if(!a)throw new TypeError("Invalid event target");return new Me((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return a(t),function(){return s(t)}}))}function Yr(e,t){return function(r){return function(n){return e[r](t,n)}}}function qr(e){return void 0===e&&(e=1/0),et(Ce,e)}function Kr(e){return e[e.length-1]}function Wr(e){return ie(Kr(e))?e.pop():void 0}function Gr(e){return jr(Kr(e))?e.pop():void 0}function Jr(e,t){return void 0===t&&(t=0),De((function(r,n){r.subscribe(Re(n,(function(r){return Ze(n,e,(function(){return n.next(r)}),t)}),(function(){return Ze(n,e,(function(){return n.complete()}),t)}),(function(r){return Ze(n,e,(function(){return n.error(r)}),t)})))}))}function Qr(e,t){return void 0===t&&(t=0),De((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function Xr(e,t){if(!e)throw new Error("Iterable cannot be null");return new Me((function(r){Ze(r,t,(function(){var n=e[Symbol.asyncIterator]();Ze(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function Zr(e,t){return t?function(e,t){if(null!=e){if(He(e))return function(e,t){return Qe(e).pipe(Qr(t),Jr(t))}(e,t);if(Ve(e))return function(e,t){return new Me((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(Ue(e))return function(e,t){return Qe(e).pipe(Qr(t),Jr(t))}(e,t);if(Ye(e))return Xr(e,t);if(We(e))return function(e,t){return new Me((function(r){var n;return Ze(r,t,(function(){n=e[Ke](),Ze(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return ie(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(Je(e))return function(e,t){return Xr(Ge(e),t)}(e,t)}throw qe(e)}(e,t):Qe(e)}function en(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qr(1)(Zr(e,Gr(e)))}function tn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gr(e);return De((function(t,n){(r?en(e,t,r):en(e,t)).subscribe(n)}))}var rn=new Me((function(e){return e.complete()}));function nn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gr(e),n=function(e,t){return"number"==typeof Kr(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?Qe(i[0]):qr(n)(Zr(i,r)):rn}function an(e,t){return De((function(r,n){var i=null,a=0,s=!1,o=function(){return s&&!i&&n.complete()};r.subscribe(Re(n,(function(r){null==i||i.unsubscribe();var s=0,l=a++;Qe(e(r,l)).subscribe(i=Re(n,(function(e){return n.next(t?t(r,e,l,s++):e)}),(function(){i=null,o()})))}),(function(){s=!0,o()})))}))}function sn(e){return De((function(t,r){Qe(e).subscribe(Re(r,(function(){return r.complete()}),pe)),!r.closed&&t.subscribe(r)}))}function on(e,t){switch(t.type){case"resize":{const r=Math.max(t.clientSize,0),n=Math.max(t.scrollSize,r);if(r!==e.clientSize||n!==e.scrollSize){const t=n-r,i=ln(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:r,scrollSize:n})}return e}case"scrollBy":{const r=ln(e.position+t.amount,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}case"scrollTo":{const r=ln(t.position,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}default:return e}}function ln(e,t){return Math.min(Math.max(e,0),t)}const cn={position:0,max:0,clientSize:0,scrollSize:0};const un=(0,n.memo)((function(e){var{scrollableId:t,orientation:r,scrollAmount:i,onChange:a,onResize:s,scrollbarRef:o}=e,l=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,n.useRef)(null),u=(0,n.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:f,resize:p,scrollBy:y,scrollTo:v}=function(){const[{position:e,max:t,clientSize:r,scrollSize:i},a]=(0,n.useReducer)(on,cn),s=(0,n.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),o=(0,n.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:r,scrollSize:i,scrollTo:o,scrollBy:(0,n.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:s}}(),[b,g]=(0,n.useState)(0),[w,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(-1),[A,I]=(0,n.useState)(0),C=-1!==T,M="vertical"===r,O=Math.ceil(d/m*(w-x));(0,n.useEffect)((()=>{o.current={scrollBy:y,scrollTo:v}}),[o,y,v]),(0,n.useEffect)((()=>p(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,p]),(0,n.useEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,n.useEffect)((()=>null==s?void 0:s(b)),[b,s]),Wt(c,(({width:e,height:t})=>{k(M?t:e),g(M?e:t)}),"border-box"),Wt(u,(({width:e,height:t})=>{S(M?t:e)}),"border-box");const $=(0,n.useCallback)(((e,t)=>{const r=()=>o.current.scrollBy(t),n=t=>t.target===e,i=Hr(document,"mouseup"),a=nn(Hr(e,"mouseover").pipe(Be(n),tn(!0)),Hr(e,"mouseout").pipe(_e(n),Be((()=>!1)))).pipe(an(((e,t)=>e?Lr(0===t?400:0,40):rn)),sn(i)).subscribe(r);return r(),()=>a.unsubscribe()}),[o]),N=(0,n.useCallback)((e=>{if(0===e.button)return $(e.target,-i)}),[i,$]),z=(0,n.useCallback)((e=>{if(0===e.button)return $(e.target,i)}),[i,$]),j=(0,n.useCallback)((e=>{if(0===e.button){const t=M?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return $(e.target,t<O?-h:h)}}),[M,h,O,$]),L=(0,n.useCallback)((e=>{e.stopPropagation(),0===e.button&&(P(M?e.screenY:e.screenX),I(O))}),[M,O]),D=(0,n.useCallback)((e=>{const t=M?e.screenY:e.screenX;v((A+(t-T))*m/(w-x))}),[M,T,A,m,x,w,v]),R=(0,n.useCallback)((()=>{P(-1),I(0)}),[]);return(0,n.useEffect)((()=>{if(C)return document.body.classList.add("dragging"),document.addEventListener("mouseup",R),document.addEventListener("mousemove",D),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",R),document.removeEventListener("mousemove",D)}}),[C,D,R]),n.createElement("div",{className:`scrollbar scrollbar-${r}`,role:"scrollbar","aria-controls":t,"aria-orientation":r,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:E,onMouseDown:E},n.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:N},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),n.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},n.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[M?"height":"width"]:w*(f?h/f:0)+"px",transform:`translate${M?"Y":"X"}(${O}px)`},ref:u})),n.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function dn({children:e,scrollWidth:t=0,scrollHeight:r=0,scrollAmount:i=10,droppable:a,onResize:s,onScroll:o,scrollableRef:l}){const c=(0,n.useId)(),u=(0,n.useRef)(null),d=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),y=(0,n.useRef)(null),[v,b]=(0,n.useState)(0),[g,w]=(0,n.useState)(0),[E,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(0),[A,I]=(0,n.useState)(t),[C,M]=(0,n.useState)(r),[O,$]=(0,n.useState)(0),[N,z]=(0,n.useState)(0),[j,L]=(0,n.useState)(!1),[D,R]=(0,n.useState)(!1),[F,_]=(0,n.useState)(0),B=Math.max(O-(D?g:0),0),V=Math.max(N-(j?v:0),0),[U,H]=(0,n.useState)(!0);(0,n.useEffect)((()=>{if(j||D){const e=setTimeout((()=>H(!1)),50);return()=>clearTimeout(e)}}),[j,D]),(0,n.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&p.current.scrollTo(e),void 0!==t&&y.current.scrollTo(t)}})}),[l]),(0,n.useEffect)((()=>{L(!(!A||!B)&&A-B>1)}),[A,B]),(0,n.useEffect)((()=>{R(!(!C||!V)&&C-V>1)}),[C,V]),(0,n.useEffect)((()=>{var e;I(0===t?(null===(e=d.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,n.useEffect)((()=>{var e;M(0===r?(null===(e=d.current)||void 0===e?void 0:e.scrollHeight)||0:r)}),[r]);const Y=(0,n.useCallback)((()=>{const e=u.current;$(e.clientWidth),z(e.clientHeight),k(e.getBoundingClientRect().top)}),[]),q=(0,n.useCallback)((()=>{var e;const n=d.current,i=f.current;0===t&&I(n.scrollWidth),0===r&&M(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:o}=n,{scrollWidth:l,scrollHeight:c}=i;null==s||s({clientWidth:a,clientHeight:o,scrollWidth:l,scrollHeight:c})}),[t,r,s]);Wt(u,Y),Wt(d,q),Wt(f,q),(0,n.useEffect)((()=>{null==o||o({left:x,top:T})}),[x,T,o]);const K=(0,n.useCallback)((e=>{y.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),W=(0,n.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>N?_(i):t<i&&_(-i)}),[E,N,i]);(0,n.useEffect)((()=>{if(F){const e=()=>y.current.scrollBy(F),t=Dr(100).subscribe(e);return()=>t.unsubscribe()}}),[F]);const G=(0,n.useCallback)((()=>_(0)),[]),[J,Q]=m(n.Children.toArray(e),(e=>(null==e?void 0:e.type)===Rr));return n.createElement("div",{className:`scrollable ${j?"overflow-x":""} ${D?"overflow-y":""} ${U?"scrollbars-hidden":""}`,id:c,onWheel:K,ref:u},n.createElement("div",{className:"scrollable-content",onDragOver:a?W:void 0,onDragLeave:a?G:void 0,onDragEnd:a?G:void 0,onDrop:a?G:void 0,style:{right:D?`${g}px`:"0",bottom:j?`${v}px`:"0",transform:`translateX(-${x}px)`},ref:d},(null==J?void 0:J.length)?n.createElement("div",{className:"scrollable-head",ref:h},J):null,n.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},n.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${T}px)`},ref:f},Q))),n.createElement(un,{scrollableId:c,orientation:"horizontal",clientSize:B,scrollSize:A,scrollAmount:i,onChange:S,onResize:b,scrollbarRef:p}),n.createElement(un,{scrollableId:c,orientation:"vertical",clientSize:V,scrollSize:C,scrollAmount:i,onChange:P,onResize:w,scrollbarRef:y}))}function mn(e){return De((function(t,r){var n=!1,i=null,a=null,s=function(){if(null==a||a.unsubscribe(),a=null,n){n=!1;var e=i;i=null,r.next(e)}};t.subscribe(Re(r,(function(t){null==a||a.unsubscribe(),n=!0,i=t,a=Re(r,s,pe),Qe(e(t)).subscribe(a)}),(function(){s(),r.complete()}),void 0,(function(){i=a=null})))}))}function hn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Zr(e,Gr(e))}function fn(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const r=t=>!e||e.includes(t.code),n=(e,t)=>Hr(document,e,{capture:!0}).pipe(_e(r),Be((()=>t))),a=nn(n("keydown",!0),n("keyup",!1)).pipe(mn((e=>e?hn(0):Lr(t)))).subscribe(i);return()=>a.unsubscribe()}),[e,t]),r}function pn(e){const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e}),[e]),t.current}function yn(e){return{storeExpandedState:(0,n.useCallback)(((t,r)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!r))}),[e]),retrieveExpandedState:(0,n.useCallback)(((t,r=!1)=>{if(e){const n=localStorage.getItem(`${e}/${t}`);return"string"==typeof n?"true"===n:r}return r}),[e]),storeSelectedNodeId:(0,n.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,n.useCallback)((()=>e&&localStorage.getItem(`${e}/selectedId`)||""),[e])}}function vn(e,t){return e.reduce(((e,r)=>(t(r.id,r.startExpanded)&&e.push(r.id),r.children?e.concat(vn(r.children,t)):e)),[])}function bn(e,t){return(0,n.useMemo)((()=>gn(e,t)),[e,t])}function gn(e,t){return e.reduce(((e,r)=>(e.push(r.id),r.children&&t.includes(r.id)?e.concat(gn(r.children,t)):e)),[])}var wn=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function En({id:e,label:t,children:r=[],selectedId:i,expandedIds:a,level:s,rowHeight:o,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),f=0!==r.length,p=e===i,y=`${f?"expandable":""} ${h?"expanded":""} ${p?"selected":""} ${0===r.length?"empty":""}`,v=(0,n.useCallback)((e=>{e.stopPropagation()}),[]),b=(0,n.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),g=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&Pn(r,i)&&(null==d||d(e))}),[e,i,h,r,d,m]);return n.createElement("li",{className:`tree-view-node ${y}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":s,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:b},n.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:f?g:void 0,style:{height:`${o}px`}},f?n.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:v,onClick:w},h?n.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):n.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&n.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:v},n.createElement("circle",{cx:"12",cy:"12",r:"4"})),n.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&n.createElement("ul",{className:"tree-view-node-children",role:"group"},r.map(((e,t)=>{var{id:l}=e,c=wn(e,["id"]);return n.createElement(En,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:s+1,rowHeight:o,nodeIndex:t,setSize:r.length,onSelect:d,onToggle:m,key:l}))}))))}var kn=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const xn=24,Sn=["ArrowUp","ArrowDown"];function Tn({roots:e,className:t="",storageId:r,onContextMenu:i,onDelete:a,onEnter:s,onInfo:o,onSelect:l,treeViewRef:c}){const u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:f}=yn(r),[p,y]=(0,n.useState)(""),{expandedIds:v,toggle:b}=function(e,t){const{storeExpandedState:r,retrieveExpandedState:i}=yn(t),[a,s]=(0,n.useState)((()=>vn(e,i)));(0,n.useEffect)((()=>{s(vn(e,i))}),[e,i]);const o=(0,n.useCallback)(((e,t)=>{const n=a.includes(e);n!==t&&(s(n?a.filter((t=>t!==e)):a.concat(e)),r(e,!n))}),[a,r]);return{expandedIds:a,toggle:o}}(e,r),g=bn(e,v),w=g.indexOf(p),E=pn(w)||0,k=g[E-1],[x,S]=(0,n.useState)(0),[T,P]=(0,n.useState)(xn),[A,I]=(0,n.useState)(0),C=Math.floor(x/T)-1,M=g.length,O=An(e,p),$=fn(Sn),N=-1===w,z=$&&!(0===w||w===M-1),[L,D]=(0,n.useState)((()=>O)),R=(0,n.useCallback)((()=>u.current.focus()),[]);(0,n.useEffect)((()=>{c&&(c.current={focus:R})}),[c,R]),(0,n.useEffect)((()=>{var t;if(N){const r=In(e,k);y(r||(null===(t=e[0])||void 0===t?void 0:t.id)||"")}}),[e,N,k]),(0,n.useEffect)((()=>{if(!p&&e.length>0){const t=f();Pn(e,t)?y(t):y(e[0].id)}}),[e,p,f]),(0,n.useEffect)((()=>{null==l||l(L)}),[L,l]),(0,n.useEffect)((()=>{p&&h(p)}),[p,h]),(0,n.useEffect)((()=>{z||D(O)}),[O,z]);const F=(0,n.useCallback)((e=>{e.preventDefault(),null==i||i(O,e.pageX,e.pageY)}),[O,i]),_=(0,n.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==s||s(O);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(O);break;case"KeyI":e.stopPropagation(),!e[j.ctrlKey]||e.shiftKey||e.repeat||null==o||o(O);break;case"ArrowLeft":e.stopPropagation(),e.repeat||b(p,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||b(p,!0);break;default:{const t=function(e,t,r){switch(e){case"ArrowUp":return t[t.indexOf(r)-1]||r;case"ArrowDown":return t[t.indexOf(r)+1]||r;case"Home":return t[0]||r;case"End":return t[t.length-1]||r;default:return""}}(e.key,g,p);if(t&&(e.preventDefault(),t!==p)){e.stopPropagation();const r=d.current,n=Math.floor(A/T),i=g.indexOf(t);if(i>=n+C-1){const e=M*T,t=M-C-1,n=Math.min(M-1,i+1)-C,a=n===t?e:n*T;r.scrollTo({top:a})}else if(i<=n){const e=Math.max(0,i-1)*T;r.scrollTo({top:e})}y(t)}}}}),[g,p,O,T,C,M,A,a,s,o,b]),B=(0,n.useCallback)((({clientHeight:e})=>S(e)),[]),V=(0,n.useCallback)((({top:e})=>I(e)),[]);return Wt(m,(({height:e})=>P(e)),"border-box"),n.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:F,onKeyDown:_,ref:u},n.createElement(dn,{scrollAmount:T,onResize:B,onScroll:V,scrollableRef:d},n.createElement("ul",{role:"tree"},e.map(((t,r)=>{var{id:i}=t,a=kn(t,["id"]);return n.createElement(En,Object.assign({},a,{id:i,selectedId:p,expandedIds:v,level:1,rowHeight:T,nodeIndex:r,setSize:e.length,emptyMarker:!0,onSelect:y,onToggle:b,key:i}))}))),n.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*T}px)`},ref:m})))}function Pn(e,t){for(const r of e){if(r.id===t)return!0;if(r.children&&Pn(r.children,t))return!0}return!1}function An(e,t){return e.reduce(((e,r)=>{if(void 0===e)if(r.id===t)e=r.value;else if(r.children)return An(r.children,t);return e}),void 0)}function In(e,t){return e.reduce(((e,r)=>!e&&r.children?r.children.find((e=>e.id===t))?r.id:In(r.children,t):e),"")}var Cn;!function(e){e[e.PublicMedia=0]="PublicMedia",e[e.PersonalMedia=1]="PersonalMedia",e[e.DataService=2]="DataService"}(Cn||(Cn={}));const Mn=Cn;function On(e){return De((function(t,r){var n=!1,i=0;t.subscribe(Re(r,(function(t){return(n||(n=!e(t,i++)))&&r.next(t)})))}))}var $n;!function(e){e[e.Direct=0]="Direct",e[e.HLS=1]="HLS",e[e.DASH=2]="DASH",e[e.IFrame=3]="IFrame"}($n||($n={}));const Nn=$n;var zn=Array.isArray,jn=Object.getPrototypeOf,Ln=Object.prototype,Dn=Object.keys;function Rn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gr(e),n=Wr(e),i=function(e){if(1===e.length){var t=e[0];if(zn(t))return{args:t,keys:null};if((n=t)&&"object"==typeof n&&jn(n)===Ln){var r=Dn(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}(e),a=i.args,s=i.keys;if(0===a.length)return Zr([],r);var o=new Me(function(e,t,r){return void 0===r&&(r=Ce),function(n){Fn(t,(function(){for(var i=e.length,a=new Array(i),s=i,o=i,l=function(i){Fn(t,(function(){var l=Zr(e[i],t),c=!1;l.subscribe(Re(n,(function(e){a[i]=e,c||(c=!0,o--),o||n.next(r(a.slice()))}),(function(){--s||n.complete()})))}),n)},c=0;c<i;c++)l(c)}),n)}}(a,r,s?function(e){return function(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}(s,e)}:Ce));return n?o.pipe(_r(n)):o}function Fn(e,t,r){e?Ze(r,e,t):t()}function _n(e,t){return void 0===t&&(t=Ce),e=null!=e?e:Bn,De((function(r,n){var i,a=!0;r.subscribe(Re(n,(function(r){var s=t(r);!a&&e(i,s)||(a=!1,i=s,n.next(r))})))}))}function Bn(e,t){return e===t}function Vn(e,t){return ie(t)?et(e,t,1):et(e,1)}function Un(e){return De((function(t,r){var n,i=null,a=!1;i=t.subscribe(Re(r,void 0,void 0,(function(s){n=Qe(e(s,Un(e)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):a=!0}))),a&&(i.unsubscribe(),i=null,n.subscribe(r))}))}const Hn=new Ne;function Yn(e){const t=e?Array.isArray(e)?e:[e]:[];t.length>0&&Hn.next(t)}function qn(){return Hn}var Kn=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Wn extends Bt.ZP{constructor(){super("ampcast/pending-actions"),this.inLibraryChanges$=new it([]),this.ratingChanges$=new it([]),this.lock$=new it(null),this.logger=new H("actionsStore"),this.version(2).stores({inLibraryChanges:"&src",ratingChanges:"&src"}),(0,Bt.Y1)((()=>this.inLibraryChanges.toArray())).subscribe(this.inLibraryChanges$),(0,Bt.Y1)((()=>this.ratingChanges.toArray())).subscribe(this.ratingChanges$)}registerServices(e){for(const t of e)this.registerService(t)}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}getInLibrary(e,t){const r=this.getInLibraryChangedItem(e);return r?r.inLibrary:t}getRating(e,t){const r=this.getRatingChangedItem(e);return r?r.rating:t}rate(e,t){return Kn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Gf(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.rate)throw Error(`rate() not supported by ${n}`);if(this.isLocked(e))yield this.ratingChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{rating:t})));else{const r=this.getRatingChangedItem(e);r&&(yield this.ratingChanges.delete(r.src)),yield i.rate(e,t)}Yn({match:t=>i.compareForRating(t,e),values:{rating:t}})}))}store(e,t){return Kn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Gf(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.store)throw Error(`store() not supported by ${n}`);{const r=this.getInLibraryChangedItem(e);r&&(yield this.inLibraryChanges.delete(r.src)),this.isLocked(e)?r||(yield this.inLibraryChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{inLibrary:t})))):yield i.store(e,t),Yn({match:t=>i.compareForRating(t,e),values:{inLibrary:t}})}}))}observeInLibraryChanges(e){return this.observeUpdates(e,this.inLibraryChanges$)}observeRatingChanges(e){return this.observeUpdates(e,this.ratingChanges$)}observeUpdates(e,t){return Rn([t,this.lock$]).pipe(_e((([e])=>e.length>0)),Be((([t])=>t.filter((t=>t.src.startsWith(`${e.id}:`)&&!this.isLocked(t))))),_n(((e,t)=>{const r=e.map((e=>e.src)).sort(),n=t.map((e=>e.src)).sort();return String(r)===String(n)})))}bulkRate(e,t,r,n=10){return Kn(this,void 0,void 0,(function*(){const i=t=>Kn(this,void 0,void 0,(function*(){const n=t.map((e=>e.src));yield this.ratingChanges.bulkDelete(n),Yn({match:r=>t.some((t=>e.compareForRating(r,t))),values:{rating:r}})}));if(e.bulkRate)yield e.bulkRate(t,r),i(t);else{const a=u(t,n);for(const t of a)yield Promise.all(t.map((t=>e.rate(t,r)))),i(t)}}))}bulkStore(e,t,r,n=10){return Kn(this,void 0,void 0,(function*(){const i=t=>Kn(this,void 0,void 0,(function*(){const n=t.map((e=>e.src));yield this.inLibraryChanges.bulkDelete(n),Yn({match:r=>t.some((t=>e.compareForRating(r,t))),values:{inLibrary:r}})}));if(e.bulkStore)yield e.bulkStore(t,r),i(t);else{const a=u(t,n);for(const t of a)yield Promise.all(t.map((t=>e.store(t,r)))),i(t)}}))}createStorableMediaObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"])}return e}getInLibraryChangedItem(e){const t=Jf(e);if(null==t?void 0:t.store)return this.inLibraryChanges$.getValue().find((r=>t.compareForRating(r,e)))}getRatingChangedItem(e){const t=Jf(e);if(null==t?void 0:t.rate)return this.ratingChanges$.getValue().find((r=>t.compareForRating(r,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[r]=e.src.split(":");return t.serviceId===r&&t.itemType===e.itemType}return!1}registerService(e,t){if(e.rate){const r=this.logger.id(`${e.id}/rating`);this.observeRatingChanges(e).pipe(_e((e=>e.length>0)),Be((e=>d(e,(e=>e.rating)))),et((e=>Object.keys(e).map((t=>({items:e[t],rating:Number(t)}))))),Vn((({items:r,rating:n})=>this.bulkRate(e,r,n,t))),Un((e=>(r.error(e),[])))).subscribe(r)}if(e.store){const r=this.logger.id(`${e.id}/inLibrary`);this.observeInLibraryChanges(e).pipe(_e((e=>e.length>0)),Be((e=>d(e,(e=>String(!!e.inLibrary))))),et((e=>Object.keys(e).map((t=>({items:e[t],inLibrary:"false"!==t}))))),Vn((({items:r,inLibrary:n})=>this.bulkStore(e,r,n,t))),Un((e=>(r.error(e),[])))).subscribe(r)}}}const Gn=new Wn;var Jn;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue",e.AddToPlaylist="add-to-playlist",e.AddToNewPlaylist="add-to-new-playlist",e.AddToRecentPlaylist1="add-to-recent-playlist-1",e.AddToRecentPlaylist2="add-to-recent-playlist-2",e.AddToRecentPlaylist3="add-to-recent-playlist-3",e.AddToRecentPlaylist4="add-to-recent-playlist-4"}(Jn||(Jn={}));const Qn=Jn;var Xn;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(Xn||(Xn={}));const Zn=Xn;var ei;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(ei||(ei={}));const ti=ei,ri=/^en(-us)?$/i.test(navigator.language);function ni(e){return e&&!ri?e.replaceAll(/(F)avorite(s?)/gi,"$1avourite$2"):e}class ii extends Error{constructor(){super(),Object.setPrototypeOf(this,ii.prototype)}}class ai extends ii{constructor(){super(...arguments),this.message="No music library found."}}class si extends ii{constructor(){super(...arguments),this.message="No music video library found."}}class oi extends ii{constructor(){super(...arguments),this.message="No TIDAL subscription found."}}class li extends ii{constructor(){super(...arguments),this.message=ni("No favorites playlist found.")}}var ci=Array.isArray;function ui(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===(t=1===(e=t).length&&ci(e[0])?e[0]:e).length?Qe(t[0]):new Me(function(e){return function(t){for(var r=[],n=function(n){r.push(Qe(e[n]).subscribe(Re(t,(function(e){if(r){for(var i=0;i<r.length;i++)i!==n&&r[i].unsubscribe();r=null}t.next(e)}))))},i=0;r&&!t.closed&&i<e.length;i++)n(i)}}(t))}function di(e,{timeout:t=5e3,keepAlive:r=!1}={}){return new Promise(((n,i)=>{const a=e.observeItems(),s=ui(e.observeError().pipe(Be((e=>e instanceof Error?e:Error(String((null==e?void 0:e.message)||"unknown"))))),Lr(t).pipe(Be((()=>Error("timeout")))));ui(a,s).subscribe((t=>{r||e.disconnect(),t instanceof Error?i(t):n(t)})),e.fetchAt(0)}))}var mi=new Me(pe);class hi{constructor(e=[]){this.items$=new it([]),this.maxSize=void 0,this.items$.next(e)}observeItems(){return this.items$}observeSize(){return this.items$.pipe(Be((e=>e.length)))}observeError(){return mi}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()}))}get items(){return this.items$.getValue()}}const fi="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE3MDM5NTczMDcsImV4cCI6MTcxOTUwOTMwNywiaXNzIjoiODM4Nk5ERlhMQiJ9.UJjNLqpKbxC5Jr81w1JPSSZbBNdVjVvvd3LNcaGwJQpuy8U_R5EMcwGy0Z6nDu9IzfwYa9uGPT5ooB4qcKE5Kw".toString(),pi="41bd731be5b78200d2bbaea2312b917b".toString(),yi="78aa93b641329f00e68cf1542356b8fc".toString(),vi="".toString(),bi="".toString(),gi="".toString(),wi=new J("apple"),Ei={get connectedAt(){return wi.getNumber("connectedAt")},set connectedAt(e){wi.setNumber("connectedAt",e)},get favoriteSongsId(){return wi.getString("favoriteSongsId")},set favoriteSongsId(e){wi.setString("favoriteSongsId",e)},get useMusicKitBeta(){return wi.getBoolean("useMusicKitBeta",!0)},set useMusicKitBeta(e){wi.setBoolean("useMusicKitBeta",e)}};var ki=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class xi{constructor(e){this.MusicKit=e,this.isWrapper=!0}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return ki(this,void 0,void 0,(function*(){if(!this.instance){const t=this.MusicKit.configure(e);this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}})}return this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}}),e;throw Error("Not configured")}formatArtworkURL(e,t,r){return this.MusicKit.formatArtworkURL(e,t,r)}music(e,t,r){return ki(this,void 0,void 0,(function*(){const n=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",n.storefrontId);const i=(null==r?void 0:r.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{Authorization:`Bearer ${n.developerToken}`,"Music-User-Token":n.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok){const e=new Error(String(a.status));throw e.data=a,e}return{data:yield a.json()}}))}}var Si=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ti=new H("appleAuth"),Pi=new it(!1);function Ai(){return!!Ei.connectedAt}function Ii(){return Pi.getValue()}function Ci(){return Pi.pipe(_n())}function Mi(){return Si(this,void 0,void 0,(function*(){Ti.log("disconnect");try{const e=yield Ni();try{e.isPlaying&&e.stop(),e.queue.isEmpty||(yield e.setQueue({}))}catch(e){Ti.error(e)}try{yield e.unauthorize()}catch(e){Ti.error(e)}}catch(e){}Ei.connectedAt=0,Ei.favoriteSongsId="",Pi.next(!1)}))}function Oi(){return Si(this,void 0,void 0,(function*(){throw Ti.log("refreshToken"),yield Mi(),Error("Access token refresh is not supported.")}))}const $i=new Promise(((e,t)=>{document.addEventListener("musickitloaded",(()=>Si(void 0,void 0,void 0,(function*(){Ti.log("Loaded MusicKit version",MusicKit.version),MusicKit.version.startsWith("1")&&!MusicKit.isWrapper&&(window.MusicKit=new xi(MusicKit));try{const t=yield MusicKit.configure({developerToken:fi,app:{name:"ampcast",build:"0.9.5"},sourceType:8,suppressErrorDialog:!0});t.addEventListener(MusicKit.Events.authorizationStatusDidChange,(()=>Si(void 0,void 0,void 0,(function*(){const e=t.isAuthorized;if(e)try{yield zi(t)}catch(e){Ti.error(e)}Pi.next(e)})))),e(t)}catch(e){t(e)}}))))}));function Ni(){return Si(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${Ei.useMusicKitBeta?3:1}/musickit.js`).then((()=>$i.then(e,t)),t)}))}))}function zi(e){return Si(this,void 0,void 0,(function*(){if(!Ei.favoriteSongsId){const{data:{data:t=[]}}=yield e.api.music("/v1/me/library/playlists",{"extend[library-playlists]":"tags","fields[library-playlists]":"tags"}),r=t.find((e=>{var t,r;return null===(r=null===(t=e.attributes)||void 0===t?void 0:t.tags)||void 0===r?void 0:r.includes("favorited")}));r&&(Ei.favoriteSongsId=r.id)}}))}function ji(e){return e<=0?function(){return rn}:De((function(t,r){var n=0;t.subscribe(Re(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}Ci().pipe(On((e=>!e))).subscribe((e=>Ei.connectedAt=e?Date.now():0)),Si(void 0,void 0,void 0,(function*(){try{if(Ai()){const e=yield Ni();e.isAuthorized&&(yield zi(e),Pi.next(!0))}}catch(e){Ti.error(e)}}));var Li;const Di=[],Ri=new H("AbstractPager");Li=new WeakMap;const Fi=class{constructor(e={}){this.config=e,this.additions$=new it(Di),this.error$=new it(Di),this.items$=new it(Di),this.fetches$=new it({index:0,length:0}),this.size$=new it(-1),this.srcs=new Set,Li.set(this,!1)}get maxSize(){return this.config.maxSize}observeAdditions(){return this.additions$.pipe(On((e=>e===Di)))}observeError(){return this.error$.pipe(On((e=>e===Di)))}observeItems(){return this.items$.pipe(On((e=>e===Di)))}observeSize(){return this.size$.pipe(On((e=>-1===e)),_n())}disconnect(){this.disconnected||(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Li,!0,"f"),this.subscriptions&&this.subscriptions.unsubscribe(),this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.additions$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){this.disconnected?Ri.warn("disconnected"):(t||(t=50),this.connected||this.connect(),this.fetches$.next({index:e,length:t}))}get connected(){return!!this.subscriptions}get disconnected(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Li,"f")}get error(){const e=this.error$.getValue();return e===Di?void 0:e}set error(e){this.error$.next(e)}get items(){return this.items$.getValue()}set items(e){const t=[];this.items$.next(e.map((e=>{if(!this.srcs.has(e.src)){this.srcs.add(e.src);const r=Gn.getInLibrary(e,e.inLibrary),n=Gn.getRating(e,e.rating);e.inLibrary===r&&e.rating===n||(e=Object.assign(Object.assign({},e),{inLibrary:r,rating:n})),t.push(e)}return e}))),t.length>0&&this.additions$.next(t)}get size(){const e=this.size$.getValue();return-1===e?void 0:e}set size(e){this.size$.next(e)}observeComplete(){return Rn([this.observeItems(),this.observeSize()]).pipe(_e((([e,t])=>e.reduce((e=>e+1),0)===t)),Be((([e])=>e)),ji(1))}observeFetches(){return this.fetches$}connect(){this.disconnected||this.connected||(this.subscriptions=new le,this.config.lookup||(this.subscribeTo(this.observeAdditions().pipe(at((e=>this.addMultiDisc(e)))),Ri),this.subscribeTo(this.observeAdditions().pipe(at((e=>this.addTrackCount(e)))),Ri),this.subscribeTo(qn().pipe(at((e=>this.applyChanges(e)))),Ri)))}subscribeTo(e,t){this.subscriptions.add(e.subscribe(t))}applyChanges(e){let t=!1;const r=this.items.map((r=>{for(const{match:n,values:i}of e)if(n(r))return t=!0,Object.assign(Object.assign({},r),i);return r}));t&&this.items$.next(r)}addMultiDisc(e){e.forEach((e=>{e.itemType===Zn.Album&&void 0===e.multiDisc&&this.subscribeTo(e.pager.observeItems().pipe(ji(1),at((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n],i=h(t.map((e=>e.disc)).filter(l)),a=i.length>1||i[0]>1;e[n]=Object.assign(Object.assign({},r),{multiDisc:a}),this.items$.next(e)}}))),Ri)}))}addTrackCount(e){e.forEach((e=>{e.itemType===Zn.Playlist&&!e.trackCount&&e.pager&&this.subscribeTo(e.pager.observeSize().pipe(ji(1),at((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n];e[n]=Object.assign(Object.assign({},r),{trackCount:t}),this.items$.next(e)}}))),Ri)}))}},_i=new H("SequentialPager");class Bi extends Fi{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new it(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeShouldFetch().pipe(tn(void 0),at((()=>this.fetching$.next(!0))),Vn((()=>this.fetchNext(this.config.pageSize))),at((e=>this.addPage(e))),Un((e=>(_i.error(e),this.error=e,hn(void 0)))),at((()=>this.fetching$.next(!1))),sn(this.observeComplete()),ji(100)),_i))}observeShouldFetch(){const e=Rn([this.observeFetches(),this.observeItems()]).pipe(Be((([{index:e,length:t},r])=>e+t+1>=r.length)),_e((e=>e)),Be((()=>{})),ji(1));return this.fetching$.pipe(an((t=>t?rn:e)))}addPage(e){var t,r;const n=(e.items||[]).filter(l),i=f(this.items.concat(n),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);let a=e.atEnd||i.length===this.maxSize||this.emptyCount>=this.maxEmptyCount;const s=this.config.pageSize;a||void 0!==e.atEnd||void 0!==e.total||void 0===s||(a=e.items.length<s);const o=a?i.length:e.total;void 0!==o&&(this.size=Math.min(o,null!==(r=this.maxSize)&&void 0!==r?r:1/0)),this.items=i}}class Vi extends Fi{constructor(e){super(),this.fetch=e}fetchAt(){this.disconnected||this.connected||(this.connect(),this.fetch().then((e=>{this.size=e.length,this.items=e})).catch((e=>this.error=e)))}}const Ui=new H("WrappedPager");class Hi{constructor(e,t,r){this.headerPager=e,this.bodyPager=t,this.footerPager=r,this.fetches$=new it({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){var e,t;return Rn([(null===(e=this.headerPager)||void 0===e?void 0:e.observeItems())||hn([]),this.bodyPager.observeItems(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeItems())||hn([]),this.observeComplete()]).pipe(Be((([e,t,r,n])=>e.concat(n?t.concat(r):t))))}observeSize(){var e;return Rn([this.observeHeaderSize(),this.bodyPager.observeSize(),(null===(e=this.footerPager)||void 0===e?void 0:e.observeSize())||hn(0),this.observeComplete()]).pipe(Be((([e,t,r,n])=>e+t+(n?r:0))))}observeError(){return this.bodyPager.observeError()}disconnect(){var e,t,r;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),null===(t=this.headerPager)||void 0===t||t.disconnect(),this.bodyPager.disconnect(),null===(r=this.footerPager)||void 0===r||r.disconnect())}fetchAt(e,t){this.disconnected?Ui.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){this.subscriptions||(this.subscriptions=new le,this.headerPager&&this.subscriptions.add(this.observeFetches().pipe(ji(1),at((({index:e,length:t})=>this.headerPager.fetchAt(e,t)))).subscribe(Ui)),this.subscriptions.add(Rn([this.observeHeaderSize(),this.observeFetches()]).pipe(at((([e,t])=>this.bodyPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(Ui)),this.footerPager&&this.subscriptions.add(this.observeComplete().pipe(at((()=>this.footerPager.fetchAt(0)))).subscribe(Ui)))}observeComplete(){return Rn([this.bodyPager.observeItems(),this.bodyPager.observeSize()]).pipe(Be((([e,t])=>e.reduce((e=>e+1),0)===t)),tn(!1),_n())}observeFetches(){return this.fetches$.pipe(_e((e=>e.length>0)))}observeHeaderSize(){var e;return(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize().pipe(tn(0),Be((e=>e||0)),_n()))||hn(0)}}var Yi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const qi=new H("pinStore"),Ki=[];class Wi extends Bt.ZP{constructor(){super("ampcast/pins"),this.pins$=new it(Ki),this.lockedPin$=new it(null),this.version(2).stores({pins:"&src"}),(0,Bt.Y1)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return Yi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];qi.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"]);return Object.assign(Object.assign({},r),{isPinned:!0})}))),Yn(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){qi.error(e)}}))}unpin(e){return Yi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];qi.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),Yn(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){qi.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return Rn([this.pins$,this.lockedPin$]).pipe(_e((([e])=>e!==Ki)),Be((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),r=this.lockedPin$.getValue();return r&&!t.find((e=>e.src===r.src))&&t.push(r),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const Gi=new Wi;var Ji=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Qi=new H("MusicKitPager");class Xi{static defaultToPage(e){var t,r,n;const i=(null===(r=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===r?void 0:r.tracks)||e,a=i.data||[],s=i.next;return{items:a,total:null===(n=i.meta)||void 0===n?void 0:n.total,nextPageUrl:s}}constructor(e,t,r,n,i=Xi.defaultToPage){this.options=r,this.parent=n,this.nextPageUrl=void 0,this.pager=new Bi((r=>Ji(this,void 0,void 0,(function*(){const n=yield this.fetchNext(this.nextPageUrl||e,r?t?Object.assign(Object.assign({},t),{limit:r}):{limit:r}:t),a=i(n.data),s=this.createItems(a.items),o=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:s,total:o,atEnd:l}}))),r)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new le,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>pa(e,!0,this.parent)))).subscribe(Qi)))}fetchNext(e,t){var r;return Ji(this,void 0,void 0,(function*(){const n=MusicKit.getInstance();try{return yield n.api.music(e,t)}catch(i){const a=null===(r=null==i?void 0:i.data)||void 0===r?void 0:r.status;if(401===a||403===a)return yield Oi(),n.api.music(e,t);throw i}}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,r;const n=MusicKit.getInstance(),i=this.createFromLibrary(e),a=(null===(t=i.description)||void 0===t?void 0:t.standard)||(null===(r=i.description)||void 0===r?void 0:r.short),s=`apple:${e.type}:${e.id}`,o=this.getCatalogId(e),l=e.type.startsWith("library-")||void 0,c={src:s,itemType:Zn.Playlist,externalUrl:l?`https://music.apple.com/${n.storefrontId}/library/playlist/${e.id}`:i.url,title:i.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(i),owner:i.curatorName?{name:i.curatorName}:void 0,modifiedAt:Math.floor(new Date(i.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!i.playParams||void 0,isPinned:Gi.isPinned(s),inLibrary:l,apple:{catalogId:o}};return c.pager=new Xi(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,c),c}createMediaArtist(e){var t,r;const n=this.createFromLibrary(e),i=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),a=this.getCatalogId(e);return{itemType:Zn.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:n.url||void 0,title:n.name,description:i?P(i):void 0,thumbnails:this.createThumbnails(n),genres:this.getGenres(n),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createMediaAlbum(e){var t,r;const n=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),s=this.getCatalogId(e),o={itemType:Zn.Album,src:i,externalUrl:n.url||void 0,title:n.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(n),artist:n.artistName,trackCount:n.trackCount,genres:this.getGenres(n),year:new Date(n.releaseDate).getFullYear()||0,unplayable:!n.playParams||void 0,inLibrary:e.type.startsWith("library-")||void 0,apple:{catalogId:s}};return o.pager=new Xi(`${e.href}/tracks`,{"include[library-songs]":"catalog"},void 0,o),o}createMediaItem(e){var t,r,n,i,a;const s=this.createFromLibrary(e),{id:o,kind:l}=s.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${o}`,u=(null===(t=s.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=s.editorialNotes)||void 0===r?void 0:r.short),d=e.type.startsWith("library-"),m=(null===(n=this.parent)||void 0===n?void 0:n.itemType)===Zn.Playlist,h=this.getCatalogId(e);let f=s.url||void 0;return!f&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===Zn.Album&&this.parent.externalUrl&&(f=`${this.parent.externalUrl}?i=${h}`),{itemType:Zn.Media,mediaType:"musicVideo"===l?ti.Video:ti.Audio,playbackType:Nn.HLS,src:c,externalUrl:f,title:s.name,description:u?P(u):void 0,thumbnails:this.createThumbnails(s),artists:[s.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===Zn.Album?this.parent.artist:void 0,album:s.albumName,duration:s.durationInMillis/1e3,genres:this.getGenres(s),disc:s.discNumber,track:s.trackNumber,year:new Date(s.releaseDate).getFullYear()||void 0,isrc:s.isrc,unplayable:!s.playParams||void 0,playedAt:0,inLibrary:d&&!m||void 0,apple:{catalogId:h}}}getCatalogId(e){var t,r,n;if(e.type.startsWith("library-")){let i=null===(r=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===r?void 0:r["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(n=this.getCatalog(e))||void 0===n?void 0:n.id),i||""}return e.id}createFromLibrary(e){var t;return x(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,r,n;return null===(n=null===(r=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===r?void 0:r.data)||void 0===n?void 0:n[0]}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new Xi(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const r=this.createArtistTopTracks(e);let n;if(ma()){const t=this.createArtistVideos(e);n=new Vi((()=>Ji(this,void 0,void 0,(function*(){try{return 0===(yield di(t.pager,{keepAlive:!0})).length?[r]:[r,t]}catch(e){return Qi.error(e),[r]}}))))}else n=new hi([r]);return new Hi(n,t)}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:Zn.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createArtistVideos(e){const t=this.createFromLibrary(e);return{itemType:Zn.Album,src:`apple:videos:${e.id}`,title:"Music Videos",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createVideosPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createTopTracksPager(e){return this.createArtistViewPager(e,"top-songs")}createVideosPager(e){return this.createArtistViewPager(e,"top-music-videos")}createArtistViewPager(e,t){return new Xi(e.href,{[`limit[artists:${t}]`]:30,views:t},{maxSize:100},void 0,(e=>{var r,n,i;const a=(null===(n=null===(r=e.data[0])||void 0===r?void 0:r.views)||void 0===n?void 0:n[t])||e,s=a.data||[],o=a.next;return{items:s,total:null===(i=a.meta)||void 0===i?void 0:i.total,nextPageUrl:o}}))}}var Zi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ea={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},ta={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:Zn.Playlist,search:()=>new Xi("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:r})=>{const n=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:n,total:null==r?void 0:r.total,nextPageUrl:t}}))},ra={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,layout:ea,search:()=>new Xi("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},na={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:Zn.Media,lockActionsStore:!0,layout:ea,defaultHidden:!0,search:()=>new Xi("/v1/me/library/songs",{"include[library-songs]":"catalog"})},ia={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:Zn.Album,lockActionsStore:!0,search:()=>new Xi("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog",sort:"-dateAdded"})},aa={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:Zn.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Xi("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},sa={id:"apple/playlists",title:"My Playlists",icon:"tick",itemType:Zn.Playlist,lockActionsStore:!0,search:()=>new Xi("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog",sort:"-dateAdded"})},oa={id:"apple/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search:()=>new Xi("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams,artwork","include[library-playlists]":"catalog","filter[featured]":"suggested"})},la={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:Zn.Media,mediaType:ti.Video,lockActionsStore:!0,layout:ea,defaultHidden:!0,search:()=>new Xi("/v1/me/library/music-videos")},ca={id:"apple/favorite-songs",get title(){return ni("Favorite Songs")},icon:"star",itemType:Zn.Media,layout:ea,defaultHidden:!0,search(){const e=Ei.favoriteSongsId;if(!e)throw new li;return new Xi(`/v1/me/library/playlists/${e}/tracks`,{"include[library-songs]":"catalog"},void 0,{src:`apple:library-playlists:${e}`,itemType:Zn.Playlist})}},ua={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",serviceType:Mn.PublicMedia,primaryMediaType:ti.Audio,defaultHidden:!0,internetRequired:!0,roots:[ha(Zn.Media,{title:"Songs",layout:ea}),ha(Zn.Album,{title:"Albums"}),ha(Zn.Artist,{title:"Artists"}),ha(Zn.Playlist,{title:"Playlists"}),ha(Zn.Media,{title:"Videos",layout:ea,mediaType:ti.Video},{types:"music-videos"},{maxSize:250})],sources:[na,ia,aa,sa,la,ca,ra,ta],icons:{[Qn.AddToLibrary]:"plus",[Qn.RemoveFromLibrary]:"tick-fill"},labels:{[Qn.AddToLibrary]:"Add to Apple Music Library",[Qn.RemoveFromLibrary]:"Saved to Apple Music Library"},editablePlaylists:oa,addToPlaylist:function(e,t){return Zi(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,,n]=e.src.split(":"),i=t.map((e=>{const[,t,r]=e.src.split(":");return{id:r,type:t}}));return r.api.music(`/v1/me/library/playlists/${n}/tracks`,void 0,{fetchOptions:{method:"POST",body:JSON.stringify({data:i})}})}))},canRate:()=>!1,canStore:function(e){switch(e.itemType){case Zn.Media:case Zn.Playlist:return!0;case Zn.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r,items:n=[]}={}){return Zi(this,void 0,void 0,(function*(){const i=MusicKit.getInstance(),a={name:e,description:t,isPublic:r},s={tracks:{data:n.map((e=>{const[,t,r]=e.src.split(":");return{id:r,type:t}}))}},o=yield i.api.music("/v1/me/library/playlists",void 0,{fetchOptions:{method:"POST",body:JSON.stringify({attributes:a,relationships:s})}});return{src:`apple:${o.type}:${o.id}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,r]=e.src.split(":"),n=t.startsWith("library-");return new Xi(`${n?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${r}`,n?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return Zi(this,void 0,void 0,(function*(){if(e.itemType===Zn.Album&&e.synthetic)return e;let r=e;if(!e.externalUrl){const[,n,i]=e.src.split(":"),a=n.startsWith("library-"),s=new Xi(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${n.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${n.replace("library-","")}]`]:"relationships"},{lookup:!0}),o=yield di(s,{timeout:2e3});r=x(e,o[0]),r.description=(null===(t=o[0])||void 0===t?void 0:t.description)||e.description}return r.inLibrary=Gn.getInLibrary(r,r.inLibrary),void 0===r.inLibrary&&pa([r]),r}))},getPlaybackType:function(){return Zi(this,void 0,void 0,(function*(){return Nn.HLS}))},lookup:function(e,t,r=10,n){return Zi(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=fa(Zn.Media,`${e} ${t}`,void 0,{pageSize:r,maxSize:r,lookup:!0});return(yield di(i,{timeout:n})).filter((e=>!e.unplayable))}))},lookupByISRC:function(e,t,r){return Zi(this,void 0,void 0,(function*(){if(0===e.length)return[];const n=new Xi("/v1/catalog/{{storefrontId}}/songs",{"filter[isrc]":e.slice(0,25).join(",")},{pageSize:t,maxSize:t,lookup:!0});return(yield di(n,{timeout:r})).filter((e=>!e.unplayable))}))},store:function(e,t){var r;return Zi(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),s=null===(r=e.apple)||void 0===r?void 0:r.catalogId,o="/v1/me/library";if(t){const e=`ids[${a}]`;return n.api.music(o,{[e]:s},{fetchOptions:{method:"POST"}})}return n.api.music(`${o}/${a}/${s}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:Ci,isConnected:Ai,isLoggedIn:Ii,login:function(){return Si(this,void 0,void 0,(function*(){if(!Ii()){Ti.log("connect");try{const e=MusicKit.getInstance();yield e.authorize()}catch(e){Ti.error(e)}}}))},logout:Mi},da=ua;function ma(){var e;return null===(e=window.MusicKit)||void 0===e?void 0:e.version.startsWith("3")}function ha(e,t,r,n){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>fa(e,t,r,n)})}function fa(e,t,r,n){if(t){const i=Object.assign(Object.assign({},r),{term:t});if(!i.types){switch(e){case Zn.Media:i.types="songs";break;case Zn.Album:i.types="albums";break;case Zn.Artist:i.types="artists";break;case Zn.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new Xi("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},n),void 0,(e=>{var t;const r=e.results[a]||{data:[]},n=r.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:r.data,total:i,nextPageUrl:n}}))}return new hi}function pa(e,t=!1,r){return Zi(this,void 0,void 0,(function*(){const n=e[0];if(!n||!ua.canStore(n,t))return;const i=(null==r?void 0:r.itemType)===Zn.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,s]=n.src.split(":");s=s.replace("library-","");const o=MusicKit.getInstance(),{data:{resources:l}}=yield o.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${s}]`]:"inLibrary","format[resources]":"map",[`ids[${s}]`]:a,"omit[resource]":"autos"}),c=l[s];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));Yn(a.map((e=>({match:t=>{var r;return(null===(r=t.apple)||void 0===r?void 0:r.catalogId)===e},values:{inLibrary:!!u.get(e)}}))))}))}var ya;!function(e){e[e.Folders=6]="Folders",e[e.ByDecade=7]="ByDecade",e[e.ByGenre=8]="ByGenre"}(ya||(ya={}));const va=ya;var ba=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ga=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function wa(e){var{service:t,settings:r,userName:i="",login:a}=e,s=ga(e,["service","settings","userName","login"]);const o=t.id,[l,c]=(0,n.useState)(!1),[u,d]=(0,n.useState)(""),m=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),y=n.createElement(wr,{icon:t.icon,text:`Log in to ${t.name}`}),v=(0,n.useCallback)((()=>ba(this,void 0,void 0,(function*(){try{const e=h.current.value.replace(/\/+$/,""),t=f.current.value,n=p.current.value;if(r.host=e,c(!0),d("Connecting..."),"https:"===location.protocol&&!e.startsWith("https:"))throw Error("https required");const i=yield a(e,t,n);m.current.close(i)}catch(e){console.error(e),c(!1),e instanceof TypeError?d("Host not found"):d(e.message||e.statusText||"Error")}}))),[r,a]),b=(0,n.useCallback)((e=>{e.preventDefault(),v()}),[v]);return n.createElement(or,Object.assign({},s,{className:`login-dialog login-dialog-${t.id}`,title:y,ref:m}),n.createElement("form",{id:`${o}-login`,method:"dialog",onSubmit:b},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-host`},"Host:"),n.createElement("input",{type:"url",id:`${o}-host`,name:`${o}-host`,autoFocus:!r.host,defaultValue:r.host,placeholder:"https://",required:!0,ref:h})),n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-username`},"User:"),n.createElement("input",{type:"text",id:`${o}-username`,name:`${o}-username`,autoFocus:!!r.host,defaultValue:i,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",required:!0,ref:f})),n.createElement("p",null,n.createElement("label",{htmlFor:`${o}-password`},"Password:"),n.createElement("input",{type:"password",id:`${o}-password`,name:`${o}-password`,ref:p,required:!0}))),n.createElement("p",{className:"message "+(l?"":"error")},u),n.createElement(fr,{submitText:"Login"})))}let Ea=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");class ka{constructor(e){this.storage=new J(e),this.session=new J(`${e}/session`,"session"),this.libraryId$=new it(this.storage.getString("libraryId"))}get audioLibraries(){return this.libraries.filter((e=>"musicvideos"!==e.type))}get device(){return"PC"}get deviceId(){let e=this.storage.getString("deviceId");return e||(e=Ea(),this.storage.setString("deviceId",e)),e}get host(){return this.storage.getString("host")}set host(e){this.storage.setString("host",e)}get isLocal(){return this.storage.getBoolean("isLocal")}set isLocal(e){this.storage.setBoolean("isLocal",e)}get libraryId(){return this.storage.getString("libraryId")}set libraryId(e){this.storage.setString("libraryId",e),this.libraryId$.next(e)}observeLibraryId(){return this.libraryId$.pipe(_n())}get libraries(){return this.storage.getJson("libraries")||[]}set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>"music"===e.type&&R(e.title)))||e.find((e=>"music"===e.type))||e.find((e=>"audiobooks"===e.type));this.storage.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""}get serverId(){return this.storage.getString("serverId")}set serverId(e){this.storage.setString("serverId",e)}get sessionId(){let e=this.session.getString("id");return e||(e=String(Math.floor(1e7*Math.random())),this.session.setString("id",e)),e}get token(){return this.storage.getString("token")}set token(e){this.storage.setString("token",e)}get userId(){return this.storage.getString("userId")}set userId(e){this.storage.setString("userId",e)}get videoLibraryId(){var e;return null===(e=this.libraries.find((e=>"musicvideos"===e.type)))||void 0===e?void 0:e.id}clear(){this.storage.removeItem("serverId"),this.storage.removeItem("userId"),this.storage.removeItem("token")}}const xa=new ka("emby");var Sa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ta=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Pa(e=ys,t=xa){return Sa(this,void 0,void 0,(function*(){return cr((r=>n.createElement(Aa,Object.assign({},r,{service:e,settings:t}))),!0)}))}function Aa(e){var{service:t,settings:r}=e,i=Ta(e,["service","settings"]);const a=(0,n.useCallback)(((e,t,n)=>Sa(this,void 0,void 0,(function*(){const{device:i,deviceId:a}=r,s=`MediaBrowser Client="ampcast", Version="0.9.5", Device="${i}", DeviceId="${a}"`,o=yield fetch(`${e}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":s},body:JSON.stringify({Username:t,Pw:n})});if(!o.ok)throw o;const l=yield o.json(),c=l.ServerId,u=l.User.Id,d=l.AccessToken;return JSON.stringify({serverId:c,userId:u,token:d})}))),[r]);return n.createElement(wa,Object.assign({},i,{service:t,settings:r,login:a}))}var Ia=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Ca(e,t,r){return Ia(this,void 0,void 0,(function*(){return(yield $a(e,t,{method:"GET"},r)).json()}))}function Ma(e,t,r=xa){return Ia(this,void 0,void 0,(function*(){const n={UserId:r.userId,ParentId:r.libraryId,IncludeItemTypes:"Audio",SortBy:"SortName",Recursive:!0,Limit:500,StartIndex:0,EnableImages:!1,EnableUserData:!1,EnableTotalRecordCount:!1};switch(t){case Zn.Album:n.IncludeItemTypes="MusicAlbum";break;case Zn.Artist:n.IncludeItemTypes="AlbumArtist"}return((yield Ca(e,n,r)).Items||[]).map((({Id:e,Name:t})=>({id:e||t,title:t})))}))}function Oa(e,t={},r=xa){return Ia(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return $a(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:n},r)}))}function $a(e,t,r,n=xa){return Ia(this,void 0,void 0,(function*(){const{host:i,device:a,deviceId:s,token:o}=n;if(!o)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{Accept:"application/json","X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.9.5", Device="${a}", DeviceId="${s}", Token="${o}"`});const l=yield fetch(`${i}/${e}`,r);if(!l.ok)throw l;return l}))}function Na(e,t=xa){const{host:r,userId:n,token:i,deviceId:a,sessionId:s}=t;if(r&&n&&i&&a){const[,t,o,l]=e.src.split(":"),c=`${s}-${o}`;return"video"===t?e.playbackType===Nn.Direct?`${r}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:n,DeviceId:a,api_key:i,PlaySessionId:c})}`:`${r}/Videos/${o}/master.m3u8?${new URLSearchParams({MediaSourceId:l||o,DeviceId:a,api_key:i,TranscodeReasons:"ContainerNotSupported",VideoCodec:"h264,h265,hevc",AudioCodec:"mp3,aac",PlaySessionId:c})}`:`${r}/Audio/${o}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"aac",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",UserId:n,api_key:i,DeviceId:a,EnableRedirection:"true",StartTimeTicks:"0",PlaySessionId:c})}`}throw Error("Not logged in")}const za={addToPlaylist:function(e,t,r=xa){return Ia(this,void 0,void 0,(function*(){const n=r.userId,i=t.join(",");yield $a(`Playlists/${e}/Items`,{Ids:i,UserId:n},{method:"POST"},r)}))},createPlaylist:function(e,t,r,n=xa){return Ia(this,void 0,void 0,(function*(){const i=n.userId,a=r.join(","),s=yield Oa("Playlists",{Name:e,Ids:a,UserId:i},n),{Id:o}=yield s.json(),l=`Items/${o}`,c=yield Ca(`Users/${i}/${l}`,void 0,n);return yield Oa(l,Object.assign(Object.assign({},c),{Overview:t}),n),c}))},delete:function(e,t,r){return Ia(this,void 0,void 0,(function*(){yield $a(e,t,{method:"DELETE"},r)}))},get:Ca,getFilters:function(e,t,r){return Ia(this,void 0,void 0,(function*(){return e===va.ByDecade?function(e,t){return Ia(this,void 0,void 0,(function*(){const r=(new Date).getFullYear(),n=(yield Ma("Years",e,t)).map((e=>Number(e.title))).filter((e=>e>500&&e<=r)),i=d(n,(e=>10*Math.floor(e/10)));return Object.keys(i).sort().reverse().map((e=>({id:i[e].join(","),title:`${e}s`})))}))}(t,r):function(e,t){return Ia(this,void 0,void 0,(function*(){return Ma("Genres",e,t)}))}(t,r)}))},getEndpointInfo:function(e=xa){return Ia(this,void 0,void 0,(function*(){return yield Ca("System/Endpoint",void 0,e)}))},getMusicLibraries:function(e=xa){var t;return Ia(this,void 0,void 0,(function*(){const r=yield Ca(`Users/${e.userId}/Views`,void 0,e);return((null===(t=r.Items)||void 0===t?void 0:t.filter((e=>/^(audiobooks|music|musicvideos)$/.test(e.CollectionType))))||[]).map((({Id:e,Name:t,CollectionType:r})=>({id:e,title:t,type:r})))}))},post:Oa,getPlayableUrl:Na,getPlaybackType:function(e,t=xa){return Ia(this,void 0,void 0,(function*(){try{if(e.mediaType===ti.Video){const{host:n,userId:i,token:a,deviceId:s}=t,[,,o,l]=e.src.split(":"),c=`${n}/Videos/${o}/stream?${new URLSearchParams({MediaSourceId:l||o,Static:"true",UserId:i,DeviceId:s,api_key:a})}`;return(yield(r=c,V("video",r)))?Nn.Direct:Nn.HLS}{const r=Na(e,t),n=(yield function(e){return o(this,void 0,void 0,(function*(){return(yield fetch(e,{method:"HEAD"})).headers.get("Content-Type")||""}))}(r)).toLowerCase();return"application/x-mpegurl"===n||"application/vnd.apple.mpegurl"===n?Nn.HLS:Nn.Direct}}catch(e){return Nn.Direct}var r}))}},ja=za;var La=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Da=new H("embyAuth"),Ra=new it(""),Fa=new it(!1);function _a(){return Fa.getValue()}function Ba(e){xa.token=e,Ra.next(e)}function Va(e,t,r){void 0===t&&(t=Nr);var n=Lr(e,t);return function(e,t){return De((function(e,r){var i=null!=t?t:{},a=i.leading,s=void 0===a||a,o=i.trailing,l=void 0!==o&&o,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(y(),m&&r.complete())},f=function(){d=null,m&&r.complete()},p=function(e){return d=Qe(n).subscribe(Re(r,h,f))},y=function(){if(c){c=!1;var e=u;u=null,r.next(e),!m&&p()}};e.subscribe(Re(r,(function(e){c=!0,u=e,(!d||d.closed)&&(s?y():p())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))}(0,r)}Ra.pipe(_n()).pipe(_e((e=>""!==e)),et((()=>function(){return La(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([ja.getEndpointInfo(),ja.getMusicLibraries()]);return xa.isLocal=!!e.IsLocal,xa.libraries=t,!0}catch(e){return 401===e.status?xa.token="":Da.error(e),Ra.next(""),!1}}))}()))).subscribe(Fa),Ra.next(xa.token);var Ua;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(Ua||(Ua={}));const Ha=new H("OffsetPager");class Ya extends Fi{constructor(e,t){super(t),this.fetch=e,this.fetchStates={}}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeFetches().pipe(Va(200,void 0,{leading:!1,trailing:!0}),_e((({index:e,length:t})=>t>0&&this.isInRange(e))),Be((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),et((e=>e)),et((e=>this.fetchPage(e))),Un((e=>(Ha.error(e),this.error=e,hn(void 0)))),sn(this.observeComplete())),Ha))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,r=void 0,i=function*(){if(this.fetchStates[e]!==Ua.Fulfilled&&this.fetchStates[e]!==Ua.Pending){this.fetchStates[e]=Ua.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=Ua.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=Ua.Rejected,t}}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}insertPage(e,t){var r;const n=this.items.slice(),i=Math.min(t.total,null!==(r=this.maxSize)&&void 0!==r?r:1/0),a=Math.ceil(i/this.pageSize),s=(e-1)*this.pageSize;if(t.items.forEach(((e,t)=>n[t+s]=e)),n.length=i,t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=Ua.Fulfilled;this.size=i,this.items=n}getPageNumbersFromIndex(e,t){const r=this.size||0,n=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-n,0),a=Math.min(e+n+t-1,0===r?this.maxSize?this.maxSize-1:1/0:r-1),s=this.getPageNumberFromIndex(i),o=this.getPageNumberFromIndex(a);if(s===o)return[s];{const e=[];for(let t=s;t<=o;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){const t=this.size||0;return 0===t?e>=0:e>=0&&e<t}}class qa{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=Math.min((null==r?void 0:r.maxSize)||1/0,(null==r?void 0:r.pageSize)||(xa.isLocal?qa.maxPageSize:200)),this.pager=new Ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,ParentIndexNumber,Path,ProductionYear,Overview,PresentationUniqueKey,ProviderIds",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield ja.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r,n;return{itemType:Zn.Artist,src:`emby:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",description:e.Overview||void 0,playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,thumbnails:this.createThumbnails(e),artist_mbid:null===(n=e.ProviderIds)||void 0===n?void 0:n.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n,i;return{itemType:Zn.Album,src:`emby:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,pager:this.createAlbumTracksPager(e)}}createMediaPlaylist(e){var t,r,n;const i=`emby:playlist:${e.Id}`;return{src:i,itemType:Zn.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:Gi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:Zn.Folder,src:`emby:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:Zn.Media,mediaType:l?ti.Video:ti.Audio,src:`emby:${l?"video":"audio"}:${e.Id}:${e.PresentationUniqueKey||""}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(r=e.UserData)||void 0===r?void 0:r.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480),this.createThumbnail(r,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${xa.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new hi([t]),n=new qa(`Users/${xa.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending"});return new Hi(void 0,n,r)}createArtistAllTracks(e){return{itemType:Zn.Album,src:`emby:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new qa(`Users/${xa.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"SortName",SortOrder:"Ascending"})}createAlbumTracksPager(e){return new qa(`Users/${xa.userId}/Items`,{ParentId:e.Id,SortBy:"ParentIndexNumber,IndexNumber",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new qa(`Playlists/${e.Id}/Items`,{UserId:xa.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new qa(`Users/${xa.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new hi([e]);return new Hi(t,n)}return n}getExternalUrl(e){return`${xa.host}/web/index.html#!/item?id=${e.Id}&serverId=${xa.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}qa.minPageSize=10,qa.maxPageSize=1e3;const Ka=qa;var Wa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ga="emby",Ja="AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName",Qa={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},Xa={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre","PlayCount"]},Za={id:"emby/liked-songs",title:"My Songs",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>ws({ParentId:Es(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},es={id:"emby/liked-albums",title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search:()=>ws({ParentId:Es(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},ts={id:"emby/liked-artists",title:"My Artists",icon:"heart",itemType:Zn.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Ka("Artists/AlbumArtists",{ParentId:Es(),isFavorite:!0,UserId:xa.userId})},rs={id:"emby/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>ws({ParentId:Es(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ns={id:"emby/most-played",title:"Most Played",icon:"most-played",itemType:Zn.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>ws({ParentId:Es(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},is={id:"emby/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,layout:Qa,secondaryLayout:Xa,search:()=>ws({ParentId:Es(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},as={id:"emby/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search:()=>ws({ParentId:Es(),IncludeItemTypes:"Playlist"})},ss={id:"emby/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Zn.Media,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?ws({ParentId:Es(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:Ja}):new hi},os={id:"emby/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Zn.Album,viewType:va.ByGenre,search:e=>e?ws({ParentId:Es(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new hi},ls={id:"emby/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Zn.Artist,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?new Ka("Artists/AlbumArtists",{ParentId:Es(),GenreIds:e.id,UserId:xa.userId}):new hi},cs={id:"emby/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:Zn.Media,viewType:va.ByDecade,defaultHidden:!0,search:e=>e?ws({ParentId:Es(),Years:e.id,IncludeItemTypes:"Audio",SortBy:Ja}):new hi},us={id:"emby/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Zn.Album,viewType:va.ByDecade,search:e=>e?ws({ParentId:Es(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new hi},ds={id:"emby/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>ws({ParentId:Es(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},ms={id:"emby/random-albums",title:"Random Albums",icon:"shuffle",itemType:Zn.Album,search:()=>ws({ParentId:Es(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},hs={id:"emby/videos",title:"Music Videos",icon:"video",itemType:Zn.Media,mediaType:ti.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=xa.videoLibraryId;if(!t)throw new si;return ws({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},fs={id:"emby/folders",title:"Folders",icon:"folder",itemType:Zn.Folder,viewType:va.Folders,search(){const e={itemType:Zn.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Vi((()=>Wa(this,void 0,void 0,(function*(){return xa.libraries.map((({id:t,title:r})=>{const n={itemType:Zn.Folder,src:`emby:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new hi([i]),s=new Ka(`Users/${xa.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},void 0,n);return n.pager=new Hi(a,s),n}))})))),e.pager}},ps={id:Ga,icon:Ga,name:"Emby",url:"https://emby.media/",serviceType:Mn.PersonalMedia,defaultHidden:!0,roots:[bs(Zn.Media,{title:"Songs"}),bs(Zn.Album,{title:"Albums"}),bs(Zn.Artist,{title:"Artists"}),bs(Zn.Playlist,{title:"Playlists",layout:Qa,secondaryLayout:Xa})],sources:[Za,es,ts,ns,rs,is,ss,os,ls,cs,us,ds,ms,hs,fs],labels:{[Qn.AddToLibrary]:ni("Add to Emby Favorites"),[Qn.RemoveFromLibrary]:ni("Remove from Emby Favorites")},editablePlaylists:as,get audioLibraries(){return xa.audioLibraries},get libraryId(){return xa.libraryId},set libraryId(e){xa.libraryId=e},get libraries(){return xa.libraries},set libraries(e){xa.libraries=e},observeLibraryId:()=>xa.observeLibraryId(),addToPlaylist:function(e,t){return Wa(this,void 0,void 0,(function*(){const r=ks(e);return ja.addToPlaylist(r,t.map(ks))}))},canRate:()=>!1,canStore:vs,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return Wa(this,void 0,void 0,(function*(){return{src:`emby:playlist:${(yield ja.createPlaylist(e,t,r.map(ks))).Id}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>ws({ids:ks(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return Wa(this,void 0,void 0,(function*(){return ja.getFilters(e,t)}))},getMetadata:function(e){return Wa(this,void 0,void 0,(function*(){if(!vs(e)||void 0!==e.inLibrary)return e;const t=Gn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=ks(e),n=new Ka(`Users/${xa.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield di(n,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return ja.getPlayableUrl(e)},getPlaybackType:function(e){return Wa(this,void 0,void 0,(function*(){return ja.getPlaybackType(e)}))},lookup:function(e,t,r=10,n){return Wa(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return di(gs(Zn.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return Wa(this,void 0,void 0,(function*(){const r=ks(e),n=`Users/${xa.userId}/FavoriteItems/${r}`;t?yield ja.post(n):yield ja.delete(n)}))},observeIsLoggedIn:function(){return Fa.pipe(_n())},isConnected:function(){return!!xa.token},isLoggedIn:_a,login:function(){return La(this,void 0,void 0,(function*(){if(!_a()){Da.log("connect");try{const e=yield Pa();if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);xa.serverId=t,xa.userId=r,Ba(n)}}catch(e){Da.error(e)}}}))},logout:function(){return La(this,void 0,void 0,(function*(){Da.log("disconnect"),xa.clear(),Ba(""),Fa.next(!1)}))}},ys=ps;function vs(e){switch(e.itemType){case Zn.Album:return!e.synthetic;case Zn.Folder:return!1;default:return!0}}function bs(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`emby/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>gs(e,t)})}function gs(e,t,r,n){const i=Object.assign({ParentId:Es(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===Zn.Artist)return new Ka("Artists",Object.assign(Object.assign({},i),{UserId:xa.userId}),n);switch(e){case Zn.Media:i.IncludeItemTypes="Audio",i.SortBy=Ja;break;case Zn.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case Zn.Playlist:i.IncludeItemTypes="Playlist"}return ws(i,n)}function ws(e,t){return new Ka(`Users/${xa.userId}/Items`,e,t)}function Es(){const e=xa.libraryId;if(!e)throw new ai;return e}function ks({src:e}){const[,,t]=e.split(":");return t}const xs=new ka("jellyfin");var Ss=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ts={addToPlaylist:function(e,t){return Ss(this,void 0,void 0,(function*(){return ja.addToPlaylist(e,t,xs)}))},createPlaylist:function(e,t,r){return Ss(this,void 0,void 0,(function*(){return ja.createPlaylist(e,t,r,xs)}))},delete:function(e,t){return Ss(this,void 0,void 0,(function*(){return ja.delete(e,t,xs)}))},get:function(e,t){return Ss(this,void 0,void 0,(function*(){return ja.get(e,t,xs)}))},getEndpointInfo:function(){return Ss(this,void 0,void 0,(function*(){return ja.getEndpointInfo(xs)}))},getFilters:function(e,t){return Ss(this,void 0,void 0,(function*(){return ja.getFilters(e,t,xs)}))},getMusicLibraries:function(){return Ss(this,void 0,void 0,(function*(){return ja.getMusicLibraries(xs)}))},post:function(e,t={}){return Ss(this,void 0,void 0,(function*(){return ja.post(e,t,xs)}))},getPlayableUrl:function(e){return ja.getPlayableUrl(e,xs)},getPlaybackType:function(e){return Ss(this,void 0,void 0,(function*(){return ja.getPlaybackType(e,xs)}))}};var Ps=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const As=new H("jellyfinAuth"),Is=new it(""),Cs=new it(!1);function Ms(){return Cs.getValue()}function Os(e){xs.token=e,Is.next(e)}Is.pipe(_n()).pipe(_e((e=>""!==e)),et((()=>function(){return Ps(this,void 0,void 0,(function*(){try{const[e,t]=yield Promise.all([Ts.getEndpointInfo(),Ts.getMusicLibraries()]);return xs.isLocal=!!e.IsLocal,xs.libraries=t,!0}catch(e){return 401===e.status?xs.token="":As.error(e),Is.next(""),!1}}))}()))).subscribe(Cs),Is.next(xs.token);class $s{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=Math.min((null==r?void 0:r.maxSize)||1/0,(null==r?void 0:r.pageSize)||(xs.isLocal?$s.maxPageSize:200)),this.pager=new Ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,ChildCount,DateCreated,Genres,Path,ProviderIds",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield Ts.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r,n;return{itemType:Zn.Artist,src:`jellyfin:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,artist_mbid:null===(n=e.ProviderIds)||void 0===n?void 0:n.MusicBrainzArtist,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n,i;return{itemType:Zn.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,release_mbid:null===(i=e.ProviderIds)||void 0===i?void 0:i.MusicBrainzAlbum,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,r,n;const i=`jellyfin:playlist:${e.Id}`;return{src:i,itemType:Zn.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistItemsPager(e),isPinned:Gi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:Zn.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i,a,s,o;const l="Video"===e.MediaType,c=null===(t=e.ProviderIds)||void 0===t?void 0:t.MusicBrainzArtist;return{itemType:Zn.Media,mediaType:l?ti.Video:ti.Audio,src:`jellyfin:${l?"video":"audio"}:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(r=e.UserData)||void 0===r?void 0:r.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(i=e.UserData)||void 0===i?void 0:i.IsFavorite,artists:(null===(a=e.Artists)||void 0===a?void 0:a.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0,track_mbid:null===(s=e.ProviderIds)||void 0===s?void 0:s.MusicBrainzTrack,release_mbid:null===(o=e.ProviderIds)||void 0===o?void 0:o.MusicBrainzAlbum,artist_mbids:c?[c]:void 0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480),this.createThumbnail(r,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${xs.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createAlbumTracksPager(e){return new $s(`Users/${xs.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new hi([t]),n=new $s(`Users/${xs.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending"});return new Hi(void 0,n,r)}createArtistAllTracks(e){return{itemType:Zn.Album,src:`jellyfin:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new $s(`Users/${xs.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"Name",SortOrder:"Ascending"})}createPlaylistItemsPager(e){return new $s(`Playlists/${e.Id}/Items`,{UserId:xs.userId,MediaType:"Audio"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new $s(`Users/${xs.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new hi([e]);return new Hi(t,n)}return n}getExternalUrl(e){return`${xs.host}/web/index.html#!/details?id=${e.Id}&serverId=${xs.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}$s.minPageSize=10,$s.maxPageSize=1e3;const Ns=$s;var zs=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const js="jellyfin",Ls={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},Ds={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},Rs={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>ao({ParentId:so(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Fs={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search:()=>ao({ParentId:so(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},_s={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:Zn.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Ns("Artists/AlbumArtists",{ParentId:so(),isFavorite:!0,UserId:xs.userId})},Bs={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>ao({ParentId:so(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Vs={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:Zn.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>ao({ParentId:so(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Us={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,layout:Ls,secondaryLayout:Ds,search:()=>ao({ParentId:so(),SortBy:"DateCreated,SortName",SortOrder:"Descending,Ascending",IncludeItemTypes:"Playlist"})},Hs={id:"jellyfin/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search:()=>ao({ParentId:so(),IncludeItemTypes:"Playlist"})},Ys={id:"jellyfin/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Zn.Media,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?ao({ParentId:so(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new hi},qs={id:"jellyfin/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Zn.Album,viewType:va.ByGenre,search:e=>e?ao({ParentId:so(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new hi},Ks={id:"jellyfin/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Zn.Artist,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?new Ns("Artists/AlbumArtists",{ParentId:so(),GenreIds:e.id,UserId:xs.userId}):new hi},Ws={id:"jellyfin/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:Zn.Media,viewType:va.ByDecade,defaultHidden:!0,search:e=>e?ao({ParentId:so(),Years:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new hi},Gs={id:"jellyfin/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Zn.Album,viewType:va.ByDecade,search:e=>e?ao({ParentId:so(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new hi},Js={id:"jellyfin/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>ao({ParentId:so(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},Qs={id:"jellyfin/random-albums",title:"Random Albums",icon:"shuffle",itemType:Zn.Album,search:()=>ao({ParentId:so(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},Xs={id:"jellyfin/videos",title:"Music Videos",icon:"video",itemType:Zn.Media,mediaType:ti.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=xs.videoLibraryId;if(!t)throw new si;return ao({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},Zs={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:Zn.Folder,viewType:va.Folders,search(){const e={itemType:Zn.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Vi((()=>zs(this,void 0,void 0,(function*(){return xs.libraries.map((({id:t,title:r})=>{const n={itemType:Zn.Folder,src:`jellyfin:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new hi([i]),s=new Ns(`Users/${xs.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},void 0,n);return n.pager=new Hi(a,s),n}))})))),e.pager}},eo={id:js,icon:js,name:"Jellyfin",url:"https://jellyfin.org",serviceType:Mn.PersonalMedia,defaultHidden:!0,roots:[no(Zn.Media,{title:"Songs"}),no(Zn.Album,{title:"Albums"}),no(Zn.Artist,{title:"Artists"}),no(Zn.Playlist,{title:"Playlists",layout:Ls,secondaryLayout:Ds})],sources:[Rs,Fs,_s,Vs,Bs,Us,Ys,qs,Ks,Ws,Gs,Js,Qs,Xs,Zs],labels:{[Qn.AddToLibrary]:ni("Add to Jellyfin Favorites"),[Qn.RemoveFromLibrary]:ni("Remove from Jellyfin Favorites")},editablePlaylists:Hs,get audioLibraries(){return xs.audioLibraries},get libraryId(){return xs.libraryId},set libraryId(e){xs.libraryId=e},get libraries(){return xs.libraries},set libraries(e){xs.libraries=e},observeLibraryId:()=>xs.observeLibraryId(),addToPlaylist:function(e,t){return zs(this,void 0,void 0,(function*(){const r=oo(e);return Ts.addToPlaylist(r,t.map(oo))}))},canRate:()=>!1,canStore:ro,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return zs(this,void 0,void 0,(function*(){return{src:`jellyfin:playlist:${(yield Ts.createPlaylist(e,t,r.map(oo))).Id}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Genre"]},id:e.src,icon:"pin",isPin:!0,search:()=>ao({ids:oo(e),IncludeItemTypes:"Playlist"})}},getFilters:function(e,t){return zs(this,void 0,void 0,(function*(){return Ts.getFilters(e,t)}))},getMetadata:function(e){return zs(this,void 0,void 0,(function*(){if(!ro(e)||void 0!==e.inLibrary)return e;const t=Gn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=oo(e),n=new Ns(`Users/${xs.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield di(n,{timeout:2e3});return x(e,i[0])}))},getPlayableUrl:function(e){return Ts.getPlayableUrl(e)},getPlaybackType:function(e){return zs(this,void 0,void 0,(function*(){return Ts.getPlaybackType(e)}))},lookup:function(e,t,r=10,n){return zs(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return di(io(Zn.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return zs(this,void 0,void 0,(function*(){const r=oo(e),n=`Users/${xs.userId}/FavoriteItems/${r}`;t?yield Ts.post(n):yield Ts.delete(n)}))},observeIsLoggedIn:function(){return Cs.pipe(_n())},isConnected:function(){return!!xs.token},isLoggedIn:Ms,login:function(){return Ps(this,void 0,void 0,(function*(){if(!Ms()){As.log("connect");try{const e=yield Pa(to,xs);if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);xs.serverId=t,xs.userId=r,Os(n)}}catch(e){As.error(e)}}}))},logout:function(){return Ps(this,void 0,void 0,(function*(){As.log("disconnect"),xs.clear(),Os(""),Cs.next(!1)}))}},to=eo;function ro(e){switch(e.itemType){case Zn.Album:return!e.synthetic;case Zn.Folder:return!1;default:return!0}}function no(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>io(e,t)})}function io(e,t,r,n){const i=Object.assign({ParentId:so(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===Zn.Artist)return new Ns("Artists",Object.assign(Object.assign({},i),{UserId:xs.userId}),n);switch(e){case Zn.Media:i.IncludeItemTypes="Audio",i.SortBy="AlbumArtist,Album,SortName";break;case Zn.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case Zn.Playlist:i.IncludeItemTypes="Playlist"}return ao(i,n)}function ao(e,t){return new Ns(`Users/${xs.userId}/Items`,e,t)}function so(){const e=xs.libraryId;if(!e)throw new ai;return e}function oo({src:e}){const[,,t]=e.split(":");return t}var lo=r(2568),co=r.n(lo);const uo=new J("lastfm"),mo={get token(){return uo.getString("token")},set token(e){uo.setString("token",e)},get userId(){return uo.getString("userId")},set userId(e){uo.setString("userId",e)},get sessionKey(){return uo.getString("sessionKey")},set sessionKey(e){uo.setString("sessionKey",e)},get firstScrobbledAt(){return uo.getString("firstScrobbledAt")},set firstScrobbledAt(e){uo.setString("firstScrobbledAt",e)},get playCount(){return uo.getNumber("playCount")},set playCount(e){uo.setNumber("playCount",e)},clear(){uo.clear()}};var ho=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const fo=new H("lastfmApi"),po=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}getSignature(e){const t=Object.keys(e);let r="";return t.sort(),t.forEach((t=>r+=t+e[t])),r+=yi,co()(r)}scrobble(e){return ho(this,void 0,void 0,(function*(){fo.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const r=e[0],n=String(r.playedAt);yield this.post(Object.assign({method:t,timestamp:n},this.getScrobbleParams(r)))}else if(e.length>0){const r={};e.forEach(((e,t)=>{const n=this.getScrobbleParams(e);r[`timestamp[${t}]`]=String(e.playedAt),Object.keys(n).forEach((e=>{r[`${e}[${t}]`]=n[e]}))})),yield this.post(Object.assign({method:t},r))}}))}updateNowPlaying(e){return ho(this,void 0,void 0,(function*(){fo.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){fo.log('Failed to update "now playing":',{item:e}),fo.error(t)}}))}getUserInfo(){return ho(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:mo.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return ho(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:pi,format:"json"}))}`,r=yield fetch(t,{method:"GET"});if(!r.ok)throw r;return r.json()}))}post(e){return ho(this,void 0,void 0,(function*(){const t=mo.token,r=mo.sessionKey;e=Object.assign(Object.assign({},e),{api_key:pi,token:t,sk:r});const n=this.getSignature(e),i=`${new URLSearchParams(e)}&api_sig=${n}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.track_mbid&&(t.mbid=e.track_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,r=t){if(e){const n=e["#text"];if(n&&!n.endsWith(this.placeholderImage))return{url:n,width:t,height:r}}}},yo=po;var vo=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const bo=new H("lastfmAuth"),go=new it(""),wo=new it("");function Eo(){return go.pipe(_n())}function ko(){return""!==go.getValue()}function xo(){return Eo().pipe(Be((e=>""!==e)),_n())}Eo().pipe(_e((e=>!!e)),et((()=>function(){return vo(this,void 0,void 0,(function*(){try{yield yo.getUserInfo()}catch(e){401===e.status?(mo.clear(),wo.next(""),go.next("")):bo.error(e)}}))}()))).subscribe(bo),wo.next(mo.sessionKey),go.next(mo.token);class So{constructor(e,t,r,n){this.album=n,this.defaultConfig={pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),r),{page:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new Bi(((e=this.defaultConfig.pageSize)=>{return r=this,n=void 0,a=function*(){const r=this.pageNumber,n=yield yo.get(Object.assign(Object.assign({},s),{page:r,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:o,itemType:l}=t(n);return{items:this.createMediaObjects(l,i),total:a,atEnd:o}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case Zn.Artist:return t.map((e=>this.createMediaArtist(e)));case Zn.Album:return t.map((e=>this.createMediaAlbum(e)));case Zn.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,r,n,i,a,s;const o=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(Zn.Media,e)),{mediaType:ti.Audio,src:o?`lastfm:listen:${o}`:`lastfm:track:${Ea()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(r=this.album)||void 0===r?void 0:r.name)||(null===(n=e.album)||void 0===n?void 0:n["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(s=e.album)||void 0===s?void 0:s.mbid),track_mbid:e.mbid,duration:Number(e.duration)||0,track:l&&Number(l)||void 0,inLibrary:"loved"in e?!!Number(e.loved):"user.getLovedTracks"===this.method||void 0,playedAt:o})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(Zn.Album,e)),{src:`lastfm:album:${Ea()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(Zn.Artist,e)),{src:`lastfm:artist:${Ea()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:Zn.Album,title:"Top Tracks",thumbnails:yo.createThumbnails(e.image),src:`lastfm:top-tracks:${Ea()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:yo.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new hi([t]),n=new So({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Zn.Album}}),{maxSize:100,playCountName:"userplaycount"});return new Hi(r,n)}createAlbumPager(e){return new So({method:"album.getInfo",album:e.name,artist:e.artist.name,user:mo.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,r=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:r,total:r.length,atEnd:!0,itemType:Zn.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new So({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Zn.Media}}),{pageSize:10,maxSize:10})}}So.minPageSize=10,So.maxPageSize=200;const To=So;class Po extends To{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:mo.userId}),(({recenttracks:e})=>{var t,r;const n=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],s="true"===(null===(r=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===r?void 0:r.nowplaying),o=Number(n.page)||1,l=Number(n.totalPages)||1,c=1===l||o===l,u=Number(n.total)||void 0;return s&&a.shift(),{items:a,total:u,atEnd:c,itemType:Zn.Media}}),t)}}var Ao=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Io={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Co={id:"lastfm/history",title:"History",icon:"clock",itemType:Zn.Media,search:({startAt:e=0}={})=>new Po(e?{to:e}:void 0)},Mo={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,search:()=>new Po},Oo={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new To({method:"user.getLovedTracks",user:mo.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},r=e.track,n=r?Array.isArray(r)?r:[r]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,s=1===a||i===a;return{items:n,total:Number(t.total)||void 0,atEnd:s,itemType:Zn.Media}}))},$o={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",serviceType:Mn.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[Mo],sources:[jo("user.getTopTracks",{title:"Top Tracks",itemType:Zn.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),jo("user.getTopAlbums",{title:"Top Albums",itemType:Zn.Album,layout:Io}),jo("user.getTopArtists",{title:"Top Artists",itemType:Zn.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:Io}),Oo,Co],labels:{[Qn.AddToLibrary]:"Love on last.fm",[Qn.RemoveFromLibrary]:"Unlove on last.fm"},canRate:()=>!1,canStore:function(e){var t;return e.itemType===Zn.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},compareForRating:function(e,t){var r,n,i;const[a]=e.src.split(":"),[s]=t.src.split(":");return a===s&&(e.itemType===Zn.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(r=e.artists)||void 0===r?void 0:r[0])&&zo(e.title,t.title)&&zo(null===(n=e.artists)||void 0===n?void 0:n[0],null===(i=t.artists)||void 0===i?void 0:i[0])))},getMetadata:function(e){return Ao(this,void 0,void 0,(function*(){if(e.itemType!==Zn.Media||void 0!==e.inLibrary)return e;const t={method:"track.getInfo",user:mo.userId};if(e.track_mbid)t.mbid=e.track_mbid;else{const{title:r,artists:n=[]}=e;if(t.artist=n[0],t.track=r,!t.artist)return e}const{track:r}=yield yo.get(t);if(!r||"error"in r)throw Error((null==r?void 0:r.message)||"Not found");{const t={},{album:n,wiki:i}=r;return n&&(t.album=n.title,t.albumArtist=n.artist,e.thumbnails||(t.thumbnails=yo.createThumbnails(n.image))),!e.description&&i&&(t.description=P(i.content||i.summary)),!e.year&&i&&(t.year=i.published&&new Date(i.published).getFullYear()||void 0),Object.assign(Object.assign(Object.assign({},e),t),{inLibrary:Gn.getInLibrary(e,!!Number(r.userloved)),playCount:Number(r.userplaycount)||0,globalPlayCount:Number(r.playcount)||0})}}))},store:function(e,t){return Ao(this,void 0,void 0,(function*(){if(e.itemType===Zn.Media){const{title:r,artists:n=[]}=e,i=n[0];r&&i&&(yield yo.post({method:t?"track.love":"track.unlove",track:r,artist:i}))}}))},observeIsLoggedIn:xo,isConnected:function(){return!!mo.token},isLoggedIn:ko,login:function(){return vo(this,void 0,void 0,(function*(){if(!ko()){bo.log("connect");try{const e=yield function(){return vo(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/lastfm/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});e(r.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${pi}&cb=${n}`,"last.fm","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return vo(this,void 0,void 0,(function*(){const t="auth.getSession",r={api_key:pi,token:e,method:t},n=yo.getSignature(r),i=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${pi}&token=${e}&api_sig=${n}&format=json`);if(!i.ok)throw i;const{session:a}=yield i.json();return mo.userId=a.name,mo.token=e,mo.sessionKey=a.key,a.key}))}(e);wo.next(t),go.next(e)}catch(e){bo.error(e)}}}))},logout:function(){return vo(this,void 0,void 0,(function*(){bo.log("disconnect"),mo.clear(),wo.next(""),go.next("")}))}},No=$o;function zo(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function jo(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:r="overall"}={})=>new To({method:e,period:r,user:mo.userId},(r=>{const[,n]=e.toLowerCase().split("."),i=r[n.slice(3)],a=i["@attr"],s=i[n.slice(6,-1)],o=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||o===l;return{items:s,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}var Lo=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Do=new H("localdb/listens"),Ro=[],Fo=new it(Ro);class _o extends Bt.ZP{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const Bo=new _o;function Vo(){return Fo.pipe(_e((e=>e!==Ro)))}function Uo(e,t,r){const n=Math.min(e/2,240);return t=Math.floor(t/1e3),(r=Math.floor(r/1e3))-t>n}function Ho(e){return Lo(this,void 0,void 0,(function*(){try{e.length>0&&(yield Bo.items.bulkPut(e))}catch(e){Do.error(e)}}))}function Yo(e,t=30){return Math.round(e.playedAt/t)}function qo(e,t,r=5){const n=t.playedAt,i=n-r,a=n+t.duration+r;for(const r of e){if(r.playedAt<i)return;if(r.playedAt>i&&r.playedAt<a&&Go(t,r,.5))return r}}function Ko(e,t){const r=Wo();return function(e,t,r=5){const n=t.playedAt;if(n)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<n)return;const s=e[i],o=s.playedAt-r,l=s.playedAt+s.duration+r;if(n>o&&n<l&&Go(s,t,.75))return s}}(r,e,t)||al(r,e)}function Wo(){return Fo.getValue()}function Go(e,t,r){return T(e.title,t.title,r)}function Jo(e){return Lo(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,r=Math.floor(Date.now()/1e3)-1209600,n=yield Bo.items.where(t).equals(0).toArray();yield Ho(n.filter((e=>e.playedAt<r)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}Lo(void 0,void 0,void 0,(function*(){try{yield Jo("lastfm"),yield Jo("listenbrainz")}catch(e){Do.error(e)}(0,Bt.Y1)((()=>Bo.items.orderBy("playedAt").reverse().toArray())).subscribe(Fo)}));const Qo=new Ne,Xo=new Ne,Zo=new Ne;var el=r(4909),tl=r.n(el);const rl=new J("lookup"),nl={get preferPersonalMedia(){return rl.getBoolean("preferPersonalMedia")},set preferPersonalMedia(e){rl.setBoolean("preferPersonalMedia",e)}},il=/\s*[\s[({](with\s|featuring\s|feat[\s.]+|ft[\s.]+).+$/i;function al(e,t,r=[],n){const{artist:i,title:a}=wl(t);if(!i||!a)return;let s=sl(e,t,r);return nl.preferPersonalMedia&&(s=S(s,(e=>{const t=Jf(e);return!!t&&ep(t)}))),n&&(s=S(s,(e=>e.src.startsWith(`${n}:`)))),s[0]}function sl(e,t,r,n){let i=[];return r.length>0&&(i=e.filter((e=>e.isrc&&r.includes(e.isrc)))),i=0===i.length?e.filter((e=>ll(e,t))):S(i,(e=>ll(e,t))),0===i.length&&(i=e.filter((e=>ol(e,t,!0,!0)))),n||(0===i.length&&(i=e.filter((e=>ol(e,t,!0,!1)))),0===i.length&&(i=e.filter((e=>ol(e,t,!1,!1))))),i=S(i,(e=>hl(e,t))),i=S(i,(e=>hl(e,t)&&e.track===t.track)),i}function ol(e,t,r,n){return!(!function(e,t,r){const n=t.title;return!!n&&(!!vl(n,e.title)||(r?dl(e,t,!0):!!ml(e,e.title,n)||(!!ml(e,fl(e.title),fl(n))||dl(e,t,!1))))}(e,t,r)||!cl(e,t,n))||!(n||r||!function(e,t){return!(!cl(e,t,!0)||!pl(e,t))||(!(!cl(e,t,!1)||!pl(e,t))||!!T(yl(e),yl(t)))}(e,t))}function ll(e,t){return!!(t.src===e.src||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid||t.track_mbid&&t.track_mbid===e.track_mbid)}function cl(e,t,r){var n;const i=null===(n=t.artists)||void 0===n?void 0:n[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const s=a[0];if(!s)return!1;if(vl(i,s))return!0;if(r)return!1;if(vl(gl(i),gl(s)))return!0;if(vl(El(i),El(s)))return!0;const o=t.albumArtist;return!!(o&&vl(gl(o),gl(s))||vl(El(i),e.albumArtist)||function(e,t){const r=ul(t.artists),n=ul(e.artists);return(n.length>1||r.length>1)&&r.filter((e=>n.find((t=>vl(gl(e),gl(t)))))).length>0}(e,t)||function(e,t){var r,n;const i=gl((null===(r=t.artists)||void 0===r?void 0:r[0])||""),a=gl((null===(n=e.artists)||void 0===n?void 0:n[0])||""),[s,o]=i.length>a.length?[i,a]:[a,i];return!!(bl(s,`(${o})`)||bl(s,`[${o}]`)||bl(s,`{${o}}`))}(e,t))}function ul(e){return e.join("|").split(/\s*[,;&|/x×]\s*/)}function dl(e,t,r){if(!hl(e,t))return!1;if(e.track!==t.track)return!1;const n=gl(e.title),i=gl(t.title);return r?vl(n,i):!(!n.startsWith(i)&&!i.startsWith(n))||T(n,i,.75)}function ml(e,t,r){if(t=gl(t),vl(r=gl(r),t))return!0;const[,...n]=e.artists||[];if(n.length>0){const e=n.length>1?` & ${n.pop()}`:"";if(vl(r,`${t} (feat. ${n.join(", ")}${e})`))return!0}return!(!il.test(r)||!vl(El(r),t))||!(!il.test(e.title)||!vl(r,El(t)))}function hl(e,t){return!(!e.album||!t.album)&&(!(!t.release_mbid||t.release_mbid!==e.release_mbid)||vl(gl(t.album),gl(e.album)))}function fl(e){return(e=(e=e.replace(/\s*\((19|20)\d\d(\sDigital)?\sRemaster\)$/gi,"")).replace(/\s*\((Album|Single)(\s+Version)?\)$/gi,"")).replace(/\s*-\s*(Album|Single)(\s+Version)?$/gi,"")}function pl(e,t){return T(gl(t.title,!0).toLowerCase(),gl(e.title,!0).toLowerCase())}function yl(e){const{artist:t,title:r}=wl(e);return`${gl(t,!0)}-${gl(r,!0)}`.toLowerCase()}function vl(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function bl(e,t=""){const r=e.length-t.length;for(let n=0;n<=r;n++)if(vl(e.substring(n,n+t.length),t))return!0;return!1}function gl(e,t){let r=tl()(e).replace(/\s\s+/g," ").trim();return t&&(r=r.replace(/[^\w\s]/g,"")),r}function wl(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function El(e){return e.replace(il,"")}var kl,xl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Sl=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const Tl=new H("lookup");class Pl{constructor(e){this.item=e,this.controller=new AbortController,kl.set(this,void 0),Pl.current&&Pl.current.cancel(),Pl.current=this}get cancelled(){return this.signal.aborted}get promise(){return Sl(this,kl,"f")}cancel(){this.controller.abort("Cancelled")}find(){return xl(this,void 0,void 0,(function*(){const e=this.item;let t;!function(e){Qo.next({lookupItem:e})}(e);try{(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)})(this,kl,this.findItem(e),"f"),t=yield Sl(this,kl,"f"),t&&([Pl.lastFoundServiceId]=t.src.split(":"))}catch(e){this.cancelled||Tl.error(e)}return!t&&this.cancelled?function(e){Zo.next({lookupItem:e})}(e):function(e,t){Xo.next({lookupItem:e,foundItem:t?x(t,e):void 0})}(e,t),Pl.current===this&&(Pl.current=null),t}))}get signal(){return this.controller.signal}findItem(e){return xl(this,void 0,void 0,(function*(){const t=Ko(e);if(t&&Vf(t))return t;const{link:r}=e,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["link"]),i=r&&Qf(r)?Object.assign(Object.assign({},n),r):void 0;if(i&&Vf(i))return i;let a=[],s=[];const{artist:o,title:l}=wl(e);if(o&&l){s=yield this.getISRCs(e);const t=Jf(r);if(t&&(a=yield this.serviceLookup(t,e,s),0===a.length&&("plex"===t.id||"tidal"===t.id))){const t=Gf("plex-tidal");t&&(a=yield this.serviceLookup(t,e,s))}0===a.length&&s.length>0&&(a=yield this.lookupByISRC(s)),0===a.length&&(a=yield this.multiServiceLookup(e,s,t))}return al(a,e,s,Pl.lastFoundServiceId)||t||i}))}serviceLookup(e,t,r,n){return xl(this,void 0,void 0,(function*(){this.throwIfCancelled();try{if(e.lookup&&e.isLoggedIn()){const{artist:i,title:a}=wl(t),s=e=>String(e).replace(/[([{}].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," ");return sl(yield e.lookup(s(t.albumArtist||El(i)),s(El(a)),10,2e3),t,r,n)}}catch(e){Tl.error(e)}return[]}))}multiServiceLookup(e,t,r){return xl(this,void 0,void 0,(function*(){this.throwIfCancelled();const n=Hf().filter((e=>e!==r&&e.isLoggedIn()));return 0===n.length?[]:(yield Promise.all([...n.map((r=>this.serviceLookup(r,e,t)))])).flat()}))}lookupByISRC(e){return xl(this,void 0,void 0,(function*(){this.throwIfCancelled();const t=this.getISRCServices();return 0===t.length?[]:(yield Promise.all([...t.map((t=>t.lookupByISRC(e,10,2e3)))])).flat()}))}getISRCs(e){return xl(this,void 0,void 0,(function*(){if(e.isrc)return[e.isrc];if(this.getISRCServices().length>0)try{return yield Vl.getISRCs(e,this.signal)}catch(e){Tl.error(e)}return[]}))}getISRCServices(){return Hf().filter((e=>!!e.lookupByISRC&&e.isLoggedIn()))}throwIfCancelled(){if(this.cancelled)throw Error(this.signal.reason)}}kl=new WeakMap,Pl.current=null,Pl.lastFoundServiceId="";class Al extends Vi{constructor(e){super((()=>{return t=this,r=void 0,i=function*(){const t=yield Vl.get(`release/${e}`,{inc:"recordings+artist-credits+isrcs"}),{media:[{tracks:r=[]}={}]=[]}=t;return r.map((e=>_l(t,e)))},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}))}}const Il={CD:1,SACD:2,MiniDisc:3,DAT:4,"Digital Media":5,DCC:6,HDCD:7,"USB Flash Drive":8,slotMusic:9,UMD:10,"CD-R":11,"8cm CD":12,"Blu-spec CD":13,"SHM-CD":14,HQCD:15,"Hybrid SACD":16,"CD+G":17,"8cm CD+G":18,"Enhanced CD":19,"Data CD":20,"DTS CD":21,Playbutton:22,"Music Card":23,VinylDisc:24,'3.5" Floppy Disk':25,"SHM-SACD":26,CED:27,"Copy Control CD":28,"SD Card":29,"Hybrid SACD (CD layer)":30,"Hybrid SACD (SACD layer)":31,PlayTape:32,HiPac:33,"Floppy Disk":34,"Zip Disk":35,"VinylDisc (CD side)":36};var Cl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ml="https://musicbrainz.org/ws/2",Ol=new class{constructor(e=1e3,t=1/0){this.period=e,this.maxRequests=t,this.requests=[],this.currentRequest$=new Ne,this.lastFetchTime=0,this.timerId=void 0}get size(){return this.requests.length}fetch(e){return t=this,r=void 0,i=function*(){const t=Le(this.currentRequest$.pipe(_e((t=>t===e)),et((e=>{var t;if(null===(t=e.signal)||void 0===t?void 0:t.aborted)throw Error(e.signal.reason);{this.lastFetchTime=Date.now();const t=[],{signal:r,timeout:n}=e;r&&t.push(r),n&&t.push(AbortSignal.timeout(n));const i=function(e){const t=new AbortController;for(const r of e){if(r.aborted)return t.abort(),r;r.addEventListener("abort",(()=>t.abort(r.reason)),{signal:t.signal})}return t.signal}(t);return fetch(new Request(e.url,Object.assign(Object.assign({},e),{signal:i})))}}))));return this.addRequest(e),t},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}addRequest(e){if(this.flush(),this.size>=this.maxRequests)throw Error("Too many requests");this.requests.push(e),this.startTimer()}startTimer(){if(!this.timerId){const e=Date.now()-this.lastFetchTime;if(e<this.period){const t=this.period-e;this.timerId=setTimeout((()=>{this.timerId=void 0,this.nextRequest()}),t)}else this.nextRequest()}}nextRequest(){this.flush();const e=this.requests.shift();e&&(this.currentRequest$.next(e),this.size>0&&this.startTimer())}flush(){const[e,t]=m(this.requests,(e=>{var t;return null===(t=e.signal)||void 0===t?void 0:t.aborted}));for(const t of e)this.currentRequest$.next(t);this.requests.length=0,this.requests.push(...t)}}(1200,5);function $l(e,t,r){return Cl(this,void 0,void 0,(function*(){const n={signal:r,timeout:2e3},i=Array.isArray(e),a=(i?e:[e]).map(((e,t)=>({item:e,index:t}))),s=[],o=[],l=[],c=[],u=[];for(const e of a){const{recording_mbid:r,release_mbid:n,track_mbid:i,isrc:d}=e.item;r&&n&&i&&d?s.push(e):i?o.push(e):r&&n?l.push(e):t?s.push(e):r?l.push(e):d?u.push(e):n&&1===a.length?c.push(e):s.push(e)}const d=(yield Promise.all([Promise.resolve(s),Nl(o,n),zl(l,n),Ll(c,n),jl(u,n)])).flat(),m=a.map((e=>d.find((t=>t.index===e.index)).item));return i?m:m[0]}))}function Nl(e,t){return Cl(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield Rl("/recording",{query:e.map((e=>`tid:${e.item.track_mbid}`)).join(" OR ")},t),n=Fl(r);return e.map((e=>{const{item:t,index:r}=e,i=t.track_mbid,a=n.filter((e=>e.track_mbid===i)),s=al(a,t);if(s){const{artist_mbids:e,release_mbid:n,recording_mbid:a}=s,o=Dl({artist_mbids:e,release_mbid:n,recording_mbid:a},t,s);return Yn({match:e=>e.track_mbid===i,values:o}),{item:Object.assign(Object.assign({},t),o),index:r}}return e}))}))}function zl(e,t){return Cl(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield Rl("/recording",{query:e.map((e=>`rid:${e.item.recording_mbid}`)).join(" OR ")},t),n=Fl(r);return e.map((e=>{const{item:t,index:r}=e,i=t.recording_mbid,a=t.release_mbid;let s=n.filter((e=>e.recording_mbid===i));s=S(s,(e=>e.release_mbid===a));const o=al(s,t);if(o){const{artist_mbids:e,release_mbid:n,track_mbid:a}=o,s=Dl({artist_mbids:e,release_mbid:n,track_mbid:a},t,o);return Yn({match:e=>e.recording_mbid===i,values:s}),{item:Object.assign(Object.assign({},t),s),index:r}}return e}))}))}function jl(e,t){return Cl(this,void 0,void 0,(function*(){if(0===e.length)return e;const{recordings:r=[]}=yield Rl("/recording",{query:e.map((e=>`isrc:${e.item.isrc}`)).join(" OR ")},t);return e.map((e=>{const{item:t,index:n}=e,i=t.isrc,a=al(Fl(r.filter((e=>{var t;return null===(t=e.isrcs)||void 0===t?void 0:t.includes(i)}))),t);if(a){const{recording_mbid:e,artist_mbids:r,release_mbid:s,track_mbid:o}=a,l=Dl({recording_mbid:e,artist_mbids:r,release_mbid:s,track_mbid:o},t,a);return Yn({match:e=>e.isrc===i,values:l}),{item:Object.assign(Object.assign({},t),l),index:n}}return e}))}))}function Ll(e,t){return Cl(this,void 0,void 0,(function*(){if(1!==e.length)return e;const[r]=e,{item:n,index:i}=r,a=n.release_mbid,s=n.recording_mbid,o=n.src,l=new Al(a),c=yield di(l,t),u=s?c.find((e=>e.recording_mbid===s)):al(c,n);if(u){const{recording_mbid:e,artist_mbids:t,track_mbid:r}=u,s=Dl({recording_mbid:e,artist_mbids:t,track_mbid:r},n,u);return Yn({match:t=>t.release_mbid===a&&(e?t.recording_mbid===e:t.src===o),values:s}),[{item:Object.assign(Object.assign({},n),s),index:i}]}return e}))}function Dl(e,t,r){let{duration:n,track:i,year:a,isrc:s,albumArtist:o}=t;return n=n||r.duration,i=i||r.track,a=a||r.year,s=s||r.isrc,o=o||r.albumArtist,Object.assign(Object.assign({},e),{duration:n,track:i,year:a,isrc:s,albumArtist:o})}function Rl(e,t={},r={}){return Cl(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`;const n=new Request(`${Ml}/${e}`,Object.assign(Object.assign({},r),{method:"GET",headers:{"User-Agent":"ampcast/0.9.5 ( rekkyrosso@gmail.com )"}})),i=yield Ol.fetch(n);if(!i.ok)throw i;return i.json()}))}function Fl(e){let t=[];for(const r of e){const e=r.releases||[];for(const n of e){const e=n.status||"",i=n.country||"",a=n.media||[];for(const s of a){const a=s.format||"",o=s.track||[];for(const s of o){s.recording=r;const o=_l(n,s,{status:e,country:i,format:a});t.push(o)}}}}return t=S(t,(e=>"Official"===e.musicBrainz.status)),t.sort(((e,t)=>(Il[e.musicBrainz.format]||99)-(Il[t.musicBrainz.format]||99))),t}function _l(e,t,r){var n;const i=t.recording,[a]=Bl(e)||[],s=Bl(i);return{itemType:Zn.Media,mediaType:ti.Audio,src:`musicbrainz:track:${t.id}`,externalUrl:`https://musicbrainz.org/recording/${i.id}`,title:t.title,artists:null==s?void 0:s.map((e=>e.name)),album:e.title,albumArtist:null==a?void 0:a.name,duration:t.length/1e3||0,track:Number(t.number),recording_mbid:i.id,track_mbid:t.id,release_mbid:e.id,artist_mbids:null==s?void 0:s.map((e=>e.id)),isrc:null===(n=i.isrcs)||void 0===n?void 0:n[0],year:new Date(i["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,musicBrainz:r}}function Bl(e){var t;return null===(t=e["artist-credit"])||void 0===t?void 0:t.map((e=>e.artist))}const Vl={get:Rl,getISRCs:function(e,t){return Cl(this,void 0,void 0,(function*(){const{recording_mbid:r,release_mbid:n,track_mbid:i}=e,a={signal:t,timeout:2e3};if(r){const{isrcs:e=[]}=yield Rl(`/recording/${r}`,{inc:"isrcs"},a);return e}if(i){const{recordings:[{isrcs:e=[]}={}]}=yield Rl("/recording",{query:`tid:${i}`},a);return e}if(n){const t=new Al(n),r=al(yield di(t,a),e);return(null==r?void 0:r.isrc)?[r.isrc]:[]}return[]}))},addMetadata:$l},Ul=new J("listenbrainz"),Hl={get token(){return Ul.getString("token")},set token(e){Ul.setString("token",e)},get userId(){return Ul.getString("userId")},set userId(e){Ul.setString("userId",e)},get firstScrobbledAt(){return Ul.getString("firstScrobbledAt")},set firstScrobbledAt(e){Ul.setString("firstScrobbledAt",e)},clear(){Ul.clear()}};var Yl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ql=new H("listenbrainzApi"),Kl=new class{constructor(){this.apiHost="https://api.listenbrainz.org/1",this.webHost="https://musicbrainz.org",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}store(e,t){return Yl(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const r="feedback/recording-feedback",n={score:t?1:0};e.recording_msid&&(n.recording_msid=e.recording_msid),e.recording_mbid&&(n.recording_mbid=e.recording_mbid),yield this.post(r,n)}}))}addUserData(e){return Yl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getInLibrary(e);Yn(e.map(((e,r)=>({match:t=>du(t,e),values:{inLibrary:t[r]}}))))}}))}addToPlaylist(e,t){return Yl(this,void 0,void 0,(function*(){t=(t=yield $l(t,!1)).filter((e=>e.recording_mbid));const[,,r]=e.src.split(":");return this.post(`playlist/${r}/item/add`,{playlist:{track:t.map((e=>this.createTrack(e)))}})}))}createPlaylist(e,{description:t="",isPublic:r,items:n=[]}={}){return Yl(this,void 0,void 0,(function*(){const i=Hl.userId;return n=(n=yield $l(n,!1)).filter((e=>e.recording_mbid)),this.post("playlist/create",{playlist:{extension:{"https://musicbrainz.org/doc/jspf#playlist":{creator:i,public:r}},creator:i,title:e,annotation:t,track:n.map((e=>this.createTrack(e)))}})}))}createTrack(e){var t,r;const n=this.webHost,i=e.recording_mbid,a=e.release_mbid||"";return{title:e.title,id:i,identifier:i?`${n}/recording/${i}`:"",creator:null===(t=e.artists)||void 0===t?void 0:t.join(" & "),trackNum:e.track,duration:e.duration,extension:{"https://musicbrainz.org/doc/jspf#track":{artist_identifiers:(null===(r=e.artist_mbids)||void 0===r?void 0:r.map((e=>`${n}/artist/${e}`)))||[],release_identifier:a?`${n}/release/${a}`:""}},album:e.album||""}}getInLibrary(e){return Yl(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,r]=m(e,(e=>!!e.recording_mbid)),n=t.map((e=>e.recording_mbid)),i=r.map((e=>e.recording_msid)),a={};n.length>0&&(a.recording_mbids=n),i.length>0&&(a.recording_msids=i);const{feedback:s}=yield this.post(`feedback/user/${Hl.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=s.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return Yl(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${Hl.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return Yl(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${Hl.userId}/listen-count`);return e}))}getListens(e){return Yl(this,void 0,void 0,(function*(){return yield this.get(`user/${Hl.userId}/listens`,e)}))}scrobble(e){return Yl(this,void 0,void 0,(function*(){e.length>0&&(ql.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return Yl(this,void 0,void 0,(function*(){ql.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){ql.log('Failed to update "now playing":',{item:e}),ql.error(t)}}))}get(e,t,r){return Yl(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const n=yield this.fetch(e,{method:"GET"},r);if(!n.ok||204===n.status)throw n;return n.json()}))}post(e,t){return Yl(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return(yield this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:r},!0)).json()}))}fetch(e,t,r=!1){return Yl(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),r&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${Hl.token}`})),e.startsWith("/")&&(e=e.slice(1));const n=yield window.fetch(`${this.apiHost}/${e}`,t);if(!n.ok)throw n;const i=n.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&ql.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),n}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.9.5",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[r]=e.src.split(":");switch(r){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"tidal":case"plex-tidal":t.music_service="tidal.com";break;case"blob":case"file":t.music_service_name="Local file";break;default:{const e=Gf(r);e&&(t.music_service_name=e.name)}}const n={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(n.release_name=e.album),n}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},Wl=Kl;var Gl=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Jl(e){var{href:t,className:r="",children:i=t}=e,a=Gl(e,["href","className","children"]);return n.createElement("a",Object.assign({},a,{className:`external-link ${r}`,href:t,target:"_blank",rel:"noopener"}),n.createElement("span",{className:"external-link-text"},i),n.createElement(rt,{name:"link"}))}var Ql=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Xl(e){const t=cu.id,[r,i]=(0,n.useState)(!1),[a,s]=(0,n.useState)(""),o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u="https://listenbrainz.org/profile/",d=n.createElement(wr,{icon:cu.icon,text:`Log in to ${cu.name}`}),m=(0,n.useCallback)((()=>Ql(this,void 0,void 0,(function*(){try{const e=l.current.value,t=c.current.value;Hl.userId=e,i(!0),s("Connecting…");const r=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!r.ok)throw r;const{valid:n,user_name:a}=yield r.json();if(!n)throw Error("Invalid token");if(a!==e)throw Error("Token not valid for this user");s(""),o.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e),s(e.message||e.statusText||"Error")}i(!1)}))),[]),h=(0,n.useCallback)((e=>{e.preventDefault(),m()}),[m]);return n.createElement(or,Object.assign({},e,{className:"listenbrainz-login-dialog login-dialog",title:d,ref:o}),n.createElement("form",{id:`${t}-login`,method:"dialog",onSubmit:h},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-username`},"User:"),n.createElement("input",{type:"text",id:`${t}-username`,name:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:l})),n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-token`},"Token:"),n.createElement("input",{type:"password",id:`${t}-token`,name:`${t}-token`,required:!0,ref:c}))),n.createElement("p",{className:"message "+(r?"":"error")},a),n.createElement("p",{className:"listenbrainz-link service-link"},n.createElement(Jl,{href:u},n.createElement(rt,{name:"listenbrainz"}),u)),n.createElement(fr,{submitText:"Login"})))}var Zl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ec=new H("listenbrainzAuth"),tc=new it("");function rc(){return tc.pipe(_n())}function nc(){return""!==tc.getValue()}function ic(){return rc().pipe(Be((e=>""!==e)),_n())}rc().pipe(_e((e=>!!e)),et((()=>function(){return Zl(this,void 0,void 0,(function*(){try{yield Wl.getListenCount()}catch(e){401===e.status?(Hl.clear(),tc.next("")):ec.error(e)}}))}()))).subscribe(ec),tc.next(Hl.token);var ac=r(6998),sc=r.n(ac);const oc="https://musicbrainz.org",lc=new J("youtube"),cc={get apiKey(){return bi||lc.getString("apiKey")},set apiKey(e){lc.setString("apiKey",e)},get clientId(){return gi||lc.getString("clientId")},set clientId(e){lc.setString("clientId",e)},get connectedAt(){return lc.getNumber("connectedAt")},set connectedAt(e){lc.setNumber("connectedAt",e)},get enabled(){return!0}};var uc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const dc=new H("youtubeAuth"),mc="https://www.googleapis.com/auth/youtube.readonly",hc=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],fc=new it(""),pc=new Ne;function yc(){return!!cc.connectedAt}function vc(){return""!==gc()}function bc(){return fc.pipe(_n()).pipe(Be((e=>""!==e)),_n())}function gc(){return fc.getValue()}function wc(){return uc(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}function Ec(){return uc(this,void 0,void 0,(function*(){const e=yield wc();return e.client?e.client:new Promise(((t,r)=>{e.load("client",{callback:()=>{const{apiKey:n,clientId:i}=cc,a={apiKey:n,clientId:i,discoveryDocs:hc,scope:mc};e.client.init(a).then((()=>t(e.client)),r)},onerror:r})}))}))}function kc(){var e,t;return uc(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}bc().pipe(On((e=>!e))).subscribe((e=>cc.connectedAt=e?Date.now():0)),bc().pipe(_e((e=>e)),ji(1),et((()=>Promise.all([wc(),Ec()]))),at((([e,t])=>{e.load("client:auth2",(()=>{e.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=t.getToken();fc.next((null==e?void 0:e.access_token)||"")}else fc.next("")}))}))}))).subscribe(dc),cc.enabled&&yc()&&Zr(Ec()).pipe(Be((e=>e.getToken())),at((e=>fc.next((null==e?void 0:e.access_token)||""))),sn(pc)).subscribe(dc);var xc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Sc=new H("youtubeCache");class Tc extends Bt.ZP{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return xc(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){Sc.error(e)}}))}fetch(e){return xc(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){Sc.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const Pc=new Tc;var Ac=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ic=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};class Cc{constructor(e,t,r){this.defaultConfig={pageSize:Cc.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),r),this.pager=new Bi((()=>Ac(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},r){return Ac(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,r,n;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:Zn.Playlist,externalUrl:`${$c}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),trackCount:null===(n=e.contentDetails)||void 0===n?void 0:n.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistItemsPager(e.id),isPinned:Gi.isPinned(i)}}createMediaItem(e){var t,r,n,i,a;return{itemType:Zn.Media,mediaType:ti.Video,playbackType:Nn.IFrame,src:`youtube:video:${e.id}`,externalUrl:Rc(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(r=e.contentDetails)||void 0===r?void 0:r.duration),thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${$c}/channel/${e}`}:void 0}createPlaylistItemsPager(e){return new Cc("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,r=0,n=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(r)+Number(n)||0}fetchPage(e,t){return Ac(this,void 0,void 0,(function*(){const r=this.createCacheKey(e,t,this.pageNumber),n=yield this.getFromCache(r),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),n),{pageInfo:s,nextPageToken:o}=a,l=Ic(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,r),u=null==s?void 0:s.totalResults,d=!o;return this.nextPageToken=o,this.pageNumber++,yield this.saveToCache(r,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return Ac(this,void 0,void 0,(function*(){const r=`${t}/videos`,n=yield this.getFromCache(r),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Cc.videoFields}`},n);return yield this.saveToCache(r,i),i.items||[]}))}fetch(e,t,r){return Ac(this,void 0,void 0,(function*(){const n=yield Ec(),i=(null==r?void 0:r.etag)?{"If-None-Match":r.etag}:void 0,{result:a,status:s,statusText:o}=yield n.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:i});if(a)return a;if(304===s&&r)return r;throw Error(o||`Error (${s})`)}))}getFromCache(e){return Ac(this,void 0,void 0,(function*(){return Pc.fetch(e)}))}saveToCache(e,t){return Ac(this,void 0,void 0,(function*(){this.config.noCache||(yield Pc.store(e,t))}))}createCacheKey(e,t,r){const{fields:n}=t,i=Ic(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${r}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Cc.minPageSize=5,Cc.maxPageSize=50,Cc.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Cc.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const Mc=Cc;var Oc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const $c="https://www.youtube.com",Nc={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},zc={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:Zn.Media,mediaType:ti.Video,lockActionsStore:!0,layout:Nc,defaultHidden:!0,search:()=>new Mc("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:Mc.videoFields})},jc={id:"youtube/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,mediaType:ti.Video,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Owner","LastPlayed"]},search(){return new Vi((()=>Oc(this,void 0,void 0,(function*(){return f(Wo().filter((e=>e.src.startsWith("youtube:"))),"src")}))))}},Lc={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,secondaryLayout:Nc,search:()=>new Mc("/playlists",{mine:"true",part:"snippet,contentDetails",fields:Mc.playlistFields})};function Dc(e=""){if(e.startsWith("youtube:"))return e;const t=sc()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function Rc(e){return`${$c}/watch?v=${e}`}function Fc(e){return Oc(this,void 0,void 0,(function*(){const t=Rc(e),r=yield fetch(`${$c}/oembed?url=${t}&format=json`);if(!r.ok)switch(r.status){case 401:throw Error("Embedding prevented by channel owner");case 403:throw Error("Private video");case 404:throw Error("Video does not exist");default:throw Error(`${r.statusText} (${r.status})`)}const n=yield r.json();return{itemType:Zn.Media,mediaType:ti.Video,playbackType:Nn.IFrame,src:`youtube:video:${e}`,externalUrl:t,title:n.title,aspectRatio:n.width/n.height||16/9,duration:0,track:0,thumbnails:[{url:n.thumbnail_url,width:n.thumbnail_width,height:n.thumbnail_height}],owner:{name:n.author_name,url:n.author_url},playedAt:0}}))}const _c={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",serviceType:Mn.PublicMedia,primaryMediaType:ti.Video,get disabled(){return!cc.enabled},defaultHidden:!0,defaultNoScrobble:!0,internetRequired:!0,restrictedAccess:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"search",itemType:Zn.Media,mediaType:ti.Video,layout:Nc,searchable:!0,search:({q:e=""}={})=>e?new Mc("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:Mc.maxPageSize,noCache:!0}):new hi}],sources:[zc,jc,Lc],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},Nc),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new Mc("/playlists",{id:t,part:"snippet,contentDetails",fields:Mc.playlistFields})}}},getPlaybackType:function(){return Oc(this,void 0,void 0,(function*(){return Nn.IFrame}))},observeIsLoggedIn:bc,isConnected:yc,isLoggedIn:vc,login:function(){return uc(this,void 0,void 0,(function*(){if(!vc()){dc.log("connect");try{const e=yield function(){return uc(this,void 0,void 0,(function*(){const e=google.accounts.oauth2;return new Promise(((t,r)=>{const n=e.initTokenClient({client_id:cc.clientId,scope:mc,prompt:"",callback:e=>{e.error?r(e.error_description):t(e.access_token)},error_callback:e=>{r(e.message)}});n.requestAccessToken()}))}))}();fc.next(e)}catch(e){dc.error(e)}}}))},logout:function(){return uc(this,void 0,void 0,(function*(){dc.log("disconnect"),pc.next(void 0);try{const e=gc();e&&(yield kc()).revoke(e,(()=>fc.next("")))}catch(e){}cc.connectedAt=0,fc.next("")}))}},Bc=_c;const Vc=new H("ListenBrainzHistoryPager");class Uc{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new it(-1),this.nextPageParams=void 0,this.pager=new Bi(((t=50)=>{return r=this,n=void 0,a=function*(){try{const{payload:r}=yield Wl.get(`user/${Hl.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),n=r.listens,i=this.createItems(n),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:n.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(On((e=>-1===e)),_n())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>Wl.addUserData(e)))).subscribe(Vc)),this.fetchListenCount&&this.subscriptions.add(Zr(Wl.getListenCount()).pipe(at((e=>this.size$.next(e)))).subscribe(Vc)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,r,n;const i=e.track_metadata,a=i.additional_info,s=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,o=this.getPlayableSrc(a)||"";return{itemType:Zn.Media,mediaType:o.startsWith("youtube:")?ti.Video:ti.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:s?`${oc}/recording/${s}`:void 0,recording_mbid:s,recording_msid:e.recording_msid||void 0,release_mbid:null===(r=i.mbid_mapping)||void 0===r?void 0:r.release_mbid,artist_mbids:null===(n=i.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:e.listened_at,link:{src:o,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=sc()(e);if(t)return Rc(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const r=e.origin_url;if(r){if(r.includes("apple.com"))return this.getAppleSrc(r);if(r.includes("spotify.com"))return this.getSpotifySrc(r);if(r.includes("tidal.com"))return"tidal:";if(/youtu\.?be/.test(r))return Dc(r)}const n=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i=Hf().map((e=>e.id));for(const e of i)if(n.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Uc.maxPageSize=100;const Hc=Uc;class Yc{constructor(){let e=0;this.pager=new Bi(((t=50)=>{return r=this,n=void 0,a=function*(){try{const r=yield Wl.get(`feedback/user/${Hl.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const n=this.createItems(r.feedback),i=r.total_count;return{items:n,total:i,atEnd:r.offset+n.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e))).filter(l)}createItem(e){var t,r;const n=e.track_metadata;if(!n)return;const i=n.additional_info,a=e.recording_mbid;return{itemType:Zn.Media,mediaType:ti.Audio,src:`listenbrainz:track:${Ea()}`,title:n.track_name,artists:n.artist_name?[n.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:n.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${oc}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=n.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(r=n.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:0,inLibrary:!0}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Yc.maxPageSize=100;const qc=Yc;const Kc=new H("ListenBrainzPlaylistItemsPager");class Wc{constructor(e){let t=0;this.pager=new Bi(((r=100)=>{return n=this,i=void 0,s=function*(){const{playlist:n}=yield Wl.get(`playlist/${e}`,{offset:t,count:r},!0);t+=r;const i=n.track.map((e=>this.createMediaItem(e)));return{items:i,total:i.length,atEnd:!0}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}));var n,i,a,s}),{pageSize:100})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>Wl.addUserData(e)))).subscribe(Kc)))}createMediaItem(e){var t,r,n;const i=e.identifier.split("/").pop(),a=null===(t=e.extension)||void 0===t?void 0:t["https://musicbrainz.org/doc/jspf#track"],s=null==a?void 0:a.additional_metadata;return{itemType:Zn.Media,mediaType:ti.Audio,src:`listenbrainz:track:${i}`,externalUrl:e.identifier,title:e.title,artists:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_credit_name)):e.creator?[e.creator]:void 0,duration:0,recording_mbid:i,release_mbid:null===(r=null==a?void 0:a.additional_metadata)||void 0===r?void 0:r.caa_release_mbid,artist_mbids:(null==s?void 0:s.artists)?s.artists.map((e=>e.artist_mbid)):null===(n=null==a?void 0:a.artist_identifiers)||void 0===n?void 0:n.map((e=>e.split("/").pop())),playedAt:0}}}class Gc{constructor(e){let t=0;this.pager=new Bi(((r=50)=>{return n=this,i=void 0,s=function*(){const n=yield Wl.get(e,{offset:t,count:r},!0);t+=r;const i=this.createItems(n.playlists),a=n.playlist_count;return{items:i,total:a,atEnd:n.offset+i.length>=a}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}));var n,i,a,s}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((({playlist:e})=>this.createItem(e)))}createItem(e){const t=e.identifier.split("/").pop();return{itemType:Zn.Playlist,src:`listenbrainz:playlist:${t}`,title:e.title,description:this.getTextFromHtml(e.annotation),externalUrl:e.identifier,owner:{name:e.creator},pager:new Wc(t)}}getTextFromHtml(e){if(/<\/?p>/i.test(e)){const t=document.createElement("div");return t.innerHTML=e||"",Array.from(t.querySelectorAll("p")).map((e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.replace(/\s+/g," "))||""})).join("\n")}return P(e)}}const Jc=new H("ListenBrainzStatsPager");class Qc{constructor(e,t){let r=0;this.pager=new Bi(((n=50)=>{return i=this,a=void 0,o=function*(){try{const i=yield Wl.get(e,Object.assign(Object.assign({},t),{offset:r,count:n}));return r+=n,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function n(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(r,n)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.subscriptions.add(this.pager.observeAdditions().pipe(Be((e=>e.filter((e=>e.itemType===Zn.Media)))),_e((e=>e.length>0)),et((e=>Wl.addUserData(e)))).subscribe(Jc)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,r=t.recordings.map((e=>this.createMediaItem(e))),n=t.total_recording_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isReleasesResponse(e)){const t=e.payload,r=t.releases.map((e=>this.createMediaAlbum(e))),n=t.total_release_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isArtistsResponse(e)){const t=e.payload,r=t.artists.map((e=>this.createMediaArtist(e))),n=t.total_artist_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}throw Error("Unknown response")}createMediaArtist(e){var t;const r=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:Zn.Artist,src:`listenbrainz:artist:${Ea()}`,externalUrl:r?`${oc}/artist/${r}`:void 0,title:e.artist_name,artist_mbid:r,playCount:e.listen_count,pager:new hi}}createMediaAlbum(e){const t=e.release_mbid||void 0,r={itemType:Zn.Album,src:`listenbrainz:album:${Ea()}`,externalUrl:t?`${oc}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},r),{pager:t?new Al(t):new hi})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:Zn.Media,mediaType:ti.Audio,src:`listenbrainz:track:${Ea()}`,externalUrl:t?`${oc}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}var Xc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Zc={view:"details",fields:["Index","Artist","Title"]},eu={id:"listenbrainz/history",title:"History",icon:"clock",itemType:Zn.Media,search:({startAt:e=0}={})=>new Hc(e?{max_ts:e}:void 0)},tu={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,search:()=>new Hc},ru={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new qc},nu={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:Zn.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new Qc(`stats/user/${Hl.userId}/recordings`,e)},iu={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:Zn.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new Qc(`stats/user/${Hl.userId}/releases`,e)},au={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:Zn.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:{view:"none"},search:e=>new Qc(`stats/user/${Hl.userId}/artists`,e)},su={id:"listenbrainz/playlists",title:"My Playlists",icon:"playlist",itemType:Zn.Playlist,secondaryLayout:Zc,defaultHidden:!0,search:()=>new Gc(`user/${Hl.userId}/playlists`)},ou={id:"listenbrainz/recommendations",title:"Recommendations",icon:"playlist",itemType:Zn.Playlist,secondaryLayout:Zc,defaultHidden:!0,search:()=>new Gc(`user/${Hl.userId}/playlists/createdfor`)},lu={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",serviceType:Mn.DataService,canScrobble:!0,defaultHidden:!0,internetRequired:!0,roots:[tu],sources:[nu,iu,au,ru,eu,su,ou],labels:{[Qn.AddToLibrary]:"Love on ListenBrainz",[Qn.RemoveFromLibrary]:"Unlove on ListenBrainz"},editablePlaylists:su,addToPlaylist:function(e,t){return Xc(this,void 0,void 0,(function*(){return Wl.addToPlaylist(e,t)}))},canRate:()=>!1,canStore:uu,compareForRating:du,createPlaylist:function(e,t={}){return Xc(this,void 0,void 0,(function*(){const{playlist_mbid:r}=yield Wl.createPlaylist(e,t);return{src:`listenbrainz:playlist:${r}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},store:function(e,t){return Xc(this,void 0,void 0,(function*(){uu(e)&&(yield Wl.store(e,t))}))},observeIsLoggedIn:ic,isConnected:function(){return!!Hl.token},isLoggedIn:nc,login:function(){return Zl(this,void 0,void 0,(function*(){if(!nc()){ec.log("connect");try{const e=yield function(){return Ql(this,void 0,void 0,(function*(){return cr(Xl,!0)}))}();if(e){const{userId:t,token:r}=JSON.parse(e);Hl.userId=t,Hl.token=r,tc.next(r)}}catch(e){ec.error(e)}}}))},logout:function(){return Zl(this,void 0,void 0,(function*(){ec.log("disconnect"),Hl.clear(),tc.next("")}))}},cu=lu;function uu(e){return e.itemType===Zn.Media&&!(!e.recording_mbid&&!e.recording_msid)}function du(e,t){const[r]=e.src.split(":"),[n]=t.src.split(":");return r===n&&e.itemType===Zn.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}const mu=new J("subsonic"),hu=new it(mu.getString("libraryId")),fu={get audioLibraries(){return this.libraries},get host(){return mu.getString("host")},set host(e){mu.setString("host",e)},get credentials(){return mu.getString("credentials")},set credentials(e){mu.setString("credentials",e)},get libraryId(){return mu.getString("libraryId")},set libraryId(e){mu.setString("libraryId",e),hu.next(e)},observeLibraryId:()=>hu.pipe(_n()),get libraries(){var e;const t=mu.getJson("libraries",[]);return""!==(null===(e=t[0])||void 0===e?void 0:e.id)&&t.splice(0,0,{id:"",title:"(all)"}),t},set libraries(e){mu.setJson("libraries",e),e.find((e=>e.id===this.libraryId))||(this.libraryId="")},get userName(){return mu.getString("userName")},set userName(e){mu.setString("userName",e)},clear(){mu.removeItem("userName"),mu.removeItem("credentials")}},pu=fu;var yu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function vu(e,t,{host:r,credentials:n}=pu){return yu(this,void 0,void 0,(function*(){if(!n)throw Error("No subsonic credentials");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1));const i=yield fetch(`${r}/rest/${e}${e.includes("?")?"&":"?"}${n}`,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return a}))}function bu(e,t=pu){var r;return yu(this,void 0,void 0,(function*(){const n=yield vu("getAlbumList",t.libraryId?Object.assign(Object.assign({},e),{musicFolderId:t.libraryId}):e,t);return(null===(r=n.albumList.album)||void 0===r?void 0:r.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))}function gu(e=pu){return yu(this,void 0,void 0,(function*(){return(yield vu("getArtists",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).artists.index.map((e=>e.artist)).flat()}))}function wu(){return yu(this,void 0,void 0,(function*(){const e=[];let t=10*Math.floor((new Date).getFullYear()/10);for(;t>=1930;)e.push({id:String(t),title:`${t}s`}),t-=10;return e}))}function Eu(e,t){var r;return yu(this,void 0,void 0,(function*(){const n=yield vu("getGenres",void 0,t);return(null===(r=n.genres.genre)||void 0===r?void 0:r.map((({value:t,albumCount:r,songCount:n})=>{const i=e===Zn.Album?r:n;return{id:t,title:`${t} (${i})`,count:i}})).filter((e=>e.count>0)).sort(((e,t)=>e.count===t.count?e.title.localeCompare(t.title):t.count-e.count)))||[]}))}function ku(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getMusicDirectory",{id:e},t)).directory}))}const xu={addToPlaylist:function(e,t){return yu(this,void 0,void 0,(function*(){const r=u(t,300);for(const t of r){const r=new URLSearchParams({playlistId:e});t.forEach((e=>r.append("songIdToAdd",e))),yield vu(`updatePlaylist?${r}`)}}))},createPlaylist:function(e,t,r,n){return yu(this,void 0,void 0,(function*(){const{playlist:i}=yield vu("createPlaylist",{name:e}),a=u(n,300);for(const e of a){const n=new URLSearchParams({playlistId:i.id,comment:t,public:String(r)});e.forEach((e=>n.append("songIdToAdd",e))),yield vu(`updatePlaylist?${n}`)}return i}))},get:vu,getAlbum:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getAlbum",{id:e},t)).album}))},getAlbumInfo:function(e,t,r){return yu(this,void 0,void 0,(function*(){return(yield vu("getAlbumInfo"+(t?"":"2"),{id:e},r)).albumInfo}))},getAlbumTracks:function(e,t,r){return yu(this,void 0,void 0,(function*(){return t?(yield vu("getMusicDirectory",{id:e},r)).directory.child||[]:(yield vu("getAlbum",{id:e},r)).album.song||[]}))},getAlbumsByDecade:function(e,t,r,n){return yu(this,void 0,void 0,(function*(){const i=Number(e);return bu({type:"byYear",fromYear:i+9,toYear:i,size:r,offset:t},n)}))},getAlbumsByGenre:function(e,t,r,n){return yu(this,void 0,void 0,(function*(){return bu({type:"byGenre",genre:e,size:r,offset:t},n)}))},getArtist:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getArtist",{id:e},t)).artist}))},getArtists:gu,getArtistAlbums:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getArtist",{id:e},t)).artist.album||[]}))},getArtistInfo:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getArtistInfo2",{id:e},t)).artistInfo2}))},getArtistTopTracks:function(e,t=50,r){return yu(this,void 0,void 0,(function*(){return(yield vu("getTopSongs",{artist:e,count:t},r)).topSongs.song||[]}))},getDecades:wu,getFilters:function(e,t,r){return yu(this,void 0,void 0,(function*(){return e===va.ByDecade?wu():Eu(t,r)}))},getGenres:Eu,getIndexes:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getIndexes",{musicFolderId:e},t)).indexes.index||[]}))},getLikedAlbums:function(e,t,r){return yu(this,void 0,void 0,(function*(){return bu({type:"starred",size:t,offset:e},r)}))},getLikedArtists:function(e=pu){return yu(this,void 0,void 0,(function*(){return(yield vu("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.artist||[]}))},getLikedSongs:function(e=pu){return yu(this,void 0,void 0,(function*(){return(yield vu("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.song||[]}))},getMostPlayed:function(e,t,r){return yu(this,void 0,void 0,(function*(){return bu({type:"frequent",size:t,offset:e},r)}))},getMusicDirectory:ku,getMusicDirectoryItems:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield ku(e,t)).child.sort(((e,t)=>e.isDir===t.isDir?e.isDir?e.title.localeCompare(t.title):0:e.isDir?-1:1))}))},getMusicLibraries:function(e){var t;return yu(this,void 0,void 0,(function*(){const r=yield vu("getMusicFolders",void 0,e);return(null===(t=r.musicFolders.musicFolder)||void 0===t?void 0:t.sort(((e,t)=>e.name.localeCompare(t.name))).map((({id:e,name:t})=>({id:String(e),title:t}))))||[]}))},getPlayableUrl:function(e,{host:t,credentials:r}=pu){const[,,n]=e.split(":");return`${t}/rest/stream?id=${n}&${r}`},getPlaylist:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getPlaylist",{id:e},t)).playlist}))},getPlaylists:function(e){return yu(this,void 0,void 0,(function*(){return(yield vu("getPlaylists",void 0,e)).playlists.playlist||[]}))},getPlaylistItems:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getPlaylist",{id:e},t)).playlist.entry||[]}))},getRandomAlbums:function(e=100,t){return yu(this,void 0,void 0,(function*(){return bu({type:"random",size:e,offset:0},t)}))},getRandomArtists:function(e=100,t){return yu(this,void 0,void 0,(function*(){return p(yield gu(t)).slice(0,e)}))},getRandomSongs:function(e=100,t=pu){return yu(this,void 0,void 0,(function*(){return(yield vu("getRandomSongs",t.libraryId?{musicFolderId:t.libraryId,size:e}:{size:e},t)).randomSongs.song||[]}))},getRecentlyPlayed:function(e,t,r){return yu(this,void 0,void 0,(function*(){return bu({type:"recent",size:t,offset:e},r)}))},getSong:function(e,t){return yu(this,void 0,void 0,(function*(){return(yield vu("getSong",{id:e},t)).song}))},getSongsByGenre:function(e,t,r,n=pu){return yu(this,void 0,void 0,(function*(){const i={genre:e,offset:t,count:r};return(yield vu("getSongsByGenre",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).songsByGenre.song||[]}))},getVideos:function(e){return yu(this,void 0,void 0,(function*(){return(yield vu("getVideos",void 0,e)).videos.video||[]}))},scrobble:function(e,t){return yu(this,void 0,void 0,(function*(){return vu("scrobble",e,t)}))},searchAlbums:function(e,t,r,n=pu){var i;return yu(this,void 0,void 0,(function*(){const a={query:e,albumCount:r,albumOffset:t,songCount:0,artistCount:0},s=yield vu("search2",n.libraryId?Object.assign(Object.assign({},a),{musicFolderId:n.libraryId}):a,n);return(null===(i=s.searchResult2.album)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))},searchArtists:function(e,t,r,n=pu){return yu(this,void 0,void 0,(function*(){const i={query:e,artistOffset:t,artistCount:r,songCount:0,albumCount:0};return(yield vu("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.artist||[]}))},searchSongs:function(e,t,r,n=pu){return yu(this,void 0,void 0,(function*(){const i={query:e,songOffset:t,songCount:r,albumCount:0,artistCount:0};return(yield vu("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.song||[]}))}},Su=xu,Tu=new J("navidrome"),Pu={get host(){return Tu.getString("host")},set host(e){Tu.setString("host",e)},get credentials(){return Tu.getString("credentials")},set credentials(e){Tu.setString("credentials",e)},get token(){return Tu.getString("token")},set token(e){Tu.setString("token",e)},get userId(){return Tu.getString("userId")},set userId(e){Tu.setString("userId",e)},clear(){Tu.removeItem("token"),Tu.removeItem("credentials"),Tu.removeItem("userId")}};var Au=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Iu(e){const t=(0,n.useCallback)(((e,t,r)=>Au(this,void 0,void 0,(function*(){const n=yield fetch(`${e}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:r})});if(!n.ok)throw n;const{token:i,subsonicSalt:a,subsonicToken:s,id:o}=yield n.json(),l=`u=${t}&s=${a}&t=${s}&v=1.16.1&c=ampcast&f=json`;return JSON.stringify({userId:o,token:i,credentials:l})}))),[]);return n.createElement(wa,Object.assign({},e,{service:od,settings:Pu,login:t}))}var Cu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Mu(e,t){return Cu(this,void 0,void 0,(function*(){return(yield $u(e,t,{method:"GET"})).json()}))}function Ou(e,t){return Cu(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return $u(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:r})}))}function $u(e,t,r){return Cu(this,void 0,void 0,(function*(){const{host:n,token:i}=Pu;if(!i)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{Accept:"application/json","x-nd-authorization":`Bearer ${i}`});const a=yield fetch(`${n}/api/${e}`,r);if(!a.ok)throw a;return a}))}const Nu={addToPlaylist:function(e,t){return Cu(this,void 0,void 0,(function*(){yield Ou(`playlist/${e}/tracks`,{ids:t})}))},createPlaylist:function(e,t,r,n){return Cu(this,void 0,void 0,(function*(){const i=yield Ou("playlist",{name:e,comment:t,public:r}),a=yield i.json();return yield Ou(`playlist/${a.id}/tracks`,{ids:n}),a}))},get:Mu,getFilters:function(e){return Cu(this,void 0,void 0,(function*(){return e===va.ByDecade?Su.getDecades():function(){return Cu(this,void 0,void 0,(function*(){return(yield Mu("genre",{_sort:"name"})).map((({id:e,name:t})=>({id:e,title:t})))}))}()}))},getPage:function(e,t){return Cu(this,void 0,void 0,(function*(){const r=yield $u(e,t,{method:"GET",headers:{Accept:"application/json"}});let n=yield r.json(),i=0;return Array.isArray(n)?i=Number(r.headers.get("X-Total-Count"))||n.length:(n=[n],i=1),{items:n,total:i}}))},getPlayableUrl:function(e){return Su.getPlayableUrl(e,Pu)}},zu=Nu;var ju=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Lu=new H("navidromeAuth"),Du=new it(""),Ru=new it(!1);function Fu(){return Ru.getValue()}function _u(e){Pu.token=e,Du.next(e)}Du.pipe(_n()).pipe(_e((e=>""!==e)),et((()=>function(){return ju(this,void 0,void 0,(function*(){try{return yield zu.get("playlist",{_end:1}),!0}catch(e){return 401===e.status?Pu.clear():Lu.error(e),Du.next(""),!1}}))}()))).subscribe(Ru),Du.next(Pu.token);class Bu{constructor(e,t,r,n){this.itemType=e,this.path=t,this.params=r,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new Ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,r=void 0,i=function*(){const t=(e-1)*this.pageSize,r=t+this.pageSize,{items:n,total:i}=yield zu.getPage(this.path,Object.assign(Object.assign({},this.params),{_start:t,_end:r}));return{items:n.map((e=>this.createMediaObject(e))),total:i}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}createMediaObject(e){let t;switch(this.itemType){case Zn.Album:t=this.createMediaAlbum(e);break;case Zn.Artist:t=this.createMediaArtist(e);break;case Zn.Playlist:t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}createMediaItem(e){var t;const r=e.mediaFileId||e.id;return{itemType:Zn.Media,mediaType:ti.Audio,src:`navidrome:audio:${r}`,externalUrl:this.getExternalUrl(`album/${e.albumId}`),title:e.title,addedAt:this.parseDate(e.createdAt),artists:[e.artist],albumArtist:e.albumArtist,album:e.album,duration:e.duration,track:e.trackNumber,disc:e.discNumber,inLibrary:e.starred,year:e.year,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),thumbnails:this.createThumbnails(e.albumId),recording_mbid:e.mbzTrackId,release_mbid:e.mbzAlbumId,track_mbid:e.mbzReleaseTrackId,artist_mbids:e.mbzArtistId?[e.mbzArtistId]:void 0}}createMediaAlbum(e){var t;const r=e.id;return{itemType:Zn.Album,src:`navidrome:album:${r}`,externalUrl:this.getExternalUrl(`album/${r}`),title:e.name,addedAt:this.parseDate(e.createdAt),artist:e.albumArtist,inLibrary:e.starred,year:e.minYear||e.maxYear,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:new Bu(Zn.Media,"song",{album_id:r,_sort:"album"}),thumbnails:this.createThumbnails(r),release_mbid:e.mbzAlbumId,artist_mbids:e.mbzAlbumArtistId?[e.mbzAlbumArtistId]:void 0}}createMediaArtist(e){var t;const r=e.id,n=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:Zn.Artist,src:`navidrome:artist:${r}`,externalUrl:this.getExternalUrl(`artist/${r}`),title:e.name,description:P(e.biography)||void 0,inLibrary:e.starred,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:this.createArtistAlbumsPager(e),thumbnails:n?this.createThumbnails(r):void 0,artist_mbid:e.mbzArtistId}}createMediaPlaylist(e){const t=e.id,r=`navidrome:playlist:${t}`;return{itemType:Zn.Playlist,src:r,externalUrl:this.getExternalUrl(`playlist/${t}`),title:e.name,description:P(e.comment),addedAt:this.parseDate(e.createdAt),duration:e.duration,trackCount:e.songCount,pager:new Bu(Zn.Media,`playlist/${t}/tracks`,{playlist_id:t}),thumbnails:this.createThumbnails(t),isPinned:Gi.isPinned(r),isOwn:e.ownerId===Pu.userId,owner:{name:e.ownerName}}}getExternalUrl(e){return`${Pu.host}/app/#/${e}/show`}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){const{host:n}=Pu;return{url:`${n}/rest/getCoverArt?id=${e}&size=${t}&{navidrome-credentials}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new hi([t]),n=new Bu(Zn.Album,"album",{album_artist_id:e.id,_sort:"minYear",_order:"DESC"});return new Hi(void 0,n,r)}createArtistAllTracks(e){const t=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:Zn.Album,src:`navidrome:all-tracks:${e.id}`,title:"All Songs",artist:e.name,thumbnails:t?this.createThumbnails(e.id):void 0,pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Bu(Zn.Media,"song",{artist:e.name,_sort:"title"})}}Bu.minPageSize=10,Bu.maxPageSize=500;const Vu=Bu;var Uu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Hu="navidrome",Yu="order_album_artist_name,order_album_name,disc_number,track_number",qu="order_album_artist_name,order_album_name",Ku={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Wu={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},Gu={id:"navidrome/liked-songs",title:"My Songs",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>new Vu(Zn.Media,"song",{starred:!0,_sort:"starred_at",_order:"DESC"})},Ju={id:"navidrome/liked-albums",title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search:()=>new Vu(Zn.Album,"album",{starred:!0,_sort:"starred_at",_order:"DESC"})},Qu={id:"navidrome/liked-artists",title:"My Artists",icon:"heart",itemType:Zn.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Vu(Zn.Artist,"artist",{starred:!0,_sort:"starred_at",_order:"DESC"})},Xu={id:"navidrome/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Vu(Zn.Media,"song",{_sort:"play_date",_order:"DESC"})},Zu={id:"navidrome/most-played",title:"Most Played",icon:"most-played",itemType:Zn.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>new Vu(Zn.Media,"song",{_sort:"play_count",_order:"DESC"})},ed={id:"navidrome/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,layout:Ku,secondaryLayout:Wu,search:()=>new Vu(Zn.Playlist,"playlist",{_sort:"name"})},td={id:"navidrome/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Zn.Media,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?new Vu(Zn.Media,"song",{genre_id:e.id,_sort:Yu}):new hi},rd={id:"navidrome/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Zn.Album,viewType:va.ByGenre,search:e=>e?new Vu(Zn.Album,"album",{genre_id:e.id,_sort:qu}):new hi},nd={id:"navidrome/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Zn.Artist,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?new Vu(Zn.Artist,"artist",{genre_id:e.id,_sort:"name"}):new hi},id={id:"navidrome/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Vu(Zn.Media,"song",{_sort:"random"},{maxSize:100})},ad={id:"navidrome/random-albums",title:"Random Albums",icon:"shuffle",itemType:Zn.Album,search:()=>new Vu(Zn.Album,"album",{_sort:"random"},{maxSize:100})},sd={id:Hu,icon:Hu,name:"Navidrome",url:"https://www.navidrome.org/",serviceType:Mn.PersonalMedia,defaultHidden:!0,roots:[cd(Zn.Media,{title:"Songs"}),cd(Zn.Album,{title:"Albums"}),cd(Zn.Artist,{title:"Artists"}),cd(Zn.Playlist,{title:"Playlists",layout:Ku,secondaryLayout:Wu})],sources:[Gu,Ju,Qu,Xu,Zu,ed,td,rd,nd,id,ad],labels:{[Qn.AddToLibrary]:ni("Add to Navidrome Favorites"),[Qn.RemoveFromLibrary]:ni("Remove from Navidrome Favorites")},editablePlaylists:ed,addToPlaylist:function(e,t){return Uu(this,void 0,void 0,(function*(){const r=ud(e);return zu.addToPlaylist(r,t.map(ud))}))},canRate:()=>!1,canStore:ld,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n=[]}={}){return Uu(this,void 0,void 0,(function*(){return{src:`navidrome:playlist:${(yield zu.createPlaylist(e,t,r,n.map(ud))).id}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const t=ud(e);return new Vu(Zn.Playlist,`playlist/${t}`)}}},getFilters:function(e){return Uu(this,void 0,void 0,(function*(){return zu.getFilters(e)}))},getMetadata:function(e){return Uu(this,void 0,void 0,(function*(){const t=e.itemType,r=ud(e);if(t===Zn.Album){if(e.synthetic)return e;if(void 0===e.description){const t=yield Su.getAlbumInfo(r,!1,Pu);e=Object.assign(Object.assign({},e),{description:P(t.notes),release_mbid:t.musicBrainzId})}}else if(t===Zn.Artist&&void 0===e.description){const t=yield Su.getArtistInfo(r,Pu);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!ld(e)||void 0!==e.inLibrary)return e;const n=Gn.getInLibrary(e);if(void 0!==n)return Object.assign(Object.assign({},e),{inLibrary:n});const i=t===Zn.Artist?"artist":t===Zn.Album?"album":"song",a=new Vu(t,`${i}/${r}`,{pageSize:1,maxSize:1}),s=yield di(a,{timeout:2e3});return x(e,s[0])}))},getPlayableUrl:function({src:e}){return zu.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{navidrome-credentials}",Pu.credentials)},lookup:function(e,t,r=10,n){return Uu(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return di(new Vu(Zn.Media,"song",{title:`${e} ${t}`,_sort:"order_artist_name,order_album_name,track_number"},i),{timeout:n})}))},store:function(e,t){return Uu(this,void 0,void 0,(function*(){const r=ud(e),n=t?"star":"unstar";switch(e.itemType){case Zn.Media:yield Su.get(n,{id:r},Pu);break;case Zn.Album:yield Su.get(n,{albumId:r},Pu);break;case Zn.Artist:yield Su.get(n,{artistId:r},Pu)}}))},observeIsLoggedIn:function(){return Ru.pipe(_n())},isConnected:function(){return!!Pu.token},isLoggedIn:Fu,login:function(){return ju(this,void 0,void 0,(function*(){if(!Fu()){Lu.log("connect");try{const e=yield function(){return Au(this,void 0,void 0,(function*(){return cr(Iu,!0)}))}();if(e){const{userId:t,token:r,credentials:n}=JSON.parse(e);Pu.userId=t,Pu.credentials=n,_u(r)}}catch(e){Lu.error(e)}}}))},logout:function(){return ju(this,void 0,void 0,(function*(){Lu.log("disconnect"),Pu.clear(),_u(""),Ru.next(!1)}))}},od=sd;function ld(e){switch(e.itemType){case Zn.Media:case Zn.Artist:return!0;case Zn.Album:return!e.synthetic;default:return!1}}function cd(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`navidrome/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){switch(t=t.trim(),e){case Zn.Media:return new Vu(e,"song",{title:t,_sort:Yu});case Zn.Album:return new Vu(e,"album",{name:t,_sort:qu});case Zn.Artist:return new Vu(e,"artist",{name:t,_sort:"name"});case Zn.Playlist:return new Vu(e,"playlist",{q:t,_sort:"name"});default:return new hi}}})}function ud({src:e}){const[,,t]=e.split(":");return t}var dd;!function(e){e[e.Low=4]="Low",e[e.Normal=8]="Normal",e[e.High=12]="High",e[e.Lossless=16]="Lossless",e[e.Master=20]="Master"}(dd||(dd={}));const md=dd,hd=new J("plex"),fd=new it(hd.getString("libraryId")),pd={get audioLibraries(){return this.libraries},get clientId(){let e=hd.getString("clientId");return e||(e=Ea(),hd.setString("clientId",e)),e},get drm(){return hd.getString("drm","widevine")},set drm(e){hd.setString("drm",e)},get connection(){return hd.getJson("connection")},set connection(e){hd.setJson("connection",e)},get hasTidal(){return hd.getBoolean("hasTidal")},set hasTidal(e){hd.setBoolean("hasTidal",e)},get host(){const e=this.connection;return e?e.local&&"http:"===location.protocol?`http://${e.address}:${e.port}`:e.uri:""},get internetRequired(){var e;return!(null===(e=this.connection)||void 0===e?void 0:e.local)||"http:"!==location.protocol},get libraryId(){return hd.getString("libraryId")},set libraryId(e){hd.setString("libraryId",e),fd.next(e)},observeLibraryId:()=>fd.pipe(_n()),get libraries(){return hd.getJson("libraries")||[]},set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>R(e.title)))||e[0];hd.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""},get server(){return hd.getJson("server")},set server(e){hd.setJson("server",e)},get serverId(){var e;return(null===(e=this.server)||void 0===e?void 0:e.clientIdentifier)||""},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get streamingQuality(){return hd.getNumber("streamingQuality",md.High)},set streamingQuality(e){hd.setNumber("streamingQuality",e)},get userId(){return hd.getString("userId")},set userId(e){hd.setString("userId",e)},get userToken(){return hd.getString("userToken")},set userToken(e){hd.setString("userToken",e)},clear(){hd.removeItem("userId"),hd.removeItem("userToken"),hd.removeItem("server"),hd.removeItem("connection"),hd.removeItem("hasTidal")}};var yd;!function(e){e.Episode="4",e.Artist="artist",e.Album="album",e.Track="track",e.Clip="clip",e.Playlist="playlist"}(yd||(yd={}));const vd=yd;var bd;!function(e){e.Episode="4",e.Artist="8",e.Album="9",e.Track="10",e.MusicVideo="12",e.Clip="14",e.Playlist="15"}(bd||(bd={}));const gd=bd;var wd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ed=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const kd="https://plex.tv/api/v2",xd="https://music.provider.plex.tv",Sd="https://discover.provider.plex.tv";function Td(e){var{headers:t,body:r}=e,n=Ed(e,["headers","body"]);return wd(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),r&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),r=JSON.stringify(r)),(yield Pd(Object.assign({headers:t,body:r},n))).json()}))}function Pd({host:e=pd.host,path:t,method:r="GET",params:n,headers:i,body:a,token:s,keepalive:o,timeout:l}){return wd(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=n?`${t}?${new URLSearchParams(n)}`:t).startsWith("/")&&(t=t.slice(1)),s||(s=e===pd.host?pd.serverToken:pd.userToken);const c=e===pd.host?void 0:pd.drm,u={method:r,headers:Object.assign(Object.assign({},i),$d(s,c)),body:a,keepalive:o};l&&(u.signal=AbortSignal.timeout(l));const d=yield fetch(`${e}/${t}`,u);if(!d.ok)throw d;return d}))}function Ad(e){const t=e.map(zd).join(",");return`server://${pd.serverId}/com.plexapp.plugins.library/library/metadata/${t}`}function Id(e){return`provider://tv.plex.provider.music/library/metadata/${e.map(zd).join(",")}`}function Cd(e="all"){return`/library/sections/${Md()}/${e}`}function Md(){const e=pd.libraryId;if(!e)throw new ai;return e}function Od(e,t=pd.host){return wd(this,void 0,void 0,(function*(){if(0===e.length)return[];const{MediaContainer:{Metadata:r=[]}}=yield Td({host:t,path:`/library/metadata/${e.join(",")}`,headers:{"X-Plex-Container-Start":"0","X-Plex-Container-Size":String(e.length)}});return r}))}function $d(e,t){const r={"X-Plex-Product":"ampcast","X-Plex-Version":"0.9.5","X-Plex-Platform":j.displayName,"X-Plex-Platform-Version":j.version,"X-Plex-Device":j.os,"X-Plex-Device-Name":j.displayName,"X-Plex-Client-Identifier":pd.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(r["X-Plex-Token"]=e),t&&(r["X-Plex-Drm"]=t),r}function Nd(e){switch(e){case Zn.Album:return gd.Album;case Zn.Artist:return gd.Artist;case Zn.Playlist:return gd.Playlist;default:return gd.Track}}function zd({src:e}){const[,,t]=e.split(":");return t}const jd={addToPlaylist:function(e,t,r=pd.host){return wd(this,void 0,void 0,(function*(){const n=zd(e),[i,a]=m(t,(e=>e.src.startsWith("plex-tidal:"))),s=r===xd,o=`/playlists/${n}/items`;if(a.length>0&&!s){const e=Ad(a);yield Td({host:r,method:"PUT",path:o,params:{uri:e}})}if(i.length>0){const e=Id(i);yield Td({host:r,method:"PUT",path:o,params:{uri:e}})}}))},createPlaylist:function(e,t,r,n=pd.host){return wd(this,void 0,void 0,(function*(){const i=n===xd,[a,s]=m(r,(e=>e.src.startsWith("plex-tidal:"))),o=i?Id(a):Ad(s),{MediaContainer:{Metadata:[l]=[]}}=yield Td({host:n,method:"POST",path:"/playlists",params:{type:"audio",title:e,uri:o,smart:0}});return t&&(yield Pd({host:n,method:"PUT",path:`/playlists/${l.ratingKey}`,params:{summary:t}})),!i&&a.length>0&&(yield Td({host:n,method:"PUT",path:`/playlists/${l.ratingKey}/items`,params:{uri:Id(a)}})),l}))},fetch:Pd,fetchJSON:Td,getAccount:function(e){return wd(this,void 0,void 0,(function*(){const{MyPlex:t}=yield Td({path:"myplex/account",token:e});return t}))},getFilters:function(e,t){return wd(this,void 0,void 0,(function*(){return e===va.ByDecade?function(){return wd(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield Td({path:Cd("decade"),params:{type:gd.Album}}),t=10*Math.floor((new Date).getFullYear()/10);return e.filter((({key:e})=>Number(e)>500&&Number(e)<=t)).map((({key:e,title:t})=>({id:e,title:t})))}))}():function(e){return wd(this,void 0,void 0,(function*(){const t=Nd(e),{MediaContainer:{Directory:r}}=yield Td({path:Cd("genre"),params:{type:t}});return r.map((({key:e,title:t})=>({id:e,title:t})))}))}(t)}))},getHeaders:$d,getMetadata:Od,getMusicLibraries:function(e=pd.host,t=pd.serverToken){return wd(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:r}}=yield Td({host:e,path:"/library/sections",token:t});return r.filter((e=>"artist"===e.type)).map((({key:e,title:t})=>({id:e,title:t})))}))},getPlayableUrl:function(e){const{host:t,serverToken:r}=pd;if(t&&r){if(e.playbackType===Nn.Direct){const[n]=e.srcs||[];if(!n)throw Error("No playable source");return`${t}${n}?X-Plex-Token=${r}`}{const[,n,i]=e.src.split(":");return`${t}/${"video"===n?"video":"music"}/:/transcode/universal/start.mpd?${new URLSearchParams(Object.assign(Object.assign({path:`/library/metadata/${i}`,hasMDE:"1",mediaIndex:"0",partIndex:"0",musicBitrate:"320",directStreamAudio:"1",mediaBufferSize:"12288",protocol:e.playbackType===Nn.HLS?"hls":"dash",directPlay:"0"},$d(r)),{"X-Plex-Client-Profile-Extra":"add-transcode-target(type=musicProfile&context=streaming&protocol=dash&container=mp4&audioCodec=aac)+add-transcode-target(type=musicProfile&context=streaming&protocol=hls&container=mpegts&audioCodec=aac,mp3)"}))}`}}throw Error("Not logged in")},getPlaybackType:function(e){return wd(this,void 0,void 0,(function*(){try{const{host:t,serverToken:r}=pd,[n]=e.srcs||[],i=`${t}${n}?X-Plex-Token=${r}`;return(yield V(e.mediaType===ti.Video?"video":"audio",i))?Nn.Direct:Nn.HLS}catch(e){return Nn.Direct}}))},getServers:function(e=pd.serverToken){return wd(this,void 0,void 0,(function*(){return m((yield Td({host:kd,path:"/resources",params:{includeHttps:"1"},token:e})).filter((e=>"server"===e.provides)),(e=>e.owned)).flat()}))},search:function(e){var t=e.params,r=void 0===t?{}:t,{type:n}=r,i=Ed(r,["type"]),a=Ed(e,["params"]);return wd(this,void 0,void 0,(function*(){let e=[];const t=a.host===Sd;if(t){const{MediaContainer:{SearchResults:[{SearchResult:t=[]}]}}=yield Td(Object.assign(Object.assign({},a),{params:i}));e=t}else{const{MediaContainer:{SearchResult:t=[]}}=yield Td(Object.assign(Object.assign({},a),{params:i}));e=t}return Od(e.map((e=>e.Metadata)).filter((e=>e.type===n)).map((e=>e.ratingKey)),t?xd:void 0)}))}},Ld=jd;var Dd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Rd=new H("plexAuth"),Fd=new it(""),_d=new it(!1),Bd=new Ne;let Vd;function Ud(){return _d.getValue()}function Hd(){return _d.pipe(_n())}function Yd(){return Bd}function qd(){return Dd(this,void 0,void 0,(function*(){if(!Ud()){Rd.log("connect");try{Bd.next("");const{id:e,userToken:t,serverToken:r}=yield function(){return Dd(this,void 0,void 0,(function*(){const{id:e,serverToken:t}=yield function(){return Dd(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/plex/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});let n=10;const s=()=>Dd(this,void 0,void 0,(function*(){n--;try{const{authToken:r,id:i}=yield Ld.fetchJSON({host:kd,path:`/pins/${Vd.id}`});r?e({id:i,serverToken:r}):n?setTimeout(s,200):(Bd.next("Timeout"),t("Timeout"))}catch(e){t(e)}}));s()}};window.addEventListener("message",a,!1);const s=`clientID=${pd.clientId}&code=${Vd.code}&forwardUrl=${encodeURIComponent(n)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${s}`,"Plex","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}();yield function(e){return Dd(this,void 0,void 0,(function*(){const{server:t,connection:r}=pd;if(t&&r){const e=r.local?"local":"public";if(Bd.next(`Trying existing ${e} connection…`),yield Gd(t,r))return;pd.server=null,pd.connection=null}Bd.next(`Searching for ${r?"a new":"a"} connection…`);const n=yield Ld.getServers(e);if(0===n.length){const e="Could not find a Plex server";throw Bd.next(e),Error(e)}for(const e of n){const t=yield Wd(e);if(t)return pd.server=e,void(pd.connection=t)}const i="Could not establish a connection";throw Bd.next(i),Error(i)}))}(t);try{const{authToken:r}=yield Ld.getAccount(t);return{id:e,serverToken:t,userToken:r}}catch(r){return{id:e,serverToken:t,userToken:""}}}))}();pd.userId=e,pd.userToken=t,Fd.next(r)}catch(e){Rd.error(e)}}}))}function Kd(){return Dd(this,void 0,void 0,(function*(){Rd.log("disconnect"),pd.clear(),Fd.next(""),_d.next(!1)}))}function Wd(e){return Dd(this,void 0,void 0,(function*(){const t=m(e.connections,(e=>e.local)).flat();for(const r of t)if(yield Gd(e,r))return r;return null}))}function Gd(e,t){return Dd(this,void 0,void 0,(function*(){const r=e.name,n=t.local?"local":"public";try{return yield Ld.fetch({host:t.uri,path:"/",method:"HEAD",token:e.accessToken,timeout:3e3}),Bd.next(`(${r}) ${n} connection successful`),!0}catch(e){Bd.next(`(${r}) ${n} connection failed`)}return!1}))}function Jd(){return Dd(this,void 0,void 0,(function*(){try{const e=yield function(){return e=this,t=void 0,n=function*(){if(!_){const e=Object.entries(B),t={initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]};for(const[r,n]of e)try{yield navigator.requestMediaKeySystemAccess(n,[t]),_=r;break}catch(e){}_||(_=F)}return _},new((r=void 0)||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}));var e,t,r,n}();pd.drm=e}catch(e){Rd.error(e)}}))}function Qd(){return Dd(this,void 0,void 0,(function*(){try{pd.userToken&&(yield Ld.fetchJSON({host:xd,path:"/playlists/all",params:{librarySectionID:"tidal"},headers:{"X-Plex-Container-Size":"1"}}),pd.hasTidal=!0)}catch(e){406===e.status?pd.hasTidal=!1:Rd.error(e)}}))}Fd.pipe(_n()).pipe(_e((e=>!!e)),et((()=>function(){return Dd(this,void 0,void 0,(function*(){try{const[e]=yield Promise.all([Ld.getMusicLibraries(),Jd(),Qd()]);return pd.libraries=e,!0}catch(e){return 401===e.status?(pd.clear(),Fd.next(""),Bd.next("Connection failed"),!1):(Rd.error(e),Bd.next("Connected with errors"),!0)}}))}()))).subscribe(_d),Yd().pipe(_e((e=>""!==e))).subscribe(Rd.rx()),Fd.next(pd.serverToken);var Xd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Zd=new H("PlexPager");class em{constructor(e,t,r){var n;this.request=e,this.options=t,this.parent=r,this.pageNumber=1,this.serviceId=(null==t?void 0:t.serviceId)||"plex";let i=null==t?void 0:t.pageSize;i||(i=this.isTidal?50:(null===(n=pd.connection)||void 0===n?void 0:n.local)?em.plexMaxPageSize:200),this.pageSize=Math.min((null==t?void 0:t.maxSize)||1/0,i);const a=Object.assign(Object.assign({},t),{pageSize:this.pageSize});this.pager=this.isTidal?new Bi((()=>this.fetchNext()),a):new Ya((e=>this.fetch(e)),a)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}get isTidal(){return"plex-tidal"===this.serviceId}get isSearch(){return this.request.path.endsWith("/search")}connect(){var e;this.subscriptions||(this.subscriptions=new le,(null===(e=this.options)||void 0===e?void 0:e.lookup)||this.isSearch||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>this.enhanceItems(e)))).subscribe(Zd)))}enhanceItems(e){return Xd(this,void 0,void 0,(function*(){const[t,r]=m(e,(e=>e.src.startsWith("plex-tidal:"))),n=(e,t)=>Xd(this,void 0,void 0,(function*(){if((e=e.filter((e=>!(e.itemType===Zn.Media&&e.mediaType===ti.Video)))).length>0){const r=t===xd,n=yield Ld.getMetadata(e.map((({src:e})=>{const[,,t]=e.split(":");return t})),t),i=r?[]:yield this.getPlexAlbums(n),a=n.map((e=>this.createMediaObject(e,i,!0)));Yn(a.map((e=>({match:t=>t.src===e.src,values:e}))))}}));yield Promise.all([n(r.filter((e=>[Zn.Media,Zn.Album].includes(e.itemType)))),n(t.filter((e=>[Zn.Media,Zn.Artist].includes(e.itemType))),xd)])}))}fetch(e){var t;return Xd(this,void 0,void 0,(function*(){const r=this.request.path;let n,i=[],a=0;if(this.isSearch)n=yield Ld.search(this.request),a=n.length;else{const t=this.request,{headers:r}=t,i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["headers"]),s=yield Ld.fetchJSON(Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign({},r),{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)})})),{MediaContainer:{Metadata:o=[],size:l,totalSize:c}}=s;n=o,a=c||l}return(null===(t=this.options)||void 0===t?void 0:t.lookup)&&!this.isTidal&&(i=yield this.getPlexAlbums(n)),r.endsWith("/tidal/myMixes")&&(n=n.map(((e,t)=>"playlist"===e.type&&1===e.leafCount?Object.assign(Object.assign({},e),{leafCount:void 0,title:`My Mix ${t+1}`,summary:e.title}):e))),{items:n.map((e=>this.createMediaObject(e,i))),total:a}}))}fetchNext(){return Xd(this,void 0,void 0,(function*(){const e=yield this.fetch(this.pageNumber);return this.pageNumber++,e}))}createMediaObject(e,t,r){switch(e.type){case vd.Clip:return this.createMediaItemFromVideo(e);case vd.Album:return this.createMediaAlbum(e,r);case vd.Artist:return this.createMediaArtist(e,r);case vd.Playlist:return this.createMediaPlaylist(e,r);case vd.Track:{const r=t.find((t=>t.ratingKey===e.parentRatingKey));return this.createMediaItemFromTrack(e,r)}default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e,t){var r;const[n]=e.Media||[],[i]=(null==n?void 0:n.Part)||[];let a=(e.title||"").trim();const s=!!a,o=s?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,l=this.getFileName(null==i?void 0:i.file)||"[Unknown]",c="com.tidal"===e.attribution;return a=c?this.fixTrackTitle(a):a||l.replace(/\.\w+/,""),{src:this.getSrc("audio",e),srcs:null===(r=e.Media)||void 0===r?void 0:r.map((({Part:[e]})=>e.key)),itemType:Zn.Media,mediaType:ti.Audio,playbackType:c?Nn.DASH:void 0,title:a,fileName:c?void 0:l,externalUrl:this.getExternalUrl(e),addedAt:e.addedAt,artists:s?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:o&&!e.originalTitle?e.grandparentTitle:void 0,album:o,duration:e.duration/1e3,track:o?e.index:void 0,disc:o&&e.index?e.parentIndex:void 0,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year||e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e)||(t?this.getGenres(t):void 0),thumbnails:this.createThumbnails((c?void 0:e.thumb)||e.parentThumb||e.grandparentThumb),release_mbid:t?this.getMbid(t):void 0,track_mbid:this.getMbid(e),unplayable:!i||void 0}}createMediaAlbum(e,t){const r={src:this.getSrc("album",e),itemType:Zn.Album,externalUrl:this.getExternalUrl(e),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb||e.parentThumb),release_mbid:this.getMbid(e)};return t||(r.pager=this.createPager({path:e.key})),r}createMediaArtist(e,t){var r;const n={src:this.getSrc("artist",e),itemType:Zn.Artist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,country:null===(r=e.Country)||void 0===r?void 0:r.map((e=>e.tag)).join(", "),addedAt:e.addedAt,inLibrary:this.getInLibrary(e),rating:this.getRating(e.userRating),globalRating:this.getRating(e.rating),genres:this.getGenres(e),thumbnails:this.createThumbnails(e.thumb),artist_mbid:this.getMbid(e)};return t||(n.pager=this.createArtistAlbumsPager(e)),n}createMediaItemFromVideo(e){var t;const[r]=e.Media||[],[n]=(null==r?void 0:r.Part)||[],i="com.tidal"===e.attribution;return{src:this.getSrc("video",e),srcs:null===(t=e.Media)||void 0===t?void 0:t.map((({Part:[e]})=>e.key)),itemType:Zn.Media,mediaType:ti.Video,playbackType:i?Nn.HLS:void 0,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(null==n?void 0:n.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:this.getGenres(e),inLibrary:this.getInLibrary(e),thumbnails:this.createThumbnails(e.thumb),unplayable:!n||void 0}}createMediaPlaylist(e,t){const r=this.getSrc("playlist",e),n={src:r,itemType:Zn.Playlist,externalUrl:this.getExternalUrl(e),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,thumbnails:this.createThumbnails(e.thumb||e.composite),isPinned:Gi.isPinned(r)};return t||(n.pager=this.createPager({path:e.key})),n}createMediaFolder(e){var t;const r={itemType:Zn.Folder,src:`plex:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}getExternalUrl(e){var t,r;const n="com.tidal"===e.attribution,i="https://app.plex.tv/desktop/#!";let a="";if(n)a=`${i}/provider/tv.plex.provider.music`;else{const e=null===(t=pd.server)||void 0===t?void 0:t.clientIdentifier;a=e?`${i}/server/${e}`:""}let s="details",o=`/library/metadata/${e.ratingKey}`;switch(e.type){case vd.Clip:if(n){const t=e.grandparentRatingKey;o=t?`/library/metadata/${t}`:""}else o=null===(r=e.art)||void 0===r?void 0:r.replace(/\/art\/\d+$/,"");break;case vd.Playlist:o=`/playlists/${e.ratingKey}`,s="playlist";break;case vd.Track:{const t=e.parentRatingKey;o=t?`/library/metadata/${t}`:"";break}}return a&&o?`${a}/${s}?key=${encodeURIComponent(o)}`:""}getFileName(e=""){return e.split(/[/\\]/).pop()}getGenres(e){var t;return null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag))}getInLibrary(e){return"com.tidal"===e.attribution?e.saved:void 0}getMbid(e){const t=e.Guid;if(t){const e=t.map((e=>e.id)).find((e=>e.startsWith("mbid://")));return null==e?void 0:e.replace("mbid://","")}}getPlexAlbums(e){return Xd(this,void 0,void 0,(function*(){const t=e.filter((e=>"track"===e.type&&"com.tidal"!==e.attribution)),r=h(t.map((e=>e.parentRatingKey)));return r.length>0?Ld.getMetadata(r):[]}))}getRating(e){return"number"==typeof e?Math.round((e||0)/2):void 0}getSrc(e,t){return`${"com.tidal"===t.attribution?"plex-tidal":"plex"}:${e}:${t.ratingKey}`}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${pd.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${r}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:r}}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=this.createPager({path:r},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new hi([e]);return new Hi(t,n)}return n}createArtistAlbumsPager(e){if("com.tidal"===e.attribution){const t=this.createPager({path:e.key}),r=this.createArtistTopTracks(e),n=this.createArtistVideos(e),i=new Vi((()=>Xd(this,void 0,void 0,(function*(){try{return 0===(yield di(n.pager,{keepAlive:!0})).length?[r]:[r,n]}catch(e){return Zd.error(e),[r]}}))));return new Hi(i,t)}{const t=this.createPager({path:Cd(),params:{"artist.id":e.ratingKey,type:gd.Album,sort:"year:desc,originallyAvailableAt:desc,artist.titleSort:desc,album.titleSort,album.index"}}),r=this.createArtistVideos(e),n=new Vi((()=>Xd(this,void 0,void 0,(function*(){try{return 0===(yield di(r.pager,{keepAlive:!0})).length?[]:[r]}catch(e){return Zd.error(e),[]}})))),i=this.createArtistOtherTracks(e),a=new hi([i]);return new Hi(n,t,a)}}createArtistOtherTracks(e){return{itemType:Zn.Album,src:this.getSrc("other-tracks",e),title:"Other Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createOtherTracksPager(e),synthetic:!0}}createArtistTopTracks(e){return{itemType:Zn.Album,src:this.getSrc("top-tracks",e),title:"Top Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createTopTracksPager(e),synthetic:!0}}createArtistVideos(e){return{itemType:Zn.Album,src:this.getSrc("videos",e),title:"Music Videos",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createVideosPager(e),synthetic:!0}}createOtherTracksPager(e){return this.createPager({params:{originalTitle:e.title,type:gd.Track}})}createTopTracksPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/popular`},{maxSize:20})}createVideosPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/extras`})}createPager(e,t,r){return new em(Object.assign(Object.assign(Object.assign(Object.assign({},this.request),{params:void 0}),e),{host:this.isTidal?xd:e.host}),Object.assign(Object.assign({},t),{serviceId:this.serviceId}),r)}fixTrackTitle(e){return e&&(e=(e=e.replace(/(\([^)]*\))\s*\1/g,"$1")).replace(/(\([^)]*\)\s*\[[^\]]*\]).*/g,"$1")),e}}em.minPageSize=10,em.plexMaxPageSize=1e3,em.tidalMaxPageSize=100;const tm=em;var rm=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const nm={view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},im={view:"details",fields:["AlbumTrack","Artist","Title","Duration","PlayCount","Rate"]},am={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},sm={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]},om={id:"plex/recently-added",title:"Recently Added",icon:"recently-added",itemType:Zn.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","AddedAt"]},search:()=>new tm({path:Cd(),params:{type:gd.Track,"album.addedAt>>":"-6mon",sort:"album.addedAt:desc"}})},lm={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new tm({path:Cd(),params:{type:gd.Track,"lastViewedAt>":"0",sort:"lastViewedAt:desc"}})},cm={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:Zn.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new tm({path:Cd(),params:{type:gd.Track,"viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"}})},um={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new tm({path:Cd(),params:{type:gd.Track,"track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},dm={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:Zn.Album,lockActionsStore:!0,layout:nm,secondaryLayout:im,search:()=>new tm({path:Cd(),params:{type:gd.Album,"album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},mm={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:Zn.Artist,lockActionsStore:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:im,search:()=>new tm({path:Cd(),params:{type:gd.Artist,"artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},hm={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,layout:am,secondaryLayout:sm,search:()=>(Md(),new tm({path:"/playlists/all",params:{type:gd.Playlist,playlistType:"audio",sort:"addedAt:desc"}}))},fm={id:"plex/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search:()=>(Md(),new tm({path:"/playlists/all",params:{type:gd.Playlist,playlistType:"audio",readOnly:"0",smart:"0"}}))},pm={id:"plex/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Zn.Album,viewType:va.ByGenre,search:e=>e?new tm({path:Cd(),params:{genre:e.id,type:gd.Album}}):new hi},ym={id:"plex/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Zn.Artist,viewType:va.ByGenre,defaultHidden:!0,search:e=>e?new tm({path:Cd(),params:{genre:e.id,type:gd.Artist}}):new hi},vm={id:"plex/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Zn.Album,viewType:va.ByDecade,search:e=>e?new tm({path:Cd(),params:{decade:e.id,type:gd.Album}}):new hi},bm={id:"plex/random-tracks",title:"Random Tracks",icon:"shuffle",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new tm({path:Cd(),params:{type:gd.Track,sort:"random"}},{maxSize:100})},gm={id:"plex/random-albums",title:"Random Albums",icon:"shuffle",itemType:Zn.Album,layout:nm,secondaryLayout:im,search:()=>new tm({path:Cd(),params:{type:gd.Album,sort:"random"}},{maxSize:100})},wm={id:"plex/videos",title:"Music Videos",icon:"video",itemType:Zn.Media,mediaType:ti.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search:({q:e=""}={})=>new tm({path:Cd("extras/all"),params:{title:e,type:gd.Artist,extraType:gd.Episode}})},Em={id:"plex/folders",title:"Folders",icon:"folder",itemType:Zn.Folder,viewType:va.Folders,search(){const e={itemType:Zn.Folder,src:"plex:folder:",title:"Folders",fileName:"",path:""};return e.pager=new Vi((()=>rm(this,void 0,void 0,(function*(){return pd.libraries.map((({id:t,title:r})=>{const n={itemType:Zn.Folder,src:`plex:folder:/library/sections/${t}/folder`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new hi([i]),s=new tm({path:`library/sections/${t}/folder`,params:{includeCollections:"1"}},void 0,n);return n.pager=new Hi(a,s),n}))})))),e.pager}},km={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",serviceType:Mn.PersonalMedia,defaultHidden:!0,get internetRequired(){return pd.internetRequired},roots:[Tm(Zn.Media,{title:"Tracks",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount","Rate"]}}),Tm(Zn.Album,{title:"Albums"}),Tm(Zn.Artist,{title:"Artists"}),Tm(Zn.Playlist,{title:"Playlists",layout:am,secondaryLayout:sm})],sources:[um,dm,mm,cm,om,lm,hm,pm,ym,vm,bm,gm,wm,Em],editablePlaylists:fm,get audioLibraries(){return pd.audioLibraries},get libraryId(){return pd.libraryId},set libraryId(e){pd.libraryId=e},get libraries(){return pd.libraries},set libraries(e){pd.libraries=e},observeLibraryId:()=>pd.observeLibraryId(),addToPlaylist:function(e,t){return rm(this,void 0,void 0,(function*(){return Ld.addToPlaylist(e,t)}))},canRate:Sm,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return rm(this,void 0,void 0,(function*(){return{src:`plex:playlist:${(yield Ld.createPlaylist(e,t,r)).ratingKey}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,id:e.src,icon:"pin",isPin:!0,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},search:()=>new tm({path:`/playlists/${Pm(e)}`,params:{type:gd.Playlist,playlistType:"audio"}})}},getFilters:function(e,t){return rm(this,void 0,void 0,(function*(){return Ld.getFilters(e,t)}))},getMetadata:function(e){return rm(this,void 0,void 0,(function*(){if(!Sm(e)||void 0!==e.rating)return e;const t=Gn.getRating(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const r=Pm(e),[n]=yield Ld.getMetadata([r]);return Object.assign(Object.assign({},e),{rating:Math.round((n.userRating||0)/2)})}))},getPlayableUrl:function(e){return Ld.getPlayableUrl(e)},getPlaybackType:function(e){return rm(this,void 0,void 0,(function*(){return Ld.getPlaybackType(e)}))},getThumbnailUrl:function(e){return e.replace("{plex-token}",pd.serverToken)},lookup:function(e,t,r=10,n){return rm(this,void 0,void 0,(function*(){return e&&t?di(new tm({path:"/library/search",params:{query:`${e} ${t}`,searchTypes:"music",limit:50,type:vd.Track}},{pageSize:r,maxSize:r,lookup:!0}),{timeout:n}):[]}))},rate:function(e,t){return rm(this,void 0,void 0,(function*(){yield Ld.fetch({path:"/:/rate",method:"PUT",params:{key:Pm(e),identifier:"com.plexapp.plugins.library",rating:2*t||-1}})}))},observeConnectionLogging:Yd,observeIsLoggedIn:Hd,isConnected:function(){return!!pd.server},isLoggedIn:Ud,login:qd,logout:Kd},xm=km;function Sm(e,t){if(t||!e.src.startsWith("plex:"))return!1;switch(e.itemType){case Zn.Album:return!e.synthetic;case Zn.Artist:return!0;case Zn.Media:return e.mediaType===ti.Audio;default:return!1}}function Tm(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>function(e,t,r,n){Md();const i=e===Zn.Playlist?"/playlists/all":Cd(),a=Object.assign({},void 0);return t&&(a.title=t.trim()),a.type=Nd(e),e===Zn.Playlist&&(a.playlistType="audio"),new tm({path:i,params:a},void 0)}(e,t)})}function Pm({src:e}){const[,,t]=e.split(":");return t}const Am=new J("services"),Im=Am.getJson("hidden",{}),Cm=new it(Im),Mm=!0;function Om(e){return!function(e){var t;return null!==(t=Cm.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function $m(e){const t=Cm.getValue(),r=Object.assign(Object.assign({},t),e);Am.setJson("hidden",r),Cm.next(r)}var Nm=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const zm="plex-tidal",jm={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Lm={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Dm={id:`${zm}/library-tracks`,title:"My Tracks",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:jm,search:()=>Xm(gd.Track)},Rm={id:`${zm}/library-albums`,title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search:()=>Xm(gd.Album)},Fm={id:`${zm}/library-artists`,title:"My Artists",icon:"heart",itemType:Zn.Artist,lockActionsStore:!0,search:()=>Xm(gd.Artist)},_m={id:`${zm}/library-playlists`,title:"My Playlists",icon:"heart",itemType:Zn.Playlist,lockActionsStore:!0,layout:Lm,search:()=>(rh(),eh("/playlists/all",{sort:"addedAt:desc"}))},Bm={id:`${zm}/editable-playlists`,title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search:()=>eh("/playlists/all",{readOnly:"0",smart:"0"})},Vm={id:`${zm}/library-videos`,title:"My Videos",icon:"heart",itemType:Zn.Media,mediaType:ti.Video,defaultHidden:!0,layout:jm,search:()=>Xm(gd.MusicVideo)},Um={id:`${zm}/my-mixes`,title:"Recommended",icon:"playlist",itemType:Zn.Playlist,layout:Lm,search:()=>(rh(),eh("/hubs/sections/tidal/myMixes"))},Hm={id:`${zm}/plex-picks`,title:"Plex Picks",icon:"album",itemType:Zn.Album,defaultHidden:!0,search:()=>eh("/hubs/sections/tidal/plexPicks")},Ym={id:`${zm}/new-playlists`,title:"New Playlists",icon:"playlist",itemType:Zn.Playlist,defaultHidden:!0,layout:Lm,search:()=>eh("/hubs/sections/tidal/newPlaylists")},qm={id:zm,name:"TIDAL",icon:zm,url:"https://tidal.com/",serviceType:Mn.PublicMedia,primaryMediaType:ti.Audio,authService:xm,internetRequired:!0,defaultHidden:!0,roots:[Qm(Zn.Media,{title:"Tracks",layout:jm}),Qm(Zn.Album,{title:"Albums"}),Qm(Zn.Artist,{title:"Artists"})],sources:[Dm,Rm,Fm,_m,Vm,Um,Ym,Hm],icons:{[Qn.AddToLibrary]:"heart",[Qn.RemoveFromLibrary]:"heart-fill"},labels:{[Qn.AddToLibrary]:"Add to My TIDAL",[Qn.RemoveFromLibrary]:"Remove from My TIDAL"},editablePlaylists:Bm,addToPlaylist:function(e,t){return Nm(this,void 0,void 0,(function*(){return Ld.addToPlaylist(e,t,xd)}))},canRate:()=>!1,canStore:Gm,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",items:r=[]}={}){return Nm(this,void 0,void 0,(function*(){return{src:`plex-tidal:playlist:${(yield Ld.createPlaylist(e,t,r,xd)).ratingKey}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search:()=>eh(`/playlists/${th(e)}`,{type:gd.Playlist,playlistType:"audio"})}},getDrmInfo:function(e){if((null==e?void 0:e.playbackType)===Nn.DASH){const t=pd.drm,r="fairplay"===t,n={type:t,keySystem:r?"com.apple.fps.1_0":B[t],license:Jm(e).replace(/\.(mpd|m3u8)/,"/license")};return r&&(n.certificate="https://resources.tidal.com/drm/fairplay/certificate"),n}},getMetadata:function(e){return Nm(this,void 0,void 0,(function*(){if(!Gm(e)||void 0!==e.inLibrary)return e;const t=Gn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const r=th(e),[n]=yield Ld.getMetadata([r],xd);return Object.assign(Object.assign({},e),{inLibrary:n.saved})}))},getPlayableUrl:Jm,getPlaybackType:function(e){return Nm(this,void 0,void 0,(function*(){return e.mediaType===ti.Video?Nn.HLS:Nn.DASH}))},getThumbnailUrl:function(e){return xm.getThumbnailUrl(e)},lookup:function(e,t,r=10,n){return Nm(this,void 0,void 0,(function*(){if(!pd.hasTidal||!e||!t)return[];e=e.replace(/\s*([,;&|/x×]|(\b(feat\.?|ft\.?|featuring|with)\s))\s*/gi," ").trim();const i=e=>Nm(this,void 0,void 0,(function*(){return di(Zm(vd.Track,e,r,{pageSize:r,maxSize:r,lookup:!0}),{timeout:n})}));let a=yield i(`${e} ${t}`);return 0===a.length&&(a=yield i(t)),a}))},store:function(e,t){return Nm(this,void 0,void 0,(function*(){yield Ld.fetch({host:xd,path:"/actions/"+(t?"save":"unsave"),method:"PUT",params:{ratingKey:th(e)}})}))},observeIsLoggedIn:function(){return Rn([xm.observeIsLoggedIn(),(e=qm,Cm.pipe(Be((()=>Om(e))),_n()))]).pipe(Be((([e,t])=>e&&t)),_n());var e},isConnected:function(){return xm.isConnected()&&Om(qm)},isLoggedIn:Wm,login:qd,logout:Kd},Km=qm;function Wm(){return xm.isLoggedIn()&&Om(qm)}function Gm(e){switch(e.itemType){case Zn.Album:return!e.synthetic;case Zn.Artist:case Zn.Media:return!0;default:return!1}}function Jm(e){const{userToken:t}=pd;if(t&&Wm()){const r=e.srcs||[];let n=r[0];switch(pd.streamingQuality){case md.Lossless:n=r[0];break;case md.High:n=r[1];break;case md.Low:n=r[2]}if(n||(n=r[0]),!n)throw Error("No playable source");const i=Ld.getHeaders(t,pd.drm),a=new URLSearchParams(i);return`${xd}${n}?${a}`}throw Error("Not logged in")}function Qm(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`${zm}/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>(t=t.trim())?Zm(function(e,t){switch(e){case Zn.Album:return vd.Album;case Zn.Artist:return vd.Artist;case Zn.Playlist:return vd.Playlist;default:return void 0===ti.Video?vd.Clip:vd.Track}}(e),t):new hi})}function Xm(e){return rh(),eh("/library/sections/saved/all",{type:e})}function Zm(e,t,r=100,n){return new tm({host:Sd,path:"/library/search",params:{query:t,limit:r,type:e,searchTypes:"music"}},Object.assign(Object.assign({},n),{serviceId:zm}))}function eh(e,t,r){return new tm({host:xd,path:e,params:t},Object.assign(Object.assign({},r),{serviceId:zm}))}function th({src:e}){const[,,t]=e.split(":");return t}function rh(){if(!pd.hasTidal)throw new oi}var nh=r(5754);const ih=new(r.n(nh)()),ah=new J("spotify/auth"),sh=new J("spotify/user","memory"),oh={get clientId(){return vi||ah.getString("clientId")},set clientId(e){ah.setString("clientId",e)},get codeVerifier(){return ah.getString("code_verifier")},set codeVerifier(e){ah.setString("code_verifier",e)},get market(){return sh.getString("market")},set market(e){sh.setString("market",e)},get token(){return ah.getJson("token")},set token(e){ah.setJson("token",e)},get userId(){return sh.getString("userId")},set userId(e){sh.setString("userId",e)},clear(){ah.removeItem("token"),sh.clear()}};var lh=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ch=new H("spotifyAuth"),uh=location.hostname,dh=("localhost"===uh?`http://${uh}:${location.port}`:`https://${uh}`)+"/auth/spotify/callback/",mh="https://accounts.spotify.com";let hh;const fh=new it("");function ph(){return fh.pipe(_n())}function yh(){return!!oh.token}function vh(){return""!==fh.getValue()}function bh(){return lh(this,void 0,void 0,(function*(){ch.log("refreshToken");const e=oh.token,t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${mh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:oh.clientId,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw yield Eh(),e;const r=yield e.json();return yield gh(r),r.access_token}throw yield Eh(),Error("No 'refresh_token'")}))}function gh(e){return lh(this,void 0,void 0,(function*(){try{const{access_token:t}=e;oh.token=e,ih.setAccessToken(t),yield kh(),wh(t)}catch(e){ch.error(e),yield Eh()}}))}function wh(e){fh.next(e)}function Eh(){return lh(this,void 0,void 0,(function*(){oh.clear(),fh.next(""),yield function(){return lh(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();oh.codeVerifier=e,hh=yield function(e){return lh(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}()}))}function kh(){return lh(this,void 0,void 0,(function*(){if(!oh.userId){const e=yield ih.getMe();oh.userId=e.id,oh.market=e.country}}))}lh(void 0,void 0,void 0,(function*(){const e=oh.token;try{if(e){try{ih.setAccessToken(e.access_token),yield kh(),yh()&&wh(e.access_token)}catch(e){if(401!==e.status||!yh())throw e;yield bh()}return}}catch(e){ch.error(e)}yield Eh()}));var xh=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Sh=new H("SpotifyPager");class Th{constructor(e,t,r){this.defaultConfig={pageSize:Th.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new Bi(((t=this.defaultConfig.pageSize)=>xh(this,void 0,void 0,(function*(){var n;const i=(this.pageNumber-1)*t,a=()=>xh(this,void 0,void 0,(function*(){const{items:n,total:a,next:s}=yield e(i,t);return this.pageNumber++,{items:n.map((e=>this.createMediaObject(e,r))),total:a,atEnd:!s}}));try{return yield a()}catch(e){if(401===e.status)return yield bh(),yield a();if(429===e.status){const t=Number(null===(n=e.headers)||void 0===n?void 0:n.get("Retry-After"));if(t&&t<=10)return yield A(1e3*t),yield a();throw e}throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new le,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(et((e=>this.addUserData(e)))).subscribe(Sh)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:Zn.Media,mediaType:ti.Audio,playbackType:Nn.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable||void 0,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var r;return{itemType:Zn.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(r=e.tracks)||void 0===r?void 0:r.total,pager:this.createAlbumPager(e),inLibrary:t}}createMediaArtist(e){return{itemType:Zn.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createMediaPlaylist(e,t){const r=e.owner.id===oh.userId;return{itemType:Zn.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?P(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistItemsPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:Gi.isPinned(e.uri),isOwn:r,inLibrary:!r&&t}}createMediaItemFromTrack(e,t){var r,n,i,a,s;const o=/album|compilation/i.test((null===(r=e.album)||void 0===r?void 0:r.album_type)||"")?e.album:void 0;return{itemType:Zn.Media,mediaType:ti.Audio,playbackType:Nn.IFrame,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(n=e.artists)||void 0===n?void 0:n.map((e=>e.name)),albumArtist:null==o?void 0:o.artists.map((e=>e.name)).join(", "),album:null==o?void 0:o.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:e.disc_number,track:e.track_number,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(s=e.album)||void 0===s?void 0:s.images,unplayable:!1===e.is_playable||void 0,inLibrary:t}}createArtistAlbumsPager(e){const t=this.getMarket(),r=this.createArtistTopTracks(e),n=new hi([r]),i=new Th(((r,n)=>xh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ih.getArtistAlbums(e.id,{offset:r,limit:n,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:s}}))));return new Hi(n,i)}createArtistTopTracks(e){return{itemType:Zn.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){const t=this.getMarket();return new Th(((r,n)=>xh(this,void 0,void 0,(function*(){const{tracks:i}=yield ih.getArtistTopTracks(e.id,t,{offset:r,limit:n,market:t});return{items:i,next:""}}))),{pageSize:30,maxSize:100})}createAlbumPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.total_tracks)return new Vi((()=>xh(this,void 0,void 0,(function*(){const t=r.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addUserData(t),t}))));{const t=this.getMarket();return new Th(((r,n)=>xh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ih.getAlbumTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:s}}))))}}createPlaylistItemsPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.tracks.total)return new Vi((()=>xh(this,void 0,void 0,(function*(){const e=r.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addUserData(e),e}))));{const t=this.getMarket();return new Th(((r,n)=>xh(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ih.getPlaylistTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:s}}))))}}getMarket(){return oh.market}addUserData(e){return xh(this,void 0,void 0,(function*(){const t=e[0];if(t){const r=e.filter((e=>void 0===e.inLibrary&&_h.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===r.length)return;let n=[];n=t.itemType===Zn.Album?yield ih.containsMySavedAlbums(r):yield ih.containsMySavedTracks(r),Yn(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:n[t]}}))))}}))}}Th.minPageSize=10,Th.maxPageSize=50;const Ph=Th;var Ah=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ih={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Ch={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},Mh={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new Ph(((e,t)=>Ah(this,void 0,void 0,(function*(){const{items:e,total:r}=yield ih.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:r,next:void 0}}))),{maxSize:50,pageSize:50})}},Oh={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:Zn.Media,layout:Ih,search(){return new Ph(((e,t)=>Ah(this,void 0,void 0,(function*(){return ih.getMyTopTracks({offset:e,limit:t})}))))}},$h={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:Zn.Artist,search(){return new Ph(((e,t)=>Ah(this,void 0,void 0,(function*(){return ih.getMyTopArtists({offset:e,limit:t})}))))}},Nh={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:Ih,search(){const e=Yh();return new Ph(((t,r)=>Ah(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield ih.getMySavedTracks({offset:t,limit:r,market:e});return{items:n.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},zh={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search(){const e=Yh();return new Ph(((t,r)=>Ah(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield ih.getMySavedAlbums({offset:t,limit:r,market:e});return{items:n.map((e=>e.album)),total:i,next:a}}))),{pageSize:20},!0)}},jh={id:"spotify/playlists",title:"My Playlists",icon:"heart",itemType:Zn.Playlist,lockActionsStore:!0,secondaryLayout:Ch,search(){const e=Yh();return new Ph(((t,r)=>Ah(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield ih.getUserPlaylists(oh.userId,{offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))),void 0,!0)}},Lh={id:"spotify/editable-playlists",title:"Editable Playlists",icon:"playlist",itemType:Zn.Playlist,search(){const e=Yh(),t=oh.userId;let r=0;return new Ph(((n,i)=>Ah(this,void 0,void 0,(function*(){const{items:a,total:s,next:o}=yield ih.getUserPlaylists(t,{offset:n,limit:i,market:e}),[l,c]=m(a,(e=>e.owner.id===t));return r+=c.length,{items:l,total:s-r,next:o}}))),void 0,!0)}},Dh={id:"spotify/featured-playlists",title:"Recommended",icon:"playlist",itemType:Zn.Playlist,secondaryLayout:Ch,search(){const e=Yh();return new Ph(((t,r)=>Ah(this,void 0,void 0,(function*(){const{playlists:{items:n,total:i,next:a}}=yield ih.getFeaturedPlaylists({offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))))}},Rh={id:"spotify/new-albums",title:"New releases",icon:"album",itemType:Zn.Album,secondaryLayout:Ch,defaultHidden:!0,search(){const e=Yh();return new Ph(((t,r)=>Ah(this,void 0,void 0,(function*(){const{albums:{items:n,total:i,next:a}}=yield ih.getNewReleases({offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))))}},Fh={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",serviceType:Mn.PublicMedia,primaryMediaType:ti.Audio,defaultHidden:!0,internetRequired:!0,restrictedAccess:!0,editablePlaylists:Lh,roots:[Uh(Zn.Media,{title:"Songs",layout:Ih}),Uh(Zn.Album,{title:"Albums"}),Uh(Zn.Artist,{title:"Artists"}),Uh(Zn.Playlist,{title:"Playlists",secondaryLayout:Ch})],sources:[Nh,zh,jh,Mh,Oh,$h,Dh,Rh],icons:{[Qn.AddToLibrary]:"heart",[Qn.RemoveFromLibrary]:"heart-fill"},labels:{[Qn.AddToLibrary]:"Add to Spotify Library",[Qn.RemoveFromLibrary]:"Remove from Spotify Library"},addToPlaylist:function(e,t){return Ah(this,void 0,void 0,(function*(){if(null==t?void 0:t.length){const[,,r]=e.src.split(":"),n=u(t,100);for(const e of n)yield ih.addTracksToPlaylist(r,e.map((e=>e.src)))}}))},canRate:()=>!1,canStore:Bh,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n}={}){return Ah(this,void 0,void 0,(function*(){const i=oh.userId,a=yield ih.createPlaylist(i,{name:e,description:t,public:r});if(null==n?void 0:n.length){const e=u(n,100);for(const t of e)yield ih.addTracksToPlaylist(a.id,t.map((e=>e.src)))}return{src:a.uri,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),r=Yh();return new Ph((()=>Ah(this,void 0,void 0,(function*(){return{items:[yield ih.getPlaylist(t,{market:r,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return Ah(this,void 0,void 0,(function*(){if(!Bh(e)||void 0!==e.inLibrary)return e;const t=Gn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,r]=e.src.split(":");switch(e.itemType){case Zn.Album:{const[t]=yield ih.containsMySavedAlbums([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Zn.Media:{const[t]=yield ih.containsMySavedTracks([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Zn.Playlist:{const[t]=yield ih.areFollowingPlaylist(r,[oh.userId]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},getPlaybackType:function(){return Ah(this,void 0,void 0,(function*(){return Nn.IFrame}))},getTracksById:function(e){return Ah(this,void 0,void 0,(function*(){const t=e.slice(0,50),r=Yh(),n=new Ph((()=>Ah(this,void 0,void 0,(function*(){const{tracks:e}=yield ih.getTracks(t,{market:r});return{items:e,total:e.length}}))),{maxSize:50,pageSize:50},!0);return di(n)}))},lookup:function(e,t,r=10,n){return Ah(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," ");return di(Hh(Zn.Media,`${i(e)} ${i(t)}`,{pageSize:r,maxSize:r,lookup:!0}),{timeout:n})}))},lookupByISRC:function(e,t,r){return Ah(this,void 0,void 0,(function*(){if(0===e.length)return[];const n=Hh(Zn.Media,e.map((e=>`isrc:${e}`)).join("+"),{pageSize:t,maxSize:t,lookup:!0});return(yield di(n,{timeout:r})).filter((e=>!e.unplayable))}))},store:function(e,t){return Ah(this,void 0,void 0,(function*(){return Vh([e],t)}))},bulkStore:function(e,t){return Ah(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;let n=0;switch(r.itemType){case Zn.Media:n=500;break;case Zn.Album:n=200;break;case Zn.Playlist:n=10}if(0===n)return;const i=u(e,n);for(const e of i)yield Vh(e,t)}))},observeIsLoggedIn:function(){return ph().pipe(Be((e=>""!==e)),_n())},isConnected:yh,isLoggedIn:vh,login:function(){return lh(this,void 0,void 0,(function*(){if(!vh()){ch.log("connect");try{const e=yield function(){return lh(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let r=null;const n=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",n,!1),null==r||r.close(),r=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return lh(this,void 0,void 0,(function*(){const t=oh.codeVerifier,r=yield fetch(`${mh}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:oh.clientId,grant_type:"authorization_code",code:e,redirect_uri:dh,code_verifier:t})});if(!r.ok)throw r;return yield r.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",n,!1);const i=new URLSearchParams({client_id:oh.clientId,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:dh,response_type:"code",code_challenge_method:"S256",code_challenge:hh});r=window.open(`${mh}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==r?void 0:r.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}();yield gh(e)}catch(e){ch.error(e)}}}))},logout:function(){return lh(this,void 0,void 0,(function*(){ch.log("disconnect"),yield Eh()}))}},_h=Fh;function Bh(e,t){switch(e.itemType){case Zn.Album:return!e.synthetic;case Zn.Media:return!0;case Zn.Playlist:return!e.isOwn&&!t;default:return!1}}function Vh(e,t){return Ah(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;const n=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>Ah(this,void 0,void 0,(function*(){switch(r.itemType){case Zn.Album:t?yield Promise.all(u(n,20).map((e=>ih.addToMySavedAlbums(e)))):yield Promise.all(u(n,20).map((e=>ih.removeFromMySavedAlbums(e))));break;case Zn.Media:t?yield Promise.all(u(n,50).map((e=>ih.addToMySavedTracks(e)))):yield Promise.all(u(n,50).map((e=>ih.removeFromMySavedTracks(e))));break;case Zn.Playlist:t?yield Promise.all(n.map((e=>ih.followPlaylist(e)))):yield Promise.all(n.map((e=>ih.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield bh(),yield i()}}))}function Uh(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Hh(e,t)})}function Hh(e,t,r){return t?new Ph(function(e,t){const r=Yh();switch(e){case Zn.Media:return(e,n)=>Ah(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:s}}=yield ih.searchTracks(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Zn.Album:return(e,n)=>Ah(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:s}}=yield ih.searchAlbums(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Zn.Artist:return(e,n)=>Ah(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:s}}=yield ih.searchArtists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Zn.Playlist:return(e,n)=>Ah(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:s}}=yield ih.searchPlaylists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));default:throw TypeError("Search not supported for this type of media")}}(e,t),Object.assign({maxSize:250},r)):new hi}function Yh(){return oh.market}function qh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Wr(e);return De((function(t,n){for(var i=e.length,a=new Array(i),s=e.map((function(){return!1})),o=!1,l=function(t){Qe(e[t]).subscribe(Re(n,(function(e){a[t]=e,o||s[t]||(s[t]=!0,(o=s.every(Ce))&&(s=null))}),pe))},c=0;c<i;c++)l(c);t.subscribe(Re(n,(function(e){if(o){var t=re([e],te(a));n.next(r?r.apply(void 0,re([],te(t))):t)}})))}))}function Kh(e){return _e((function(t,r){return e<=r}))}function Wh(e,t){return t?function(r){return en(t.pipe(ji(1),De((function(e,t){e.subscribe(Re(t,pe))}))),r.pipe(Wh(e)))}:et((function(t,r){return Qe(e(t,r)).pipe(ji(1),function(e){return Be((function(){return e}))}(t))}))}function Gh(e,t){void 0===t&&(t=Nr);var r=Lr(e,t);return Wh((function(){return r}))}var Jh,Qh,Xh,Zh=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ef=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},tf=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const rf=new H("SpotifyPlayer"),nf="Spotify player not connected",af=(e,t)=>e.paused===t.paused&&e.position===t.position;Jh=new WeakMap,Qh=new WeakMap,Xh=new WeakMap;const sf=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new it(!0),this.src$=new it(""),this.currentTrackSrc$=new it(""),this.error$=new Ne,this.playerReady$=new it(!1),this.playerStarted$=new it(!1),this.state$=new it(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,Jh.set(this,!1),Qh.set(this,!0),Xh.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{rf.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(_e((e=>""!==e)),et((e=>this.connect(e))),at((()=>this.playerReady$.next(!0))),ji(1)).subscribe(rf)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe(et((()=>this.player.activateElement()))).subscribe(rf),this.observeReady().pipe(et((()=>this.safeVolume(this.muted?0:this.volume)))).subscribe(rf),this.observeReady().pipe(an((()=>this.observeIsLoggedIn())),an((e=>e?this.observePaused():rn)),an((e=>e?rn:this.observeSrc())),qh(this.observeAccessToken()),an((([e,t])=>e&&e!==this.loadedSrc?hn(void 0).pipe(an((()=>this.loadError?this.reconnect(t):hn(void 0))),et((()=>this.addToQueue(e,t))),Un((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),rn))),ji(1)):rn))).subscribe(rf),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe(at((e=>{var t,r;const n=null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri;n&&this.loadedSrc===this.src&&this.currentTrackSrc!==n&&this.currentTrackSrc$.next(n)}))).subscribe(rf),this.currentTrackSrc$.pipe(_e((e=>!!e)),an((()=>this.observeCurrentTrackState().pipe(Kh(2),et((e=>!e.paused&&this.paused?(rf.log("State mismatch: pausing..."),this.safePause()):e.paused&&!this.paused?(rf.log("State mismatch: resuming..."),this.safePlay()):hn(void 0))),ji(1))))).subscribe(rf),this.observeIsLoggedIn().pipe(On((e=>e===this.isLoggedIn)),at((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(nf))}))).subscribe(rf),this.observeIsLoggedIn().pipe(_e((e=>e)),ji(1),et((()=>c("https://sdk.scdn.co/spotify-player.js")))).subscribe(rf),this.observeError().subscribe(rf.error)}get autoplay(){return ef(this,Jh,"f")}set autoplay(e){ef(this,Jh,"f")!==e&&(tf(this,Jh,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return ef(this,Qh,"f")}set muted(e){ef(this,Qh,"f")!==e&&(tf(this,Qh,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return ef(this,Xh,"f")}set volume(e){ef(this,Xh,"f")!==e&&(tf(this,Xh,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return nn(this.observeCurrentTrackState(),this.observePaused().pipe(an((e=>e?this.getCurrentState():Dr(250).pipe(et((()=>this.getCurrentState()))))))).pipe(Be((e=>{var t,r;return(null===(r=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc?e.position/1e3:0})),_n())}observeDuration(){return this.observeCurrentTrackState().pipe(Be((e=>e.duration/1e3)),_n())}observeEnded(){return this.observePlaying().pipe(an((()=>this.observeCurrentTrackState())),_n(af),qh(this.observePaused()),Be((([e,t])=>!t&&e.paused&&0===e.position)),_e((e=>e)),Be((()=>{})))}observeError(){return this.error$}observePlaying(){return this.currentTrackSrc$.pipe(an((e=>e?this.observeCurrentTrackState().pipe(_n(af),qh(this.observePaused()),Be((([e,t])=>!t&&!e.paused)),_n(),_e((e=>e)),Be((()=>{})),ji(1)):rn)))}observeCurrentTrackState(){return this.observeState().pipe(_e((e=>{var t,r;return(null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc})))}appendTo(){}load({src:e}){rf.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(nf))}play(){var e;rf.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.isLoggedIn||this.error$.next(Error(nf))}pause(){rf.log("pause"),this.paused$.next(!0),this.safePause()}stop(){rf.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return Zh(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(Be((e=>!!e)),_n())}observePaused(){return this.paused$.pipe(_n())}observeReady(){return Rn([this.playerReady$,this.playerStarted$]).pipe(_e((([e,t])=>e&&t)),Be((()=>{})),ji(1))}observeSrc(){return this.src$.pipe(_n())}observeState(){return this.state$.pipe(_e(l))}addToQueue(e,t,r=3){var n;return Zh(this,void 0,void 0,(function*(){if(e!==this.src)return;if(!t)throw Error(nf);const i=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!i.ok){if(r>0)switch(i.status){case 401:{const t=yield bh();return this.addToQueue(e,t,--r)}case 429:{const r=Number(null===(n=i.headers)||void 0===n?void 0:n.get("Retry-After"));if(r&&r<=5)return yield A(1e3*r),this.addToQueue(e,t,0);throw i}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--r)}throw i}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return Zh(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{let n=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>Zh(this,void 0,void 0,(function*(){n&&(e=yield bh()),n=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",r),i.addListener("authentication_error",r),i.addListener("account_error",r),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{rf.log("not_ready"),this.deviceId="",r("not_ready")})),i.addListener("ready",(({device_id:e})=>{rf.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return Zh(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return Zh(this,void 0,void 0,(function*(){return rf.log("reconnect"),Le(Zr(this.disconnect()).pipe(Gh(1e3),et((()=>this.connect(e))),Gh(3e3),Be((()=>{}))))}))}safePause(){return Zh(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){rf.error(e)}}))}safePlay(){return Zh(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return Zh(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){rf.error(e)}}))}safeVolume(e){var t;return Zh(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){rf.error(e)}}))}}(ph());var of=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const lf=new H("SubsonicLoginDialog");function cf(e){const t=(0,n.useCallback)(((e,t,r)=>of(this,void 0,void 0,(function*(){const n=r=>of(this,void 0,void 0,(function*(){const n=new URLSearchParams(Object.assign(Object.assign({u:t},r),{c:"ampcast",f:"json"})).toString(),i=yield fetch(`${e}/rest/ping?${n}`);if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw a.error;return JSON.stringify({userName:t,credentials:n})}));try{const e=Ea(12),t=co()(r+e);return yield n({t,s:e,v:"1.13.0"})}catch(e){if(40===e.code)throw e;return lf.log("Login failed. Attempting legacy login...."),yield n({p:r,v:"1.12.0"})}}))),[]);return n.createElement(wa,Object.assign({},e,{service:zf,settings:pu,userName:pu.userName,login:t}))}var uf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const df=new H("subsonicAuth"),mf=new it(""),hf=new it(!1);function ff(){return hf.getValue()}function pf(e){pu.credentials=e,mf.next(e)}mf.pipe(_n()).pipe(_e((e=>""!==e)),et((()=>function(){return uf(this,void 0,void 0,(function*(){try{const e=yield Su.getMusicLibraries();return pu.libraries=e,!0}catch(e){return 40===e.code?pu.credentials="":df.error(e),mf.next(""),!1}}))}()))).subscribe(hf),mf.next(pu.credentials);var yf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class vf{constructor(e,t,r,n){this.parent=n,this.pageNumber=1,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new Bi((()=>yf(this,void 0,void 0,(function*(){const r=this.pageSize,n=(this.pageNumber-1)*r,{items:i,total:a,atEnd:s}=yield t(n,r);return this.pageNumber++,{items:i.map((t=>this.createMediaObject(e,t))),total:a,atEnd:s}}))),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e,t){let r;switch(e){case Zn.Album:r=this.createMediaAlbum(t);break;case Zn.Artist:r=this.createMediaArtist(t);break;case Zn.Playlist:r=this.createMediaPlaylist(t);break;case Zn.Folder:r=this.createFolderItem(t);break;default:r=this.createMediaItem(t)}return r}createMediaItem(e){return"video"===e.type?this.createMediaItemFromVideo(e):this.createMediaItemFromSong(e)}createFolderItem(e){return"type"in e?this.createMediaItem(e):this.createMediaFolder(e)}createMediaItemFromSong(e){return{itemType:Zn.Media,mediaType:ti.Audio,playbackType:Nn.Direct,src:`subsonic:audio:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,artists:[e.artist],album:e.album,duration:e.duration,track:e.track,disc:e.discNumber,year:e.year,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,thumbnails:this.createThumbnails(e.coverArt)}}createMediaItemFromVideo(e){return{itemType:Zn.Media,mediaType:ti.Video,playbackType:Nn.Direct,src:`subsonic:video:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,duration:e.duration,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,thumbnails:this.createThumbnails(e.id)}}createMediaAlbum(e){return{itemType:Zn.Album,src:`subsonic:album:${e.id}`,title:e.name,addedAt:this.parseDate(e.created),artist:e.artist,year:e.year,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,pager:this.createAlbumTracksPager(e),thumbnails:this.createThumbnails(e.coverArt),subsonic:{isDir:e.isDir}}}createMediaArtist(e){return{itemType:Zn.Artist,src:`subsonic:artist:${e.id}`,title:e.name,pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.coverArt),inLibrary:!!e.starred}}createMediaPlaylist(e){const t=`subsonic:playlist:${e.id}`;return{src:t,itemType:Zn.Playlist,title:e.name,description:e.comment,addedAt:this.parseDate(e.created),duration:e.duration,trackCount:e.songCount,pager:this.createPlaylistItemsPager(e),thumbnails:this.createThumbnails(e.coverArt),isPinned:Gi.isPinned(t),isOwn:e.owner===pu.userName,owner:{name:e.owner}}}createMediaFolder(e){var t;const r=e.title||"[unknown]",n={itemType:Zn.Folder,src:`subsonic:folder:${e.id}`,title:r,fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480),this.createThumbnail(e,800)]:void 0}createThumbnail(e,t,r=t){return{url:`${pu.host}/rest/getCoverArt?id=${e}&size=${t}&{subsonic-credentials}`,width:t,height:r}}getFileName(e){return e.split(/[/\\]/).pop()}createAlbumTracksPager(e){return e.song?new hi(e.song.map((e=>this.createMediaObject(Zn.Media,e)))):new vf(Zn.Media,(()=>yf(this,void 0,void 0,(function*(){return{items:yield Su.getAlbumTracks(e.id,e.isDir),atEnd:!0}}))))}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new hi([t]),n=e.album?new hi(e.album.map((e=>this.createMediaObject(Zn.Album,e)))):new vf(Zn.Album,(()=>yf(this,void 0,void 0,(function*(){return{items:yield Su.getArtistAlbums(e.id),atEnd:!0}}))),void 0);return new Hi(r,n)}createArtistTopTracks(e){return{itemType:Zn.Album,src:`subsonic:top-tracks:${e.id}`,title:"Top Songs",artist:e.name,thumbnails:this.createThumbnails(e.coverArt),pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){return new vf(Zn.Media,(()=>yf(this,void 0,void 0,(function*(){return{items:yield Su.getArtistTopTracks(e.name),atEnd:!0}}))))}createPlaylistItemsPager(e){return e.entry?new hi(e.entry.map((e=>this.createMediaObject(Zn.Media,e)))):new vf(Zn.Media,(()=>yf(this,void 0,void 0,(function*(){return{items:yield Su.getPlaylistItems(e.id),atEnd:!0}}))))}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new vf(Zn.Folder,(()=>yf(this,void 0,void 0,(function*(){return{items:yield Su.getMusicDirectoryItems(r),atEnd:!0}}))),{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Zn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new hi([e]);return new Hi(t,n)}return n}}vf.minPageSize=10,vf.maxPageSize=500;const bf=vf;var gf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const wf="subsonic",Ef={id:"subsonic/liked-songs",title:"My Songs",icon:"heart",itemType:Zn.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search(){return new bf(Zn.Media,(()=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getLikedSongs(),atEnd:!0}}))))}},kf={id:"subsonic/liked-albums",title:"My Albums",icon:"heart",itemType:Zn.Album,lockActionsStore:!0,search(){return new bf(Zn.Album,((e,t)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getLikedAlbums(e,t)}}))))}},xf={id:"subsonic/recently-played",title:"Recently Played",icon:"clock",itemType:Zn.Album,search(){return new bf(Zn.Album,((e,t)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getRecentlyPlayed(e,t)}}))))}},Sf={id:"subsonic/most-played",title:"Most Played",icon:"most-played",itemType:Zn.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},secondaryLayout:{view:"details",fields:["Index","Title","Artist","Duration","PlayCount"]},search(){return new bf(Zn.Album,((e,t)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getMostPlayed(e,t)}}))))}},Tf={id:"subsonic/playlists",title:"Playlists",icon:"playlist",itemType:Zn.Playlist,layout:{view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","Genre","PlayCount"]},search(){return new bf(Zn.Playlist,(()=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getPlaylists(),atEnd:!0}}))))}},Pf={id:"subsonic/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Zn.Media,viewType:va.ByGenre,defaultHidden:!0,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},search(e){return e?new bf(Zn.Media,((t,r)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getSongsByGenre(e.id,t,r),total:e.count}})))):new hi}},Af={id:"subsonic/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Zn.Album,viewType:va.ByGenre,search(e){return e?new bf(Zn.Album,((t,r)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getAlbumsByGenre(e.id,t,r),total:e.count}})))):new hi}},If={id:"subsonic/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Zn.Album,viewType:va.ByDecade,search(e){return e?new bf(Zn.Album,((t,r)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getAlbumsByDecade(e.id,t,r)}})))):new hi}},Cf={id:"subsonic/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Zn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search(){return new bf(Zn.Media,(()=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getRandomSongs(100),atEnd:!0}}))))}},Mf={id:"subsonic/random-albums",title:"Random Albums",icon:"shuffle",itemType:Zn.Album,search(){return new bf(Zn.Album,(()=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getRandomAlbums(100),atEnd:!0}}))))}},Of={id:"subsonic/videos",title:"Music Videos",icon:"video",itemType:Zn.Media,mediaType:ti.Video,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Duration"]},search(){return new bf(Zn.Media,(()=>gf(this,void 0,void 0,(function*(){return{items:yield Su.getVideos(),atEnd:!0}}))))}},$f={id:"subsonic/folders",title:"Folders",icon:"folder",itemType:Zn.Folder,viewType:va.Folders,search(){const e={itemType:Zn.Folder,src:"",title:"Folders",fileName:"",path:""},t=(e,t)=>e.name.localeCompare(t.name);return e.pager=new Vi((()=>gf(this,void 0,void 0,(function*(){return pu.libraries.filter((({id:e})=>!!e)).map((({id:r,title:n})=>{const i={itemType:Zn.Folder,src:`subsonic:folder:${r}`,title:n,fileName:n,path:`/${n}`},a=Object.assign(Object.assign({},e),{fileName:"../"}),s=new hi([a]),o=new bf(Zn.Folder,(()=>gf(this,void 0,void 0,(function*(){return{items:(yield Su.getIndexes(r)).map((e=>e.artist.map((({id:e,name:t})=>({id:e,name:t,title:t}))))).flat().sort(t),atEnd:!0}}))),void 0,i);return i.pager=new Hi(s,o),i}))})))),e.pager}},Nf={id:wf,icon:wf,name:"Subsonic",url:"http://www.subsonic.org/",serviceType:Mn.PersonalMedia,defaultHidden:!0,roots:[Lf(Zn.Media,{title:"Songs"}),Lf(Zn.Album,{title:"Albums"}),Lf(Zn.Artist,{title:"Artists"})],sources:[Ef,kf,xf,Sf,Tf,Pf,Af,If,Cf,Mf,Of,$f],labels:{[Qn.AddToLibrary]:"Like on Subsonic",[Qn.RemoveFromLibrary]:"Unlike on Subsonic"},editablePlaylists:Tf,get audioLibraries(){return pu.audioLibraries},get libraryId(){return pu.libraryId},set libraryId(e){pu.libraryId=e},get libraries(){return pu.libraries},set libraries(e){pu.libraries=e},observeLibraryId:()=>pu.observeLibraryId(),addToPlaylist:function(e,t){return gf(this,void 0,void 0,(function*(){const r=Rf(e);return Su.addToPlaylist(r,t.map(Rf))}))},canRate:()=>!1,canStore:jf,compareForRating:function(e,t){return e.src===t.src},createPlaylist:function(e,{description:t="",isPublic:r=!1,items:n=[]}={}){return gf(this,void 0,void 0,(function*(){return{src:`subsonic:playlist:${(yield Su.createPlaylist(e,t,r,n.map(Rf))).id}`,title:e,itemType:Zn.Playlist,pager:new hi}}))},createSourceFromPin:function(e){return{title:e.title,itemType:Zn.Playlist,layout:{view:"card",fields:["Thumbnail","IconTitle","TrackCount","Blurb"]},id:e.src,icon:"pin",isPin:!0,search(){const t=Rf(e);return new bf(Zn.Playlist,(()=>gf(this,void 0,void 0,(function*(){return{items:[yield Su.getPlaylist(t)],atEnd:!0}}))))}}},getFilters:function(e,t){return gf(this,void 0,void 0,(function*(){return Su.getFilters(e,t)}))},getMetadata:function(e){var t;return gf(this,void 0,void 0,(function*(){const r=e.itemType,n=Rf(e);if(r===Zn.Album){if(e.synthetic)return e;if(void 0===e.description){const r=yield Su.getAlbumInfo(n,null===(t=e.subsonic)||void 0===t?void 0:t.isDir);e=Object.assign(Object.assign({},e),{description:P(r.notes),release_mbid:r.musicBrainzId})}}else if(r===Zn.Artist&&void 0===e.description){const t=yield Su.getArtistInfo(n);e=Object.assign(Object.assign({},e),{description:P(t.biography),artist_mbid:t.musicBrainzId})}if(!jf(e)||void 0!==e.inLibrary)return e;const i=Gn.getInLibrary(e);if(void 0!==i)return Object.assign(Object.assign({},e),{inLibrary:i});if(r===Zn.Album){const t=yield Df(e),r=yield Su.getMusicDirectory(t);return Object.assign(Object.assign({},e),{inLibrary:r.starred})}{const t=yield Su.getSong(n);return Object.assign(Object.assign({},e),{inLibrary:t.starred})}}))},getPlayableUrl:function({src:e}){return Su.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{subsonic-credentials}",pu.credentials)},lookup:function(e,t,r=10,n){return gf(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return di(new bf(Zn.Media,((r,n)=>gf(this,void 0,void 0,(function*(){return{items:yield Su.searchSongs(`${e} ${t}`,r,n)}}))),i),{timeout:n})}))},store:function(e,t){return gf(this,void 0,void 0,(function*(){const r=t?"star":"unstar";switch(e.itemType){case Zn.Media:{const[,,t]=e.src.split(":");yield Su.get(r,{id:t});break}case Zn.Album:{const t=yield Df(e);yield Su.get(r,{id:t});break}}}))},observeIsLoggedIn:function(){return hf.pipe(_n())},isConnected:function(){return!!pu.credentials},isLoggedIn:ff,login:function(){return uf(this,void 0,void 0,(function*(){if(!ff()){df.log("connect");try{const e=yield function(){return of(this,void 0,void 0,(function*(){return cr(cf,!0)}))}();if(e){const{userName:t,credentials:r}=JSON.parse(e);pu.userName=t,pf(r)}}catch(e){df.error(e)}}}))},logout:function(){return uf(this,void 0,void 0,(function*(){df.log("disconnect"),pu.clear(),pf(""),hf.next(!1)}))}},zf=Nf;function jf(e){switch(e.itemType){case Zn.Media:return!0;case Zn.Album:return!e.synthetic;default:return!1}}function Lf(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`subsonic/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){return(t=t.trim())?new bf(e,((r,n)=>gf(this,void 0,void 0,(function*(){switch(e){case Zn.Media:return{items:yield Su.searchSongs(t,r,n)};case Zn.Album:return{items:yield Su.searchAlbums(t,r,n)};case Zn.Artist:return{items:yield Su.searchArtists(t,r,n)};default:throw TypeError("Search not supported for this type of media")}})))):new hi}})}function Df(e){var t;return gf(this,void 0,void 0,(function*(){const r=Rf(e);if(null===(t=e.subsonic)||void 0===t?void 0:t.isDir)return r;const[{parent:n}]=yield Su.getAlbumTracks(r);return n||""}))}function Rf({src:e}){const[,,t]=e.split(":");return t}const Ff=new H("mediaServices");function _f(){return[da,_h,ys,to,od,xm,Km,zf,Bc,No,cu]}function Bf(){return _f().filter((e=>!e.disabled))}function Vf(e){if(Xf(e.src))return!0;const t=Jf(e);return!!(null==t?void 0:t.isLoggedIn())}function Uf(){return Bf().filter(Zf)}function Hf(){return Bf().filter((e=>!!e.lookup))}function Yf(){return Bf().filter(ep)}function qf(){return _f().filter((e=>!Zf(e)))}function Kf(){return Bf().filter(rp)}function Wf(){return Uf().filter((e=>e.canScrobble))}function Gf(e){return _f().find((t=>t.id===e))}function Jf({src:e}={}){const[t]=String(e).split(":");return Gf(t)}function Qf(e){return!!e&&tp(e.src)}function Xf(e){const[t]=String(e).split(":");return/^(blob|file|https?|youtube)$/.test(t)}function Zf(e){return np(e,Mn.DataService)}function ep(e){return np(e,Mn.PersonalMedia)}function tp(e){if(Xf(e))return!0;const[t,r,n]=String(e).split(":");return!!n&&!!r&&function(e){const t=Gf(e);return!!t&&t.serviceType!==Mn.DataService}(t)}function rp(e){return np(e,Mn.PublicMedia)}function np(e,t){return function(e){return!!e&&"serviceType"in e}(e)&&e.serviceType===t}if(Gn.registerServices(Bf()),!Mm||Bc.disabled){let e=!1;const t={};if(Bc.disabled&&Om(Bc)&&(t[Bc.id]=!0,e=!0),!Mm){const r=Kf().filter(Om);if(r.length>1){let n=r;if(pd.hasTidal||(n=S(n,(e=>e!==Km))),n.length>1&&(n=S(n,(e=>e.isConnected())),n.length>1)){const e=[da,Km,_h,Bc];for(;n.length>1&&e.length>0;){const t=e.pop();n=S(n,(e=>e!==t))}}const[i]=n;for(const e of r)e!==i&&(t[e.id]=!0,e.isConnected()&&!e.authService&&e.logout());e=!0}}e&&$m(t)}function ip({service:e,showConnectivity:t,showRestrictedAccess:r}){const i=e.authService||e,a=r&&rp(e)&&e.restrictedAccess;return n.createElement(wr,{className:"media-service-label",icon:e.icon,text:e===i?`${e.name}${a?" *":""}`:n.createElement(n.Fragment,null,e.name," ",n.createElement("span",{className:`auth-service auth-service-${i.id} ${t?"show-connectivity":""}`,title:`via ${i.name}`},i.name)),showConnectivity:t})}Zr(Bf()).pipe(et((e=>e.observeIsLoggedIn().pipe(On((e=>!e)),at((t=>Ff.log(`${e.id} ${t?"":"dis"}connected`))))))).subscribe(Ff);var ap=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function sp(e){var{id:t,item:r,index:i,selected:a}=e,s=ap(e,["id","item","index","selected"]);const o=(0,n.useCallback)((e=>{e.target.focus()}),[]);return n.createElement("button",Object.assign({},s,{className:"tab",type:"button",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`,onMouseDown:o}),r.tab)}function op({id:e,item:t,index:r,hidden:i}){return n.createElement("div",{className:"tab-panel",id:`${e}-panel-${r}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${r}`},t.panel)}function lp({label:e,items:t,className:r=""}){const i=(0,n.useId)(),a=(0,n.useRef)(null),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(0);(0,n.useEffect)((()=>{o(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,n.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),s.length-1);const r=s[t];r&&!r.disabled&&r.focus()}),[l,s]),d=(0,n.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return n.createElement("div",{className:`tab-list ${r}`},n.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>n.createElement("li",{role:"presentation",key:t},n.createElement(sp,{id:i,item:e,index:t,selected:t===l}))))),n.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>n.createElement(op,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}function cp(e,t){const[r,i]=(0,n.useState)(t);return(0,n.useEffect)((()=>{const t=e().subscribe(i);return()=>t.unsubscribe()}),[e]),r}function up(){return cp((0,n.useMemo)((()=>()=>nn(Kt.observe(),Yt.observeUserThemes()).pipe(Be((()=>Object.assign({},Kt.current))))),[]),Kt.current)}function dp(){return cp((0,n.useMemo)((()=>()=>Yt.observeUserThemes()),[]),[])}var mp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function hp(e){var{icon:t,className:r=""}=e,i=mp(e,["icon","className"]);return n.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${r}`,type:"button",onMouseDown:E,onMouseUp:w}),n.createElement(rt,{name:t}))}var fp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function pp(e){var{colorName:t,onChange:r}=e,i=fp(e,["colorName","onChange"]);const a=(0,n.useCallback)((e=>{const n=e.target.value;Kt[t]=n,null==r||r(n)}),[t,r]);return n.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function yp({label:e,backgroundColorName:t,textColorName:r,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:s,nextSuggestion:o,trackingColor:l="frame"}){const c=up(),u=i&&a,d=c[t],m=c[r],[h,f]=(0,n.useState)((()=>d||i||"")),[p,y]=(0,n.useState)((()=>m||a||"")),v=!d&&!m,b=(0,n.useCallback)((()=>{if(s&&o){const[e,n]=s;Kt[t]=e,Kt[r]=n,o()}}),[t,r,s,o]),g=(0,n.useCallback)((()=>{v?(Kt[t]=h,Kt[r]=p):(Kt[t]="",Kt[r]="")}),[v,t,r,h,p]),w=(0,n.useCallback)((()=>{const e=Kt[t],n=Kt[r];Kt[t]=n,Kt[r]=e}),[t,r]);return n.createElement("p",{className:"color-pair "+(v?"locked":"")},n.createElement("label",null,e,":"),n.createElement(pp,{colorName:t,value:d||i,title:`${e} background color`,disabled:v,onChange:f}),n.createElement(hp,{icon:"swap",title:"Swap",onClick:w,disabled:v}),n.createElement(pp,{colorName:r,value:m||a,title:`${e} text color`,disabled:v,onChange:y}),u?n.createElement(hp,{icon:v?"locked":"unlocked",title:v?"Allow editing":`Lock to ${l} color`,onClick:g}):null,s&&o?n.createElement("button",{className:"small",type:"button",onClick:b},"Suggest"):null)}function vp(e,t){const r=new xt(e),n=new xt(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)}function bp(e,t,r={includeFallbackColors:!1,level:"AA",size:"small"}){let n=null,i=0;const{includeFallbackColors:a,level:s,size:o}=r;for(const r of t){const t=vp(e,r);t>i&&(i=t,n=new xt(r))}return function(e,t,r={level:"AA",size:"small"}){const n=vp(e,t);switch((r.level??"AA")+(r.size??"small")){case"AAsmall":case"AAAlarge":return n>=4.5;case"AAlarge":return n>=3;case"AAAsmall":return n>=7;default:return!1}}(e,n,{level:s,size:o})||!a?n:(r.includeFallbackColors=!1,bp(e,["#fff","#000"],r))}let gp=null,wp="none";const Ep="text/ampcast-items",kp={get type(){return Ep},set:function(e,t,r){e.dataTransfer.setData(Ep,"#globalDrag"),e.dataTransfer.effectAllowed=r,gp=t,wp=r},unset:function(){gp=null,wp="none"},getData:function(e){return"#globalDrag"===e.dataTransfer.getData(Ep)?gp:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData(Ep)?wp:"none"}};function xp({style:e,title:t}){return n.createElement("div",{className:"list-view-cell",style:e},t)}function Sp({col:e,onResize:t}){const[r,i]=(0,n.useState)(-1),[a,s]=(0,n.useState)(0),o=-1!==r,{width:l,index:c}=e,u=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&(i(e.screenX),s(l))}),[l]);(0,n.useEffect)((()=>t(e.index,l)),[e.index,l,t]);const d=(0,n.useCallback)((e=>{t(c,Math.max(20,a+(e.screenX-r)))}),[r,a,c,t]),m=(0,n.useCallback)((()=>{i(-1),s(0)}),[]);return(0,n.useEffect)((()=>{if(o)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[o,d,m]),n.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+l-4+"px"}})}function Tp({width:e,height:t,cols:r,sizeable:i,onColumnResize:a}){const s=(0,n.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return n.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},n.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},r.map((e=>n.createElement(xp,Object.assign({},e,{key:e.index}))))," ",i&&r.map((e=>n.createElement(Sp,{col:e,onResize:s,key:e.index})))))}function Pp({rowIndex:e,col:{className:t="",render:r,style:i},item:a}){return n.createElement("div",{className:`list-view-cell ${t}`,style:i},r(a,e))}function Ap({item:e,className:t,id:r,rowIndex:i,height:a,selected:s,cols:o,setSize:l,dragIndex:c}){const u=`${t} ${s?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return n.createElement("li",{role:"option",className:`list-view-row ${u}`,id:r,"aria-selected":s,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},o.map((t=>n.createElement(Pp,{rowIndex:i,col:t,item:e,key:t.index}))))}function Ip({listViewId:e,title:t,width:r,height:i,rowHeight:a,cols:s,items:o,itemKey:l,itemClassName:c,selectedId:u,selectedIds:d,scrollTop:m,overScan:h=2,draggable:f,dragIndex:p,multiple:y=!1}){const v=(0,n.useRef)(null),b=o.length,g=Math.floor(m/a),w=Math.floor(i/a),E=Math.max(0,g-h),k=Math.min(b,w+2*h),x=o.slice(E,E+k);return n.createElement("ol",{role:"listbox",className:"list-view-body",draggable:f,style:{width:r?`${r}px`:void 0},"aria-label":t,"aria-multiselectable":y,"aria-activedescendant":u,ref:v},x.map(((t,r)=>n.createElement(Ap,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+r,height:a,selected:!!t&&d.includes(t[l]),cols:s,item:t,setSize:b,dragIndex:p,key:t[l]}))))}const Cp=[],Mp=()=>"",Op=["ArrowUp","ArrowDown","PageUp","PageDown"];function $p({items:e=[],itemKey:t,title:r,itemClassName:i=Mp,layout:a,className:s="",selectedIndex:o=-1,draggable:c,droppable:u,droppableTypes:d=[],multiple:m,reorderable:h,disabled:f,onClick:p,onDoubleClick:y,onContextMenu:v,onDrop:b,onDelete:g,onEnter:w,onInfo:E,onRowIndexChange:k,onScrollIndexChange:x,onPageSizeChange:S,onSelect:T,onMove:P,listViewRef:A}){const I=(0,n.useId)(),C=(0,n.useRef)(null),M=(0,n.useRef)(null),O=(0,n.useRef)(null),$=(0,n.useRef)(null),N=(0,n.useRef)(null),z="details"===a.view&&a.showTitles,L="details"===a.view&&a.sizeable,[D,R]=(0,n.useState)(-1),[F,_]=(0,n.useState)(0),[B,V]=(0,n.useState)(0),[U,H]=(0,n.useState)(0),[Y,q]=(0,n.useState)(0),[K,W]=function(e){const[t,r]=(0,n.useState)([]),i="details"===e.view&&e.sizeable;(0,n.useEffect)((()=>{const t="details"===e.view,n=t&&e.sizeable;r(e.cols.reduce(((e,r,i)=>{const a=e[i-1],s=a?a.left+a.width:0,{title:o="",className:l="",align:c="left",width:u=200}=r,d=n?{left:`${s}px`,width:`${u}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},r),{title:o,className:l,align:c,index:i,left:s,width:u,style:d})),e}),[]))}),[e]);const a=(0,n.useCallback)(((e,n)=>{i&&t[e].width!==n&&r(t.reduce(((t,r,i)=>{if(i>=e){const a=t[i-1],s=a?a.left+a.width:0,o=i===e?n:r.width,l={left:`${s}px`,width:`${o}px`,textAlign:r.align};t.push(Object.assign(Object.assign({},r),{left:s,width:o,style:l}))}else t.push(r);return t}),[]))}),[t,i]);return[t,a]}(a),G=(0,n.useMemo)((()=>K.reduce(((e,t)=>e+t.width),0)),[K]),J=Y?Math.max(Math.floor(B/Y),1)-(z?1:0):0,Q=e.length,{selectedItems:X,selectAll:Z,selectAt:ee,selectRange:te,toggleSelectionAt:re}=function(e,t,r){const[i,a]=(0,n.useState)([]),s=pn(e);(0,n.useEffect)((()=>{if(e!==s){const s=e.filter((e=>i.some((r=>r[t]===e[t]))));if(o=s,(n=i).length!==o.length||!n.every(((e,t)=>o[t]===e))){const t=e.length;if(t>0&&0===s.length)if(r<t){const t=e[r];a(t?[t]:[])}else{const r=e[t-1];a(r?[r]:[])}else a(s)}}var n,o}),[s,e,i,t,r]);const o=(0,n.useCallback)((()=>{a(e.filter(l))}),[e]),c=(0,n.useCallback)((t=>{const r=e[t];a(r?[r]:[])}),[e]),u=(0,n.useCallback)(((t,r)=>{const n=Math.min(t,r),i=Math.max(t,r),s=e.slice(n,i+1).filter(l);a(s)}),[e]),d=(0,n.useCallback)(((t,r)=>{const n=e[t],s=i.includes(n);s!==r&&a(s?i.filter((e=>e!==n)):e.filter((e=>i.includes(e)||e===n)))}),[e,i]);return{selectedItems:i,selectAll:o,selectAt:c,selectRange:u,toggleSelectionAt:d}}(e,t,D),ne=X.length>0,ie=Jt(),[ae,se]=(0,n.useState)(-1),[oe,le]=(0,n.useState)(-1),[ce,ue]=(0,n.useState)(-1),de=0===Q,me=-1!==ce,he=Y?Math.floor(F/Y):0,fe=fn(Op)&&!(0===D||D===Q-1),pe=pn(e),[ye,ve]=(0,n.useState)((()=>X)),[be,ge,we,Ee]=c||h?X:[],ke=e[D]?`${I}-${e[D][t]}`:"",xe=(0,n.useMemo)((()=>X.map((e=>e[t]))),[X,t]),Se=(0,n.useCallback)((()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.focus()}),[]),Te=(0,n.useCallback)((e=>{const t=O.current,r=Math.floor(F/Y);if(e>=r+J-1){const r=(Q+(z?1:0))*Y,n=Q-J-1,i=Math.min(Q-1,e+1)-J,a=i===n?r:i*Y;t.scrollTo({top:a})}else if(e<=r){const r=Math.max(0,e-1)*Y;t.scrollTo({top:r})}}),[F,Y,J,z,Q]),Pe=(0,n.useCallback)((e=>{Te(e),ee(e),R(e)}),[Te,ee]);(0,n.useEffect)((()=>{C.current={focus:Se,scrollIntoView:Pe,scrollTo:Te,selectAll:Z,selectAt:ee},A&&(A.current=Object.assign(A.current||{},C.current))}),[A,Se,Pe,Te,Z,ee]),(0,n.useEffect)((()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView(o)}),[o]),(0,n.useEffect)((()=>null==k?void 0:k(D)),[D,k]),(0,n.useEffect)((()=>null==x?void 0:x(he)),[he,x]),(0,n.useEffect)((()=>null==S?void 0:S(J)),[J,S]),(0,n.useEffect)((()=>null==T?void 0:T(ye)),[ye,T]),(0,n.useEffect)((()=>R(Math.min(Q-1,D))),[Q,D]),(0,n.useEffect)((()=>{if(pe&&e.length!==pe.length){const r=pe[D];if(r){const n=e.findIndex((e=>e&&e[t]===r[t]));-1!==n&&R(n)}}}),[e,pe,D,t]),(0,n.useEffect)((()=>{fe||ve(X)}),[X,fe]),(0,n.useEffect)((()=>{de&&R(-1)}),[de]),(0,n.useEffect)((()=>{!m&&X.length>1&&ee(D)}),[m,D,X,ee]);const Ae=(0,n.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==w||w(X,t[j.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==g||g(X);break;case"KeyI":if(t[j.ctrlKey]&&!t.shiftKey){t.preventDefault(),t.stopPropagation(),t.repeat||null==E||E(X);break}break;case"KeyA":t[j.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||Z());break;case"ShiftLeft":case"ShiftRight":t.repeat||se(D);break;case"Space":t.preventDefault(),t.repeat||(t[j.ctrlKey]?(t.stopPropagation(),re(D)):X.includes(e[D])||(t.stopPropagation(),re(D,!0)));break;default:{const r=e.length,n=function(e,t,r,n){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=r-1;break;case"PageDown":t+=r-1;break;case"Home":t=0;break;case"End":t=n-1;break;default:return-1}return Math.min(Math.max(t,0),n-1)}(t.key,D,J,r);-1!==n&&(t.preventDefault(),n!==D&&(t.stopPropagation(),Te(n),R(n)),m&&t.shiftKey&&-1!==ae?te(ae,n):t[j.ctrlKey]||ee(n))}}}),[D,e,J,w,g,E,Te,Z,ee,te,re,X,m,ae]),Ie=(0,n.useCallback)((e=>{const t=Np(e);-1!==t&&(R(t),m&&e.shiftKey?-1===ae?te(t,D):te(ae,t):m&&e[j.ctrlKey]?re(t):function(e){const t=zp(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||ee(t))}),[ee,re,te,D,ae,m]),Ce=(0,n.useCallback)((e=>{if(0===e.button){const t=Np(e);-1!==t&&(!m||e[j.ctrlKey]||e.shiftKey||ee(t))}}),[ee,m]),Me=(0,n.useCallback)((e=>{"Shift"===e.key&&se(-1)}),[]),Oe=(0,n.useCallback)((({clientWidth:e,clientHeight:t})=>{H(e),V(t)}),[]),$e=(0,n.useCallback)((({top:e})=>{_(e)}),[]);Wt($,(({height:e})=>q(e)),"border-box"),(0,n.useEffect)((()=>{M.current.classList.toggle("thin",20*ie>U)}),[ie,U]);const Ne=(0,n.useCallback)((t=>{const r=Np(t);-1!==r&&(t.preventDefault(),null==p||p(e[r],r))}),[e,p]),ze=(0,n.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(M.current,D);if(t){const r=t.getBoundingClientRect();null==v||v(X,Math.min(r.left+U,r.right),r.bottom,D,e.button)}}else null==v||v(X,e.pageX,e.pageY,Np(e),e.button)}),[D,X,v,U]),je=(0,n.useCallback)((t=>{const r=Np(t);-1!==r&&(t.preventDefault(),null==y||y(e[r],r))}),[e,y]);(0,n.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(M.current.querySelectorAll(".list-view-body:not(.list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let r=0;r<t.length;r++){const n=t[r].cloneNode(!0);n.removeAttribute("id"),n.removeAttribute("role"),n.style.transform=`translateY(${Y*r}px)`,e.appendChild(n)}}),[be,ge,we,Ee,Y]);const Le=(0,n.useCallback)((e=>{const t=e.dataTransfer;if(c||h){t.setDragImage(N.current,-16,-16);let r="none";r=c&&h?"copyMove":c?"copy":"move",kp.set(e,X,r),ue(D)}else t.effectAllowed="none"}),[c,h,X,D]),De=(0,n.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(u||h){let r=Np(e);-1===r&&(r=Q),me?h&&jp(t,d)?(t.dropEffect="move",le(r)):(t.dropEffect="none",le(-1)):u&&jp(t,d)?(t.dropEffect="copy",le(r)):(t.dropEffect="none",le(-1))}else me?t.dropEffect="copy":(t.dropEffect="none",le(-1))}),[Q,me,u,d,h]),Re=(0,n.useCallback)((e=>{if(u||h){let t=Np(e);-1===t&&(t=Q);const r=kp.getEffect(e);if(!h||"move"!==r&&"copyMove"!==r){if(u){const r=function(e,t){const r=e.dataTransfer;switch(r.types[0]){case"Files":return Array.from(r.files).filter((e=>t.some((t=>Dp(t,e.type)))));case"text/ampcast-items":return kp.getData(e);default:return Lp(r,t)}}(e,d);r&&(null==b||b(r,t))}}else{const e=ce<t?-1:0;null==P||P(X,t),R(t+e)}}le(-1),e.preventDefault(),e.stopPropagation()}),[Q,X,u,d,h,ce,b,P]),Fe=(0,n.useCallback)((()=>{kp.unset(),ue(-1)}),[]),_e=(0,n.useCallback)((e=>{const t=e.dataTransfer;"copyMove"===t.effectAllowed&&(t.dropEffect="copy"),le(-1)}),[]),Be=(0,n.useCallback)((()=>{m||ne||ee(Math.max(D,0))}),[ne,D,m,ee]);return n.createElement("div",{className:`list-view list-view-${a.view} ${s}`,tabIndex:f?void 0:de?-1:0,onClick:Ne,onContextMenu:ze,onDoubleClick:je,onDragStart:Le,onDragEnter:De,onDragOver:De,onDragLeave:_e,onDragEnd:Fe,onDrop:Re,onFocus:Be,onKeyDown:Ae,onKeyUp:Me,onMouseDown:Ie,onMouseUp:Ce,ref:M},n.createElement(dn,{scrollWidth:L?G:void 0,scrollHeight:(Q+(u?1:0)+(z?1:0))*Y,scrollAmount:Y,droppable:u||h&&me,onResize:Oe,onScroll:$e,scrollableRef:O},z&&n.createElement(Rr,null,n.createElement(Tp,{width:G,height:Y,sizeable:L,cols:K,onColumnResize:W})),n.createElement(Ip,{title:r,width:L?G:void 0,height:B,rowHeight:Y,cols:K,items:e,itemKey:t,itemClassName:i,listViewId:I,selectedId:ke,selectedIds:f?Cp:xe,scrollTop:F,dragIndex:oe,draggable:!f&&(c||h),multiple:m}),n.createElement("div",{className:"list-view-cursor",style:{width:L?`${G}px`:void 0,transform:`translateY(${Math.max(D,0)*Y}px)`},ref:$})),n.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function Np(e){let t=0;const r=zp(e);return r&&(t=Number(r.getAttribute("aria-posinset"))||0),t-1}function zp(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function jp(e,t){return null!==Lp(e,t)}function Lp(e,t){const r=[kp.type].concat(t),n=Array.from(e.items);for(const e of r)for(const t of n)if(Dp(e,t.type))return t;return null}function Dp(e,t){const[r,n]=e.split("/"),[i,a]=t.split("/");return r===i&&(n===a||"*"===n)}var Rp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Fp(e){var{renderItem:t=String,className:r=""}=e,i=Rp(e,["renderItem","className"]);const a=(0,n.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return n.createElement($p,Object.assign({},i,{className:`list-box ${r}`,layout:a}))}var _p=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Bp(e){return _p(this,void 0,void 0,(function*(){return!Yt.getUserTheme(e)||br({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var Vp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Up(e){var{suggestedName:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["suggestedName"]);const i=(0,n.useId)(),a=(0,n.useMemo)((()=>e=>e.name),[]),[s,o]=(0,n.useState)(t),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u=dp(),d=(0,n.useCallback)((e=>{o(e.target.value)}),[]),m=(0,n.useCallback)((([e])=>{e&&(c.current.value=e.name,o(e.name))}),[]),h=(0,n.useCallback)((()=>Vp(this,void 0,void 0,(function*(){s&&(yield Bp(s))&&l.current.close(s)}))),[s]),f=(0,n.useCallback)((e=>Vp(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return n.createElement(or,Object.assign({},r,{className:"save-theme-dialog",title:"Save Theme",onSubmit:f,ref:l}),n.createElement("form",{method:"dialog"},n.createElement("p",{className:"prompt-message"},n.createElement("label",{htmlFor:i},"Name: "),n.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),n.createElement(Fp,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),n.createElement(fr,{value:s,submitText:"Save"})))}var Hp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Yp=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=up(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useMemo)((()=>Kt.fontSize),[]),o=(0,n.useMemo)((()=>Yt.getDefaultThemes()),[]),l=dp(),c=!!t.userTheme;(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Kt.fontSize)),()=>{Kt.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,n.useCallback)((()=>Kt.save()),[]),d=(0,n.useCallback)((()=>{const e=a.current.checked?Yt.getUserTheme(i.current.value):Yt.getDefaultTheme(r.current.value);e&&Kt.apply(e)}),[]),m=(0,n.useCallback)((e=>{Kt.fontSize=e.target.valueAsNumber}),[]);return n.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},n.createElement("fieldset",null,n.createElement("legend",null,"Theme"),n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),n.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),n.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:r},o.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))),n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),n.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),n.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))))),n.createElement("fieldset",null,n.createElement("legend",null,"Preferences"),n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"font-size"},n.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),n.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:s,onChange:m})))),n.createElement(fr,null))}),null)},{tab:"Theme Editor",panel:n.createElement((function(){const e=(0,n.useId)(),t=up(),r=`${t.name}${Kt.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,s]=function(e){const[t,r]=(0,n.useState)([]),[i,a]=(0,n.useState)(-1);(0,n.useEffect)((()=>{const t=new xt(e),n=h([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new xt(e))),i=n.reverse().map((e=>[e.toHexString(),bp(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));r(p(i)),a(-1===i.length?-1:0)}),[e]);const s=(0,n.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],s]}(t.frameColor);(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Kt.fontSize)),()=>{Kt.restore(),e.removeProperty("--font-size")}}),[]);const o=(0,n.useCallback)((()=>{Kt.save()}),[]),l=(0,n.useCallback)((()=>{!function(e){var t,r,i,a;t=this,r=void 0,a=function*(){const t=yield cr((t=>n.createElement(Up,Object.assign({},t,{suggestedName:e}))),!0);t&&(Kt.name=t,Kt.userTheme=!0,yield Yt.save(Kt.current))},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,r||[])).next())}))}(t.name)}),[t]),c=(0,n.useCallback)((e=>{Kt.spacing=e.target.valueAsNumber}),[]),u=(0,n.useCallback)((e=>{Kt.roundness=e.target.valueAsNumber}),[]),d=(0,n.useCallback)((e=>{Kt.flat=e.target.checked}),[]);return n.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:o},n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"theme-name"},n.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),n.createElement("input",{type:"text",id:`${e}-theme-name`,value:r,spellCheck:!1,readOnly:!0,tabIndex:-1}),n.createElement("button",{className:"small",type:"button",onClick:l},"Save as…")),n.createElement(yp,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),n.createElement(yp,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),n.createElement(yp,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:s,key:`${i}/selection`}),n.createElement(yp,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:Kt.defaultMediaButtonColor,defaultTextColor:Kt.defaultMediaButtonTextColor,key:`${i}/media-button`}),n.createElement(yp,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:Kt.defaultButtonColor,defaultTextColor:Kt.defaultButtonTextColor,key:`${i}/button`}),n.createElement(yp,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:Kt.defaultScrollbarColor,defaultTextColor:Kt.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),n.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),n.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),n.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),n.createElement(fr,null))}),null)},{tab:"My Themes",panel:n.createElement((function(){const e=(0,n.useRef)(null),t=(0,n.useMemo)((()=>e=>e.name),[]),r=(0,n.useRef)(null),i=dp(),[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)([]),[c]=o;(0,n.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),s(""))}}),[i,a]);const u=(0,n.useCallback)((()=>Hp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield Tr({title:"My Themes",label:"Name",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield Bp(t))&&(yield Yt.rename(e,t),s(t))}}))),[c]),d=(0,n.useCallback)((()=>Hp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=Yt.getUserTheme(e);if(t){const{userTheme:r}=t,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["userTheme"]);!function(e,t,r="text/json"){const n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:r})),n.download=e,n.type=r,n.click()}(`${e}.json`,JSON.stringify(n,void 0,4))}}}))),[c]),m=(0,n.useCallback)((()=>Hp(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,r=void 0,i=function*(){return br({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e);t&&(yield Yt.remove(e),l([]))}}))),[c]),h=(0,n.useCallback)((()=>{r.current.click()}),[]),f=(0,n.useCallback)((e=>Hp(this,void 0,void 0,(function*(){var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(yield function(e){return t=this,r=void 0,i=function*(){try{const t=yield e.text(),r=JSON.parse(t);if(!Kt.validate(r))return void(yield kr("Not a valid theme.",!0));let n=r.name,i=!1;for(;n&&!i;)n=yield Tr({title:"Import theme",suggestedValue:n,okLabel:"Import",system:!0}),n&&(i=yield Bp(n),i&&(yield Yt.save(Object.assign(Object.assign({},r),{name:n}))))}catch(e){console.error(e),yield kr("Could not load theme.",!0)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(r),e.target.value="")}))),[]);return n.createElement("form",{className:"user-themes",method:"dialog"},n.createElement("h3",null,"My themes:"),n.createElement(Fp,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),n.createElement("p",{className:"user-themes-buttons"},n.createElement("button",{type:"button",onClick:u,disabled:!c},"Rename…"),n.createElement("button",{type:"button",onClick:d,disabled:!c},"Export…"),n.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),n.createElement("fieldset",{className:"user-themes-import"},n.createElement("legend",null,"Import themes"),n.createElement("p",null,n.createElement("input",{type:"file",accept:"text/json,.json",onChange:f,ref:r}),n.createElement("button",{type:"button",onClick:h},"Import…"))),n.createElement(fr,null))}),null)}];function qp(){return n.createElement(lp,{className:"appearance-settings",items:Yp,label:"Appearance"})}function Kp(){const e=(0,n.useRef)(null),t=(0,n.useId)(),r=(0,n.useCallback)((()=>{nl.preferPersonalMedia=e.current.checked}),[]);return n.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:r},n.createElement("input",{id:`${t}-lookup-preference`,type:"checkbox",defaultChecked:nl.preferPersonalMedia,ref:e}),n.createElement("label",{htmlFor:`${t}-lookup-preference`},"Prefer personal media"),n.createElement("div",{className:"note"},n.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),n.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from your preferred service is used. Otherwise your last played media service is used.")),n.createElement(fr,null))}function Wp({services:e,multiSelect:t}){const r=(0,n.useId)(),i=t?"checkbox":"radio";return n.createElement("ul",{className:"media-service-list checkbox-list"},t?null:n.createElement("li",{className:"no-icon",key:"none"},n.createElement("input",{id:`${r}-none`,type:i,name:r,value:"",defaultChecked:!e.some(Om)}),n.createElement("label",{htmlFor:`${r}-none`},"None")),e.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${r}-${e.id}`,type:i,name:t?void 0:r,value:e.id,defaultChecked:Om(e)}),n.createElement("label",{htmlFor:`${r}-${e.id}`},n.createElement(ip,{service:e,showRestrictedAccess:!0}))))))}var Gp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Jp=new H("confirmDisconnectServices");var Qp=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Xp({serviceType:e,services:t}){const r=(0,n.useRef)(null),i=e===Mn.PublicMedia,a=!i||Mm,[s,o]=(0,n.useState)((()=>!!i&&t.filter(Om).some(Zp))),l=(0,n.useCallback)((()=>Qp(this,void 0,void 0,(function*(){const e=r.current.elements;let t=!1;for(const r of e){const e=r.value;e&&r.checked&&(t||(t=Zp(Gf(e))))}o(t)}))),[]),c=(0,n.useCallback)((()=>Qp(this,void 0,void 0,(function*(){const e=r.current.elements,t={},i=[];for(const r of e){const e=r.value;if(e){const n=!r.checked;t[e]=n;const a=Gf(e);a&&n&&i.push(a)}}(yield function(e){return Gp(this,void 0,void 0,(function*(){let t=0===(e=e.filter((e=>e.isConnected()&&!function(e){return Bf().filter((t=>t.authService===e)).some(Om)}(e)))).length;if(!t&&(t=yield br({message:n.createElement("div",{className:"confirm-disconnect-services"},n.createElement("p",null,"You will be disconnected from the following services:"),n.createElement("ul",null,e.map((e=>n.createElement("li",{key:e.id},n.createElement(ip,{service:e})))))),okLabel:"Disconnect",system:!0}),t))try{yield Promise.all(e.filter((e=>!e.authService||!Om(e.authService))).map((e=>e.logout())))}catch(e){Jp.error(e)}return t}))}(i))&&$m(t)}))),[]);return n.createElement("form",{method:"dialog",onSubmit:c},n.createElement("fieldset",{className:"media-services",onChange:i?l:void 0,ref:r},n.createElement("legend",null,"Enable"),n.createElement(Wp,{services:t,multiSelect:a})),s?n.createElement("p",{className:"restricted-access"},"*Access is restricted to approved users only."):null,n.createElement(fr,null))}function Zp(e){return!!(null==e?void 0:e.restrictedAccess)}function ey({title:e,serviceType:t,services:r}){const i=(0,n.useMemo)((()=>{const e=[{tab:"General",panel:n.createElement(Xp,{serviceType:t,services:r})}];return t===Mn.DataService&&e.push({tab:"Lookup",panel:n.createElement(Kp,null)}),e}),[t,r]);return n.createElement(lp,{className:"media-services-settings",items:i,label:e})}var ty=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function ry(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useCallback)((()=>ty(this,void 0,void 0,(function*(){const e=t.current.checked;Ei.useMusicKitBeta!==e&&(Ei.useMusicKitBeta=e,yield mr({title:"Reload required",message:"The app will now reload.",system:!0}),yield da.logout(),location.reload())}))),[]);return n.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:r},n.createElement("fieldset",null,n.createElement("legend",null,"MusicKit*"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!Ei.useMusicKitBeta}),n.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:Ei.useMusicKitBeta,ref:t}),n.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),n.createElement("div",{className:"note"},n.createElement("p",null,"MusicKit beta enables playback of music videos."),n.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),n.createElement("p",null,"You will need to reload the page for changes to take effect. And you will need to log in again.")),n.createElement("p",null,n.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),n.createElement(fr,null))}var ny=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function iy(e){return ny(this,void 0,void 0,(function*(){const t=e.clientIdentifier;if(pd.serverId===t){const{connection:r,libraries:n}=pd;return{id:t,device:e,connection:r,libraries:n}}{const r=yield Wd(e);let n=[];if(r)try{n=yield Ld.getMusicLibraries(r.uri,e.accessToken)}catch(e){console.error(e)}return{id:t,device:e,connection:r,libraries:n}}}))}function ay(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=function(){const e=cp(xm.observeIsLoggedIn,!1),[t,r]=(0,n.useState)((()=>{const{server:e,connection:t,libraries:r}=pd;return e?[{id:e.clientIdentifier,device:e,connection:t,libraries:r}]:[]}));return(0,n.useEffect)((()=>{if(e){const e=Zr(function(){return ny(this,void 0,void 0,(function*(){const e=yield Ld.getServers();return Promise.all(e.map(iy))}))}()).subscribe(r);return()=>e.unsubscribe()}}),[e]),t}(),[a,s]=(0,n.useState)(null),[o,l]=(0,n.useState)([]),[c,u]=(0,n.useState)(pd.libraryId);(0,n.useEffect)((()=>{s(i.find((e=>e.id===pd.serverId))||i[0]||null)}),[i]),(0,n.useEffect)((()=>{l((null==a?void 0:a.libraries)||[])}),[a]);const d=(0,n.useCallback)((()=>{s(i.find((e=>e.id===t.current.value))||null)}),[i]),m=(0,n.useCallback)((()=>{u(r.current.value)}),[]),h=(0,n.useCallback)((()=>{a&&(pd.serverId!==a.id&&(pd.server=a.device,pd.connection=a.connection,pd.libraries=a.libraries,pd.libraryId===c&&(pd.libraryId="")),pd.libraryId=c)}),[a,c]);return n.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:h},n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-servers`},"Preferred Server:"),n.createElement("select",{id:`${e}-servers`,value:null==a?void 0:a.id,onChange:d,ref:t},i.map((({id:e,device:t,connection:r})=>n.createElement("option",{value:e,key:e},`${t.name}${r?"":" (offline)"}`))))),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-libraries`},"Preferred Library:"),n.createElement("select",{id:`${e}-libraries`,value:c,onChange:m,ref:r,key:null==a?void 0:a.id},o.map((({id:e,title:t})=>n.createElement("option",{value:e,key:e},t))))),n.createElement(fr,null))}function sy(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=pd.streamingQuality,i=(0,n.useCallback)((()=>{var e,r;pd.streamingQuality=null!==(r=null===(e=t.current["streaming-quality"])||void 0===e?void 0:e.value)&&void 0!==r?r:md.Lossless}),[]);return n.createElement("form",{className:"plex-tidal-streaming-settings",method:"dialog",onSubmit:i,ref:t},n.createElement("fieldset",null,n.createElement("legend",null,"Quality"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-lossless`,value:md.Lossless,defaultChecked:r===md.Lossless}),n.createElement("label",{htmlFor:`${e}-lossless`},"Lossless")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-high`,value:md.High,defaultChecked:r===md.High}),n.createElement("label",{htmlFor:`${e}-high`},"High")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-low`,value:md.Low,defaultChecked:r===md.Low}),n.createElement("label",{htmlFor:`${e}-low`},"Low"))),n.createElement(fr,null))}var oy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function ly(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=!!vi,i="https://developer.spotify.com/dashboard/create",a=(0,n.useCallback)((()=>oy(this,void 0,void 0,(function*(){oh.clientId=t.current.value}))),[]);return n.createElement("form",{className:"spotify-credentials",method:"dialog",onSubmit:a},n.createElement("fieldset",null,n.createElement("legend",null,"Your App"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),n.createElement("input",{type:"text",name:"spotify-client-id",id:`${e}-client-id`,defaultValue:oh.clientId,readOnly:r,ref:t}))),n.createElement("fieldset",null,n.createElement("legend",null,"Registration"),n.createElement("p",{className:"spotify-link service-link"},n.createElement(Jl,{href:i},n.createElement(rt,{name:"spotify"}),i))),n.createElement("fieldset",{className:"spotify-credentials-requirements note"},n.createElement("legend",null,"Requirements"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-callback`},"Redirect URI:"),n.createElement("input",{type:"text",id:`${e}-callback`,value:`${location.origin}/auth/spotify/callback/`,readOnly:!0})),n.createElement("p",null,"APIs used:"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api1`},"Web API")),n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api2`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api2`},"Web Playback SDK")))),n.createElement(fr,null))}var cy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function uy(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=!!gi,a="https://console.cloud.google.com/apis/credentials",s=(0,n.useCallback)((()=>cy(this,void 0,void 0,(function*(){cc.apiKey=t.current.value,cc.clientId=r.current.value}))),[]);return n.createElement("form",{className:"youtube-credentials",method:"dialog",onSubmit:s},n.createElement("fieldset",null,n.createElement("legend",null,"Your App"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-api-key`},"API Key:"),n.createElement("input",{type:"text",name:"youtube-api-key",id:`${e}-api-key`,defaultValue:cc.apiKey,readOnly:i,ref:t})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-client-id`},"Client ID:"),n.createElement("input",{type:"text",name:"youtube-client-id",id:`${e}-client-id`,defaultValue:cc.clientId,readOnly:i,ref:r}))),n.createElement("fieldset",null,n.createElement("legend",null,"Registration"),n.createElement("p",{className:"youtube-link service-link"},n.createElement(Jl,{href:a},n.createElement(rt,{name:"youtube"}),a))),n.createElement("fieldset",{className:"youtube-credentials-requirements note"},n.createElement("legend",null,"Requirements"),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-origin`},"Authorized JavaScript origin:"),n.createElement("input",{type:"text",id:`${e}-origin`,value:location.origin,readOnly:!0})),n.createElement("p",null,"Selected APIs:"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{type:"checkbox",id:`${e}-api1`,checked:!0,readOnly:!0}),n.createElement("label",{htmlFor:`${e}-api1`},"YouTube Data API v3")))),n.createElement(fr,null))}var dy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function my({service:e}){const t=e.authService||e,[r,i]=(0,n.useState)((()=>t.isConnected())),a=(0,n.useCallback)((()=>dy(this,void 0,void 0,(function*(){yield t.logout(),i(t.isConnected())}))),[t]);return n.createElement("p",null,n.createElement("button",{type:"button",className:"disconnect-button",onClick:a,disabled:!r},r?`Disconnect from ${t.name}…`:"Not connected"))}function hy({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=(0,n.useCallback)((()=>{const e=r.current.elements,t={};for(const r of e)t[r.value]=!r.checked;$m(t)}),[]);return n.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:i},n.createElement(my,{service:e}),n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Display"),n.createElement("ul",{className:"checkbox-list"},e.sources.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:Om(e)}),n.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),n.createElement(fr,null))}function fy({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=e.libraryId,a=function(e){const t=cp(e.observeIsLoggedIn,!1),[r,i]=(0,n.useState)((()=>e.audioLibraries||[]));return(0,n.useEffect)((()=>{if(t&&e.getLibraries){const t=Zr(e.getLibraries()).subscribe((t=>{e.libraries=t,i(e.audioLibraries||[])}));return()=>t.unsubscribe()}}),[e,t]),r}(e),s=(0,n.useCallback)((()=>{e.libraryId=r.current.value}),[e]);return n.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:s},n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-libraries`},"Preferred Library:"),n.createElement("select",{id:`${t}-libraries`,defaultValue:i,ref:r},a.map((({id:e,title:t})=>n.createElement("option",{value:e,key:e},t))))),n.createElement(fr,null))}var py=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function yy({service:e}){const t=(0,n.useMemo)((()=>e=>e.title),[]),[r,i]=(0,n.useState)((()=>Gi.getPinsForService(e.id))),[a,s]=(0,n.useState)([]),o=(0,n.useCallback)((()=>py(this,void 0,void 0,(function*(){const t=Gi.getPinsForService(e.id);yield Gi.unpin(t.filter((e=>-1===r.findIndex((t=>t.src===e.src)))))}))),[e,r]),l=(0,n.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),s([])}),[a]);return n.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:o},n.createElement("h3",null,"Pinned playlists:"),n.createElement(Fp,{title:"Pinned playlists",items:r,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:s}),n.createElement("p",{className:"pinned-settings-buttons"},n.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),n.createElement(fr,null))}const vy=new J("scrobbling"),by=new it(vy.getJson("noScrobble",{})),gy=new it(vy.getJson("options",{}));function wy(e,t){var r;const n=by.getValue()[e.id];return!(null!==(r=null==n?void 0:n[t.id])&&void 0!==r?r:t.defaultNoScrobble)}function Ey(e,t){const r=by.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});vy.setJson("noScrobble",a),by.next(a)}function ky(e){var t;return!!(null===(t=gy.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function xy(e,t){const r=gy.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});vy.setJson("options",a),gy.next(a)}const Sy={canScrobble:wy,setNoScrobble:Ey,canUpdateNowPlaying:ky,updateOptions:xy};function Ty({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useMemo)(qf,[]),s=(0,n.useCallback)((()=>{const t=r.current.elements,n={};for(const e of t)n[e.value]=!e.checked;Ey(e,n);const a=i.current.elements,s={};for(const e of a)s[e.value]=e.checked;xy(e,s)}),[e]);return n.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:s},n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Scrobble"),n.createElement("ul",null,a.map((r=>n.createElement("li",{key:r.id},n.createElement("input",{id:`${t}-${r.id}`,type:"checkbox",value:r.id,defaultChecked:wy(e,r),disabled:"youtube"===r.id}),n.createElement("label",{htmlFor:`${t}-${r.id}`},r.name)))))),n.createElement("fieldset",{ref:i},n.createElement("legend",null,"Options"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:ky(e)}),n.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),n.createElement(fr,null))}function Py({service:e}){const t=(0,n.useMemo)((()=>{const t=[{tab:"General",panel:n.createElement(hy,{service:e})}];return"spotify"!==e.id||vi||t.push({tab:"Credentials",panel:n.createElement(ly,null)}),"youtube"!==e.id||gi||t.push({tab:"Credentials",panel:n.createElement(uy,null)}),"libraryId"in e&&t.push({tab:"Library",panel:"plex"===e.id?n.createElement(ay,null):n.createElement(fy,{service:e})}),e.serviceType===Mn.DataService&&e.canScrobble&&t.push({tab:"Scrobbling",panel:n.createElement(Ty,{service:e})}),"plex-tidal"===e.id&&t.push({tab:"Streaming",panel:n.createElement(sy,null)}),e.createSourceFromPin&&t.push({tab:"Pinned",panel:n.createElement(yy,{service:e})}),"apple"===e.id&&t.push({tab:"Beta",panel:n.createElement(ry,null)}),t}),[e]);return n.createElement(lp,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}const Ay=new J("playlist"),Iy=new it(Ay.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Cy={observe:function(){return Iy},get:function(){return Iy.getValue()},set:function(e){Ay.setJson("settings",e),Iy.next(e)}},My=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=(0,n.useMemo)((()=>Cy.get()),[]),r=cp(Cy.observe,t),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useCallback)((()=>{Cy.set(t)}),[t]),c=(0,n.useCallback)((()=>{Cy.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:s.current.checked,showSourceIcons:o.current.checked})}),[]);return n.createElement("form",{className:"playlist-settings-general",method:"dialog"},n.createElement("fieldset",null,n.createElement("legend",null,"Content"),n.createElement("p",null,n.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:r.allowDuplicates,onChange:c,ref:i}),n.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),n.createElement("fieldset",null,n.createElement("legend",null,"Display"),n.createElement("p",null,n.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:r.showLineNumbers,onChange:c,ref:a}),n.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:r.zeroPadLineNumbers,disabled:!r.showLineNumbers,onChange:c,ref:s}),n.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:r.showSourceIcons,onChange:c,ref:o}),n.createElement("label",{htmlFor:`${e}-source-icons`},"Show media service icons"))),n.createElement(fr,{onCancel:l}))}),null)}];function Oy(){return n.createElement(lp,{className:"playlist-settings",items:My,label:"Playlist Settings"})}const $y=new J("visualizer/settings"),Ny={get ambientVideoEnabled(){return $y.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&($y.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&$y.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&$y.removeItem("lockedVisualizer")),zy.next(this))},get ambientVideoSource(){return $y.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&($y.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&$y.removeItem("lockedVisualizer"),zy.next(this))},get ambientVideoBeats(){return $y.getBoolean("ambientVideoBeats",!0)},set ambientVideoBeats(e){e!==this.ambientVideoBeats&&($y.setBoolean("ambientVideoBeats",e),zy.next(this))},get useAmbientVideoSource(){return $y.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&($y.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&$y.removeItem("lockedVisualizer"),zy.next(this))},get coverArtAnimatedBackground(){return $y.getBoolean("coverArtAnimatedBackground")},set coverArtAnimatedBackground(e){e!==this.coverArtAnimatedBackground&&($y.setBoolean("coverArtAnimatedBackground",e),zy.next(this))},get coverArtBeats(){return $y.getBoolean("coverArtBeats",!0)},set coverArtBeats(e){e!==this.coverArtBeats&&($y.setBoolean("coverArtBeats",e),zy.next(this))},get fullscreenProgress(){return $y.getBoolean("fullscreenProgress")},set fullscreenProgress(e){e!==this.fullscreenProgress&&($y.setBoolean("fullscreenProgress",e),zy.next(this))},get lockedVisualizer(){return $y.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:r}=e;$y.setJson("lockedVisualizer",{providerId:t,name:r})}else $y.removeItem("lockedVisualizer");zy.next(this)},get provider(){return $y.getString("provider")},set provider(e){var t;e!==this.provider&&($y.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&$y.removeItem("lockedVisualizer"),zy.next(this))}},zy=new it(Ny),jy=Ny;function Ly(){return zy}function Dy(){return Ly().pipe(Be((e=>e.fullscreenProgress)),_n())}var Ry;Ry=new WeakMap;const Fy=class{constructor(){Ry.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Ry,"f")}set autoplay(e){!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Ry,e,"f")}observeCurrentTime(){return rn}observeDuration(){return rn}observeEnded(){return rn}observeError(){return rn}observePlaying(){return rn}seek(){}};var _y,By,Vy=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Uy=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};_y=new WeakMap,By=new WeakMap;const Hy=class{constructor(e,t){this.type=e,this.name=t,this.logger=new H(`HTML5Player/${this.type}/${this.name}`),this.element$=new it(document.createElement(this.type)),this.error$=new Ne,this.playing$=new Ne,this.item=null,this.stopped=!0,this.autoplay=!1,_y.set(this,!0),By.set(this,1);const r=this.element;r.hidden=!0,r.muted="video"===e,r.volume=1,r.autoplay=!1,r.className=`html5-${e} html5-${e}-${t}`,r.id=`ampcast-${e}-${t}`,r.crossOrigin="anonymous",this.element$.pipe(an((e=>Hr(e,"error").pipe(Be((()=>e.error)),_e((e=>null!==e&&!("fatal"in e))))))).subscribe(this.error$),this.element$.pipe(an((e=>Hr(e,"playing"))),Be((()=>{}))).subscribe(this.playing$),this.error$.subscribe((e=>{this.stopped?this.logger.warn({err:e}):this.logger.error(e)}))}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return Vy(this,_y,"f")}set muted(e){Uy(this,_y,e,"f"),"video"===this.type&&(this.element.muted=e)}get volume(){return Vy(this,By,"f")}set volume(e){Uy(this,By,e,"f"),"video"===this.type&&(this.element.volume=e)}observeCurrentTime(){return this.element$.pipe(an((e=>Hr(e,"timeupdate").pipe(tn(e),Be((()=>e.currentTime)),Be((e=>isFinite(e)?e:0))))))}observeDuration(){return this.element$.pipe(an((e=>Hr(e,"durationchange").pipe(tn(e),Be((()=>e.duration)),_e((e=>isFinite(e)))))))}observeEnded(){return this.element$.pipe(an((e=>Hr(e,"ended"))),Be((()=>{})))}observeError(){return this.error$.pipe(_e((()=>!this.stopped)))}observePlaying(){return this.playing$.pipe(_e((()=>!this.stopped)))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.item=e,this.autoplay&&this.safePlay(e)}play(){this.logger.log("play"),this.safePlay(this.item)}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.stopped=!0,this.element.pause(),this.element.currentTime=0,this.element.removeAttribute("src")}seek(e){this.element.currentTime=e}resize(e,t){"video"===this.type&&(this.element.style.width=`${e}px`,this.element.style.height=`${t}px`)}get element(){return this.element$.getValue()}getMediaSrc(e){var t,r;if(e){const n=Jf(e);return null!==(r=null===(t=null==n?void 0:n.getPlayableUrl)||void 0===t?void 0:t.call(n,e))&&void 0!==r?r:e.src}throw Error("No playable item")}safePlay(e){return t=this,r=void 0,i=function*(){this.stopped=!1;try{if(!e)throw Error("Player not loaded");const t=this.getMediaSrc(e);this.element.getAttribute("src")!==t&&this.element.setAttribute("src",t),yield this.element.play()}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}};var Yy,qy,Ky=r(1062),Wy=r.n(Ky),Gy=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Jy=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const Qy=(e,t)=>e.width===t.width&&e.height===t.height,Xy=16/9,Zy={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,origin:location.origin,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var ev;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(ev||(ev={})),Yy=new WeakMap,qy=new WeakMap;const tv=class{constructor(e){this.player=null,this.src$=new it(""),this.size$=new it({width:0,height:0}),this.error$=new Ne,this.ready$=new Ne,this.state$=new Ne,this.videoId$=new it(""),this.playerLoading=!1,Yy.set(this,!0),qy.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div"),i=this.logger=new H(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",r.className="youtube-video-wrapper",n.id=this.targetId,r.append(n),t.append(r),this.observeReady().pipe(et((()=>this.observeSrc())),On((e=>!e)),at((e=>{const t=this.player,[,r,n,i="0"]=e.split(":"),a=Number(i)||0;if(n){if("playlist"===r){const e={list:n,listType:r,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(n,a):t.cueVideoById(n,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(et((()=>this.observeVideoSize())),at((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(_e((e=>e===ev.ENDED&&this.loop)),at((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(_e((e=>e===ev.PLAYING)),at((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(Be((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),at((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return Gy(this,Yy,"f")}set muted(e){Gy(this,Yy,"f")!==e&&(Jy(this,Yy,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return Gy(this,qy,"f")}set volume(e){Gy(this,qy,"f")!==e&&(Jy(this,qy,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(an((e=>{var t;return e===ev.PLAYING?Lr(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(Be((()=>this.player.getCurrentTime())),sn(this.observeState())):hn((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(Be((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),_e((e=>0!==e)),_n())}observeEnded(){return this.observeState().pipe(_e((e=>e===ev.ENDED&&!this.loop)),Be((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(_e((e=>e===ev.PLAYING)),Be((()=>{})))}observeVideoId(){return this.videoId$.pipe(_n())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load({src:e}){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.playerLoading||this.error$.next(Error("YouTube player not loaded"))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(an((e=>e?this.getAspectRatio(e):hn(Xy))),_n())}observeReady(){return this.ready$.pipe(ji(1))}observeSize(){return this.size$.pipe(_n(Qy),_e((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(_n())}observeState(){return this.state$}observeVideoSize(){return Rn([this.observeSize(),this.observeAspectRatio()]).pipe(Be((([{width:e,height:t},r])=>{const n=Math.max(Math.round(e/r),t);return{width:Math.max(Math.round(n*r),e),height:n}})),_n(Qy))}createPlayer(){if(!this.player&&this.element.isConnected){this.playerLoading=!0;const e=Wy()(this.targetId,{playerVars:Zy,host:"https://www.youtube-nocookie.com"});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.playerLoading=!1,this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return Zr(Fc(e)).pipe(sn(Lr(3e3)),sn(this.observeVideoId().pipe(Kh(1))),Be((({aspectRatio:e})=>e||Xy)),Un((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),hn(Xy)))))}getPlayerState(){return this.player?this.player.getPlayerState():ev.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return sc()(e)||""}};var rv,nv,iv,av,sv,ov,lv,cv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},uv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};rv=new WeakMap,nv=new WeakMap,iv=new WeakMap,av=new WeakMap,sv=new WeakMap,ov=new WeakMap,lv=new WeakMap;const dv=class{constructor(e,t,r,n){this.selectPlayer=t,this.loadPlayer=r,this.audio=n,this.element=document.createElement("div"),this.players=[],this.player$=new it(null),this.error$=new Ne,this.stopped=!0,rv.set(this,null),nv.set(this,!1),iv.set(this,!1),av.set(this,!1),sv.set(this,1),ov.set(this,0),lv.set(this,0),this.element.className=e}get autoplay(){return cv(this,nv,"f")}set autoplay(e){uv(this,nv,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return cv(this,iv,"f")}set loop(e){uv(this,iv,e,"f"),this.players.forEach((t=>t.loop=e))}get muted(){return cv(this,av,"f")}set muted(e){uv(this,av,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e),this.audio&&(this.audio.volume=e?0:this.volume)}get volume(){return cv(this,sv,"f")}set volume(e){uv(this,sv,e,"f"),this.players.forEach((t=>t.volume=e)),this.audio&&(this.audio.volume=this.muted?0:e)}observeCurrentTime(){return this.observeCurrentPlayer().pipe(an((e=>e?e.observeCurrentTime():hn(0))),_n())}observeDuration(){return this.observeCurrentPlayer().pipe(an((e=>e?e.observeDuration():rn)),_n())}observeEnded(){return this.observeCurrentPlayer().pipe(an((e=>e?e.observeEnded():rn)))}observeError(){return this.observeCurrentPlayer().pipe(an((e=>e?nn(this.error$,e.observeError()):rn)),_e((()=>!this.stopped)))}observePlaying(){return this.observeCurrentPlayer().pipe(an((e=>e?e.observePlaying():rn)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,r=this.selectPlayer(e);if(this.player$.next(null),t&&t!==r&&(t.autoplay=!1,t.muted=!0,t.hidden=!0,t.stop()),this.autoplay&&(this.stopped=!1),this.loadError=null,!r||this.players.includes(r))if(this.player$.next(r),r)try{r.autoplay=this.autoplay,this.loadPlayer(r,e),r.muted=this.muted,r.hidden=this.hidden}catch(e){this.loadError=Error((null==e?void 0:e.message)||"Failed to load")}else this.loadError=Error("No player found");else this.loadError=Error("Player not registered")}play(){var e;this.stopped=!1,this.autoplay=!0,this.loadError?this.error$.next(this.loadError):null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.stopped=!0,this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){uv(this,ov,e,"f"),uv(this,lv,t,"f"),e*t>0&&this.players.forEach((r=>r.resize(e,t)))}registerPlayers(e){e.filter((e=>!this.players.includes(e))).forEach((e=>{e.muted=!0,e.hidden=!0,e.autoplay=this.autoplay,e.loop=this.loop,e.volume=this.volume,cv(this,ov,"f")*cv(this,lv,"f")>0&&e.resize(cv(this,ov,"f"),cv(this,lv,"f")),e.appendTo(this.element),this.players.push(e)}))}unregisterPlayers(e){const t=e.filter((e=>this.players.includes(e))),[r,n]=m(this.players,(e=>t.includes(e)));r.forEach((e=>e.stop())),this.players.length=0,this.players.push(...n)}get currentPlayer(){return this.player$.getValue()}get loadError(){return cv(this,rv,"f")}set loadError(e){uv(this,rv,e,"f"),e&&this.error$.next(e)}observeCurrentPlayer(){return this.player$.pipe(_n())}};class mv extends Fy{constructor({context:e,source:t},r){super(),this.name=r,this.logger=new H(`WaveformPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className=`visualizer visualizer-waveform visualizer-waveform-${r}`}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}var hv;hv=new WeakMap;const fv=class extends mv{constructor(e){super(e,"beats"),hv.set(this,""),this.visualizer={providerId:"waveform",name:"beats",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i);n.getByteFrequencyData(a),e.clearRect(0,0,t,r),e.fillStyle=this.color,e.strokeStyle="rgba(0, 0, 0, .9)",e.lineWidth=document.fullscreenElement?2:1;const s=(t-48)/12,o=.0075*r,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const n=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*n,e.fillRect(u,r-c/2,s,c/2+4),e.strokeRect(u,r-c/2,s,c/2+4),u+=s+4}}}}}get color(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,hv,"f")||`rgba(255, 255, 255, ${document.fullscreenElement?.4:.6})`}set color(e){!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,hv,e,"f")}load(){super.load(this.visualizer)}resize(e){const t=Math.min(Math.max(e/3,9*Kt.fontSize),360);super.resize(t,.225*t)}},pv=new H("AmbientVideoPlayer");class yv extends Fy{constructor(e){super(),this.storage=new J("ambientVideoPlayer"),this.beatsPlayer=new fv(e),this.videoPlayer=this.createVideoPlayer(this.beatsPlayer),Ly().pipe(Be((e=>e.ambientVideoBeats)),_n(),at((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(pv),Ly().pipe(Be((e=>e.ambientVideoSource)),_n(),Kh(1),at((()=>this.storage.removeItem("user-progress")))).subscribe(pv)}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!jy.ambientVideoBeats}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.beatsPlayer.load()}play(){pv.log("play"),this.videoPlayer.play(),jy.ambientVideoBeats&&this.beatsPlayer.play()}pause(){pv.log("pause"),this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){pv.log("stop"),this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t),this.beatsPlayer.resize(e)}createVideoPlayer(e){const t=new Hy("video","ambient"),r=this.createYouTubePlayer(),n=new dv("ambient-video-player",(e=>e?e.src.startsWith("youtube:")?r:t:null),((e,t)=>{const r=t.src;if(r.startsWith("youtube:")){const[,,t]=r.split(":"),n=this.getProgressKey(),i=this.storage.getJson(n,{})[t]||("progress"===n?120:0);e.load({src:`${r}:${i}`})}else e.load({src:r})}));return n.loop=!0,n.volume=0,n.hidden=!0,n.registerPlayers([t,r,e]),n.unregisterPlayers([e]),n}createYouTubePlayer(){const e=new tv("ambient");return e.observeVideoId().pipe(an((t=>t?e.observeCurrentTime().pipe(Be(Math.round),_n(),_e((e=>e>0&&e%20==0)),qh(e.observeDuration()),_e((([,e])=>e>120)),at((([e])=>{const r=this.getProgressKey(),n=this.storage.getJson(r,{});n[t]=e,this.storage.setJson(r,n)}))):rn))).subscribe(pv),e}getProgressKey(){return jy.useAmbientVideoSource&&jy.ambientVideoSource?"user-progress":"progress"}}function vv(e,t){return void 0===t&&(t=Nr),De((function(r,n){var i=null,a=null,s=null,o=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,n.next(e)}};function l(){var r=s+e,a=t.now();if(a<r)return i=this.schedule(void 0,r-a),void n.add(i);o()}r.subscribe(Re(n,(function(r){a=r,s=t.now(),i||(i=t.schedule(l,e),n.add(i))}),(function(){o(),n.complete()}),void 0,(function(){a=i=null})))}))}var bv=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};let gv=0;class wv extends tv{constructor(e){super("loader-"+gv++),this.load({src:e})}loadPlaylist(){return bv(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return rn}loadDuration(){return bv(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const r=this.observeCued(),n=nn(this.observeError(),Lr(3e3).pipe(Be((()=>Error("timeout")))));r.pipe(sn(n),ji(1)).subscribe({next:e}),n.pipe(sn(r),ji(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(_e((e=>e===ev.CUED)),Be((()=>{})),ji(1))}}const Ev="\n9HI3UVKoesg rOSUaprXqiY etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw SDxtzBm5vD4\nA1m0SEqmmbE 9uZ8CCa0t4Y 35CTu7dWzo8 wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY QxE5VqaQ6oE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nQxS6PpMArMU IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\ntOWGsyt40t8 QLbPYQcUcgM xwf7EssFnXU -Pail6FITXc vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c VWHTlq5Fcr8 ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE OiRqM-4c14Y\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k fVRSSNkq3Bk\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\n9IENFNxy5i8 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 hg2FDCmqNkg tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM 3F4l-6GwkKM F399teRPBaY 2jw2eAIW8sU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk JFMT1tU17TM FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs fmsTHHtxAug l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc eXcbc2gmDsA rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E TX9U62sj5nM\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 KPV1hFJIXrg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bWG0rEB6gmc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\nvuLm2t58qIQ FDqQlAUDZyk R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU fd8spJiYS0k 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI MntPfBulD2o _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow 2FE1_YK5OPI pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE RKWLu6UHryQ\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI wjMf_bEfqIc hNC6-bxHJac\nJBm1ainuk-c PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg 8quqk2FPRgQ p7G1lkYIFTM RzE9pczkYU4 7TML_MTQdg4\nFGCIBbg0IYk oaQ8UXlKDiw 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\nD4mdWvVONyg eQIzdzSTH08 tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 sYYMBV68hmE 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY dY-bDp_3krs 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 OdsIYD9F6Og _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y fWnlQnposC4 pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY xR7RK3QGmfY\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo 5bwHtF7fR94 IXSTdSv-Jlo mf5E3FDZ6rY 7JsOhtl_zG4 vr5dCRHAgb0 Di9jRVy7WHk cVdfUy_VMTY\nLD_jcIQGl0Q ZXas8NdyLsE JptSD1Jdhyw --qCu9yL5H8 74wsGjTZzGg Wey4zHA4nPg VArhsYKbKzk t76IJmQKzKA\nl1RxmWxXQcM 7HagxwgIRcY gJgwJwg6Deg 1mD8V2trqcw i5ZbYQ1Nok4 YE3iWysmcBQ vdycBdIx-do UE-J2Dt8LNs\nx_dVi_PC_sc z3oaQlq9weg gvusDEF3eh4 0wb-OBF3LOo tKC1zBZf8NM Moz3NHnVXog s7v0c2nKKGE cV9kT-xcQZw\napwA8UQ_xeE 6BcYV3gqcFA TaWhAJGUK-w oHrnBcYW6U0 iXI8oo8KpMA 4Qdd8khODKc KVKtVyhCMQ8 6h3zxMYjAwI\njMaWecFnC_8 XS3p0GDnLF4 CCc2EYQchpE Oj0l4QlC-JE pENN3OPwydk 6q81M5Xd5X8 IqS4kWK6aV0 8OUQ7eCqt50\ngdAbs95GIm4 j800SVeiS5I bZIuALduxQU UyFoYkj8dAc q5hHF9Ofu3g UrKl1h8wWpg SNpXK6omAdQ 9D53rJslwak\n91q_XSSDCDE ufUfa_wS6cc O87EBwZaC_U J_Qs64FctiA yP64H8aLEE8 Ml_PEaEBKi0 SolQqtVQ7vA al7T6Y6CoUo\nnmm0zfspmos wUtgReo4pDM 7HDlompCs58 ZsMlXu09ghs iO_Me1wspYM jHyItjAKRdY F18YfQD3s28 RgzTvK84LHo\nDOVsgCZoFLI kBbaAJMJC_k iyhP3voUf_s Ek7MAukn5P0 RpKLilRfFNE 7eN7zRJdfkM kk7tTjPOzt4 ryuJGfYs5VE\nt4NKrOr9lAY IL3990sA0ZE fVoMdt5MZKg eKWntyoSuzc kN3VMkM79c0 B6WFz8Zb9Oo avSd8c-m3Wc M3u4Mus9y_g\nPd4H-TFjSkQ jMWKm-g5V3w ZR9YaU4EYjk nVcxbSw6o5k crgLdtAGgIQ D223br7vnpk HRIczsM6bIc\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));const kv=new H("ambientvideo/visualizers");kv.log(`default (total=${Ev.length})`);const xv=new it([]);Ly().pipe(vv(1),Be((e=>!!e.ambientVideoEnabled)),_n(),an((e=>e?Ly().pipe(Be((e=>!!e.useAmbientVideoSource)),_n(),an((e=>e?Ly().pipe(Be((e=>e.ambientVideoSource||"")),_n(),an((e=>e?function(e){return t=this,r=void 0,i=function*(){const t=Dc(e),[,r,n]=t.split(":");let i=[n];return"playlist"===r&&(i=yield function(e){return bv(this,void 0,void 0,(function*(){const t=new wv(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e):hn([])))):hn(Ev)))):hn([]))),Un((e=>(kv.error(e),hn([]))))).subscribe(xv);const Sv={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,get visualizers(){return xv.getValue()},observeVisualizers:function(){return xv},createPlayer(e){return this.player||(this.player=new yv(e)),this.player}},Tv=Sv;var Pv,Av,Iv=r(9653),Cv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Mv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};Pv=new WeakMap,Av=new WeakMap;const Ov=class extends Fy{constructor({context:e,source:t},r){super(),this.name=r,this.logger=new H(`AmpShaderPlayer/${this.name}`),this.canvas=document.createElement("canvas"),this.animationFrameId=0,this.fragFrameColor=null,this.fragBackgroundColor=null,this.fragColor=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.startTime=performance.now(),this.currentVisualizer="",Pv.set(this,""),Av.set(this,""),this.source=t,this.analyser=e.createAnalyser(),this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader",this.outputGl=this.canvas.getContext("2d"),window.OffscreenCanvas?this.offscreenCanvas=new OffscreenCanvas(200,200):this.offscreenCanvas=document.createElement("canvas");const n=this.gl=this.offscreenCanvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1}),i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.R8,512,2,0,n.RED,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);const a=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,a);const s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(this.logger.log("disconnect"),this.cancelAnimation(),this.source.disconnect(this.analyser)):(this.logger.log("connect"),this.source.connect(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){this.logger.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.createShader(`#version 300 es\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n#ifdef GL_ES\r\nprecision highp float;\r\nprecision highp int;\r\nprecision mediump sampler3D;\r\n#endif\r\nuniform vec3 iFrameColor;\r\nuniform vec3 iBackgroundColor;\r\nuniform vec3 iColor;\r\nuniform float iTime;\r\nuniform float iChannelTime[4];\r\nuniform vec4 iDate;\r\nuniform vec2 iResolution;\r\nuniform sampler2D iChannel0;\r\nuniform sampler2D iChannel1;\r\nuniform sampler2D iChannel2;\r\nuniform sampler2D iChannel3;\r\nuniform float iSampleRate;\r\nuniform float iTimeDelta;\r\nuniform float iChannelResolution[4];\r\nvec3 iMouse = vec3(0., 0., 0.);\r\n#define iFrame (floor(iTime / 60))\r\n\n${e.shader}\nout vec4 as_FragColor;\r\nvoid main() {\r\n    vec4 color = vec4(1e20);\r\n    mainImage(color, gl_FragCoord.xy);\r\n    as_FragColor = color;\r\n}\r\n`)),this.autoplay&&!this.animationFrameId&&this.render()}play(){this.logger.log("play"),this.animationFrameId||this.render()}pause(){this.logger.log("pause"),this.cancelAnimation()}stop(){this.logger.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){const r=this.gl;if(e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,r.viewport(0,0,e,t),this.program){const n=r.getUniformLocation(this.program,"iResolution");r.uniform2f(n,e,t),this.renderFrame()}}get backgroundColor(){return Cv(this,Pv,"f")||Kt.backgroundColor}set backgroundColor(e){Mv(this,Pv,e,"f")}get color(){return Cv(this,Av,"f")||Kt.textColor}set color(e){Mv(this,Av,e,"f")}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get frameColor(){return Kt.frameColor}clear(){const{width:e,height:t}=this.canvas;this.outputGl.clearRect(0,0,e,t)}createShader(e){const t=this.gl;this.program&&(t.detachShader(this.program,this.vertexShader),t.detachShader(this.program,this.fragmentShader),t.deleteProgram(this.program),this.program=null,this.vertexShader=null,this.fragmentShader=null);const r=this.vertexShader=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,"#version 300 es\nin vec4 as_Position;void main(void){gl_Position=as_Position;}"),t.compileShader(r);const n=this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e),t.compileShader(n);const i=t.createProgram();if(t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw Error(`Link failed: ${t.getProgramInfoLog(i)}`);t.useProgram(i);const a=t.getAttribLocation(i,"as_Position");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.startTime=performance.now(),this.fragFrameColor=t.getUniformLocation(i,"iFrameColor"),this.fragBackgroundColor=t.getUniformLocation(i,"iBackgroundColor"),this.fragColor=t.getUniformLocation(i,"iColor"),this.fragTime=t.getUniformLocation(i,"iTime"),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),this.fragDate=t.getUniformLocation(i,"iDate");const s=t.getUniformLocation(i,"iResolution");t.uniform2f(s,this.canvas.width,this.canvas.height),this.program=i}render(){this.renderFrame(),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.program){const e=this.gl,t=this.analyser.frequencyBinCount,r=new Uint8Array(t),n=new Uint8Array(t);this.analyser.getByteFrequencyData(r),this.analyser.getByteTimeDomainData(n);const i=this.currentTime;e.uniform1f(this.fragTime,i),e.uniform1fv(this.fragChannelTime,new Float32Array([i,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform3f(this.fragFrameColor,...this.toRgb(this.frameColor)),e.uniform3f(this.fragBackgroundColor,...this.toRgb(this.backgroundColor)),e.uniform3f(this.fragColor,...this.toRgb(this.color)),e.texSubImage2D(e.TEXTURE_2D,0,0,0,512,1,e.RED,e.UNSIGNED_BYTE,r),e.texSubImage2D(e.TEXTURE_2D,0,0,1,512,1,e.RED,e.UNSIGNED_BYTE,n),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.outputGl.drawImage(this.offscreenCanvas,0,0)}}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}toRgb(e){const[t,r,n]=new Iv.Z(e).srgb;return[t,r,n]}};const $v=new it([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield r.e(595).then(r.bind(r,9967));e&&$v.next(e)},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const Nv={id:"ampshader",name:"ampshader",get visualizers(){return $v.getValue()},observeVisualizers:function(){return $v},createPlayer(e){return this.player||(this.player=new Ov(e,"main")),this.player}},zv=Nv;var jv=r(6708);const Lv=new H("AudioMotionPlayer");class Dv extends Fy{constructor({context:e,source:t}){super(),this.element=document.createElement("div"),this.currentVisualizer="",this.source=t,this.element.className="visualizer visualizer-audiomotion",this.element.hidden=!0,this.visualizer=new jv.Z(this.element,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1}),Kt.observe().pipe(at((()=>this.registerGradients()))).subscribe(Lv)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?(Lv.log("disconnect"),this.visualizer.disconnectInput()):(Lv.log("connect"),this.visualizer.connectInput(this.source)))}appendTo(e){e.append(this.element)}load(e){Lv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.visualizer.setOptions(e.options)),this.autoplay&&this.visualizer.toggleAnalyzer(!0)}play(){Lv.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Lv.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){Lv.log("stop"),this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new xt(Kt.isMediaButtonLight?Kt.mediaButtonColor:Kt.defaultMediaButtonColor),t=[new xt(Kt.mediaButtonColor),new xt(Kt.defaultMediaButtonColor),new xt(Kt.frameColor),new xt(Kt.frameTextColor),new xt(Kt.backgroundColor),new xt(Kt.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,r=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:Kt.black,colorStops:[r[0],{pos:.6,color:r[1]},r[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:Kt.black,colorStops:Kt.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:Kt.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}const Rv="audiomotion",Fv=[{providerId:Rv,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:Rv,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:Rv,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:Rv,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:Rv,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}],_v={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",visualizers:Fv,observeVisualizers:()=>hn(Fv),createPlayer(e){return this.player||(this.player=new Dv(e)),this.player}},Bv=_v;var Vv=r(2238),Uv=r.n(Vv);const Hv=new H("ButterchurnPlayer");class Yv extends Fy{constructor({context:e,source:t}){super(),this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.error$=new Ne,this.animationFrameId=0,this.currentVisualizer="",this.source=t,this.canvas.className="visualizer visualizer-butterchurn",this.canvas.hidden=!0,this.visualizer=Uv().createVisualizer(e,this.canvas,{width:400,height:200})}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?(Hv.log("disconnect"),this.visualizer.disconnectAudio(this.source)):(Hv.log("connect"),this.visualizer.connectAudio(this.source),this.animationFrameId||this.render()))}observeError(){return this.error$}appendTo(e){e.append(this.canvas)}load(e){Hv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.visualizer.loadPreset(e.data,.5)),this.autoplay&&!this.animationFrameId&&this.render()}play(){Hv.log("play"),this.animationFrameId||this.render()}pause(){Hv.log("pause"),this.cancelAnimation()}stop(){Hv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){e=Math.ceil(e),t=Math.ceil(t),this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const{width:e,height:t}=this.canvas;this.context2D.clearRect(0,0,e,t)}render(){if(this.animationFrameId)this.visualizer.render();else try{this.visualizer.render()}catch(e){Hv.error(e),this.error$.next(e)}this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}const qv=new it([]);function Kv(){return qv.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield r.e(577).then(r.t.bind(r,6607,23));if(t){qv.next(Object.keys(t).map((r=>({providerId:e,name:r,data:t[r]}))));const{default:n}=yield r.e(271).then(r.t.bind(r,3710,23));n&&qv.next(Kv().concat(Object.keys(n).map((t=>({providerId:e,name:t,data:n[t]})))))}},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const Wv={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",get visualizers(){return Kv()},observeVisualizers:function(){return qv},createPlayer(e){return this.player||(this.player=new Yv(e)),this.player}},Gv=Wv;class Jv extends Ov{constructor(e){super(e,"animated-background"),this.visualizer={providerId:"ampshader",name:"Foamy water by k_mouse",shader:"// https://www.shadertoy.com/view/llcXW7\r\n// Made by k-mouse (2016-11-23)\r\n// Modified from David Hoskins (2013-07-07) and joltz0r (2013-07-04)\r\n\r\n#define TAU 6.28318530718\r\n\r\n#define TILING_FACTOR 1.0\r\n#define MAX_ITER 24\r\n\r\nfloat waterHighlight(vec2 p, float time, float foaminess)\r\n{\r\n    vec2 i = vec2(p);\r\n\tfloat c = 0.0;\r\n    float foaminess_factor = mix(1.0, 6.0, foaminess);\r\n\tfloat inten = .005 * foaminess_factor;\r\n\r\n\tfor (int n = 0; n < MAX_ITER; n++)\r\n\t{\r\n\t\tfloat t = time * (1.0 - (3.5 / float(n+1)));\r\n\t\ti = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\r\n\t\tc += 1.0/length(vec2(p.x / (sin(i.x+t)),p.y / (cos(i.y+t))));\r\n\t}\r\n\tc = 0.2 + c / (inten * float(MAX_ITER));\r\n\tc = 1.17-pow(c, 1.4);\r\n    c = pow(abs(c), 8.0);\r\n\treturn c / sqrt(foaminess_factor);\r\n}\r\n\r\nfloat sampleMusic() {\r\n\treturn clamp(0.5 * (\r\n        texture( iChannel0, vec2( 0.15, 0.25 ) ).x +\r\n        texture( iChannel0, vec2( 0.30, 0.25 ) ).x\r\n    ), 0.15, 1.0);\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\r\n\tfloat time = iTime * 0.1+23.0;\r\n\tvec2 uv = fragCoord.xy / iResolution.xy;\r\n\tvec2 uv_square = vec2(uv.x * iResolution.x / iResolution.y, uv.y);\r\n    float dist_center = pow(1.2*length(uv - 0.5), 2.0);\r\n\r\n    float foaminess = smoothstep(0.4, 1.4, dist_center);\r\n    float clearness = 0.1 + 0.9*smoothstep(0.1, 0.5, dist_center);\r\n\r\n\tvec2 p = mod(uv_square*TAU*TILING_FACTOR, TAU)-250.0;\r\n\r\n    float c = waterHighlight(p, time, foaminess);\r\n\tvec3 color = vec3(c * sampleMusic());\r\n\r\n    color = clamp(iBackgroundColor - color, 0.0, 1.0);\r\n    color = mix(iBackgroundColor, color, -clearness);\r\n\r\n\tfragColor = vec4(color, 1.0);\r\n}\r\n",externalUrl:"https://www.shadertoy.com/view/llcXW7"}}load(){super.load(this.visualizer)}}var Qv;const Xv=new H("CovertArtPlayer");Qv=new WeakMap;const Zv=class extends Fy{constructor(e){super(),this.element=null,Qv.set(this,!0),this.animatedBackground=new Jv(e),this.beatsPlayer=new fv(e),Ly().pipe(Be((e=>e.coverArtAnimatedBackground)),_n(),at((e=>{this.animatedBackground.hidden=this.hidden||!e}))).subscribe(Xv),Ly().pipe(Be((e=>e.coverArtBeats)),_n(),at((e=>{this.beatsPlayer.hidden=this.hidden||!e}))).subscribe(Xv)}get autoplay(){return this.beatsPlayer.autoplay}set autoplay(e){this.animatedBackground.autoplay=e,this.beatsPlayer.autoplay=e}get backgroundColor(){return this.animatedBackground.backgroundColor}set backgroundColor(e){this.animatedBackground.backgroundColor=e}get beatsColor(){return this.beatsPlayer.color}set beatsColor(e){this.beatsPlayer.color=e}get hidden(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Qv,"f")}set hidden(e){(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)})(this,Qv,e,"f"),this.animatedBackground.hidden=e||!jy.coverArtAnimatedBackground,this.beatsPlayer.hidden=e||!jy.coverArtBeats,this.element&&(this.element.hidden=e)}appendTo(e){const t=e.querySelector(".beats-player");t&&(e.hidden=this.hidden,this.element=e,this.beatsPlayer.appendTo(t),this.animatedBackground.appendTo(e.querySelector(".animated-background")))}load(){this.animatedBackground.load(),this.beatsPlayer.load()}play(){Xv.log("play"),jy.coverArtAnimatedBackground&&this.animatedBackground.play(),jy.coverArtBeats&&this.beatsPlayer.play()}pause(){Xv.log("pause"),this.animatedBackground.pause(),this.beatsPlayer.pause()}stop(){Xv.log("stop"),this.animatedBackground.stop(),this.beatsPlayer.stop()}resize(e,t){this.animatedBackground.resize(e,t),this.beatsPlayer.resize(e)}},eb=[{providerId:"coverart",name:""}],tb={id:"coverart",name:"Cover Art",visualizers:eb,observeVisualizers:()=>hn(eb),createPlayer(e){return this.player||(this.player=new Zv(e)),this.player}},rb=tb;function nb(e,t,r,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*r+(1+3*e+3*a-3*s)*n+s*i)/6}function ib(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,o=n<t-1?e[n+2]:2*a-i;return nb((r-n/t)*t,s,i,a,o)}}function ab(e,t){let r;if(void 0===t)for(const t of e)null!=t&&(r>t||void 0===r&&t>=t)&&(r=t);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(r>i||void 0===r&&i>=i)&&(r=i)}return r}const sb=Math.sqrt(50),ob=Math.sqrt(10),lb=Math.sqrt(2);function cb(e,t,r){const n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),a=n/Math.pow(10,i),s=a>=sb?10:a>=ob?5:a>=lb?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=r&&r<2?cb(e,t,2*r):[o,l,c]}function ub(e,t,r){if(!((r=+r)>0))return[];if((e=+e)==(t=+t))return[e];const n=t<e,[i,a,s]=n?cb(t,e,r):cb(e,t,r);if(!(a>=i))return[];const o=a-i+1,l=new Array(o);if(n)if(s<0)for(let e=0;e<o;++e)l[e]=(a-e)/-s;else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=(i+e)/-s;else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}var db,mb=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hb(e){if(!(t=mb.exec(e)))throw new Error("invalid format: "+e);var t;return new fb({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function fb(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function pb(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function yb(e,t){var r=pb(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}hb.prototype=fb.prototype,fb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const vb={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>yb(100*e,t),r:yb,s:function(e,t){var r=pb(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(db=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+pb(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function bb(e){return e}var gb,wb,Eb=Array.prototype.map,kb=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function xb(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Sb(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Tb(e){let t,r,n;function i(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=xb,r=(t,r)=>xb(e(t),r),n=(t,r)=>e(t)-r):(t=e===xb||e===Sb?e:Pb,r=e,n=e),{left:i,center:function(e,t,r=0,a=e.length){const s=i(e,t,r,a-1);return s>r&&n(e[s-1],t)>-n(e[s],t)?s-1:s},right:function(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<=0?i=t+1:a=t}while(i<a)}return i}}}function Pb(){return 0}gb=function(e){var t,r,n=void 0===e.grouping||void 0===e.thousands?bb:(t=Eb.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>n&&(o=Math.max(1,n-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>n));)o=t[s=(s+1)%t.length];return a.reverse().join(r)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?bb:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Eb.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=hb(e)).fill,r=e.align,d=e.sign,m=e.symbol,h=e.zero,f=e.width,p=e.comma,y=e.precision,v=e.trim,b=e.type;"n"===b?(p=!0,b="g"):vb[b]||(void 0===y&&(y=12),v=!0,b="g"),(h||"0"===t&&"="===r)&&(h=!0,t="0",r="=");var g="$"===m?i:"#"===m&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===m?a:/[%p]/.test(b)?l:"",E=vb[b],k=/[defgprs%]/.test(b);function x(e){var i,a,l,m=g,x=w;if("c"===b)x=E(e)+x,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),y),v&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,x=("s"===b?kb[8+db/3]:"")+x+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}p&&!h&&(e=n(e,1/0));var T=m.length+e.length+x.length,P=T<f?new Array(f-T+1).join(t):"";switch(p&&h&&(e=n(P+e,P.length?f-x.length:1/0),P=""),r){case"<":e=m+e+x+P;break;case"=":e=m+P+e+x;break;case"^":e=P.slice(0,T=P.length>>1)+m+e+x+P.slice(T);break;default:e=P+m+e+x}return o(e)}return y=void 0===y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),x.toString=function(){return e+""},x}return{format:d,formatPrefix:function(e,t){var r,n=d(((e=hb(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((r=t,((r=pb(Math.abs(r)))?r[1]:NaN)/3)))),a=Math.pow(10,-i),s=kb[8+i/3];return function(e){return n(a*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),wb=gb.format,gb.formatPrefix;const Ab=Tb(xb),Ib=Ab.right,Cb=(Ab.left,Tb((function(e){return null===e?NaN:+e})).center,Ib);function Mb(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Ob(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function $b(){}var Nb=.7,zb=1/Nb,jb="\\s*([+-]?\\d+)\\s*",Lb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Db="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Rb=/^#([0-9a-f]{3,8})$/,Fb=new RegExp(`^rgb\\(${jb},${jb},${jb}\\)$`),_b=new RegExp(`^rgb\\(${Db},${Db},${Db}\\)$`),Bb=new RegExp(`^rgba\\(${jb},${jb},${jb},${Lb}\\)$`),Vb=new RegExp(`^rgba\\(${Db},${Db},${Db},${Lb}\\)$`),Ub=new RegExp(`^hsl\\(${Lb},${Db},${Db}\\)$`),Hb=new RegExp(`^hsla\\(${Lb},${Db},${Db},${Lb}\\)$`),Yb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qb(){return this.rgb().formatHex()}function Kb(){return this.rgb().formatRgb()}function Wb(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Rb.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?Gb(t):3===r?new Xb(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?Jb(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?Jb(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Fb.exec(e))?new Xb(t[1],t[2],t[3],1):(t=_b.exec(e))?new Xb(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Bb.exec(e))?Jb(t[1],t[2],t[3],t[4]):(t=Vb.exec(e))?Jb(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Ub.exec(e))?ig(t[1],t[2]/100,t[3]/100,1):(t=Hb.exec(e))?ig(t[1],t[2]/100,t[3]/100,t[4]):Yb.hasOwnProperty(e)?Gb(Yb[e]):"transparent"===e?new Xb(NaN,NaN,NaN,0):null}function Gb(e){return new Xb(e>>16&255,e>>8&255,255&e,1)}function Jb(e,t,r,n){return n<=0&&(e=t=r=NaN),new Xb(e,t,r,n)}function Qb(e,t,r,n){return 1===arguments.length?((i=e)instanceof $b||(i=Wb(i)),i?new Xb((i=i.rgb()).r,i.g,i.b,i.opacity):new Xb):new Xb(e,t,r,null==n?1:n);var i}function Xb(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function Zb(){return`#${ng(this.r)}${ng(this.g)}${ng(this.b)}`}function eg(){const e=tg(this.opacity);return`${1===e?"rgb(":"rgba("}${rg(this.r)}, ${rg(this.g)}, ${rg(this.b)}${1===e?")":`, ${e})`}`}function tg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function rg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ng(e){return((e=rg(e))<16?"0":"")+e.toString(16)}function ig(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new sg(e,t,r,n)}function ag(e){if(e instanceof sg)return new sg(e.h,e.s,e.l,e.opacity);if(e instanceof $b||(e=Wb(e)),!e)return new sg;if(e instanceof sg)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(r-n)/o+6*(r<n):r===a?(n-t)/o+2:(t-r)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new sg(s,o,l,e.opacity)}function sg(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function og(e){return(e=(e||0)%360)<0?e+360:e}function lg(e){return Math.max(0,Math.min(1,e||0))}function cg(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}Mb($b,Wb,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:qb,formatHex:qb,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ag(this).formatHsl()},formatRgb:Kb,toString:Kb}),Mb(Xb,Qb,Ob($b,{brighter(e){return e=null==e?zb:Math.pow(zb,e),new Xb(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Nb:Math.pow(Nb,e),new Xb(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Xb(rg(this.r),rg(this.g),rg(this.b),tg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Zb,formatHex:Zb,formatHex8:function(){return`#${ng(this.r)}${ng(this.g)}${ng(this.b)}${ng(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:eg,toString:eg})),Mb(sg,(function(e,t,r,n){return 1===arguments.length?ag(e):new sg(e,t,r,null==n?1:n)}),Ob($b,{brighter(e){return e=null==e?zb:Math.pow(zb,e),new sg(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Nb:Math.pow(Nb,e),new sg(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Xb(cg(e>=240?e-240:e+120,i,n),cg(e,i,n),cg(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new sg(og(this.h),lg(this.s),lg(this.l),tg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=tg(this.opacity);return`${1===e?"hsl(":"hsla("}${og(this.h)}, ${100*lg(this.s)}%, ${100*lg(this.l)}%${1===e?")":`, ${e})`}`}}));const ug=e=>()=>e;function dg(e,t){var r=t-e;return r?function(e,t){return function(r){return e+r*t}}(e,r):ug(isNaN(e)?t:e)}const mg=function e(t){var r=function(e){return 1==(e=+e)?dg:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):ug(isNaN(t)?r:t)}}(t);function n(e,t){var n=r((e=Qb(e)).r,(t=Qb(t)).r),i=r(e.g,t.g),a=r(e.b,t.b),s=dg(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return n.gamma=e,n}(1);function hg(e){return function(t){var r,n,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(r=0;r<i;++r)n=Qb(t[r]),a[r]=n.r||0,s[r]=n.g||0,o[r]=n.b||0;return a=e(a),s=e(s),o=e(o),n.opacity=1,function(e){return n.r=a(e),n.g=s(e),n.b=o(e),n+""}}}function fg(e,t){var r,n=t?t.length:0,i=e?Math.min(n,e.length):0,a=new Array(i),s=new Array(n);for(r=0;r<i;++r)a[r]=kg(e[r],t[r]);for(;r<n;++r)s[r]=t[r];return function(e){for(r=0;r<i;++r)s[r]=a[r](e);return s}}function pg(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function yg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function vg(e,t){var r,n={},i={};for(r in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)r in e?n[r]=kg(e[r],t[r]):i[r]=t[r];return function(e){for(r in n)i[r]=n[r](e);return i}}hg(ib),hg((function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],a=e[n%t],s=e[(n+1)%t],o=e[(n+2)%t];return nb((r-n/t)*t,i,a,s,o)}}));var bg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gg=new RegExp(bg.source,"g");function wg(e,t){var r,n,i,a=bg.lastIndex=gg.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(r=bg.exec(e))&&(n=gg.exec(t));)(i=n.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:yg(r,n)})),a=gg.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var r,n=0;n<t;++n)o[(r=l[n]).i]=r.x(e);return o.join("")})}function Eg(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function kg(e,t){var r,n,i=typeof t;return null==t||"boolean"===i?ug(t):("number"===i?yg:"string"===i?(r=Wb(t))?(t=r,mg):wg:t instanceof Wb?mg:t instanceof Date?pg:(n=t,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(t)?fg:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?vg:yg:Eg))(e,t)}function xg(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Sg(e){return+e}var Tg=[0,1];function Pg(e){return e}function Ag(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function Ig(e,t,r){var n=e[0],i=e[1],a=t[0],s=t[1];return i<n?(n=Ag(i,n),a=r(s,a)):(n=Ag(n,i),a=r(a,s)),function(e){return a(n(e))}}function Cg(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=Ag(e[s],e[s+1]),a[s]=r(t[s],t[s+1]);return function(t){var r=Cb(e,t,1,n)-1;return a[r](i[r](t))}}function Mg(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Og(e){return Math.log(e)}function $g(e){return Math.exp(e)}function Ng(e){return-Math.log(-e)}function zg(e){return-Math.exp(-e)}function jg(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Lg(e){return(t,r)=>-e(-t,r)}function Dg(){const e=function(e){const t=e(Og,$g),r=t.domain;let n,i,a=10;function s(){return n=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?jg:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),r()[0]<0?(n=Lg(n),i=Lg(i),e(Ng,zg)):e(Og,$g),t}return t.base=function(e){return arguments.length?(a=+e,s()):a},t.domain=function(e){return arguments.length?(r(e),s()):r()},t.ticks=e=>{const t=r();let s=t[0],o=t[t.length-1];const l=o<s;l&&([s,o]=[o,s]);let c,u,d=n(s),m=n(o);const h=null==e?10:+e;let f=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),s>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}2*f.length<h&&(f=ub(s,o,h))}else f=ub(d,m,Math.min(m-d,h)).map(i);return l?f.reverse():f},t.tickFormat=(e,r)=>{if(null==e&&(e=10),null==r&&(r=10===a?"s":","),"function"!=typeof r&&(a%1||null!=(r=hb(r)).precision||(r.trim=!0),r=wb(r)),e===1/0)return r;const s=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(n(e)));return t*a<a-.5&&(t*=a),t<=s?r(e):""}},t.nice=()=>r(function(e,t){var r,n=0,i=(e=e.slice()).length-1,a=e[n],s=e[i];return s<a&&(r=n,n=i,i=r,r=a,a=s,s=r),e[n]=t.floor(a),e[i]=t.ceil(s),e}(r(),{floor:e=>i(Math.floor(n(e))),ceil:e=>i(Math.ceil(n(e)))})),t}(function(){var e,t,r,n,i,a,s=Tg,o=Tg,l=kg,c=Pg;function u(){var e=Math.min(s.length,o.length);return c!==Pg&&(c=function(e,t){var r;return e>t&&(r=e,e=t,t=r),function(r){return Math.max(e,Math.min(t,r))}}(s[0],s[e-1])),n=e>2?Cg:Ig,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?r:(i||(i=n(s.map(e),o,l)))(e(c(t)))}return d.invert=function(r){return c(t((a||(a=n(o,s.map(e),yg)))(r)))},d.domain=function(e){return arguments.length?(s=Array.from(e,Sg),u()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),l=xg,u()},d.clamp=function(e){return arguments.length?(c=!!e||Pg,u()):c!==Pg},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(r=e,d):r},function(r,n){return e=r,t=n,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,r=Dg(),r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,r},Mg.apply(e,arguments),e}var Rg=r(4843);function Fg(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function _g(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Fg(r);return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}let Bg;function Vg(){return Bg||(Bg=_g("keyval-store","keyval")),Bg}function Ug(e,t=Vg()){return t("readonly",(t=>Fg(t.get(e))))}function Hg(e,t,r=Vg()){return r("readwrite",(r=>(r.put(t,e),Fg(r.transaction))))}var Yg;!function(e){e.Looking="looking",e.NotFound="not-found"}(Yg||(Yg={}));const qg=Yg;var Kg=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Wg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Gg=new H("playlist"),Jg=_g("ampcast/playlist","keyval"),Qg=[],Xg=new it(Qg),Zg=new it("");function ew(){return Xg.getValue()}function tw(e){e=e.concat(),Xg.next(e),0===e.length?nw(""):iw()||nw(e[0].id)}function rw(){return Zg.getValue()}function nw(e){Zg.next(e)}function iw(){const e=ew(),t=rw();return e.find((e=>e.id===t))||null}function aw(e){nw(e.id)}function sw(){return Rn([Xg,Zg]).pipe(Be((([e,t])=>{var r;return null!==(r=e.find((e=>e.id===t)))&&void 0!==r?r:null})),_n())}function ow(){return Rn([Xg,Zg]).pipe(Be((([e,t])=>e.findIndex((e=>e.id===t)))),_n())}function lw(){const e=Xg.getValue(),t=rw();return e.findIndex((e=>e.id===t))}function cw(){return Xg.pipe(Be((e=>e.length)),_n())}function uw(){return Xg.getValue().length}function dw(e){const t=rw();if(t){const r=ew(),n=r.findIndex((e=>e.id===t));if(-1!==n){const t=r[n+e];t&&aw(t)}}}function mw(e,t){return Kg(this,void 0,void 0,(function*(){const r=ew(),n=Cy.get().allowDuplicates;let i=yield function(e){return Kg(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===Zn.Album;let r=[];return r=Array.isArray(e)?t(e[0])?(yield Promise.all(e.map((e=>fw(e))))).flat():e:t(e)?yield fw(e):[e],r.filter(l)}))}(e);if(n||(i=i.filter((e=>-1===r.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},D(e)),{id:Ea()})));t>=0&&t<r.length?(r.splice(t,0,...e),tw(r)):tw(r.concat(e))}}))}function hw(e){const t=ew(),r=Array.isArray(e)?e:[e],n=t.filter((e=>!r.includes(e)));if(n.length!==t.length){const e=lw(),t=rw(),r=n.findIndex((e=>e.id===t));if(-1===r)if(-1===e)nw("");else{const t=n[e]||n.at(-1);nw((null==t?void 0:t.id)||"")}tw(n)}}function fw(e){return Kg(this,void 0,void 0,(function*(){return di(e.pager,{keepAlive:!0})}))}const pw={get atEnd(){return lw()===uw()-1},get atStart(){return 0===uw()||0===lw()},observe:function(){return Xg.pipe(_e((e=>e!==Qg)))},observeCurrentIndex:ow,observeCurrentItem:sw,observeNextItem:function(){return Rn([Xg,Zg]).pipe(Be((([e,t])=>{const r=e.findIndex((e=>e.id===t));return-1===r?null:e[r+1]||null})),_n())},observeSize:cw,getCurrentIndex:lw,getCurrentItem:iw,setCurrentItem:aw,getItems:ew,add:function(e){return Kg(this,void 0,void 0,(function*(){return mw(e,-1)}))},clear:function(){tw([])},eject:function(){const e=iw();e&&hw(e)},inject:function(e){return Kg(this,void 0,void 0,(function*(){return mw(e,lw()+1)}))},injectAt:mw,moveSelection:function(e,t){return Kg(this,void 0,void 0,(function*(){const r=ew(),n=r[t];if(e.includes(n))return;const i=r.filter((t=>!e.includes(t))),a=i.indexOf(n);a>=0?(i.splice(a,0,...e),tw(i)):tw(i.concat(e))}))},next:function(){dw(1)},prev:function(){dw(-1)},remove:hw,removeAt:function(e){const t=function(e){var t;return null!==(t=ew()[e])&&void 0!==t?t:null}(e);t&&hw(t)},reverseAt:function(e,t){const r=ew(),n=r.slice(e,e+t).reverse();r.splice(e,t,...n),tw(r)},shuffle:function(e){const t=ew().slice();if(t.length>0){const r=iw();if(e&&r){const e=p(t.filter((e=>e!==r)));e.unshift(r),tw(e)}else{const e=p(t);tw(e),aw(e[0])}}}},yw=pw;Kg(void 0,void 0,void 0,(function*(){const[e=[],t=""]=yield Promise.all([Ug("items",Jg),Ug("currently-playing-id",Jg)]);nw(t),tw(e.map((e=>{var t;if(null===(t=e.plex)||void 0===t?void 0:t.ratingKey){const[,t,r]=e.src.split(":");e.src=`plex:${t}:${e.plex.ratingKey}`,e.srcs=[r],delete e.plex.ratingKey}return e})))})),Xg.pipe(Kh(2),vv(200),et((e=>Hg("items",e=e.map((e=>{if("lookupStatus"in e){const{lookupStatus:t}=e;return Wg(e,["lookupStatus"])}return e})),Jg)))).subscribe(Gg),Zg.pipe(Kh(2),vv(200),et((e=>Hg("currently-playing-id",e,Jg)))).subscribe(Gg),Qo.pipe(at((({lookupItem:e})=>{const t=ew(),r=t.findIndex((t=>t.id===e.id));-1!==r&&(t[r]=Object.assign(Object.assign({},e),{lookupStatus:qg.Looking}),tw(t))}))).subscribe(Gg),Xo.pipe(at((({lookupItem:e,foundItem:t})=>{const r=ew(),n=r.findIndex((t=>t.id===e.id));-1!==n&&(r[n]=t?Object.assign(Object.assign({},x(t,e)),{id:e.id}):Object.assign(Object.assign({},e),{lookupStatus:qg.NotFound}),tw(r))}))).subscribe(Gg),Zo.pipe(at((({lookupItem:e})=>{const t=ew(),r=t.findIndex((t=>t.id===e.id));if(-1!==r){const{lookupStatus:n}=e,i=Wg(e,["lookupStatus"]);t[r]=i,tw(t)}}))).subscribe(Gg),qn().pipe(at((e=>{let t=!1;const r=ew().map((r=>{for(const{match:n,values:i}of e)if(n(r)){const e=D(i);if(Object.keys(e).length>0)return t=!0,Object.assign(Object.assign({},r),e)}return r}));t&&tw(r)}))).subscribe(Gg);const vw=new it(!1),bw=new it({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function gw(){return vw.pipe(_e((e=>e)),ji(1),Be((()=>{})))}function ww(){return bw}function Ew(){return ww().pipe(_e((e=>0!==e.startedAt)),_n(((e,t)=>e.startedAt===t.startedAt)))}function kw(){return ww().pipe(_e((e=>0!==e.endedAt)),_n(((e,t)=>e.endedAt===t.endedAt)))}function xw(e=1e4){return Ew().pipe(an((()=>ww().pipe(Va(e,void 0,{trailing:!0}),sn(kw())))))}function Sw(){return ww().pipe(Be((e=>e.currentTime)),_n())}function Tw(){return ww().pipe(Be((e=>e.duration)),_n())}function Pw(){return ww().pipe(Be((e=>e.paused)),_n())}function Aw(){const e=bw.getValue();e.startedAt&&(e.endedAt||bw.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),bw.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}sw().subscribe((e=>{var t;const r=bw.getValue();(null==e?void 0:e.id)===(null===(t=r.currentItem)||void 0===t?void 0:t.id)?bw.next(Object.assign(Object.assign({},r),{currentItem:e})):(Aw(),bw.next(Object.assign(Object.assign({},r),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0})))}));const Iw={get paused(){return bw.getValue().paused},observePlaybackReady:gw,observePlaybackState:ww,observePlaybackStart:Ew,observePlaybackEnd:kw,observePlaybackProgress:xw,observeCurrentTime:Sw,observeDuration:Tw,observePaused:Pw,getCurrentTime:function(){return bw.getValue().currentTime},setCurrentTime:function(e){const t=bw.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&bw.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return bw.getValue().duration},setDuration:function(e){const t=bw.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const r=Math.min(t.currentTime,e);bw.next(Object.assign(Object.assign({},t),{duration:e,currentTime:r}))}},play:function(){const e=bw.getValue();e.currentItem&&e.paused&&bw.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=bw.getValue();e.paused||bw.next(Object.assign(Object.assign({},e),{paused:!0}))},ready:function(){vw.next(!0)},stop:function(){const e=bw.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});bw.next(t),e.startedAt&&bw.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=bw.getValue();e.startedAt||bw.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:Aw},Cw=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const r=[{index:t,value:e}];for(let n=1;n<12;n++)r[n]={index:t,value:e*Math.pow(2,n)};return r})).flat().sort(((e,t)=>e.value-t.value));function Mw(e,t,r){return function(e,t){const r=e*t,n=r+t,i=Cw.filter((e=>e.value>=r&&e.value<n));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<Cw.length;e++){const t=Cw[e];if(t.value>n){const i=Cw[e-1],a=t.value-i.value;return[{index:i.index,value:1-(n-i.value)/a},{index:t.index,value:1-(t.value-r)/a}]}}return[]}(t,r).map((({index:t,value:r})=>e[t]*r)).reduce(((e,t)=>e+t),0)}var Ow,$w=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Ow=new WeakMap;const Nw=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new it({bars:{},beats:{},sections:{},segments:{},tatums:{}}),Ow.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,e.observeCurrentTrackState().subscribe((t=>$w(this,void 0,void 0,(function*(){var r,n;const i=null===(n=null===(r=null==t?void 0:t.track_window)||void 0===r?void 0:r.current_track)||void 0===n?void 0:n.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield ih.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Ow,"f")}observeBar(){return this.observeActiveIntervals().pipe(Be((e=>e.bars)),_n())}observeBeat(){return this.observeActiveIntervals().pipe(Be((e=>e.beats)),_n())}observeSection(){return this.observeActiveIntervals().pipe(Be((e=>e.sections)),_n())}observeSegment(){return this.observeActiveIntervals().pipe(Be((e=>e.segments)),_n())}observeTatum(){return this.observeActiveIntervals().pipe(Be((e=>e.tatums)),_n())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const r=ib([.5,1,.5])(this.beat.progress)*this.volume,n=(this.segment.timbre[1]-180)/360,i=this.frequencyBinCount;for(let a=0;a<i;a++){let s=(a-i/2-n*i)/i+1;(s<0||s>2)&&(s=0);const o=Math.sin(s*(Math.PI/2)),l=Mw(t,a,this.sampleSize);e[a]=(l+o)/2*255*r}}else e.fill(0)}getFloatFrequencyData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Uint8Array(t);this.getByteFrequencyData(r);for(let n=0;n<t;n++)e[n]=r[n]-128}getByteTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatTimeDomainData(r);const n=Uint8Array.from(r);for(let r=0;r<t;r++)e[r]=n[r]}getFloatTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatFrequencyData(r);const{real:n,imag:i}=(0,Rg.rS)(r);for(let r=0;r<t;r++)e[r]=Math.sqrt(n[r]*n[r]+i[r]*i[r])-128}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return Pw().pipe(an((e=>e?rn:this.activeIntervals$)),_e((()=>this.active)))}updateState(e){return $w(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],r=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<r&&r<t[e+1].start)return e}return 0};this.intervalTypes.forEach((r=>{const n=t(r);null!=e[r].start&&n===e[r].index||(e[r]=Object.assign(Object.assign({},this.trackAnalysis[r][n]),{index:n}));const{start:i,duration:a}=e[r],s=this.trackProgress-i;e[r].elapsed=s,e[r].progress=this.easeOutQuart(s/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:r,duration:n,elapsed:i,start:a,index:s}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[s+1])return 0;const o=this.trackAnalysis.segments[s+1].loudness_start,l=a+i;if(i<r){const n=Math.min(1,i/r);return this.interpolate(t,e)(n)}{const t=l-(a+r),i=n-r,s=Math.min(1,t/i);return this.interpolate(e,o)(s)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),r=this.queues;function n(e){return e.reduce(((e,t)=>e+t))/e.length}r.volume.unshift(t),r.volume.length>400&&r.volume.pop(),r.beat.unshift(t),r.beat.length>this.volumeSmoothing&&r.beat.pop();const i=Dg().domain([ab(r.volume),n(r.volume)]).range([0,1]),a=n(r.beat);!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Ow,i(a)||0,"f")}interpolate(e,t){return r=>e*(1-r)+t*r}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(sf),zw=new H("SpotifyVizPlayer");class jw extends Fy{constructor(){super(),this.analyser=Nw,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz";const e=this.analyser;e.observeBar().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===r||r.call(t,e)})),e.observeBeat().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===r||r.call(t,e)})),e.observeSection().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===r||r.call(t,e)})),e.observeSegment().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===r||r.call(t,e)})),e.observeTatum().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===r||r.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.cancelAnimation():this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){var t,r;zw.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.analyser.volumeSmoothing=null!==(r=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==r?r:100),this.autoplay&&!this.animationFrameId&&this.render()}play(){zw.log("play"),this.animationFrameId||this.render()}pause(){zw.log("pause"),this.cancelAnimation()}stop(){zw.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}let Lw="",Dw="";const Rw={volumeSmoothing:10,onBar(){const e=Kt.getVisualizerColors();Lw=Dw||k(e),Dw=k(e.filter((e=>e!==Dw)))},onPaint({context2D:e,height:t,width:r,now:n,analyser:i}){const a=ib([0,10*i.volume,0])(i.bar.progress),s=ib([0,300*i.volume,0])(i.beat.progress),{r:o,g:l,b:c}=new xt(Kt.black).toRgb(),u=`${o},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,r,t),e.lineWidth=a,e.strokeStyle=mg(Lw,Dw)(i.bar.progress),function(e,t,r,n,i,a=5){const s=e=>n*Math.sin(e/i+t)+r,{width:o}=e.canvas;e.beginPath();for(let t=-50;t<o+50;t+=a)-50===t?e.moveTo(t,s(t)):e.lineTo(t,s(t))}(e,n/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=s,function(e,t,r,n,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,r,n,i,a),e.closePath()}(e,r/2,t/2,i.volume*t/5+s/10),e.stroke(),e.fill()}},Fw=[{providerId:"spotifyviz",name:"example by zachwinter",config:Rw,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],_w={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",visualizers:Fw,observeVisualizers:()=>hn(Fw),createPlayer(){return this.player||(this.player=new jw),this.player}};function Bw(){return Kt.isLight&&Kt.isFrameLight?Kt.frameColor:Kt.isTextLight?Kt.textColor:Kt.frameTextColor}const Vw=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i),s=t/i;let o=0;e.lineWidth=Math.round(Kt.fontSize/(document.fullscreenElement?2:4)),e.clearRect(0,0,t,r),e.strokeStyle=Bw(),e.beginPath(),n.getByteTimeDomainData(a);for(let t=0;t<i;t++){const n=a[t]/128*r/2;0===t?e.moveTo(o,n):e.lineTo(o,n),o+=s}e.lineTo(t,r/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=document.fullscreenElement?8:4,a=n.frequencyBinCount,s=new Uint8Array(a);n.getByteFrequencyData(s),e.clearRect(0,0,t,r),e.fillStyle=Bw();const o=(t-15*i)/16,l=.0075*r,c=a/16;let u,d=0;for(let t=0;t<a;t+=c){const n=s.slice(t,t+c).reduce(((e,t)=>e+t),0)/c;u=l*n,e.fillRect(d,r-u/2,o,u/2),d+=o+i}}}}],Uw=Vw,Hw={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",visualizers:Uw,observeVisualizers:()=>hn(Uw),createPlayer(e){return this.player||(this.player=new mv(e,"main")),this.player}},Yw=Hw,qw=new H("visualizerProviders");function Kw(){return[Tv,zv,Bv,Gv,rb,_w,Yw]}function Ww(e){return Kw().find((t=>t.id===e))}function Gw(e){var t;return(null===(t=Ww(e))||void 0===t?void 0:t.visualizers)||[]}function Jw({providerRef:e,fullscreenProgressRef:t,ambientVideoEnabled:r,onSubmit:i}){const a=(0,n.useId)(),s=jy.provider,o=(0,n.useMemo)(Kw,[]);return n.createElement("form",{className:"visualizer-settings-general",method:"dialog"},n.createElement("p",null,n.createElement("label",{htmlFor:`${a}-visualizer-provider`},"Provider:"),n.createElement("select",{id:`${a}-visualizer-provider`,defaultValue:s,ref:e},n.createElement("option",{value:"none"},"(none)"),o.length>1?n.createElement("option",{value:""},"(random)"):null,o.filter((e=>"ambientvideo"!==e.id||r)).map((e=>n.createElement("option",{value:e.id,key:e.id},e.name))))),n.createElement("fieldset",null,n.createElement("legend",null,"Fullscreen"),n.createElement("p",null,n.createElement("input",{type:"checkbox",id:`${a}-fullscreen-progress`,defaultChecked:jy.fullscreenProgress,ref:t}),n.createElement("label",{htmlFor:`${a}-fullscreen-progress`},"Show progress bar"))),n.createElement(fr,{onSubmit:i}))}function Qw({ambientVideoEnabledRef:e,ambientVideoSourceRef:t,useAmbientVideoSourceRef:r,beatsOverlayEnabledRef:i,onAmbientVideoEnabledChange:a,onSubmit:s}){const o=(0,n.useId)(),[l,c]=(0,n.useState)((()=>!!jy.useAmbientVideoSource)),u=(0,n.useCallback)((()=>{t.current.validity.valid||r.current.checked||(t.current.value=""),c(r.current.checked)}),[t,r]),d=(0,n.useCallback)((()=>{const e=t.current.value;let r="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(r="Not a YouTube video or playlist.",Dc(e)&&(r="")),t.current.setCustomValidity(r)}),[t]),m=(0,n.useCallback)((()=>{a(e.current.checked)}),[e,a]);return n.createElement("form",{className:"ambient-video-settings",method:"dialog"},n.createElement("p",null,n.createElement("input",{id:`${o}-ambient-video-enabled`,type:"checkbox",defaultChecked:jy.ambientVideoEnabled,onChange:m,ref:e}),n.createElement("label",{htmlFor:`${o}-ambient-video-enabled`},"Enable ambient video")),n.createElement("fieldset",null,n.createElement("legend",null,"Source"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-default`,defaultChecked:!jy.useAmbientVideoSource,onChange:u}),n.createElement("label",{htmlFor:`${o}-source-default`},"Default videos")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-youtube`,defaultChecked:jy.useAmbientVideoSource,onChange:u,ref:r}),n.createElement("label",{htmlFor:`${o}-source-youtube`},"YouTube video or playlist:")),n.createElement("p",null,n.createElement("input",{type:"url",defaultValue:jy.ambientVideoSource,disabled:!l,required:l,onInput:d,"aria-labelledby":`${o}-source-youtube-label`,ref:t}))),n.createElement("p",null,n.createElement("input",{id:`${o}-beats-overlay`,type:"checkbox",defaultChecked:jy.ambientVideoBeats,ref:i}),n.createElement("label",{htmlFor:`${o}-beats-overlay`},'Show "beats" overlay')),n.createElement(fr,{onSubmit:s}))}function Xw({animatedBackgroundEnabledRef:e,beatsOverlayEnabledRef:t,onSubmit:r}){const i=(0,n.useId)();return n.createElement("form",{className:"cover-art-settings",method:"dialog"},n.createElement("p",null,n.createElement("input",{id:`${i}-beats-overlay`,type:"checkbox",defaultChecked:jy.coverArtBeats,ref:t}),n.createElement("label",{htmlFor:`${i}-beats-overlay`},'Show "beats" overlay')),n.createElement("p",null,n.createElement("input",{id:`${i}-animated-background`,type:"checkbox",defaultChecked:jy.coverArtAnimatedBackground,ref:e}),n.createElement("label",{htmlFor:`${i}-animated-background`},"Animated background (experimental)")),n.createElement(fr,{onSubmit:r}))}function Zw(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useRef)(null),[c,u]=(0,n.useState)(jy.ambientVideoEnabled),d=(0,n.useCallback)((()=>{jy.provider=e.current.value,jy.ambientVideoEnabled=t.current.checked,jy.useAmbientVideoSource=i.current.checked,jy.ambientVideoSource=r.current.value,jy.ambientVideoBeats=a.current.checked,jy.coverArtAnimatedBackground=s.current.checked,jy.coverArtBeats=o.current.checked,jy.fullscreenProgress=l.current.checked}),[]),m=(0,n.useMemo)((()=>[{tab:"General",panel:n.createElement(Jw,{providerRef:e,fullscreenProgressRef:l,ambientVideoEnabled:c,onSubmit:d})},{tab:"Ambient Video",panel:n.createElement(Qw,{ambientVideoEnabledRef:t,ambientVideoSourceRef:r,useAmbientVideoSourceRef:i,beatsOverlayEnabledRef:a,onAmbientVideoEnabledChange:u,onSubmit:d})},{tab:"Cover Art",panel:n.createElement(Xw,{animatedBackgroundEnabledRef:s,beatsOverlayEnabledRef:o,onSubmit:d})}]),[c,d]);return n.createElement(lp,{className:"visualizer-settings",items:m,label:"Visualizers"})}function eE(e){return n.createElement(or,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),n.createElement(Zw,null))}Zr(Kw()).pipe(et((e=>e.observeVisualizers().pipe(Be((e=>e.length)),On((e=>0===e)),at((t=>qw.log(`${e.id} (total=${t})`))))))).subscribe(qw);const tE=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useCallback)((e=>{e.preventDefault(),function(){var e,t,r,i;e=this,t=void 0,i=function*(){if(yield br({title:"Factory Reset",message:n.createElement("p",null,"This will delete all of your current settings",n.createElement("br",null),"and disconnect you from all services."),okLabel:"Continue",system:!0})){try{yield Promise.all(Bf().filter((e=>e.isConnected())).map((e=>e.logout())))}catch(e){console.error(e)}localStorage.clear(),sessionStorage.clear();try{const e=yield indexedDB.databases();yield Promise.all(e.map((e=>e.name)).filter(l).map((e=>indexedDB.deleteDatabase(e))))}catch(e){console.error(e)}location.reload()}},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}))}()}),[]);return n.createElement("form",{className:"advanced-settings-general",method:"dialog"},n.createElement("p",null,n.createElement("button",{onClick:e},"Factory Reset…")),n.createElement(fr,null))}),null)}];function rE(){return n.createElement(lp,{className:"advanced-settings",items:tE,label:"Advanced Settings"})}const nE=new J("settings-sources");function iE(e){const t=(0,n.useMemo)((()=>[{id:"streaming-media",label:n.createElement(wr,{text:"Streaming Media",icon:"globe"}),value:n.createElement(ey,{title:"Streaming Media Settings",serviceType:Mn.PublicMedia,services:Kf(),key:Mn.PublicMedia}),startExpanded:!0,children:Kf().filter(Om).map((e=>({id:e.id,label:n.createElement(ip,{service:e}),value:n.createElement(Py,{service:e,key:e.id})})))},{id:"personal-media",label:n.createElement(wr,{text:"Personal Media",icon:"network"}),value:n.createElement(ey,{title:"Personal Media Settings",serviceType:Mn.PersonalMedia,services:Yf(),key:Mn.PersonalMedia}),startExpanded:!0,children:Yf().filter(Om).map((e=>({id:e.id,label:n.createElement(ip,{service:e}),value:n.createElement(Py,{service:e,key:e.id})})))},{id:"data-services",label:n.createElement(wr,{text:"Data Services",icon:"data"}),value:n.createElement(ey,{title:"Data Services Settings",serviceType:Mn.DataService,services:Uf(),key:Mn.DataService}),startExpanded:!0,children:Uf().filter(Om).map((e=>({id:e.id,label:n.createElement(ip,{service:e}),value:n.createElement(Py,{service:e,key:e.id})})))},{id:"visualizer",label:n.createElement(wr,{text:"Visualizer",icon:"visualizer"}),value:n.createElement(Zw,null)},{id:"playlist",label:n.createElement(wr,{text:"Playlist",icon:"playlist"}),value:n.createElement(Oy,null)},{id:"appearance",label:n.createElement(wr,{text:"Appearance",icon:"palette"}),value:n.createElement(qp,null)},{id:"advanced",label:n.createElement(wr,{text:"Advanced",icon:"settings"}),value:n.createElement(rE,null)}]),[]),[r,i]=(0,n.useState)(null);return n.createElement(or,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),n.createElement(Tn,{className:"settings-dialog-sources",roots:t,storageId:nE.id,onSelect:i}),n.createElement("div",{className:"settings-dialog-source"},r))}function aE(){return n.createElement("div",{className:"app-drag-region",onContextMenu:g})}var sE=r(4511),oE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function lE(e){var{service:t,onClick:r=t.login}=e,i=oE(e,["service","onClick"]);return n.createElement("p",null,n.createElement("button",Object.assign({},i,{className:"branded login",onClick:r}),"Connect to ",t.name,"…"))}function cE({service:e}){return n.createElement("p",null,"You need to be logged in to"," ",e.serviceType===Mn.DataService?"access your data":"play music"," from"," ",e.name,".")}function uE({service:e}){return n.createElement("p",{className:`service-link service-link-${e.id}`},n.createElement(rt,{name:e.icon}),n.createElement(Jl,{href:e.url}))}function dE({service:e}){const{musicKit:t,error:r}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=Zr(Ni()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{musicKit:e,error:r}}();return n.createElement(n.Fragment,null,n.createElement(cE,{service:e}),n.createElement(lE,{service:e,disabled:!t}),r?n.createElement("p",{className:"error"},"Could not load Apple MusicKit library."):null,n.createElement(uE,{service:e}))}function mE({service:{observeConnectionLogging:e}}){const[t,r]=(0,n.useState)([]);return(0,n.useEffect)((()=>{if(e){const t=e().subscribe((e=>{r(e?t=>t.concat(e):[])}));return()=>t.unsubscribe()}r([])}),[e]),e?n.createElement("div",{className:"connection-logging"},t.map(((e,t)=>n.createElement("p",{key:t},e)))):null}function hE({service:e}){return n.createElement(n.Fragment,null,n.createElement(cE,{service:e}),n.createElement(lE,{service:e}),n.createElement(uE,{service:e}),n.createElement(mE,{service:e}))}function fE(){(0,n.useEffect)((()=>{const e=new Ne,t=e.pipe(et((e=>Lr(e))),et((()=>function(){return Dd(this,void 0,void 0,(function*(){return Vd=yield Ld.fetchJSON({host:kd,path:"/pins",method:"POST",params:{strong:"true"}}),Vd}))}())),Be((e=>1e3*e.expiresIn)),at((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()}))}function pE({service:e}){return fE(),n.createElement(hE,{service:e})}function yE({service:e}){const t=e.authService;return fE(),n.createElement(n.Fragment,null,n.createElement(cE,{service:e}),n.createElement(lE,{service:t}),n.createElement(uE,{service:t}),n.createElement(uE,{service:e}),n.createElement(mE,{service:t}))}function vE({service:e}){return n.createElement("div",{className:"dev-mode note"},n.createElement("p",null,"This application is in ",n.createElement("strong",null,"development mode"),"."),n.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function bE(e){return n.createElement(or,Object.assign({},e,{className:"settings-dialog spotify-credentials-dialog",title:"Spotify Credentials"}),n.createElement(ly,null))}var gE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function wE({service:e}){const t=(0,n.useCallback)((()=>gE(this,void 0,void 0,(function*(){oh.clientId||(yield cr(bE)),oh.clientId&&(yield e.login())}))),[e]);return n.createElement(n.Fragment,null,n.createElement(vE,{service:e}),n.createElement("p",null,"You need to be logged in to play music from Spotify.*"),n.createElement(lE,{service:e,onClick:t}),n.createElement("p",null,n.createElement("small",null,"*Spotify Premium required.")),n.createElement(uE,{service:e}))}function EE(e){return n.createElement(or,Object.assign({},e,{className:"settings-dialog youtube-credentials-dialog",title:"YouTube Credentials"}),n.createElement(uy,null))}var kE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function xE({service:e}){const{client:t,error:r}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=Zr(kc()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{client:e,error:r}}(),i=(0,n.useCallback)((()=>kE(this,void 0,void 0,(function*(){cc.apiKey&&cc.clientId||(yield cr(EE)),cc.apiKey&&cc.clientId&&(yield e.login())}))),[e]);return n.createElement(n.Fragment,null,n.createElement(vE,{service:e}),n.createElement("p",null,"You can still play YouTube videos without being logged in.",n.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),n.createElement(lE,{service:e,disabled:!t,onClick:i}),r?n.createElement("p",{className:"error"},"Could not load Google client library."):null,n.createElement(uE,{service:e}))}function SE({service:e}){return n.createElement("div",{className:"panel"},n.createElement("div",{className:`page login login-${e.id}`},n.createElement(TE,{service:e})))}function TE({service:e}){switch(e.id){case"apple":return n.createElement(dE,{service:e});case"plex":return n.createElement(pE,{service:e});case"plex-tidal":return n.createElement(yE,{service:e});case"spotify":return n.createElement(wE,{service:e});case"youtube":return n.createElement(xE,{service:e});default:return n.createElement(hE,{service:e})}}const PE=new it(IE());function AE(){return PE.pipe(_n())}function IE(){return navigator.onLine}function CE(){return cp(AE,IE())}function ME(){return n.createElement("div",{className:"panel"},n.createElement("div",{className:"page login"},n.createElement("div",{className:"note"},n.createElement("p",null,"Internet connection required."))))}function OE({children:e}){return n.createElement("div",{className:"panel empty-screen"},e)}function $E({error:e,children:t}){return n.createElement("div",{className:"panel error-screen"},n.createElement("div",{className:"error-screen-content"},n.createElement("h2",null,"Error"),n.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function NE({icon:e,children:t}){return n.createElement("h2",{className:"page-header"},n.createElement(wr,{icon:e,text:t}))}function zE({min:e="1970",max:t=jE(),value:r=t,onSelect:i}){const[a,s]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),o=function(e,t){const[r,i]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const r=[],n=new Date(e),a=new Date(t),s=n.getFullYear();let o=a.getFullYear();for(;o>=s;)r.push(o),o--;i(r)}),[e,t]),r}(e,t);(0,n.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement("span",{className:"year-picker"},n.createElement("select",{defaultValue:a,onChange:l},o.map((e=>n.createElement("option",{value:e,key:e},e)))))}function jE(){const e=new Date;return String(e.getFullYear())}nn(Hr(window,"online").pipe(Be((()=>!0))),Hr(window,"offline").pipe(Be((()=>!1)))).subscribe(PE);const LE=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function DE({min:e="1970-01",max:t=v(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),[l,c]=(0,n.useState)((()=>new Date(r).getMonth())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===s.getFullYear()?s.getMonth():11;for(;l>=o;)n.push(l),l--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{-1!==l&&(null==i||i(`${s}-${String(l+1).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(-1),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"month-picker"},n.createElement(zE,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},LE[e])))))}function RE({min:e="1970-01-01",max:t=y(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>v(r))),[l,c]=(0,n.useState)((()=>new Date(r).getDate())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=e.split("-").map(Number),l=o[0],c=o[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===s.getFullYear()&&c===s.getMonth()?s.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)n.push(d),d--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{l&&(null==i||i(`${s}-${String(l).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(0),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"date-picker"},n.createElement(DE,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},e)))))}function FE(){return cp(sw,null)}var _E=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function BE(e){var{className:t="",children:r}=e,i=_E(e,["className","children"]);return n.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`,onDoubleClick:w}),r)}var VE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},UE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const HE=new J("recentPlaylists"),YE=4;function qE(e){const{pager:t}=e,r=UE(e,["pager"]),[n]=r.src.split(":"),i=HE.getJson("all",[]),a=i.findIndex((t=>t.src===e.src));-1!==a&&i.splice(a,1);const s=e=>e.src.startsWith(`${n}:`);if(i.filter(s).length===YE){const e=i.findLastIndex(s);i.splice(e,1)}i.unshift(r),HE.setJson("all",i)}function KE(e){const t=e.map((e=>e.id));return HE.getJson("all",[]).filter((e=>{const[r]=e.src.split(":");return t.includes(r)})).slice(0,YE).map((e=>Object.assign(Object.assign({},e),{pager:new hi})))}function WE(e){const t=d(e,(e=>{const t=Jf(e);return(null==t?void 0:t.id)||""})),r=t.plex,n=t["plex-tidal"];n&&(t.plex=(null==r?void 0:r.concat(n))||n);const i=Object.keys(t).filter((e=>""!==e&&"listenbrainz"!==e)).map((e=>({service:Gf(e),items:t[e]}))).filter((({service:e})=>!!(null==e?void 0:e.editablePlaylists)));i.sort(((e,t)=>t.items.length-e.items.length));const a=Gf("listenbrainz");if(a){const t=e.filter((({recording_mbid:e,track_mbid:t,isrc:r})=>e||t||r));t.length>0&&i.push({service:a,items:t})}return i.filter((({service:e})=>e.isLoggedIn()))}function GE({id:e,children:t,onClose:r,x:i,y:a,align:s="left",autoFocus:o,hidden:l,popupRef:c}){const u=(0,n.useRef)(null),d=(0,n.useRef)(document.activeElement),[m,h]=(0,n.useState)({visibility:"hidden"}),[f,p]=(0,n.useState)([]),[y,v]=(0,n.useState)("");c&&(c.current=u.current),(0,n.useEffect)((()=>{const e={},t=u.current,r=Array.from(t.querySelectorAll(":scope > li > button"));"right"===s||i+t.offsetWidth>document.body.clientWidth?e.left=i-t.offsetWidth+"px":e.left=`${i}px`,a+t.offsetHeight>document.body.clientHeight?e.top=a-t.offsetHeight+"px":e.top=`${a}px`,l&&(e.visibility="hidden"),p(r),h(e)}),[s,i,a,l]),(0,n.useEffect)((()=>{const e=f.find((e=>!e.disabled));v((null==e?void 0:e.id)||""),o&&e&&e.focus()}),[f,o]),(0,n.useEffect)((()=>{if(r){const e=nn(Lr(0).pipe(an((()=>Hr(document,"mousedown",{capture:!0}).pipe(_e((e=>!u.current.contains(e.target))))))),Hr(document,"keydown",{capture:!0}).pipe(_e((e=>"Escape"===e.code||"Tab"===e.code))),Hr(window,"blur")).subscribe((()=>{var e;null===(e=d.current)||void 0===e||e.focus(),null==r||r()}));return()=>e.unsubscribe()}}),[r]);const b=(0,n.useCallback)((e=>{var t;if(r){let n=e.target;for(;n&&"BUTTON"!==n.nodeName;)n=n.parentElement;(null==n?void 0:n.value)&&!n.disabled&&(null===(t=d.current)||void 0===t||t.focus(),r(n.value))}}),[r]),w=(0,n.useCallback)((e=>{let t=f.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),f.length-1);const r=f[t];r&&!r.disabled&&(r.focus(),v(r.id))}),[f]),E=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),v(t.id))}),[]);return n.createElement("ul",{className:"popup-menu",id:e,tabIndex:-1,hidden:l,role:"menu","aria-label":"Actions","aria-activedescendant":y,style:m,onClick:b,onContextMenu:g,onKeyDown:w,onMouseOver:E,ref:u},t)}var JE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function QE(e){var{className:t="",label:r,acceleratorKey:i="",children:a,role:s="menuitem"}=e,o=JE(e,["className","label","acceleratorKey","children","role"]);const l=(0,n.useId)(),c=(0,n.useRef)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=!!a,[h,f]=(0,n.useState)(!0),[{x:p,y},v]=(0,n.useState)({x:0,y:0}),[b,g]=(0,n.useState)("left"),k=(0,n.useCallback)((()=>{if(m){const e=c.current,t=d.current;if(e&&t){const{left:r,right:n,top:i}=e.getBoundingClientRect(),{width:a}=t.getBoundingClientRect();n+a+1>=document.body.clientWidth?(g("right"),v({x:r,y:i-1})):(g("left"),v({x:n,y:i-1}))}}}),[m]);Wt(c,k);const x=(0,n.useCallback)((()=>{f(!0)}),[]),S=(0,n.useCallback)((()=>{k(),f(!1)}),[k]),T=(0,n.useCallback)((e=>{const t=e.code;if("Enter"===t||"Space"===t)e.stopPropagation();else if("left"===b&&"ArrowLeft"===t||"right"===b&&"ArrowRight"===t)e.stopPropagation(),u.current.focus();else if("left"===b&&"ArrowRight"===t||"right"===b&&"ArrowLeft"===t){e.stopPropagation();const t=Array.from(d.current.querySelectorAll(":scope > li > button")).find((e=>!e.disabled));null==t||t.focus()}}),[b]);return n.createElement("li",{className:`popup-menu-item ${t} ${m?"has-popup has-popup-"+b:""}`,role:"presentation",onBlur:m?x:void 0,onFocus:m?S:void 0,onKeyDown:h?void 0:T,ref:c},n.createElement("button",Object.assign({},o,{id:l,role:m?void 0:s,tabIndex:-1,"aria-haspopup":m?"true":void 0,"aria-controls":m?`${l}-popup`:void 0,onMouseDown:m?w:E,onMouseUp:w,onClick:m?w:void 0,ref:u}),n.createElement("span",{className:"popup-menu-item-label"},r),i&&!m?n.createElement("span",{className:"popup-menu-item-accelerator-key"},i):null),m?n.createElement(GE,{id:`${l}-popup`,x:p,y,align:b,hidden:h,popupRef:d},a):null)}var XE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function ZE(e){var{className:t="",checked:r=!1}=e,i=XE(e,["className","checked"]);return n.createElement(QE,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":r}))}function ek(){return n.createElement("li",{className:"popup-menu-separator",role:"separator"})}var tk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function rk(e,t,r,a){return tk(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.s)(c);try{const i=e=>{u.unmount(),c.remove(),s(e)};l.append(c),u.render(n.createElement(e,{x:t,y:r,align:a,onClose:i,autoFocus:!0}))}catch(e){u.unmount(),c.remove(),o(e)}}))}))}function nk(e){const[t,r]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const t=WE(e).slice(),n=t.findIndex((e=>"listenbrainz"===e.service.id));if(-1!==n){const e=t[n],i=Zr($l(e.items,!1)).subscribe((i=>{if(0===(i=i.filter((e=>e.recording_mbid))).length)t.splice(n,1);else{const r=e.service;t[n]={service:r,items:i}}r(t)}));return()=>i.unsubscribe()}r(t)}),[e]),t}function ik({items:e}){const t=nk((0,n.useMemo)((()=>e.filter((e=>e.itemType===Zn.Media))),[e])),r=KE(t.map((e=>e.service)));return 0===t.length?null:n.createElement(QE,{label:"Add to playlist"},n.createElement(QE,{label:"New playlist…",value:Qn.AddToNewPlaylist,key:Qn.AddToNewPlaylist}),n.createElement(ek,null),r.map(((e,r)=>n.createElement(ak,{playlist:e,itemsByService:t,index:r+1,key:e.src}))),n.createElement(ek,null),n.createElement(QE,{label:"Other…",value:Qn.AddToPlaylist,key:Qn.AddToPlaylist}))}function ak({playlist:e,itemsByService:t,index:r}){var i;const a=Jf(e),s=(null===(i=t.find((e=>e.service===a)))||void 0===i?void 0:i.items)||[];return a?n.createElement(QE,{label:n.createElement(wr,{icon:a.icon,text:`${e.title} (${s.length})`}),value:`add-to-recent-playlist-${r}`}):null}var sk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ok=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function lk(e,t,r,i,a="left"){return sk(this,void 0,void 0,(function*(){return rk((r=>n.createElement(ck,Object.assign({},r,{items:e,isContextMenu:t}))),r,i,a)}))}function ck(e){var{items:t,isContextMenu:r}=e,i=ok(e,["items","isContextMenu"]);const a=t[0],s=1===t.length&&!!a,o=t.every((e=>e.itemType===Zn.Media||e.itemType===Zn.Album));return n.createElement(GE,Object.assign({},i),o?n.createElement(uk,null):null,r&&s?n.createElement(dk,{item:a}):null,n.createElement(ik,{items:t}),n.createElement(ek,null),s?n.createElement(QE,{label:"Info…",value:Qn.Info,acceleratorKey:`${j.ctrlKeyStr}+I`,key:Qn.Info}):null)}function uk(){return n.createElement(n.Fragment,null,n.createElement(QE,{label:"Queue",value:Qn.Queue,acceleratorKey:"Enter",key:Qn.Queue}),n.createElement(QE,{label:"Play next",value:Qn.PlayNext,acceleratorKey:"Shift+Enter",key:Qn.PlayNext}),n.createElement(QE,{label:"Play now",value:Qn.PlayNow,acceleratorKey:`${j.ctrlKeyStr}+Enter`,key:Qn.PlayNow}),n.createElement(ek,null))}function dk({item:e}){const t=Jf(e);return n.createElement(n.Fragment,null,e.itemType===Zn.Playlist&&(null==t?void 0:t.createSourceFromPin)?n.createElement(QE,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?Qn.Unpin:Qn.Pin,key:e.isPinned?Qn.Unpin:Qn.Pin}):null,void 0!==e.rating&&(null==t?void 0:t.canRate(e,!0))?n.createElement(QE,{label:e.rating?US(t,Qn.Unlike):US(t,Qn.Like),value:e.rating?Qn.Unlike:Qn.Like,key:e.rating?Qn.Unlike:Qn.Like}):null,!1===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(QE,{label:US(t,Qn.AddToLibrary),value:Qn.AddToLibrary,key:Qn.AddToLibrary}):null,"apple"!==(null==t?void 0:t.id)&&!0===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(QE,{label:US(t,Qn.RemoveFromLibrary),value:Qn.RemoveFromLibrary,key:Qn.RemoveFromLibrary}):null,n.createElement(ek,null))}function mk({value:e=0,tabIndex:t=0,onChange:r}){const[i,a]=(0,n.useState)((()=>Math.max(e-1,0))),[s,o]=(0,n.useState)(-1),[l,c]=(0,n.useState)(!1),u=(0,n.useCallback)((t=>{switch(t.key){case"ArrowLeft":if(0===i&&1===e)null==r||r(0);else if(i>0){const e=i-1;a(e),null==r||r(e+1)}break;case"ArrowRight":if(0===i&&0===e)null==r||r(1);else if(i<4){const e=i+1;a(e),null==r||r(e+1)}}}),[i,e,r]);return n.createElement("div",{className:"star-rating",tabIndex:t,onKeyDown:u,onMouseDown:E,onMouseUp:w,onMouseLeave:()=>o(-1)},n.createElement("button",{className:"star-rating-button "+(0===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(0),1===e?(c(!0),null==r||r(0)):null==r||r(1)},onMouseEnter:()=>{o(0),c(!1)}},-1===s&&e>0||0===s&&!l||s>0?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(1===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(1),2===e?null==r||r(1):null==r||r(2)},onMouseEnter:()=>o(1)},-1===s&&e>1||s>=1?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(2===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(2),3===e?null==r||r(2):null==r||r(3)},onMouseEnter:()=>o(2)},-1===s&&e>2||s>=2?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(3===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(3),4===e?null==r||r(3):null==r||r(4)},onMouseEnter:()=>o(3)},-1===s&&e>3||s>=3?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(4===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(4),5===e?null==r||r(4):null==r||r(5)},onMouseEnter:()=>o(4)},-1===s&&e>4||4===s?"★":"☆"))}class hk extends AnalyserNode{constructor(e,t){super(e,t),this.isPlayingSpotify=!1,Ew().subscribe((({currentItem:e})=>{this.isPlayingSpotify=!!(null==e?void 0:e.src.startsWith("spotify:"))}))}getByteFrequencyData(e){this.isPlayingSpotify?Nw.getByteFrequencyData(e):super.getByteFrequencyData(e)}getFloatFrequencyData(e){this.isPlayingSpotify?Nw.getFloatFrequencyData(e):super.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.isPlayingSpotify?Nw.getByteTimeDomainData(e):super.getByteTimeDomainData(e)}getFloatTimeDomainData(e){this.isPlayingSpotify?Nw.getFloatTimeDomainData(e):super.getFloatTimeDomainData(e)}}class fk extends AudioContext{createAnalyser(){return new hk(this)}}var pk,yk,vk,bk,gk=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},wk=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const Ek=new H("audio");pk=new WeakMap,yk=new WeakMap,vk=new WeakMap,bk=new WeakMap;const kk=new class{constructor(){this.ready$=new it(!1),this.sourceNodes=new WeakMap,this.sourceNode$=new it(void 0),pk.set(this,void 0),yk.set(this,void 0),vk.set(this,void 0),bk.set(this,1),this.streamingSupported="safari"!==j.name,gw().pipe(at((()=>{const e=new fk;gk(this,pk,e,"f"),gk(this,yk,e.createDelay(),"f"),gk(this,vk,e.createGain(),"f"),wk(this,vk,"f").gain.value=wk(this,bk,"f"),wk(this,yk,"f").connect(wk(this,vk,"f")),wk(this,vk,"f").connect(e.destination),this.ready$.next(!0)}))).subscribe(Ek),Ew().pipe(Be((e=>e.currentItem)),_e(l),Be((e=>this.getSourceNode(e)))).subscribe(this.sourceNode$),this.observeReady().pipe(an((()=>this.sourceNode$)),_n(),De((function(e,t){var r,n=!1;e.subscribe(Re(t,(function(e){var i=r;r=e,n&&t.next([i,e]),n=!0})))})),at((([e,t])=>{null==e||e.disconnect(wk(this,yk,"f")),null==t||t.connect(wk(this,yk,"f"))}))).subscribe(Ek)}get context(){return wk(this,pk,"f")}get source(){return wk(this,yk,"f")}get volume(){return wk(this,bk,"f")}set volume(e){gk(this,bk,e,"f"),wk(this,vk,"f")&&(wk(this,vk,"f").gain.value=e)}observeReady(){return this.ready$.pipe(_e((e=>e)),ji(1),Be((()=>this)))}getSourceNode(e){const t=this.getAudioElement(e);if(t){if(!this.sourceNodes.has(t)){const e=this.context.createMediaElementSource(t);this.sourceNodes.set(t,e)}return this.sourceNodes.get(t)}}getAudioElement(e){if(this.canUseWebAudio(e)){const t=this.getAudioElementId(e);if(t)return document.querySelector(`audio#${t}`)}return null}canUseWebAudio(e){return e.mediaType===ti.Audio&&e.playbackType!==Nn.IFrame&&(this.streamingSupported||!this.isStreamed(e))}getAudioElementId(e){if(e.src.startsWith("apple:"))return"apple-music-player";switch(e.playbackType){case Nn.DASH:return"ampcast-audio-dash";case Nn.HLS:return"ampcast-audio-hls";default:return"ampcast-audio-main"}}isStreamed(e){if(e.src.startsWith("apple:"))return!0;switch(e.playbackType){case Nn.DASH:case Nn.HLS:return!0;default:return!1}}},xk=new H("visualizerPlayer"),Sk=new dv("visualizer-player",(function(e){return function(e){var t;return null===(t=Ww(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));Sk.loop=!0,Sk.muted=!0,Sk.volume=.07,Sk.observeError().subscribe(xk.error),kk.observeReady().pipe(at((e=>Sk.registerPlayers(Kw().map((t=>t.createPlayer(e))))))).subscribe(xk);const Tk=Sk;var Pk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Ak extends Hy{constructor(e,t="hls"){super(e,t),this.maxFatalErrors=3,this.hasNativeSupport=!1,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.errorCount=0,(this.element.canPlayType("application/x-mpegURL").replace("no","")||this.element.canPlayType("application/vnd.apple.mpegURL").replace("no",""))&&(this.logger.log("Using native HLS."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||kk.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||kk.streamingSupported||(this.element.volume=e)}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0,this.loadedSrc&&(this.loadedSrc="",this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src")))}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return Pk(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);this.loadedSrc!==t&&(this.player.stopLoad(),this.player.detachMedia(),this.element.removeAttribute("src"),this.player.loadSource(t),this.player.attachMedia(this.element),this.loadedSrc=t)}this.errorCount=0,yield this.element.play()}catch(e){this.error$.next(e)}}))}loadScript(){return Pk(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield r.e(817).then(r.bind(r,3041));this.scriptLoading=!1,this.scriptLoaded=!0,e.isSupported()&&(this.player=new e,this.player.on(e.Events.ERROR,((t,r)=>{r.fatal?r.type===e.ErrorTypes.MEDIA_ERROR&&this.errorCount<this.maxFatalErrors?(this.errorCount++,this.logger.warn("Fatal media error encountered, trying to recover..."),this.player.recoverMediaError()):this.error$.next(r):this.errorCount<this.maxFatalErrors&&(this.logger.warn("Non-fatal media error:"),this.logger.warn(r))}))),this.autoplay&&this.item&&this.safePlay(this.item)}))}}var Ik,Ck,Mk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ok=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},$k=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const Nk=new H("MusicKitPlayer"),zk="Apple Music player not connected";Ik=new WeakMap,Ck=new WeakMap;const jk=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new it(!0),this.duration$=new Ne,this.currentTime$=new Ne,this.ended$=new Ne,this.playing$=new Ne,this.error$=new Ne,this.playerLoaded$=new Ne,this.playerActivated$=new it(!1),this.src$=new it(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,Ik.set(this,!0),Ck.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.hasPlayed&&this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(_e((e=>e)),at((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;this.synchVolume(),e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),this.playerLoaded$.next(void 0)})),ji(1)).subscribe(Nk),this.observeReady().pipe(an((()=>this.observeIsLoggedIn())),an((e=>e?this.observePaused():rn)),an((e=>e?rn:this.observeSrc())),an((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(this.getUnplayableReason(e))),rn;const[,t,r]=e.split(":"),n=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return Zr(this.player.setQueue({[n]:r})).pipe(an((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():rn))),Un((e=>(this.loadedSrc="",this.error$.next(e),rn))))}return rn}))).subscribe(Nk),this.observeIsLoggedIn().pipe(On((e=>e===this.isLoggedIn)),at((e=>{var t;this.isLoggedIn=e,e||(this.loadedSrc="",this.paused&&!(null===(t=this.player)||void 0===t?void 0:t.isPlaying)||(this.stop(),this.error$.next(Error(zk))))}))).subscribe(Nk),this.observeError().subscribe(Nk.error),this.observeError().pipe(_e((()=>{var e;return!1===(null===(e=this.player)||void 0===e?void 0:e.isAuthorized)})),an((()=>Oi())),Un((()=>rn))).subscribe(Nk)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return Ok(this,Ik,"f")}set muted(e){$k(this,Ik,e,"f"),this.synchVolume()}get volume(){return Ok(this,Ck,"f")}set volume(e){$k(this,Ck,e,"f"),this.synchVolume()}observeCurrentTime(){return this.currentTime$.pipe(_n())}observeDuration(){return this.duration$.pipe(_n())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load({src:e}){Nk.log("load",{src:e}),this.autoplay&&this.playerActivated$.next(!0),this.src$.next(e),this.synchVolume(),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(this.getUnplayableReason(e)))):this.autoplay&&this.error$.next(Error(zk))}play(){Nk.log("play"),this.playerActivated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(this.getUnplayableReason(this.src))):this.isLoggedIn||this.error$.next(Error(zk))}pause(){var e;Nk.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){Nk.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(_n())}observeReady(){return this.playerLoaded$.pipe(an((()=>this.playerActivated$)),_e((e=>e)),Be((()=>{})),ji(1))}observeSrc(){return this.src$.pipe(_n())}canPlay(e){return!this.getUnplayableReason(e)}getUnplayableReason(e){var t;const[,r]=e.split(":");return/video/i.test(r)&&(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))?"Video playback not supported":""}safePlay(){var e,t,r,n,i;return t=this,r=void 0,i=function*(){try{this.src&&this.src===this.loadedSrc&&!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed||(this.hasPlayed=!0,this.player.isPlaying&&this.playing$.next(void 0)))}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}))}synchVolume(){if(this.player){const[,e]=this.src.split(":");this.player.volume=!kk.streamingSupported||/video/i.test(e)?this.muted?0:this.volume:1}}}(Ci()),Lk=new class extends Hy{constructor(e,t="shaka"){super(e,t),this.hasNativeSupport=!1,this.shaka=null,this.player=null,this.loadedSrc="",this.scriptLoading=!1,this.scriptLoaded=!1,this.hasPlayed=!1,this.onError=e=>{this.error$.next(e)},this.element.canPlayType("application/dash+xml").replace("no","")&&(this.logger.log("Using native DASH."),this.hasNativeSupport=!0)}set muted(e){super.muted=e,"audio"!==this.type||kk.streamingSupported||(this.element.muted=e)}set volume(e){super.volume=e,"audio"!==this.type||kk.streamingSupported||(this.element.volume=e)}observePlaying(){return super.observePlaying().pipe(_e((()=>this.hasPlayed)))}load(e){this.hasNativeSupport?super.load(e):(this.logger.log("load"),this.item=e,this.loadScript(),this.autoplay&&this.safePlay(e))}stop(){this.stopped=!0,this.hasNativeSupport?super.stop():(this.logger.log("stop"),this.element.pause(),this.element.currentTime=0)}safePlay(e){const t=Object.create(null,{safePlay:{get:()=>super.safePlay}});return Mk(this,void 0,void 0,(function*(){if(this.stopped=!1,this.hasNativeSupport)t.safePlay.call(this,e);else try{if(!e)throw Error("Player not loaded");if(!this.scriptLoaded)return void this.loadScript();if(!this.player)throw Error(`Unsupported ${this.type} format`);{const t=this.getMediaSrc(e);if(this.loadedSrc!==t){this.loadedSrc&&(yield this.recreatePlayer());const r=this.getDrmConfig(e),n=this.getStreamingConfig();this.player.configure({drm:r,streaming:n}),yield this.player.load(t),this.loadedSrc=t}}this.autoplay&&this.item===e&&(yield this.element.play(),this.hasPlayed||this.item!==e||(this.hasPlayed=!0,this.playing$.next(void 0)))}catch(t){"AbortError"===t.name||this.item!==e?this.logger.warn(t):this.error$.next(t)}}))}getDrmConfig(e){var t;if(e){const r={},n=Jf(e),i=null===(t=null==n?void 0:n.getDrmInfo)||void 0===t?void 0:t.call(n,e);return i&&(r.servers={[i.keySystem]:i.license},"fairplay"===i.type&&(r.advanced={[i.keySystem]:{serverCertificateUri:i.certificate}},r.initDataTransform=(e,t,r)=>{if("skd"!==t)return e;const n=this.shaka.util,i=n.StringUtils.fromBytesAutoDetect(e).replace("skd://","");return n.FairPlayUtils.initDataTransform(e,i,r.serverCertificate)})),r}throw Error("No playable item")}getStreamingConfig(){return{bufferingGoal:10,jumpLargeGaps:!0,retryParameters:{maxAttempts:1/0,timeout:1e4},stallSkip:.1}}loadScript(){return Mk(this,void 0,void 0,(function*(){if(this.scriptLoading||this.scriptLoaded)return;this.scriptLoading=!0;const{default:e}=yield r.e(795).then(r.t.bind(r,1123,23));this.scriptLoading=!1,this.scriptLoaded=!0,e.polyfill.installAll(),e.Player.isBrowserSupported()&&(this.shaka=e,this.player=new e.Player,yield this.player.attach(this.element),this.player.addEventListener("error",this.onError)),this.autoplay&&this.item&&this.safePlay(this.item)}))}recreatePlayer(){var e,t,r;return Mk(this,void 0,void 0,(function*(){const{hidden:n,loop:i,muted:a,volume:s}=this.element,o=this.element.cloneNode();o.removeAttribute("src"),Object.assign(o,{hidden:n,loop:i,muted:a,volume:s}),null===(e=this.player)||void 0===e||e.removeEventListener("error",this.onError),yield null===(t=this.player)||void 0===t?void 0:t.unload(),yield null===(r=this.player)||void 0===r?void 0:r.destroy(),this.player=new this.shaka.Player,yield this.player.attach(o),this.player.addEventListener("error",this.onError),this.loadedSrc="",this.hasPlayed=!1,this.element.replaceWith(o),this.element$.next(o)}))}}("audio","dash"),Dk=new Ak("audio","hls"),Rk=new Ak("video","hls"),Fk=new Hy("audio","main"),_k=new Hy("video","main"),Bk=new tv("main"),Vk=new dv("media-player",(function(e){if(!e)return null;if(e.src.startsWith("youtube:"))return Bk;if(e.src.startsWith("apple:"))return jk;if(e.src.startsWith("spotify:"))return sf;{const t=e.mediaType===ti.Video;switch(e.playbackType){case Nn.DASH:return t?_k:Lk;case Nn.HLS:return t?Rk:Dk;default:return t?_k:Fk}}}),(function(e,t){e.load(function(e){if(e){if(e.unplayable)throw Error("Unplayable");return e.blob?{src:URL.createObjectURL(e.blob)}:e}throw Error("No source")}(t))}),kk);Vk.registerPlayers([Lk,Dk,Rk,Fk,_k,Bk,jk,sf]);const Uk=Vk;var Hk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Yk=new H("embyReporting");function qk(e,t,r,n,i){return Hk(this,void 0,void 0,(function*(){try{const[,,a]=e.src.split(":");yield ja.post("Sessions/Playing/Progress",{ItemId:a,IsPaused:r,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:n},i)}catch(e){Yk.error(e)}}))}function Kk(e,t){const r=new H(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(an((e=>e?Ew():rn)),_e(n),et((({currentItem:e})=>function(e,t){return Hk(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield ja.post("Sessions/Playing",{ItemId:r,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"},t)}catch(e){Yk.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(an((e=>e?kw():rn)),_e(n),et((({currentItem:e,currentTime:r})=>function(e,t,r){return Hk(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");if(yield ja.post("Sessions/Playing/Stopped",{ItemId:n,IsPaused:!1,PositionTicks:Math.floor(1e7*t)},r),e.mediaType===ti.Video){const{deviceId:t,sessionId:n}=r,[,,i]=e.src.split(":");yield ja.delete("Videos/ActiveEncodings",{DeviceId:t,PlaySessionId:`${n}-${i}`},r)}}catch(e){Yk.error(e)}}))}(e,r,t)))).subscribe(r),e.observeIsLoggedIn().pipe(an((e=>e?xw(1e4):rn)),_e(n),_e((({currentTime:e})=>e>0)),et((({currentItem:e,currentTime:r,paused:n})=>qk(e,r,n,"timeupdate",t)))).subscribe(r),e.observeIsLoggedIn().pipe(an((e=>e?Ew():rn)),an((e=>n(e)?ww().pipe(_n(((e,t)=>e.paused===t.paused)),Kh(1),sn(kw())):rn)),et((({currentItem:e,currentTime:r,paused:n})=>qk(e,r,n,n?"pause":"unpause",t)))).subscribe(r)}Kk(ys,xa),Kk(to,xs);const Wk=new H("lastfmScrobbler");function Gk(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=Jf(e);return!t||Sy.canScrobble(No,t)}return!1}xo().pipe(an((e=>e?Ew():rn)),_e((()=>Sy.canUpdateNowPlaying(No))),Be((({currentItem:e})=>e)),_e(l),_e((e=>Gk(e))),et((e=>yo.updateNowPlaying(e)))).subscribe(Wk),xo().pipe(an((e=>e?Vo():rn)),Be((e=>e.filter((e=>!e.lastfmScrobbledAt)))),vv(1e4),et((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new Po({from:r-30,to:t+30,limit:Po.maxPageSize}),i=yield di(n),a=i.map((e=>Yo(e,30))),[s,o]=m(e,(e=>!Gk(e)||a.includes(Yo(e,30))||!!qo(i,e)));if(yield Ho(s.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield yo.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Ho(o.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){Wk.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(Wk);const Jk=new H("listenbrainzScrobbler");function Qk(e){var t;if(!e.noScrobble&&e.title&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30){const t=Jf(e);return!t||Sy.canScrobble(cu,t)}return!1}ic().pipe(an((e=>e?Ew():rn)),_e((()=>Sy.canUpdateNowPlaying(cu))),Be((({currentItem:e})=>e)),_e(l),_e((e=>Qk(e))),et((e=>Wl.updateNowPlaying(e)))).subscribe(Jk),ic().pipe(an((e=>e?Vo():rn)),Be((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),vv(1e4),et((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new Hc({min_ts:r-30,max_ts:t+30,count:Hc.maxPageSize}),i=yield di(n),a=i.map((e=>Yo(e,30))),[s,o]=m(e,(e=>!Qk(e)||a.includes(Yo(e,30))||!!qo(i,e)));if(yield Ho(s.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield Wl.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Ho(o.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){Jk.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(Jk);var Xk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Zk=new H("subsonicReporting");function ex(e,t){const r=new H(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(an((e=>e?Ew():rn)),_e(n),et((({currentItem:e})=>function(e,t){return Xk(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield Su.scrobble({id:r,submission:!1},t)}catch(e){Zk.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(an((e=>e?kw():rn)),_e(n),et((({currentItem:e,startedAt:r})=>function(e,t,r){return Xk(this,void 0,void 0,(function*(){try{if(Uo(e.duration,t,Date.now())){const[,,n]=e.src.split(":");yield Su.scrobble({id:n,time:t,submission:!0},r)}}catch(e){Zk.error(e)}}))}(e,r,t)))).subscribe(r)}ex(od,Pu);var tx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const rx=new H("plexReporting");let nx="";function ix(e,t,r){return tx(this,void 0,void 0,(function*(){try{yield ax(e,t,r)}catch(e){rx.error(e)}}))}function ax(e,t,r,n){return tx(this,void 0,void 0,(function*(){nx||rx.warn("reportState: `playQueueItemID` not defined",{state:r});const[i,,a]=e.src.split(":"),s="plex-tidal"===i;yield Ld.fetch({host:s?xd:void 0,path:s?"/timeline":"/:/timeline",params:{key:`/library/metadata/${a}`,ratingKey:a,playQueueItemID:nx,state:r,time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:n})}))}const sx=new H("plexScrobbler"),ox=e=>{var t;return/^(plex(-tidal)?):/.test(null===(t=e.currentItem)||void 0===t?void 0:t.src)};Hd().pipe(an((e=>e?Ew():rn)),_e(ox),et((({currentItem:e})=>function(e){return tx(this,void 0,void 0,(function*(){try{nx="",nx=yield function(e){return tx(this,void 0,void 0,(function*(){const[t,,r]=e.src.split(":"),n=`/library/metadata/${r}`,i="plex-tidal"===t,{MediaContainer:a}=yield Ld.fetchJSON({host:i?"https://play.provider.plex.tv":void 0,path:"/playQueues",method:"POST",params:{key:n,type:"music",uri:i?`provider://tv.plex.provider.music${n}`:`server://${pd.serverId}/com.plexapp.plugins.library${n}`,continuous:"0",repeat:"0",own:"1"}});return String(a.playQueueSelectedItemID)}))}(e),yield ax(e,0,"playing")}catch(e){rx.error(e)}}))}(e)))).subscribe(sx),Hd().pipe(an((e=>e?kw():rn)),_e(ox),et((({currentItem:e})=>function(e){return tx(this,void 0,void 0,(function*(){try{yield ax(e,0,"stopped",!0)}catch(e){rx.error(e)}}))}(e)))).subscribe(sx),Hd().pipe(an((e=>e?xw(1e4):rn)),_e(ox),_e((({currentTime:e})=>e>0)),et((({currentItem:e,currentTime:t,paused:r})=>ix(e,t,r?"paused":"playing")))).subscribe(sx),Hd().pipe(an((e=>e?Ew():rn)),an((e=>ox(e)?ww().pipe(_n(((e,t)=>e.paused===t.paused)),Kh(1),sn(kw())):rn)),et((({currentItem:e,currentTime:t,paused:r})=>ix(e,t,r?"paused":"playing")))).subscribe(sx),ex(zf,pu);const lx=new H("mediaPlayback/scrobbler");kw().pipe(et((e=>function(e){return Lo(this,void 0,void 0,(function*(){try{let t=e.currentItem;if(!t||!e.startedAt||!e.endedAt)throw Error("Invalid playback state");if(Uo(t.duration,e.startedAt,e.endedAt)){try{t=yield $l(t,!0)}catch(e){Do.error(e)}const{id:r,lookupStatus:n,blob:i}=t,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["id","lookupStatus","blob"]);Do.log("add",{listen:a}),yield Bo.items.add(Object.assign(Object.assign({},a),{playedAt:Math.floor(e.startedAt/1e3),lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}catch(e){Do.error(e)}}))}(e)))).subscribe(lx);const cx=new H("mediaPlayback"),ux=new J("mediaPlayback"),dx=new J("mediaPlayback","session"),mx=new it(!0),hx=new Ne;let fx="forward";function px(){return yw.observeCurrentItem()}function yx(){return Iw.observeCurrentTime()}function vx(){return Iw.observeDuration()}function bx(){return Uk.observeEnded()}function gx(){return Uk.observeError()}function wx(){return Iw.observePaused()}function Ex(){return Iw.observePlaybackStart()}function kx(){return Iw.observePlaybackEnd()}function xx(){return Uk.observePlaying()}function Sx(e){cx.log("load",{item:e}),Uk.autoplay&&Iw.ready(),Uk.load(e),Uk.autoplay&&Iw.play()}function Tx(){cx.log("play"),Iw.ready(),fx="forward",zx(),Iw.play(),Iw.paused||(Uk.play(),Tk.play())}function Px(){cx.log("pause"),Lx.stopAfterCurrent=!1,zx(),Iw.pause(),Uk.pause(),Tk.pause()}function Ax(e){cx.log("seek",{time:b(e)}),Uk.seek(e)}function Ix(){cx.log("stop"),Lx.stopAfterCurrent=!1,zx(),Iw.stop(),Uk.stop(),Tk.stop()}function Cx(){cx.log("prev"),fx="backward",yw.atStart||(Lx.stopAfterCurrent=!1,Nx(),yw.prev())}function Mx(){cx.log("next"),fx="forward",yw.atEnd||(Lx.stopAfterCurrent=!1,Nx(),yw.next())}function Ox(){Lx.stopAfterCurrent=!1,Nx(),yw.eject()}function $x(){return Rn([yw.observeCurrentIndex(),yw.observeSize()]).pipe(Be((([e,t])=>e===t-1)),_n())}function Nx(){Iw.paused||!1!==mx.getValue()||(Iw.stop(),Uk.stop(),Iw.play()),mx.next(!0)}function zx(){mx.next(!1)}function jx(e){return t=this,r=void 0,i=function*(){if(!Qf(e)){const t=yield function(e){return xl(this,void 0,void 0,(function*(){if(!e)return;if(Qf(e))return e;const t=Pl.current;return(null==t?void 0:t.item.id)===e.id?t.promise:new Pl(e).find()}))}(e);if(!t)return e;e=Object.assign(Object.assign({},e),t)}if(void 0===e.playbackType){const t=yield function(e){return t=this,r=void 0,i=function*(){let t=e.playbackType;if(void 0===t){const r=Jf(e);t=(null==r?void 0:r.getPlaybackType)?yield r.getPlaybackType(e):Nn.Direct,Yn({match:t=>t.src===e.src,values:{playbackType:t}})}return t},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e);e=Object.assign(Object.assign({},e),{playbackType:t})}return e},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}const Lx={stopAfterCurrent:!1,get autoplay(){return Uk.autoplay},set autoplay(e){Uk.autoplay=e,Tk.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return Uk.muted},set muted(e){dx.setBoolean("muted",e),Uk.muted=e},get paused(){return Iw.paused},get volume(){return Uk.volume},set volume(e){ux.setNumber("volume",e),Uk.volume=e},observeCurrentItem:px,observeCurrentTime:yx,observeDuration:vx,observeEnded:bx,observeError:gx,observePaused:wx,observePlaying:xx,observePlaybackStart:Ex,observePlaybackEnd:kx,observePlaybackProgress:function(e){return Iw.observePlaybackProgress(e)},observePlaybackState:function(){return Iw.observePlaybackState()},appendTo:function(e){Uk.appendTo(e),Tk.appendTo(e)},load:Sx,play:Tx,pause:Px,stop:Ix,seek:Ax,resize:function(e,t){Uk.resize(e,t),Tk.resize(e,t)},next:Mx,prev:Cx,shuffle:function(e){yw.shuffle(e)}},Dx=Lx;Lx.muted=dx.getBoolean("muted"),Lx.volume=ux.getNumber("volume",1),Uk.observeCurrentTime().subscribe((e=>Iw.setCurrentTime(e))),Uk.observeDuration().subscribe((e=>Iw.setDuration(e))),Uk.observePlaying().subscribe((()=>Iw.started())),Uk.observeEnded().subscribe((()=>Iw.ended())),Uk.observePlaying().subscribe((()=>fx="forward")),Uk.observeEnded().pipe(qh($x()),sn(hx)).subscribe((([,e])=>{e||Lx.stopAfterCurrent?Ix():yw.next()})),Uk.observeError().pipe(vv(2e3),qh(wx(),yw.observeCurrentIndex().pipe(Be((e=>0===e)),_n()),$x()),sn(hx)).subscribe((([,e,t,r])=>{e||(r||t&&"backward"===fx?Ix():"backward"===fx?yw.prev():yw.next())})),yw.observeSize().pipe(Be((e=>0===e)),_n(),On((e=>e)),_e((e=>e))).subscribe(Ix),px().pipe(an((e=>0===(null==e?void 0:e.duration)?vx().pipe(_e((e=>0!==e)),ji(1),at((t=>Yn({match:t=>t.src===e.src,values:{duration:t}})))):rn))).subscribe(cx),mx.pipe(vv(300),_e((e=>e))).subscribe((()=>{Lx.autoplay=!Iw.paused,mx.next(!1)})),mx.pipe(_n(),an((e=>e?rn:px())),_n(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),an((e=>e?jx(e):hn(null))),On((e=>!e)),at(Sx)).subscribe(cx),yw.observeNextItem().pipe(_n(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),vv(3e3),Vn((e=>e?jx(e):hn(null)))).subscribe(cx),Hr(window,"pagehide").subscribe((function(){hx.next(void 0),Ix()})),gw().subscribe(cx.rx("playbackReady")),Ex().subscribe(cx.rx("playbackStart")),kx().subscribe(cx.rx("playbackEnd")),xx().subscribe(cx.rx("playing")),bx().subscribe(cx.rx("ended")),gx().subscribe(cx.error),vx().pipe(On((e=>!e)),Be(b),_n()).subscribe(cx.rx("duration")),yx().pipe(_e((e=>Math.round(e)%30==0)),Be(b)).subscribe(cx.rx("currentTime"));var Rx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Fx=new H("musicbrainz/coverart");class _x extends Bt.ZP{constructor(){super("ampcast/musicbrainz/coverart"),this.version(2).stores({items:"&mbid, [album+artist], thumbnails"})}}const Bx=new _x;function Vx(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}var Ux=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Hx=new H("CoverArt");function Yx({item:e,size:t,className:r="",onLoad:i,onError:a}){const[s,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)((()=>e.thumbnails)),u=!!(null==l?void 0:l.length),d=u?function(e,t=240){if(1===e.length)return e[0];let r=e.filter((e=>Wx(e)<1.34));return 0===r.length&&(r=e.filter((e=>Wx(e)<1.5)),0===r.length&&(r=e)),t*=window.devicePixelRatio||1,r.sort(((e,r)=>Math.abs(e.height-t)-Math.abs(r.height-t))),r[0]}(l,t):void 0,m=d?qx(d):"",h=function(e){switch(e.itemType){case Zn.Artist:return"artist";case Zn.Album:{const t=Kx(e);return t&&"audio"!==t?t:"album"}case Zn.Media:return e.mediaType===ti.Video?"video":"audio";case Zn.Playlist:return"playlist";case Zn.Folder:return"folder"}}(e),f=e.itemType===Zn.Album&&Kx(e);(0,n.useEffect)((()=>{o(!1),c(e.thumbnails)}),[e.thumbnails]),(0,n.useEffect)((()=>{var t;if(!u){if(e.itemType===Zn.Media){const r=Ko(e);if(null===(t=null==r?void 0:r.thumbnails)||void 0===t?void 0:t[0])return void c(r.thumbnails)}const r=Zr(function(e){var t,r;return Ux(this,void 0,void 0,(function*(){if(e.itemType===Zn.Media&&(null===(t=e.link)||void 0===t?void 0:t.externalUrl)){const t=sc()(null===(r=e.link)||void 0===r?void 0:r.externalUrl);if(t)try{return(yield Fc(t)).thumbnails}catch(e){return void Hx.error(e)}}return function(e){var t;return Rx(this,void 0,void 0,(function*(){if(!e||e.itemType!==Zn.Album&&e.itemType!==Zn.Media)return;let r=!1;const n=e.release_mbid;if(n){const e=yield Bx.items.get(n);if(r=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===Zn.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield Bx.items.get({album:i,artist:a});if(e)return e.thumbnails}if(n&&!r)try{const e=yield function(e){return Rx(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(n),t=e.images.filter((e=>e.front&&e.approved))[0],r=t?Object.keys(t.thumbnails).filter((e=>0!==Vx(e))).map((e=>({url:t.thumbnails[e],width:Vx(e),height:Vx(e)}))):[];return yield Bx.items.put(0===r.length?{mbid:n}:{mbid:n,album:i,artist:a,thumbnails:r}),r}catch(e){404===e.status?yield Bx.items.put({mbid:n}):Fx.error(e)}}))}(e)}))}(e)).subscribe((e=>{(null==e?void 0:e[0])?c(e):(o(!0),null==a||a())}));return()=>r.unsubscribe()}}),[u,e,a]);const p=(0,n.useCallback)((()=>{o(!0),null==a||a()}),[a]),y=(0,n.useCallback)((()=>{o(!1),null==i||i(m)}),[i,m]);return n.createElement("figure",{className:`cover-art ${r} ${f?"cover-art-"+f:""}`,key:e.src},m&&!s?n.createElement(n.Fragment,null,n.createElement("img",{className:"cover-art-image",src:m,alt:`${e.title}: Cover art`,onError:p,onLoad:y}),f?n.createElement("div",{className:"cover-art-icon-overlay"},n.createElement(rt,{className:"cover-art-icon",name:f})):null):h?n.createElement(rt,{className:"cover-art-image",name:h}):null)}function qx(e){return Bf().reduce(((e,t)=>{var r,n;return null!==(n=null===(r=null==t?void 0:t.getThumbnailUrl)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e}),(null==e?void 0:e.url)||"")}function Kx(e){if(!e.synthetic)return"";const[,t]=e.src.split(":");switch(t){case"top-tracks":return"star";case"videos":return"video";default:return"audio"}}function Wx({width:e,height:t}){return e/t}function Gx({className:e,children:t}){const r=(0,n.useRef)(null),[i,a]=(0,n.useState)(0),s=(0,n.useCallback)((({scrollHeight:e})=>a(e)),[]);return n.createElement("div",{className:`text-box ${e}`,style:{height:`${i}px`},ref:r},n.createElement("div",{style:{position:"relative",height:"100%"}},n.createElement(dn,{onResize:s},t)))}function Jx(e){const[t,r]=(0,n.useState)(e);return(0,n.useEffect)((()=>{null==t&&null!=e&&r(e)}),[t,e]),t}const Qx=new H("Media/useCurrentItem");var Xx=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Zx(e){const t=function(e){const[t,r]=(0,n.useState)(e),[i,a]=(0,n.useState)("");return(0,n.useEffect)((()=>{if(i!==e.src){const t=Jf(e);if(null==t?void 0:t.getMetadata){const n=Zr(t.getMetadata(e)).pipe(at((t=>{a(e.src),r(Object.assign(Object.assign({},e),t))}))).subscribe(Qx);return()=>n.unsubscribe()}a(e.src)}}),[e,i]),(0,n.useEffect)((()=>{const e=qn().pipe(at((e=>{for(const{match:n,values:i}of e)if(n(t)){r(Object.assign(Object.assign({},t),i));break}}))).subscribe(Qx);return()=>e.unsubscribe()}),[t]),t}(e.item),r=Jx(t);if(e.debug)return n.createElement(yS,{item:r});switch(t.itemType){case Zn.Media:return n.createElement(eS,{item:t});case Zn.Artist:return n.createElement(rS,{item:t});case Zn.Album:return n.createElement(tS,{item:t});case Zn.Playlist:return n.createElement(nS,{item:t});case Zn.Folder:return n.createElement(iS,{item:t})}}function eS({item:e}){var t;return n.createElement("article",{className:"media-info media-item-info"},n.createElement("div",{className:"media-info-main"},n.createElement(pS,{item:e}),n.createElement(aS,{title:e.title}),n.createElement(oS,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),n.createElement(uS,{album:e.album,year:e.year}),n.createElement(dS,{album:e.album,disc:e.disc,track:e.track}),n.createElement(lS,{owner:e.owner,src:e.src}),n.createElement(BS,{item:e})),n.createElement(sS,{description:e.description}),n.createElement(cS,{url:e.externalUrl,src:e.src}))}function tS({item:e}){return n.createElement("article",{className:"media-info album-info"},n.createElement("div",{className:"media-info-main"},n.createElement(pS,{item:e}),n.createElement(aS,{title:e.title}),n.createElement(oS,{artist:e.artist}),n.createElement(mS,{year:e.year}),n.createElement(BS,{item:e})),n.createElement(sS,{description:e.description}),n.createElement(cS,{url:e.externalUrl,src:e.src}))}function rS({item:e}){return n.createElement("article",{className:"media-info artist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(pS,{item:e}),n.createElement(aS,{title:e.title}),n.createElement(hS,{genres:e.genres}),n.createElement(fS,{country:e.country}),n.createElement(BS,{item:e})),n.createElement(sS,{description:e.description}),n.createElement(cS,{url:e.externalUrl,src:e.src}))}function nS({item:e}){return n.createElement("article",{className:"media-info playlist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(pS,{item:e}),n.createElement(aS,{title:e.title}),n.createElement(lS,{owner:e.owner,src:e.src}),n.createElement(hS,{genres:e.genres}),n.createElement(BS,{item:e})),n.createElement(sS,{description:e.description}),n.createElement(cS,{url:e.externalUrl,src:e.src}))}function iS({item:e}){return n.createElement("article",{className:"media-info folder-info"},n.createElement("div",{className:"media-info-main"},n.createElement(pS,{item:e}),n.createElement(aS,{title:e.title})))}function aS({title:e}){return n.createElement("h3",{className:"title"},e||"(no title)")}function sS({description:e}){const t=null==e?void 0:e.trim().split(/[\n\r]+/);return(null==t?void 0:t.length)?n.createElement(Gx,{className:"blurb"},t.map(((e,t)=>n.createElement("p",{key:t},e)))):null}function oS({artist:e}){return e?n.createElement("h4",{className:"artist"},n.createElement("span",{className:"by"},"By: "),e):null}function lS({src:e,owner:t}){if(!t||!t.name)return null;const[r]=e.split(":"),i="youtube"===r?"Channel":"Curator";return n.createElement("p",{className:"owner"},i,":"," ",t.url?n.createElement(Jl,{href:t.url},t.name):t.name)}function cS({src:e,url:t=""}){let[r]=e.split(":"),i=r;switch(r){case"musicbrainz":i="MusicBrainz";break;case"plex-tidal":i="Plex";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",r="musicbrainz"):i="ListenBrainz";break;case"blob":case"file":i="local file system";break;case"http":case"https":i="external source";break;default:{const e=Gf(r);e&&(i=e.name)}}return n.createElement("p",{className:"external-view"},n.createElement(rt,{name:r}),t?n.createElement(Jl,{href:t},"View on ",i):n.createElement("span",{className:"external-provider"},"Provided by ","plex-tidal"===r?"TIDAL":i))}function uS({album:e,year:t}){return e&&t?n.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?n.createElement("h4",{className:"album"},"From: ",e):t?n.createElement("h4",{className:"album"},"Year: ",t):null}function dS({album:e,disc:t=1,track:r}){return e&&r?n.createElement("p",{className:"track"},"Track: ",r,t>1?` (Disc ${t})`:""):null}function mS({year:e}){return e?n.createElement("p",{className:"year"},"Year: ",e):null}function hS({genres:e}){return e?n.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function fS({country:e}){return e?n.createElement("p",{className:"country"},"Country: ",e):null}function pS(e){return n.createElement("div",{className:"thumbnail"},n.createElement(Yx,Object.assign({},e)))}function yS(e){const t=e.item,{pager:r,parent:i}=t,a=Xx(t,["pager","parent"]);return n.createElement("article",{className:"media-info debug"},n.createElement("pre",null,JSON.stringify(a,void 0,2)),n.createElement(cS,{url:a.externalUrl,src:a.src}))}function vS(e){const[t,r]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=Hr(document,"keydown",{capture:!0}).subscribe((t=>{var n;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?r((e=>!e)):t[j.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(t.preventDefault(),null===(n=e.current)||void 0===n||n.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var bS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},gS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function wS(e){return bS(this,void 0,void 0,(function*(){yield cr((t=>n.createElement(ES,Object.assign({},t,{item:e}))))}))}function ES(e){var{item:t}=e,r=gS(e,["item"]);const i=(0,n.useRef)(null),{debug:a}=vS(i),s=function(e){switch(e.itemType){case Zn.Playlist:return"Playlist info";case Zn.Album:return"Album info";case Zn.Artist:return"Artist info";case Zn.Folder:return"Folder info";default:return"Media info"}}(t);return n.createElement(or,Object.assign({},r,{className:"media-info-dialog",title:s,ref:i}),n.createElement("form",{method:"dialog"},n.createElement(Zx,{item:t,debug:a}),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}var kS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const xS={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function SS(e){var{className:t="",layout:r=xS}=e,i=kS(e,["className","layout"]);return n.createElement(sT,Object.assign({},i,{className:`playlists ${t}`,layout:r}))}function TS(e,t){const[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const r=(null==e?void 0:e.search(t))||null;return i(r),()=>null==r?void 0:r.disconnect()}),[e,t]),r}var PS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},AS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const IS={view:"card minimal",fields:["Thumbnail","Title","TrackCount"]};function CS(e){var{items:t}=e,r=AS(e,["items"]);const i=(0,n.useId)(),a=(0,n.useRef)(null),s=nk(t),[o,l]=(0,n.useState)(null),c=TS((null==(u=o)?void 0:u.editablePlaylists)||null);var u;const[d,m]=(0,n.useState)(null),h=t.length;(0,n.useEffect)((()=>{l((e=>{var t;return e||(null===(t=s[0])||void 0===t?void 0:t.service)||null}))}),[s]);const f=(0,n.useCallback)((()=>PS(this,void 0,void 0,(function*(){if((null==o?void 0:o.addToPlaylist)&&d){const e=s.find((e=>e.service===o)),t=null==e?void 0:e.items;try{yield o.addToPlaylist(d,t),qE(d)}catch(e){console.error(e),yield kr("An error occurred while updating your playlist.")}}}))),[o,d,s]),p=(0,n.useCallback)((()=>{const e=Gf(a.current.value);l(e)}),[]),y=(0,n.useCallback)((([e])=>{m(e)}),[]);return n.createElement(or,Object.assign({},r,{className:`add-to-playlist-dialog service-${(null==o?void 0:o.id)||""}`,title:"Add to playlist"}),n.createElement("form",{method:"dialog",onSubmit:f},n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-service`},"Save to:"),n.createElement("select",{id:`${i}-service`,required:!0,onChange:p,ref:a},s.map((({service:e,items:t})=>n.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",h,")"))))),n.createElement(SS,{title:o?`${null==o?void 0:o.name}: Playlists`:"",pager:c,layout:IS,onContextMenu:()=>{},onSelect:y}),n.createElement(fr,{submitText:"Add",disabled:!d})))}var MS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},OS=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function $S(e){return MS(this,void 0,void 0,(function*(){yield cr((t=>n.createElement(NS,Object.assign({},t,{items:e}))))}))}function NS(e){var{items:t}=e,r=OS(e,["items"]);const i=(0,n.useId)(),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=nk(t),[u,d]=(0,n.useState)((()=>{var e;return null===(e=c[0])||void 0===e?void 0:e.service.id})),m=t.length,h=(0,n.useCallback)((()=>MS(this,void 0,void 0,(function*(){const e=Gf(a.current.value);if(null==e?void 0:e.createPlaylist){const t=s.current.value,r=o.current.value,i=l.current.checked,a=c.find((t=>t.service===e)),u=null==a?void 0:a.items;try{const a=yield e.createPlaylist(t,{description:r,isPublic:i,items:u});yield mr({title:n.createElement(wr,{icon:e.id,text:e.name}),message:"Your playlist has been created."}),qE(a)}catch(e){console.error(e),yield kr("An error occurred while creating your playlist.")}}}))),[c]),f=(0,n.useCallback)((()=>{const e=a.current.value;d(e)}),[]);return n.createElement(or,Object.assign({},r,{className:`create-playlist-dialog service-${u||""}`,title:"Create Playlist"}),n.createElement("form",{method:"dialog",onSubmit:h},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-service`},"Save to:"),n.createElement("select",{id:`${i}-service`,required:!0,onChange:f,ref:a},c.map((({service:e,items:t})=>n.createElement("option",{value:e.id,key:e.id},e.name," (",t.length,"/",m,")"))))),n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-name`},"Name:"),n.createElement("input",{type:"text",id:`${i}-name`,required:!0,ref:s})),n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-description`},"Description:"),n.createElement("textarea",{id:`${i}-description`,rows:2,cols:40,ref:o})),n.createElement("p",{className:"save-playlist-dialog-public"},n.createElement("label",{htmlFor:`${i}-public`},"Public:"),n.createElement("input",{type:"checkbox",id:`${i}-public`,ref:l,disabled:zS(u)}))),n.createElement(fr,{submitText:"Save"})))}function zS(e){switch(e){case"emby":case"jellyfin":case"plex":case"plex-tidal":return!0;default:return!1}}var jS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const LS=new H("ampcast/performAction");function DS(e,t,r){return jS(this,void 0,void 0,(function*(){const i=t[0];if(!i)return;const a=i.itemType;switch(e){case Qn.PlayNow:case Qn.PlayNext:case Qn.Queue:!function(e,t){jS(this,void 0,void 0,(function*(){const r=t[0];if(!r)return;const n=r.itemType;if(n===Zn.Media||n===Zn.Album)switch(e){case Qn.PlayNow:case Qn.PlayNext:e===Qn.PlayNow&&(Dx.autoplay=!0),n===Zn.Media?yield yw.inject(t):yield yw.inject(r),e===Qn.PlayNow&&yw.next();break;case Qn.Queue:n===Zn.Media?yield yw.add(t):yield yw.add(r)}}))}(e,t);break;case Qn.Like:case Qn.Unlike:case Qn.Rate:case Qn.AddToLibrary:case Qn.RemoveFromLibrary:!function(e,t,r){jS(this,void 0,void 0,(function*(){if(t)try{switch(e){case Qn.Like:yield Gn.rate(t,1);break;case Qn.Unlike:yield Gn.rate(t,0);break;case Qn.Rate:"number"==typeof r&&(yield Gn.rate(t,r));break;case Qn.AddToLibrary:yield Gn.store(t,!0);break;case Qn.RemoveFromLibrary:yield Gn.store(t,!1)}}catch(n){LS.warn("Failed to perform action:",{action:e,item:t,payload:r}),LS.error(n)}}))}(e,i,r);break;case Qn.Pin:a===Zn.Playlist&&(yield Gi.pin(t));break;case Qn.Unpin:a===Zn.Playlist&&(yield Gi.unpin(t));break;case Qn.Info:yield wS(i);break;case Qn.AddToPlaylist:yield function(e){return PS(this,void 0,void 0,(function*(){yield cr((t=>n.createElement(CS,Object.assign({},t,{items:e}))))}))}(t);break;case Qn.AddToNewPlaylist:yield $S(t);break;case Qn.AddToRecentPlaylist1:case Qn.AddToRecentPlaylist2:case Qn.AddToRecentPlaylist3:case Qn.AddToRecentPlaylist4:try{yield function(e,t){var r;return VE(this,void 0,void 0,(function*(){const n=WE(t),i=KE(n.map((e=>e.service))),a=i[e],s=Jf(a),o=(null===(r=n.find((e=>e.service===s)))||void 0===r?void 0:r.items)||[];yield s.addToPlaylist(a,o),qE(a)}))}(Number(e.slice(-1))-1,t)}catch(e){LS.error(e),yield kr("An error occurred while updating your playlist.")}}}))}var RS=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const FS={[Qn.AddToLibrary]:"heart",[Qn.RemoveFromLibrary]:"heart-fill",[Qn.Rate]:"star",[Qn.Like]:"heart",[Qn.Unlike]:"heart-fill"},_S={[Qn.AddToLibrary]:"Add to library",[Qn.RemoveFromLibrary]:"Remove from library",[Qn.Rate]:"Rate",[Qn.Like]:"Like",[Qn.Unlike]:"Unlike"};function BS({item:e,inline:t}){const r=Jf(e),i=t?-1:void 0,a=(0,n.useCallback)((()=>RS(this,void 0,void 0,(function*(){e.itemType===Zn.Playlist&&(e.isPinned?yield DS(Qn.Unpin,[e]):yield DS(Qn.Pin,[e]))}))),[e]),s=(0,n.useCallback)((()=>RS(this,void 0,void 0,(function*(){e.rating?yield DS(Qn.Unlike,[e]):yield DS(Qn.Like,[e])}))),[e]),o=(0,n.useCallback)((()=>RS(this,void 0,void 0,(function*(){e.inLibrary?yield DS(Qn.RemoveFromLibrary,[e]):yield DS(Qn.AddToLibrary,[e])}))),[e]),l=(0,n.useCallback)((t=>RS(this,void 0,void 0,(function*(){const r=t.target.getBoundingClientRect(),n=yield lk([e],!1,r.right,r.bottom,"right");n&&(yield DS(n,[e]))}))),[e]),c=(0,n.useCallback)((t=>RS(this,void 0,void 0,(function*(){yield DS(Qn.Rate,[e],t)}))),[e]);return n.createElement(BE,null,t?n.createElement(hp,{icon:"menu",title:"More…",tabIndex:i,onClick:l,key:"menu"}):null,e.itemType===Zn.Playlist&&(null==r?void 0:r.createSourceFromPin)?n.createElement(hp,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:i,onClick:a,key:"pin"}):null,r?n.createElement(n.Fragment,null,void 0!==e.rating&&(null==r?void 0:r.canRate(e,t))?"plex"===r.id?n.createElement(mk,{value:e.rating,tabIndex:i,onChange:c}):n.createElement(hp,{icon:e.rating?VS(r,Qn.Unlike):VS(r,Qn.Like),title:e.rating?US(r,Qn.Unlike):US(r,Qn.Like),tabIndex:i,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==r?void 0:r.canStore(e,t))?n.createElement(hp,{icon:e.inLibrary?VS(r,Qn.RemoveFromLibrary):VS(r,Qn.AddToLibrary),title:e.inLibrary?US(r,Qn.RemoveFromLibrary):US(r,Qn.AddToLibrary),tabIndex:i,disabled:"apple"===r.id&&e.inLibrary,onClick:o,key:"store"}):null):null)}function VS(e,t){var r;return(null===(r=e.icons)||void 0===r?void 0:r[t])||FS[t]}function US(e,t){var r;return(null===(r=e.labels)||void 0===r?void 0:r[t])||_S[t]}function HS({children:e}){return n.createElement("footer",{className:"status-bar"},e)}function YS({items:e,size:t,maxSize:r,error:i,loading:a,loadingText:s="Loading",selectedCount:o,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=n.createElement("span",{className:"message"},s,"…");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=n.createElement("span",{className:"selected"},"(",qS(o)," selected)"),s=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${qS(i)} of ${void 0===t?r||`${qS(e.length)}+`:qS(r?Math.min(t,r):t)} ${c}`;u=n.createElement("span",{className:"message"},s," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||KS[e.status]||e.status||"")}(i);u=n.createElement(n.Fragment,null,n.createElement(rt,{name:"error"}),n.createElement("span",{className:"message error"},e?`Error: ${e}`:"Error"))}else u=n.createElement("span",{className:"message"},"0 ",c);return n.createElement(HS,null,u)}function qS(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const KS={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"},WS=(0,n.memo)((function({time:e}){const t=100/6,r=new Date(e);let i=r.getHours()+r.getMinutes()/60,a=Math.min(i,6),s=i-a;return i>12&&(i=24-i,s=Math.min(i,6),a=i-s),n.createElement("span",{role:"presentation",className:"sun-clock",title:r.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":s*t+"%"}})}));function GS({time:e,className:t}){return n.createElement("time",{className:t},b(e))}const JS={view:"details",fields:["Title","Genre","Owner"]};const QS=e=>n.createElement(GS,{className:"text",time:e.duration||0});function XS({value:e=""}){return""===e?null:n.createElement("span",{className:"text"},e)}const ZS={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return n.createElement(XS,{value:e.itemType===Zn.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>n.createElement(XS,{value:e.albumArtist}),className:"artist"},AlbumTrack:{title:"#",render:e=>n.createElement("span",{className:"text"},e.track?n.createElement(n.Fragment,null,n.createElement("span",{className:"disc"},e.disc||"?","."),e.track):"-"),align:"right",width:60,className:"index"},Title:{title:"Title",render:e=>n.createElement(XS,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const t=Jf(e);return t?n.createElement(wr,{icon:t.icon,text:e.title}):n.createElement(XS,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>n.createElement(XS,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>n.createElement(XS,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>n.createElement(XS,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>n.createElement(XS,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:QS,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const r=e.itemType===Zn.Media?e.mediaType===ti.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return n.createElement("figure",{className:"cover-art"},n.createElement(rt,{className:"cover-art-image",name:r}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>n.createElement(XS,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>n.createElement(XS,{value:eT(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>n.createElement(XS,{value:eT(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>n.createElement(XS,{value:e.year||""}),width:120,className:"year"},Views:{title:"Views",render:e=>null==e.globalPlayCount?null:n.createElement(XS,{value:rT(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return n.createElement(XS,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return n.createElement(XS,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},AddedAt:{title:"Date Added",render:e=>{if(!e.addedAt)return null;const t=new Date(1e3*e.addedAt),r=tT(t.valueOf());return n.createElement("time",{className:"text added-at",title:t.toLocaleString()},r)},className:"added-at"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return n.createElement("span",{className:"text last-played"},"unplayed");const t=new Date(1e3*e.playedAt),r=tT(t.valueOf());return n.createElement("time",{className:"text last-played",title:t.toLocaleString()},r)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt,r=new Date(t);return n.createElement("time",{className:"text",title:r.toLocaleString()},n.createElement(WS,{time:t}),n.createElement("span",{className:"date"},r.toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>n.createElement(Yx,{item:e}),className:"thumbnail"},Rate:{title:n.createElement(mk,{value:0,tabIndex:-1}),render:e=>n.createElement(mk,{value:e.rating,tabIndex:-1,onChange:t=>{return r=void 0,n=void 0,a=function*(){yield DS(Qn.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}}),align:"right",width:120,className:"rate"}};function eT(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function tT(e){const t=Date.now()-e;if(t<12e4)return"just now";const r=36e5;if(t<54e5)return`${Math.round(t/6e4)} mins ago`;const n=24*r;if(t<1.5*n)return`${Math.round(t/r)} hours ago`;if(t<12*n)return`${Math.round(t/n)} days ago`;const i=7*n;if(t<10*i)return`${Math.round(t/i)} weeks ago`;const a=365*n;return t<a?`${Math.round(t/2592e6)} months ago`:t<2*a?"1 year ago":`${Math.floor(t/a)} years ago`}function rT(e=0,t="listen",r=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${r}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${r}`:e<1e6?`${Math.round(e/1e3)}K  ${r}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${r}`:e<1e9?`${Math.round(e/1e6)}M  ${r}`:`${(e/1e9).toFixed(1).replace(".0","")}B  ${r}`}function nT(e){return(0,n.useCallback)((t=>{const r=e.filter((e=>e.src.startsWith("spotify:track:")));if(r.length>0){const e=r.map((e=>e.src));t.dataTransfer.setData("text/x-spotify-tracks",e.join("\n")),t.dataTransfer.effectAllowed="copyMove"}}),[e])}var iT=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},aT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function sT(e){var{className:t="",pager:r=null,statusBar:i=!0,loadingText:a,onContextMenu:s,onDoubleClick:o,onEnter:l,onError:c,onLoad:u,onNoContent:d,onSelect:m}=e,h=aT(e,["className","pager","statusBar","loadingText","onContextMenu","onDoubleClick","onEnter","onError","onLoad","onNoContent","onSelect"]);const f=function(e=JS){return(0,n.useMemo)((()=>function(e){if("none"===e.view)return{view:"details",cols:[]};const{view:t,fields:r}=e,i=r.map((e=>ZS[e]));return i.push({title:n.createElement(rt,{name:"menu"}),render:e=>n.createElement(BS,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(h.layout),[p,y]=(0,n.useState)(0),[v,b]=(0,n.useState)(0),[{items:g,loaded:w,error:E,size:k,maxSize:x},S]=function(e){const[t,r]=function(){const e=(0,n.useRef)(null);null===e.current&&(e.current=new Ne);const t=(0,n.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[i,a]=(0,n.useState)([]),[s,o]=(0,n.useState)(void 0),[l,c]=(0,n.useState)(void 0),[u,d]=(0,n.useState)(),[m,h]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>({items:i,size:s,maxSize:l,error:u,loaded:m})),[i,s,l,u,m]),p=(0,n.useCallback)(((e,t)=>{r([e,t])}),[r]);return(0,n.useEffect)((()=>{if(a([]),o(void 0),c(void 0),d(void 0),h(!1),!e)return;const r=e.observeItems(),n=e.observeSize(),i=e.observeError(),s=nn(r,i).pipe(ji(1),Be((()=>!0))),l=en(hn([]),hn([]).pipe(Gh(0))),u=new le;return u.add(en(l,r).subscribe(a)),u.add(n.subscribe(o)),u.add(i.subscribe(d)),u.add(s.subscribe(h)),u.add(t.subscribe((([t,r])=>{e.fetchAt(t,r)}))),c(e.maxSize),()=>u.unsubscribe()}),[e,t]),[f,p]}(r),[T,P]=(0,n.useState)([]),A=FE(),I=null==A?void 0:A.src,C=function(e){const[t,r]=(0,n.useState)("");return(0,n.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at|added-at|rate/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),r(t?`clip-${t}`:"")}),[e]),t}(f),M=w?g.length>0:void 0,O=nT(T);(0,n.useEffect)((()=>{E&&c&&c(E)}),[E,c]),(0,n.useEffect)((()=>{w&&u&&u()}),[w,u]),(0,n.useEffect)((()=>{!1===M&&d&&d()}),[M,d]),(0,n.useEffect)((()=>{p>=0&&v>0&&S(p,v)}),[S,p,v,r]);const $=(0,n.useCallback)((e=>{P(e),null==m||m(e)}),[m]),N=(0,n.useCallback)(((e,t,r,n,i)=>iT(this,void 0,void 0,(function*(){if(0===e.length)return;const n=yield lk(e,!0,t,r,-1===i?"right":"left");n&&(yield DS(n,e))}))),[]),z=(0,n.useCallback)(((e,t)=>iT(this,void 0,void 0,(function*(){oT(e)?yield DS(Qn.Queue,[e]):null==o||o(e,t)}))),[o]),j=(0,n.useCallback)(((e,t,r)=>iT(this,void 0,void 0,(function*(){e.every(oT)?t||r?t&&!r?yield DS(Qn.PlayNow,e):r&&!t&&(yield DS(Qn.PlayNext,e)):yield DS(Qn.Queue,e):null==l||l(e,t,r)}))),[l]),L=(0,n.useCallback)((e=>iT(this,void 0,void 0,(function*(){yield DS(Qn.Info,e)}))),[]),D=(0,n.useCallback)((e=>{if((null==e?void 0:e.itemType)===Zn.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===I?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[I]);return n.createElement("div",{className:`panel ${t} ${C}`,onDragStart:O},n.createElement($p,Object.assign({},h,{className:"media-list",layout:f,items:g,itemClassName:D,itemKey:"src",selectedIndex:0===g.length?-1:0,onContextMenu:s||N,onDoubleClick:z,onEnter:j,onInfo:L,onPageSizeChange:b,onScrollIndexChange:y,onSelect:$})),i?n.createElement(YS,{items:g,error:E,size:k,maxSize:x,loading:!!r&&!w,loadingText:a,selectedCount:T.length}):null)}function oT(e){return e.itemType===Zn.Media||e.itemType===Zn.Album}var lT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const cT={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function uT(e){var{className:t="",layout:r=cT,draggable:i=!0}=e,a=lT(e,["className","layout","draggable"]);return n.createElement(sT,Object.assign({},a,{className:`albums ${t}`,layout:r,draggable:i}))}var dT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const mT={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function hT(e){var{className:t="",layout:r=mT,multiple:i=!0,draggable:a=!0}=e,s=dT(e,["className","layout","multiple","draggable"]);return n.createElement(sT,Object.assign({},s,{className:`media-items ${t}`,layout:r,multiple:i,draggable:a}))}const fT={view:"details",fields:["AlbumTrack","Title","Artist","Duration"]},pT={view:"card compact",fields:["Thumbnail","Title","Artist","Duration"]};function yT(e,t=fT){const[r,i]=(0,n.useState)(t);return(0,n.useEffect)((()=>{if((null==e?void 0:e.synthetic)&&"details"===t.view){const[,r]=e.src.split(":");if("videos"===r)i(pT);else{const e=t.fields.slice();"Track"!==e[0]&&"AlbumTrack"!==e[0]||(e[0]="Index");const r=e.indexOf("Duration");-1!==r&&e.splice(r+1,0,"Album","Year"),i({view:"details",fields:h(e)})}}else i(t)}),[e,t]),r}var vT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function bT(e){var t,{source:r}=e,i=vT(e,["source"]);const[a,s]=(0,n.useState)(null),o=yT(a,r.secondaryLayout),l=(null==a?void 0:a.pager)||null,c=(0,n.useCallback)((([e])=>{s(e||null)}),[]),u=n.createElement(uT,Object.assign({},i,{title:r.title,onSelect:c})),d=n.createElement(hT,{title:a?`${a.title}: Tracks`:"",className:"album-tracks "+((null==a?void 0:a.multiDisc)?"multi-disc":""),pager:l,layout:o,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?u:n.createElement(ir,{id:"album-browser-layout",arrange:"rows",primaryIndex:0},u,d))}var gT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const wT={view:"card compact",fields:["Thumbnail","Title","Genre"]};function ET(e){var{className:t="",layout:r=wT}=e,i=gT(e,["className","layout"]);return n.createElement(sT,Object.assign({},i,{className:`artists ${t}`,layout:r}))}var kT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const xT={view:"card compact",fields:["Thumbnail","Title","Year"]};function ST(e){var t,r,{source:i}=e,a=kT(e,["source"]);const[s,o]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),u=yT(l,i.tertiaryLayout),d=(null==s?void 0:s.pager)||null,m=(null==l?void 0:l.pager)||null,h=(0,n.useCallback)((([e])=>{o(e||null)}),[]),f=(0,n.useCallback)((([e])=>{c(e||null)}),[]),p=n.createElement(ET,Object.assign({},a,{title:i.title,onSelect:h})),y=n.createElement(uT,{title:s?`${s.title}: Albums`:"",className:"artist-albums",pager:d,layout:i.secondaryLayout||xT,onSelect:f,key:null==s?void 0:s.src}),v=n.createElement(hT,{title:l?`${l.title}: Tracks`:"",className:"album-tracks "+((null==l?void 0:l.multiDisc)?"multi-disc":""),pager:m,layout:u,key:null==l?void 0:l.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=i.secondaryLayout)||void 0===t?void 0:t.view)?p:"none"===(null===(r=i.tertiaryLayout)||void 0===r?void 0:r.view)?n.createElement(ir,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},p,y):n.createElement(ir,{id:"artist-browser-layout",arrange:"columns",primaryIndex:1},p,n.createElement(ir,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},y,v)))}var TT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function PT(e){var{source:t}=e,r=TT(e,["source"]);return n.createElement("div",{className:"panel"},n.createElement(hT,Object.assign({},r,{title:t.title})),";")}var AT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const IT={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},CT={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function MT(e){var{source:t}=e,r=AT(e,["source"]);const[i,a]=(0,n.useState)(),[s,o]=(0,n.useState)(null),l=(null==s?void 0:s.pager)||null;(0,n.useEffect)((()=>()=>Gi.unlock()),[t]),(0,n.useEffect)((()=>{s&&Gi.lock(s)}),[s]);const c=(0,n.useCallback)((([e])=>{o(e||null)}),[]),u=(0,n.useCallback)((()=>{a(Error("Not found"))}),[]);return n.createElement("div",{className:"panel pinned-playlist"},i?n.createElement(OT,{src:t.id}):n.createElement(SS,Object.assign({},r,{title:t.title,layout:t.layout||IT,onError:a,onNoContent:u,onSelect:c,statusBar:!1,disabled:!0})),n.createElement(hT,{title:`${t.title}: Tracks`,className:"playlist-items",pager:l,layout:t.secondaryLayout||CT,onError:a}))}function OT({src:e}){const t=(0,n.useCallback)((()=>{Gi.unlock(),Gi.unpin({src:e})}),[e]);return n.createElement("div",{className:"playlists playlists-error"},n.createElement("p",{className:"message"},n.createElement(rt,{name:"error"}),n.createElement("span",{className:"text"},"Failed to load playlist.")),n.createElement("p",{className:"buttons"},n.createElement("button",{onClick:t},"Unpin")))}var $T=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const NT={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function zT(e){var t,{source:r}=e,i=$T(e,["source"]);const[a,s]=(0,n.useState)(null),o=(null==a?void 0:a.pager)||null,l=(0,n.useCallback)((([e])=>{s(e||null)}),[]),c=n.createElement(SS,Object.assign({},i,{title:r.title,onSelect:l})),u=n.createElement(hT,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:o,layout:r.secondaryLayout||NT,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?c:n.createElement(ir,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:0},c,u))}function jT(e){return ma()?n.createElement(PT,Object.assign({},e,{service:da})):n.createElement(LT,null)}function LT(){return n.createElement(OE,null,n.createElement("div",{className:"note"},n.createElement("p",null,n.createElement("strong",null,"Apple MusicKit beta required.")),n.createElement("p",null,"You need to enable ",n.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from ",da.name,".")))}function DT(e){return"apple"===e.service.id?n.createElement(jT,Object.assign({},e)):n.createElement(PT,Object.assign({},e))}function RT(e){switch(e.source.itemType){case Zn.Artist:return n.createElement(ST,Object.assign({},e));case Zn.Album:return n.createElement(bT,Object.assign({},e));case Zn.Playlist:return e.source.isPin?n.createElement(MT,Object.assign({},e)):n.createElement(zT,Object.assign({},e));default:return e.source.mediaType===ti.Video?n.createElement(DT,Object.assign({},e)):n.createElement(PT,Object.assign({},e))}}var FT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const _T={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function BT(e){var{service:t,source:r,minDate:i="2010-01-01"}=e,a=FT(e,["service","source","minDate"]);const[s,o]=(0,n.useState)(0),l=function(e,t=0){return TS(e,(0,n.useMemo)((()=>({startAt:t})),[t]))}(r,s),c=(0,n.useCallback)((e=>{const t=new Date,r=new Date(e);r.getFullYear()===t.getFullYear()&&r.getMonth()===t.getMonth()&&r.getDate()===t.getDate()?o(0):o(Math.floor(r.valueOf()/1e3))}),[]);return n.createElement(n.Fragment,null,n.createElement(NE,{icon:t.icon},t.name,":",n.createElement(RE,{min:i,onSelect:c})),n.createElement(RT,Object.assign({},a,{service:t,source:r,pager:l,layout:r.layout||_T})))}const VT="2002-11-20",UT=new H("lastfm/useHistoryStart");function HT(){const e=function(){const[e,t]=(0,n.useState)((()=>mo.firstScrobbledAt)),r=""===e||e===VT;return(0,n.useEffect)((()=>{if(r){t(VT);const e=Zr(yo.getUserInfo()).pipe(Be((e=>Number(e.user.playcount))),et((e=>{return e?hn(e):(r=ie(t=()=>Error("No history."))?t:function(){return t},new Me((function(e){return e.error(r())})));var t,r})),Be((e=>Math.floor(e/50))),Be((e=>new Po({page:e},{pageSize:50}))),et((e=>di(e))),Be((e=>e.at(-1))),_e(l),Be((e=>new Date(1e3*e.playedAt))),Be(y),at((e=>mo.firstScrobbledAt=e)),at(t)).subscribe(UT);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(BT,{service:No,source:Co,minDate:e})}var YT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const qT={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function KT(e){var{service:t,source:r,total:i}=e,a=YT(e,["service","source","total"]);const[,s]=(0,n.useReducer)((e=>e++),0);return(0,n.useEffect)((()=>{const e=Zr(Dr(6e4)).subscribe(s);return()=>e.unsubscribe()}),[]),n.createElement(n.Fragment,null,n.createElement(NE,{icon:t.icon},void 0===i?t.name:n.createElement(n.Fragment,null,t.name,": ",i.toLocaleString()," ",function(e){return Zf(e)&&!!e.canScrobble}(t)?"scrobbles":"plays")),n.createElement(RT,Object.assign({},a,{service:t,source:r,layout:r.layout||qT})))}class WT extends Fi{fetchAt(){}next(e){this.disconnected||(this.connect(),this.size=e.length,this.items=e)}}var GT=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const JT=new H("useRecentlyPlayedPager");function QT(e){const t=(0,n.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{const r=new WT,n=e(void 0,t),a=new Hi(r,n),o=nn(Vo().pipe(Kh(1),Gh(2e4)),Dr(3e5)),l=new le,c=t=>GT(this,void 0,void 0,(function*(){const r=e(t);return yield di(r)}));return l.add(n.observeItems().pipe(On((e=>0===e.length)),ji(1),Be((e=>e[0].playedAt)),an((e=>o.pipe(et((()=>c(e+1))),at((e=>r.next(e))))))).subscribe(JT)),l.add(a.observeSize().pipe(at(s)).subscribe(JT)),r.next([]),i(a),()=>l.unsubscribe()}),[t,e]),{pager:r,total:a}}function XT(){const e=(0,n.useCallback)(((e,t)=>new Po(e?{from:e}:{to:t})),[]),{pager:t,total:r}=QT(e);return n.createElement(KT,{service:No,source:Mo,pager:t,total:r})}var ZT=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const eP=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function tP(e){var{source:t}=e,r=ZT(e,["source"]);const i=(0,n.useId)(),[a,s]=(0,n.useState)(),o=function(e,t="overall"){return TS(e,(0,n.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(NE,{icon:No.icon},No.name,": ",t.title),n.createElement("div",{className:"lastfm-period-selector options"},n.createElement("ul",{className:"lastfm-periods"},eP.map((({value:e,text:t})=>n.createElement("li",{className:"lastfm-period",key:e},n.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),n.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),n.createElement(RT,Object.assign({},r,{service:No,source:t,pager:o,layout:t.layout})))}const rP="2015-09-17";function nP(){const e=function(){const[e,t]=(0,n.useState)(Hl.firstScrobbledAt),r=""===e||e===rP;return(0,n.useEffect)((()=>{if(r){t(rP);const e=Zr(Wl.getListeningActivity()).pipe(Be((e=>e.find((e=>e.listen_count>0)))),_e(l),Be((e=>y(1e3*Number(e.from_ts)))),at((e=>Hl.firstScrobbledAt=e)),ji(1)).subscribe(t);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(BT,{service:cu,source:eu,minDate:e})}function iP(){const e=(0,n.useCallback)(((e,t)=>new Hc(e?{min_ts:e}:{max_ts:t},!0)),[]),{pager:t,total:r}=QT(e);return n.createElement(KT,{service:cu,source:tu,pager:t,total:r})}const aP=[{value:"all_time",text:"All time"},{value:"this_year",text:"Year"},{value:"this_month",text:"Month"},{value:"this_week",text:"Week"}];function sP({source:e}){const t=(0,n.useId)(),[r,i]=(0,n.useState)(),a=function(e,t="all_time"){return TS(e,(0,n.useMemo)((()=>({range:t})),[t]))}(e,r),s=(0,n.useCallback)((e=>{i(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(NE,{icon:cu.icon},cu.name,": ",e.title),n.createElement("div",{className:"listenbrainz-range-selector options"},n.createElement("ul",{className:"listenbrainz-ranges"},aP.map((({value:e,text:r})=>n.createElement("li",{className:"listenbrainz-range",key:e},n.createElement("input",{id:`${t}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),n.createElement("label",{htmlFor:`${t}-range-${e}`},r)))))),n.createElement(RT,{service:cu,source:e,pager:a,layout:e.layout}))}function oP({icon:e,placeholder:t="Search",onSubmit:r}){const i=(0,n.useRef)(null),a=(0,n.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==r||r(t)}),[r]);return n.createElement("form",{className:"search-bar",onSubmit:a},n.createElement("p",{className:"text-with-button"},e?n.createElement(rt,{name:e}):null,n.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),n.createElement("button",{type:"submit",title:"Search"},n.createElement(rt,{name:"search"}))))}function lP({sources:e,onSourceChange:t}){const r=(0,n.useId)(),i=(0,n.useCallback)((r=>{const n=Number(r.target.value),i=e[n];null==t||t(i)}),[e,t]);return n.createElement("div",{className:"media-source-selector options"},n.createElement("ul",{className:"media-sources"},e.map(((e,t)=>n.createElement("li",{className:"media-source",key:e.id},n.createElement("input",{id:`${r}-${e.id}`,type:"radio",name:r,value:t,defaultChecked:0===t,onChange:i}),n.createElement("label",{htmlFor:`${r}-${e.id}`},e.title))))))}function cP({service:e,sources:t}){const[r,i]=(0,n.useState)((()=>t[0])),[a,s]=(0,n.useState)(""),o=function(e,t=""){return TS(e,(0,n.useMemo)((()=>({q:t})),[t]))}(r,a),l=!!r.searchable,c=!l&&!r.isPin;return n.createElement(n.Fragment,null,c?n.createElement(NE,{icon:e.icon},e.name,": ",r.title):null,l?n.createElement(oP,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:s}):null,t.length>1?n.createElement(lP,{sources:t,onSourceChange:i}):null,n.createElement(RT,{service:e,source:r,pager:o,layout:r.layout,loadingText:a?"Searching":void 0}))}function uP({service:e,viewType:t,itemType:r,onSelect:i}){const a=(0,n.useId)(),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(),u=t===va.ByDecade?"Decade":"Genre";(0,n.useEffect)((()=>{l&&i&&i(l)}),[l,i]),(0,n.useEffect)((()=>{const n=Zr(e.getFilters(t,r)).subscribe(o);return()=>n.unsubscribe()}),[e,t,r]),(0,n.useEffect)((()=>{l||c(s[0])}),[s,l]);const d=(0,n.useCallback)((e=>{c(s[Number(e.target.value)])}),[s]);return n.createElement("div",{className:"filter-selector"},n.createElement("label",{htmlFor:a},u,":"),n.createElement("select",{id:a,onChange:d},s.map(((e,t)=>n.createElement("option",{value:t,key:e.id},e.title)))))}function dP({service:e,source:t}){const[r,i]=(0,n.useState)(),a=TS(t,r);return n.createElement(n.Fragment,null,n.createElement(NE,{icon:e.icon},e.name,": ",t.title),n.createElement(uP,{service:e,viewType:t.viewType,itemType:t.itemType,onSelect:i}),n.createElement(RT,{service:e,source:t,pager:a,layout:t.layout}))}var mP=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const hP={view:"card minimal",fields:["FileIcon","FileName"]};function fP(e){var{className:t="",layout:r=hP,multiple:i=!0,draggable:a=!0,onSelect:s}=e,o=mP(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,n.useState)([]),u=l.every((e=>e.itemType===Zn.Media)),d=i&&u,m=a&&u,h=(0,n.useCallback)((e=>{c(e),null==s||s(e)}),[s]);return n.createElement(sT,Object.assign({},o,{className:`folder-items ${t}`,layout:r,multiple:d,draggable:m,onSelect:h}))}var pP=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function yP({service:e,source:t}){const[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)("/");(0,n.useEffect)((()=>{const e=t.search();return i(e),s("/"),()=>e.disconnect()}),[t]);const o=(0,n.useCallback)((e=>pP(this,void 0,void 0,(function*(){e.itemType===Zn.Folder&&(i(e.pager),s(e.path||"/"))}))),[]),l=(0,n.useCallback)((e=>pP(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===Zn.Folder&&(i(t.pager),s(t.path||"/"))}}))),[]);return n.createElement(n.Fragment,null,n.createElement(NE,{icon:e.icon},e.name,": ",a),n.createElement("div",{className:"panel"},n.createElement(fP,{title:`Path: ${a}`,pager:r,onEnter:l,onDoubleClick:o})))}function vP({service:e,sources:t}){const r=1===t.length?t[0]:null;switch((0,n.useEffect)((()=>{(null==r?void 0:r.lockActionsStore)?Gn.lock(e.id,r.itemType):Gn.unlock()}),[e,r]),(0,n.useEffect)((()=>()=>Gn.unlock()),[e]),null==r?void 0:r.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return n.createElement(tP,{source:r});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return n.createElement(sP,{source:r});case"lastfm/history":return n.createElement(HT,null);case"listenbrainz/history":return n.createElement(nP,null);case"lastfm/recently-played":return n.createElement(XT,null);case"listenbrainz/recently-played":return n.createElement(iP,null);default:switch(null==r?void 0:r.viewType){case va.ByDecade:case va.ByGenre:return n.createElement(dP,{service:e,source:r});case va.Folders:return n.createElement(yP,{service:e,source:r});default:return n.createElement(cP,{service:e,sources:t})}}}function bP({service:e,sources:t}){const r=CE(),i=cp(e.observeIsLoggedIn,e.isLoggedIn()),a=function(e,t){return(0,n.useMemo)((()=>function({error:r}){return r instanceof ii?n.createElement(n.Fragment,null,n.createElement(NE,{icon:e.icon},1===t.length?`${e.name}: ${t[0].title}`:e.name),n.createElement(OE,null,n.createElement("div",{className:"note"},n.createElement("p",null,(null==r?void 0:r.message)||String(r))))):n.createElement($E,{error:r},e&&n.createElement("p",{className:"buttons"},n.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e,t])}(e,t);return n.createElement("div",{className:`media-browser ${e.id}-browser`},n.createElement(sE.SV,{fallbackRender:a},e.internetRequired&&!r?n.createElement(ME,null):i?n.createElement(vP,{service:e,sources:t}):n.createElement(SE,{service:e})))}function gP(e){return e.sources.filter(Om).map((t=>({id:t.id,label:n.createElement(wr,{icon:t.icon,text:t.title}),value:n.createElement(bP,{service:e,sources:[t],key:`${EP(e)}/${t.id}`})})))}function wP(e){return Gi.getPinsForService(e.id).map((t=>{var r;return null===(r=e.createSourceFromPin)||void 0===r?void 0:r.call(e,t)})).filter(l).map((t=>({id:t.id,label:n.createElement(wr,{icon:t.icon,text:t.title}),value:n.createElement(bP,{service:e,sources:[t],key:t.id})})))}function EP(e){return ep(e)?`${e.id}/${e.libraryId||""}`:e.id}var kP=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function xP(e){const[t,r]=(0,n.useState)(0),i=(0,n.useMemo)((()=>[n.createElement(SP,{key:0}),n.createElement(PP,{key:1}),n.createElement(TP,{key:2})]),[]),a=(0,n.useCallback)((()=>{r((e=>e-1))}),[]),s=(0,n.useCallback)((()=>{r((e=>e+1))}),[]);return n.createElement(or,Object.assign({},e,{className:"settings-dialog startup-wizard",title:"Media Services"}),n.createElement("form",{method:"dialog"},i[t],n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",{type:"button",disabled:0===t,onClick:a},"« Prev"),n.createElement("button",{type:"button",disabled:t>=i.length-1,onClick:s},"Next »"),n.createElement("button",{className:"dialog-button-submit"},"Finish"))))}function SP(){const e=(0,n.useMemo)(Kf,[]);return n.createElement(AP,{icon:"globe",title:"Streaming Media",services:e,multiSelect:Mm})}function TP(){const e=(0,n.useMemo)(Yf,[]);return n.createElement(AP,{icon:"network",title:"Personal Media Servers",services:e})}function PP(){const e=(0,n.useMemo)(Wf,[]);return n.createElement(AP,{icon:"data",title:"Listening History",services:e,multiSelect:!0})}function AP({icon:e,title:t,multiSelect:r,services:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>i.filter(Om).some(IP))),l=(0,n.useCallback)((()=>kP(this,void 0,void 0,(function*(){const e=a.current.elements,t={};let r=!1;for(const n of e){const e=n.value;if(e){const i=!n.checked;t[e]=i,i||r||(r=IP(Gf(e)))}}$m(t),o(r)}))),[]);return n.createElement("div",{className:"startup-wizard-services"},n.createElement("h3",null,n.createElement(wr,{icon:e,text:t})),n.createElement("fieldset",{className:"media-services",onChange:l,ref:a},n.createElement("legend",null,"Enable"),n.createElement(Wp,{services:i,multiSelect:r})),s?n.createElement("p",{className:"restricted-access"},"*Access is restricted to approved users only."):null)}function IP(e){return!!(null==e?void 0:e.restrictedAccess)}const CP=new J("sources");function MP({onSelect:e}){const t=(0,n.useRef)(null),r=function(){const[e,t]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=nn(Cm.pipe(On((e=>e===Im)),Be((()=>{}))),nn(...Yf().filter((e=>!!e.observeLibraryId)).map((e=>e.observeLibraryId()))).pipe(Be((()=>{}))),Gi.observe()),r=Gi.observe().pipe(ji(1),an((()=>e)),Be((()=>Bf().filter(Om).map((e=>function(e){return{id:e.id,label:n.createElement(ip,{service:e,showConnectivity:!0}),value:n.createElement(bP,{service:e,sources:e.roots,key:EP(e)}),startExpanded:!0,children:[...gP(e),...wP(e)]}}(e)))))).subscribe(t);return()=>r.unsubscribe()}),[]),e}(),[i,a]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{t.current.focus()}),[]),(0,n.useEffect)((()=>{if(r){const e=0===r.length&&!i;a(!0),e&&cr(xP,!0)}}),[r,i]),n.createElement("div",{className:"panel media-sources"},n.createElement(Tn,{roots:r||[],onSelect:e,storageId:CP.id,treeViewRef:t}))}const OP=(0,n.memo)((function(){const[e,t]=(0,n.useState)(null),r=(0,n.useCallback)((()=>{cr(iE,!0)}),[]);return n.createElement("div",{className:"media-library"},n.createElement("header",{className:"media-library-head"},n.createElement(nt,null),n.createElement(aE,null),n.createElement(hp,{icon:"settings",className:"in-frame",title:"Settings",onClick:r})),n.createElement("div",{className:"media-library-body"},n.createElement(ir,{id:"media-library-layout",arrange:"columns",primaryIndex:1},n.createElement(MP,{onSelect:t}),e||n.createElement(OE,null))))})),$P=new H("visualizer"),NP={providerId:"none",name:""},zP=new it(NP),jP=new Ne,LP=[...Array(74).fill("butterchurn"),...Array(10).fill("ampshader"),...Array(4).fill("audiomotion"),...Array(1).fill("coverart"),...Array(1).fill("waveform")],DP=[...Array(58).fill("ampshader"),...Array(10).fill("butterchurn"),...Array(10).fill("spotifyviz"),...Array(2).fill("coverart")],RP=Array(10).fill("ambientvideo"),FP=Array(20).fill("ambientvideo");function _P(){return zP}function BP(){return UP().pipe(Be((e=>Ww(e))),an((e=>e?e.observeVisualizers():hn([]))))}function VP(){return Ly().pipe(Be((e=>!!e.lockedVisualizer)),_n())}function UP(){return Ly().pipe(Be((e=>e.provider||"")),_n())}function HP(e){jP.next(e)}function YP(){jy.lockedVisualizer=KP()}function qP(){jy.lockedVisualizer=null}function KP(){return zP.getValue()}function WP(e,t){const r=Ww(e);return{providerId:"none",name:(null==r?void 0:r.name)||e,reason:t}}function GP(e,t=1){var r;null===(r=Ww(e))||void 0===r||r.observeVisualizers().pipe(On((e=>0===e.length)),qh(_P()),at((([,e])=>{e===NP&&HP("sync")})),ji(t)).subscribe($P)}function JP(){const[e,t]=(0,n.useState)("searching"),r=FE(),i=null==r?void 0:r.id,a=null==r?void 0:r.src,s=null==r?void 0:r.lookupStatus;return(0,n.useEffect)((()=>t("searching")),[i]),(0,n.useEffect)((()=>{switch(s){case qg.Looking:t("searching");break;case qg.NotFound:t("error");break;default:if(a){if(tp(a)){t("loading");const e=new le;return e.add(xx().pipe(ji(1)).subscribe((()=>t("loaded")))),e.add(gx().pipe(ji(1)).subscribe((()=>t("error")))),()=>e.unsubscribe()}t("searching")}else t("loaded")}}),[i,a,s]),e}gw().pipe(an((()=>sw())),_n(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),vv(200)).subscribe((()=>HP("item"))),Tk.observeError().subscribe((()=>HP("error"))),BP().subscribe((()=>HP("provider"))),jP.pipe(mn((e=>"click"===e?Lr(50):hn(void 0)))).pipe(qh(sw(),Ly()),Be((([e,t,r])=>function(e,t,r){if(!t||t.mediaType===ti.Video)return NP;const n="error"===e,i=t.src.startsWith("spotify:"),a=r.lockedVisualizer;let s=(null==a?void 0:a.providerId)||r.provider;switch(s){case"spotifyviz":if(!i)return WP(s,"not supported");break;case"audiomotion":if(i)return WP(s,"not supported");break;case"none":return NP}if(a)return n?WP(s,"error"):function(e,t){return Gw(e).find((e=>e.name===t))}(a.providerId,a.name)||WP(s,"not found");const o=KP();if(s=r.provider,!s){let t=i?DP:LP;r.ambientVideoEnabled&&(t=t.concat(i?FP:RP)),s=k(t,n?o.providerId:void 0),"click"===e&&s===o.providerId&&1===Gw(s).length&&(s=k(t,s))}if("ambientvideo"!==s&&!kk.streamingSupported&&(t.playbackType===Nn.DASH||t.playbackType===Nn.HLS))return WP(s,"not supported");const l=Gw(s);return n&&r.provider&&1===l.length?WP(s,"error"):k(l,o)||NP}(e,t,r)))).subscribe(zP),_P().pipe(at((e=>Tk.load(e)))).subscribe($P),GP("ampshader"),GP("butterchurn",2);var QP=r(269);function XP(){return cp(Pw,!0)}function ZP(){const e=JP(),t=XP();return n.createElement("p",{className:"media-state playback-state"},"error"===e?e:t?"":`${"loaded"===e?"playing":e}…`)}function eA(){const e=cp(Tw,0),t=cp(Sw,0);return n.createElement("progress",{className:"progress-bar",max:e,value:t})}const tA=["#3e3e3e","#ebebeb"];function rA({item:e,hidden:t,onPaletteChange:r}){var i;const a=cp(Dy,!1),[s,o]=(0,n.useState)(tA),[l,c]=(0,n.useState)("dark"),[u,d]=(0,n.useState)("light"),[m,f]=(0,n.useState)({}),p=(0,n.useCallback)((e=>{const t=new QP.Z,r=new Image,n=e=>{console.warn("Could not load image.",{err:e}),o(tA)},i=e=>{var r,i;try{const n=e=>`rgb(${e.map(Number)})`,a=e=>new xt(n(e)).toHexString(),s=a(t.getColor(e)),l=new xt(s).isDark(),c=(null===(r=t.getPalette(e))||void 0===r?void 0:r.map(a))||tA,u=(null===(i=bp(s,c,{includeFallbackColors:!0,level:"AA",size:"large"}))||void 0===i?void 0:i.toHexString())||(l?"#ffffff":"#000000");o(h([s,u,...c]))}catch(e){n(e)}};r.crossOrigin="anonymous",r.src=e,r.complete?i(r):(r.onload=()=>i(r),r.onerror=()=>{const t=new Image;t.crossOrigin="anonymous",t.src=`${e}${e.includes("?")?"&":"?"}ampcast_ts=${Date.now()}`,t.complete?i(t):(t.onerror=n,t.onload=()=>i(t))})}),[]),y=(0,n.useCallback)((()=>{o(tA)}),[]);return(0,n.useEffect)((()=>{const[e,t]=s.slice(0,2).map((e=>new xt(e))),{h:n,s:i,l:a}=t.toHsl();f({"--background-color":e.toHexString(),"--text-color-h":`${n}`,"--text-color-s":100*Number(i)+"%","--text-color-l":100*Number(a)+"%"}),c(e.isDark()?"dark":"light"),d(t.isDark()?"dark":"light"),null==r||r(s)}),[s,r]),n.createElement("div",{className:`currently-playing themed ${l} text-${u}`,hidden:t,style:m},e?n.createElement(n.Fragment,null,n.createElement("div",{className:"currently-playing-thumbnail"},n.createElement(pS,{item:e,size:800,onLoad:p,onError:y,key:e.id}),n.createElement(nA,{item:e})),n.createElement("div",{className:"currently-playing-text"},n.createElement(aS,{title:e.title}),n.createElement(oS,{artist:null===(i=e.artists)||void 0===i?void 0:i.join(", ")}))):null,n.createElement(ZP,null),a?n.createElement(eA,null):null)}function nA({item:e}){const t=Jf(e);return t&&rp(t)?n.createElement(wr,{icon:t.icon,text:`Provided by ${t.name}`}):null}const iA=()=>Ly().pipe(Be((e=>e.coverArtAnimatedBackground)),_n());function aA(){const e=(0,n.useRef)(null),t=cp(iA,!1),[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)("row"),[o,l]=(0,n.useState)(["#000000"]),c=o[0],[u,d]=(0,n.useState)(0),[m,h]=(0,n.useState)(0),[f,p]=(0,n.useState)(0),y=Jt(),v=FE(),b=(null==v?void 0:v.mediaType)===ti.Video?null:v,g=pn(b),w=(null==b?void 0:b.id)||"",E=(0,n.useRef)(-1),[k,x]=(0,n.useState)(null),[T,P]=(0,n.useState)(null),A=JP(),[I,C]=(0,n.useState)(!1),M=(null==k?void 0:k.id)===w,O=(null==T?void 0:T.id)===w;return(0,n.useEffect)((()=>{if("error"===A)C(!0);else if(C(!1),"loaded"===A){const e=setTimeout((()=>C(!0)),4500);return()=>clearTimeout(e)}}),[A]),(0,n.useEffect)((()=>{const t=kk.observeReady().subscribe((t=>{const r=rb.createPlayer(t);r.appendTo(e.current),i(r)}));return()=>t.unsubscribe()}),[]),(0,n.useEffect)((()=>{if(u>m){const e=m-5*y;p(Math.min(Math.floor(.45*u),e)),s("row")}else{const e=u-3*y;p(Math.min(Math.floor(.45*m),e)),s("column")}}),[u,m,y]),Wt(e,(({width:e,height:t})=>{d(e),h(t)})),(0,n.useEffect)((()=>{let e=E.current?1:0;(null==b?void 0:b.id)!==(null==g?void 0:g.id)&&(e=E.current?0:1),0===e?x(b):P(b),E.current=e}),[b,g]),(0,n.useEffect)((()=>{if(r){const[e,t]=o.slice(0,2).map((e=>new Iv.Z(e)));let[,,...n]=o;n=S(n,(t=>(t=new Iv.Z(t),e.deltaE2000(t)>10))),n=S(n,(e=>(e=new Iv.Z(e),t.deltaE2000(e)>10))),r.backgroundColor=e.toString({format:"hex"}),r.beatsColor=n[0]}}),[r,o]),n.createElement("div",{className:`visualizer visualizer-coverart arrange-${a} ${I?"ready":""} ${t?"animated-background-enabled":""}`,style:{"--thumbnail-size":`${f}px`},ref:e},n.createElement("div",{className:"animated-background",style:{"--background-color":c}}),n.createElement(rA,{item:k,hidden:!M,onPaletteChange:M?l:void 0,key:"item0"}),n.createElement(rA,{item:T,hidden:!O,onPaletteChange:O?l:void 0,key:"item1"}),n.createElement("div",{className:"beats-player"}))}function sA(){return cp(_P,null)}function oA({visualizer:e}){return n.createElement("article",{className:"visualizer-info"},n.createElement(lA,{visualizer:e}),n.createElement(cA,{visualizer:e}))}function lA({visualizer:e}){return n.createElement("h3",null,"Visualizer: ",function(e){if(e){if(dA(e))return e.name||"none";{const t=Ww(e.providerId);if(t)return t.name}}return"none"}(e))}function cA({visualizer:e}){var t;if(e){if(dA(e))return n.createElement("p",{className:"no-visualizer-reason"},function(e){if(dA(e))switch(e.reason){case"not supported":return"Visualizer not supported for this media";case"not found":return"Visualizer not found";case"error":return"Visualizer error"}return""}(e));{const r="ambientvideo"===e.providerId&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=Ww(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return r?n.createElement(uA,{visualizer:e}):e.name?n.createElement(n.Fragment,null,n.createElement("h4",null,"Name: ",e.name),i?n.createElement("p",{className:"external-view"},n.createElement("span",null,"Url:")," ",n.createElement(Jl,{href:i})):null):null}}}function uA({visualizer:e}){const t=function(e){const[t,,r]=e.split(":"),[i,a]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(a(null),"youtube"===t&&r){const e=Zr(Fc(r)).subscribe(a);return()=>e.unsubscribe()}}),[t,r]),i}(e.src);return t?n.createElement("div",{className:"youtube-video-info"},n.createElement("h4",null,"Title: ",t.title),n.createElement(lS,{owner:t.owner,src:t.src}),n.createElement("p",{className:"external-view"},"View on YouTube: ",n.createElement(rt,{name:"youtube"})," ",n.createElement(Jl,{href:t.externalUrl}))):null}function dA(e){return"none"===(null==e?void 0:e.providerId)}function mA(e){const t=(0,n.useRef)(null),{debug:r}=vS(t),i=FE(),a=sA(),s=Jx(i),o=Jx(a);return n.createElement(or,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),n.createElement("form",{method:"dialog"},s?n.createElement(Zx,{item:s,debug:r}):n.createElement("p",null,"The playlist is empty."),s&&s.mediaType!==ti.Video?n.createElement(oA,{visualizer:o}):null,n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}var hA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function fA(){const e=FE(),t=XP(),r=(0,n.useCallback)((()=>hA(this,void 0,void 0,(function*(){yw.atStart||Dx.prev()}))),[]),i=(0,n.useCallback)((()=>hA(this,void 0,void 0,(function*(){yw.atEnd||Dx.next()}))),[]);return e?n.createElement(BE,{className:"media-buttons"},n.createElement(hp,{className:"with-overlay","aria-label":"Previous track",icon:"prev",tabIndex:-1,onClick:r}),n.createElement(hp,{className:"with-overlay","aria-label":t?"Play":"Pause",icon:t?"play":"pause",tabIndex:-1,onClick:t?Tx:Px}),n.createElement(hp,{className:"with-overlay","aria-label":"Stop",icon:"stop",onClick:Ix}),n.createElement(hp,{className:"with-overlay","aria-label":"Next track",icon:"next",tabIndex:-1,onClick:i})):null}function pA(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const e=()=>{const n=t.current,i=n.getContext("2d"),a=i.createImageData(n.width,n.height),s=new Uint32Array(a.data.buffer);for(let e=0;e<s.length;e++)s[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),r=requestAnimationFrame(e)};let r=0;return e(),()=>cancelAnimationFrame(r)}),[]),Wt(e,(({width:e,height:r})=>{const n=t.current;n.width=Math.ceil(e),n.height=Math.ceil(r)})),n.createElement("div",{className:"static",ref:e},n.createElement("canvas",{ref:t}))}const yA=(0,n.memo)((function(){var e;const t=cp(BP,[]),r=sA(),i=cp(VP,!1),a=cp(UP,""),s=pn(a),o="none"!==a,l=!a||t.length>1,c=l&&!i,u=function(){const e=FE(),t=sA(),[r,i]=(0,n.useState)("");return(0,n.useEffect)((()=>{if((null==e?void 0:e.mediaType)===ti.Video){const t=Jf(e);(null==t?void 0:t.serviceType)===Mn.PublicMedia?i("apple"===t.id?"apple-logo":t.icon):i("")}else"ambientvideo"===(null==t?void 0:t.providerId)&&t.src.startsWith("youtube:")?i("youtube"):i("")}),[e,t]),r}(),[d,m]=(0,n.useState)(0),h=XP(),f=(null===(e=FE())||void 0===e?void 0:e.mediaType)===ti.Video,p="none"===(null==(g=r)?void 0:g.providerId)&&g.reason?`visualizer ${g.reason}`:"",y=(0,n.useCallback)((()=>{cr(mA)}),[]),v=(0,n.useCallback)((()=>{cr(eE,!0)}),[]),b=(0,n.useCallback)((()=>{m(d+1),0===d&&setTimeout((()=>HP("click")))}),[d]);var g;return(0,n.useEffect)((()=>{s&&s!==a&&!f&&m((e=>e+1))}),[s,a,f]),(0,n.useEffect)((()=>{if(d){const e=Lr(500).subscribe((()=>m(0)));return()=>e.unsubscribe()}}),[d]),n.createElement("div",{className:"visualizer-controls",style:d?{opacity:"1"}:void 0},o&&d&&!h?n.createElement(pA,null):null,n.createElement(BE,{className:"visualizer-buttons visualizer-controls-settings"},n.createElement(hp,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:y}),n.createElement(hp,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:v})),o?n.createElement(BE,{className:"visualizer-buttons visualizer-controls-selector"},l?n.createElement(hp,{className:"with-overlay",icon:i?"locked":"unlocked",title:i?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:i?qP:YP}):null,c?n.createElement(hp,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:b}):null):null,n.createElement(fA,null),u?n.createElement(rt,{className:"video-source-icon",name:u}):null,n.createElement("p",{className:"media-state no-visualizer-reason"},p),n.createElement(eA,null))}));function vA(){var e;const t=FE(),r=function(){var e,t;const[r,i]=(0,n.useState)("show"),a=cp(ww,null),s=null===(e=null==a?void 0:a.paused)||void 0===e||e,o=null==a?void 0:a.currentItem,l=(null==a?void 0:a.currentTime)||0,c=(null==o?void 0:o.mediaType)===ti.Video,u=(null===(t=sA())||void 0===t?void 0:t.providerId)||"none",[d,m]=(0,n.useState)(!0),h=l>0;return(0,n.useEffect)((()=>{if(m(!0),h){const e=setTimeout((()=>m(!1)),1e4);return()=>clearTimeout(e)}}),[h]),(0,n.useEffect)((()=>{i(s?"show":"coverart"!==u||c?("none"!==u||c)&&h?d?"fade-out":"hide":"show":"hide")}),[s,u,c,h,d]),r}();return n.createElement("div",{className:`interstitial ${r}`},n.createElement("div",{className:"currently-playing"},t?n.createElement(n.Fragment,null,n.createElement("h2",null,t.title),(null===(e=t.artists)||void 0===e?void 0:e.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"by"},"by"),n.createElement("h3",null,t.artists.join(", "))):null):n.createElement("p",null,"The playlist is empty.")),n.createElement(ZP,null))}r(6234);const bA=(0,n.memo)((function(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=cp(Dy,!1),[i,a]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),l=FE(),c=null==l?void 0:l.id,u=(null==l?void 0:l.mediaType)===ti.Video,d=sA(),m=!d||"none"===d.providerId,h=!u&&"coverart"===(null==d?void 0:d.providerId),f=!function(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e){const r=t=>Hr(e,t),n=nn(r("mousemove"),r("mousedown"),r("mouseup")).pipe(at((()=>i(!0))),vv(t),at((()=>i(!1)))).subscribe();return()=>n.unsubscribe()}i(!1)}),[e,t]),r}(e.current,4e3),p=JP();(0,n.useEffect)((()=>{const e=setTimeout((()=>o(!1)),1e4);return o(!0),()=>clearTimeout(e)}),[c]),(0,n.useEffect)((()=>{Dx.appendTo(t.current)}),[]),(0,n.useEffect)((()=>{const t=Hr(document,"fullscreenchange").pipe(Be((()=>document.fullscreenElement===e.current))).subscribe(a);return()=>t.unsubscribe()}),[]),Wt(e,(({width:e,height:t})=>{Dx.resize(e,t)}));const y=(0,n.useCallback)((()=>{i?document.exitFullscreen():e.current.requestFullscreen()}),[i]);return n.createElement("div",{className:`panel media ${p} ${u?"is-playing-video":"is-playing-audio"} ${m?"no-visualizer":""}  ${h?"is-showing-cover-art":""} ${f?"idle":""} ${s?"is-new-item":""}`,onDoubleClick:y,ref:e},n.createElement("div",{className:"players",ref:t}),n.createElement(aA,null),n.createElement(vA,null),r&&i?n.createElement(eA,null):null,n.createElement(yA,null))}));var gA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const wA={duration:!0,skipCovers:!0,skipPostHeaders:!0};function EA(e,t,r,n){var i,a,s;const{common:o}=n,l=(e=0)=>Math.floor(Number(e))||0;return{itemType:Zn.Media,mediaType:e,playbackType:Nn.Direct,src:t,externalUrl:"",title:o.title||r,artists:o.artist?[o.artist]:o.artists,albumArtist:o.album&&o.albumartist||"",album:o.album||"",genres:o.genre,duration:0,track:l(null===(i=o.track)||void 0===i?void 0:i.no),disc:l(null===(a=o.disk)||void 0===a?void 0:a.no),year:l(o.year),mood:o.mood||"",rating:Number(o.rating)||0,isrc:null===(s=o.isrc)||void 0===s?void 0:s[0],recording_mbid:o.musicbrainz_recordingid,playedAt:0,noScrobble:!o.title}}var kA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const xA=new H("usePlaylistInject"),SA={items:mw,files:function(e,t){return kA(this,void 0,void 0,(function*(){try{e instanceof FileList&&(e=Array.from(e));const n=yield Promise.all(e.map((e=>function(e){return gA(this,void 0,void 0,(function*(){const{parseBlob:t}=yield Promise.all([r.e(463),r.e(12)]).then(r.bind(r,2463)),n=yield t(e,wA),{format:i}=n,a=e.type.startsWith("video"),s=i.duration||0,o=EA(a?ti.Video:ti.Audio,`blob:${Ea()}`,e.name.replace(/\.\w+$/,""),n);return Object.assign(Object.assign({},o),{duration:s?Number(s.toFixed(3)):0,blob:e})}))}(e))));yield mw(n,t)}catch(e){yield PA(e)}}))},urls:function(e,t){return kA(this,void 0,void 0,(function*(){const[n,i]=m(e,(e=>!!sc()(e))),a=n.map((e=>sc()(e)));try{const e=yield Promise.all([Promise.all(a.map((e=>Fc(e)))),Promise.all(i.map((e=>function(e){return gA(this,void 0,void 0,(function*(){const t=yield function(e,t){var n;return gA(this,void 0,void 0,(function*(){const{parseBlob:i,parseReadableStream:a}=yield Promise.all([r.e(463),r.e(12)]).then(r.bind(r,2463)),s=yield fetch(e,{signal:AbortSignal.timeout(3e3)});if(s.ok){if(s.body){const e=s.headers.get("Content-Length"),r={size:e?parseInt(e,10):void 0,mimeType:null!==(n=s.headers.get("Content-Type"))&&void 0!==n?n:void 0},i=yield a(s.body,r,t);return s.body.locked||(yield s.body.cancel()),i}return i(yield s.blob(),t)}throw Error(s.statusText||"Could not load media")}))}(e,wA),{format:n}=t,i=n.duration||0,a=EA(ti.Audio,e,e,t);return Object.assign(Object.assign({},a),{duration:i?Number(i.toFixed(3)):0})}))}(e))))]);yield mw(e.flat(),t)}catch(e){yield PA(e)}}))},spotifyTracks:function(e,t){return kA(this,void 0,void 0,(function*(){try{const r=Gf("spotify");if(null==r?void 0:r.isConnected()){const n=yield r.getTracksById(e);yield mw(n,t)}else yield PA(Error("Not connected to Spotify."))}catch(e){yield PA(Error("Failed to load Spotify tracks."))}}))}};function TA(){return SA}function PA(e){return kA(this,void 0,void 0,(function*(){xA.error(e);const t="Media could not be loaded.",r=e instanceof TypeError?t:e.message||t;yield kr(r)}))}var AA=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function IA(e){var{icon:t,className:r=""}=e,i=AA(e,["icon","className"]);const a=(0,n.useRef)(null),s=(0,n.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return n.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${r}`,type:"button",onMouseDown:s,ref:a}),n.createElement(rt,{name:t}))}const CA=(0,n.memo)((function(){const[e,t]=(0,n.useState)((()=>Dx.muted)),[r,i]=(0,n.useState)((()=>Dx.volume)),a=r<=.33?"low":r<=.67?"medium":"high";(0,n.useEffect)((()=>{Dx.muted=e}),[e]),(0,n.useEffect)((()=>{Dx.volume=r}),[r]);const s=(0,n.useCallback)((e=>{const r=e.target.valueAsNumber;i(r),t(0===r)}),[]),o=(0,n.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return n.createElement("div",{className:`volume-control volume-${a}`},n.createElement(hp,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:o}),n.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:r,onChange:s}))}));function MA(e){const t=0===cp(cw,0),r=XP();return n.createElement(GE,Object.assign({},e),n.createElement(ZE,{label:"Stop after current",value:"stop-after-current",checked:Dx.stopAfterCurrent,disabled:r,key:"stop-after-current"}),n.createElement(QE,{label:"Jump to current",value:"jump-to-current",disabled:t,key:"jump-to-current"}),n.createElement(ek,null),n.createElement(QE,{label:"Shuffle",value:"shuffle",disabled:t,key:"shuffle"}),n.createElement(ek,null),n.createElement(QE,{label:"Save as playlist…",value:"save-as-playlist",disabled:t,key:"save-as-playlist"}),n.createElement(ek,null),n.createElement(QE,{label:"Add from file…",value:"add-from-file",key:"add-from-file"}),n.createElement(QE,{label:"Add from url…",value:"add-from-url",key:"add-from-url"}),n.createElement(ek,null),n.createElement(QE,{label:"Clear",value:"clear",disabled:t,key:"clear"}))}var OA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function $A({listViewRef:e}){const t=(0,n.useRef)(null),r=cp(ow,-1),i=cp(Sw,0),a=cp(Tw,0),s=XP(),{showPlaylistMenu:o}=function(e,t){const r=TA();return{showPlaylistMenu:(0,n.useCallback)(((i,a)=>{return s=this,o=void 0,c=function*(){const s=e.current;switch(yield rk((e=>n.createElement(MA,Object.assign({},e))),i,a)){case"jump-to-current":s.scrollIntoView(yw.getCurrentIndex()),s.focus();break;case"stop-after-current":Dx.stopAfterCurrent=!Dx.stopAfterCurrent;break;case"clear":yw.clear();break;case"shuffle":yw.shuffle(!Dx.paused),s.scrollIntoView(0);break;case"add-from-file":t.current.click();break;case"add-from-url":{const e=yield Tr({title:"External Media",type:"url",label:"Url",okLabel:"Add"});e&&(yield r.urls([e],-1));break}case"save-as-playlist":yield $S(yw.getItems())}},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(r,n)}i((c=c.apply(s,o||[])).next())}));var s,o,l,c}),[e,t,r])}}(e,t),l=TA(),c=(0,n.useCallback)((e=>{Ax(e.target.valueAsNumber)}),[]),u=(0,n.useCallback)((e=>OA(this,void 0,void 0,(function*(){const{right:t,bottom:r}=e.target.getBoundingClientRect();yield o(t,r+4)}))),[o]),d=(0,n.useCallback)((()=>OA(this,void 0,void 0,(function*(){yw.atStart||(Dx.prev(),e.current.scrollIntoView(r-1))}))),[e,r]),m=(0,n.useCallback)((()=>OA(this,void 0,void 0,(function*(){yw.atEnd||(Dx.next(),e.current.scrollIntoView(r+1))}))),[e,r]),h=(0,n.useCallback)((e=>OA(this,void 0,void 0,(function*(){const t=e.target.files;t&&(yield l.files(t,-1),e.target.value="")}))),[l]);return n.createElement("div",{className:"media-controls"},n.createElement("div",{className:"current-time-control"},n.createElement(GS,{time:i}),n.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:a,step:1,value:i,disabled:s,onChange:c})),n.createElement("div",{className:"playback-control"},n.createElement(CA,null),n.createElement("div",{className:"media-buttons"},n.createElement(IA,{"aria-label":"Previous track",icon:"prev",onClick:d}),n.createElement(IA,{"aria-label":s?"Play":"Pause",icon:s?"play":"pause",onClick:s?Tx:Px}),n.createElement(IA,{"aria-label":"Stop",icon:"stop",onClick:Ix}),n.createElement(IA,{"aria-label":"Next track",icon:"next",onClick:m})),n.createElement("div",{className:"media-buttons-more"},n.createElement(IA,{title:"More…",icon:"menu",onClick:u}),n.createElement("input",{type:"file",accept:"audio/*,video/*",multiple:!0,onChange:h,ref:t}))))}var NA=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function zA(e){var{items:t,selectedItems:r,rowIndex:i}=e,a=NA(e,["items","selectedItems","rowIndex"]);const s=t.length,o=r.length,l=o===s,c=1===o;return n.createElement(GE,Object.assign({},a),-1===i?null:n.createElement(n.Fragment,null,c?n.createElement(QE,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,n.createElement(QE,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"})),n.createElement(ek,null),l?null:n.createElement(QE,{label:"Select all",value:"select-all",acceleratorKey:`${j.ctrlKeyStr}+A`,key:"select-all"}),!c&&function(e,t){const r=e.findIndex((e=>e===t[0]));return t.every(((t,n)=>t===e[r+n]))}(t,r)?n.createElement(QE,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,n.createElement(ek,null),n.createElement(ik,{items:r}),n.createElement(ek,null),c?n.createElement(QE,{label:"Info…",value:"info",acceleratorKey:`${j.ctrlKeyStr}+I`,key:"info"}):null)}const jA={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[r]=e.split(":");let i;switch(t){case qg.Looking:i="lookup-looking";break;case qg.NotFound:i="lookup-not-found";break;default:i=tp(e)?r:"lookup-pending"}return n.createElement(rt,{name:i,className:"youtube"===r?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return(null==t?void 0:t.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"artist-text"},t.join("/")),n.createElement("span",{role:"separator"},"-"),n.createElement("span",{className:"title-text"},e)):n.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:QS,align:"right",className:"duration"}]};var LA=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const DA=["audio/*","video/*","text/x-spotify-tracks","text/uri-list"];function RA(e){var{onSelect:t,onPlay:r,onEject:i,listViewRef:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["onSelect","onPlay","onEject","listViewRef"]);const o=cp(yw.observe,[]),l=function(e){const t=FE(),r=null==t?void 0:t.id,i=XP(),a=String(e).length,{zeroPadLineNumbers:s,showLineNumbers:o,showSourceIcons:l}=cp(Cy.observe,Cy.get());return(0,n.useMemo)((()=>Object.assign(Object.assign({},jA),{cols:jA.cols.filter((e=>{switch(e.className){case"index":return o;case"source":return l;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,t)=>{const o=function(e,t=0){return n.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(t,s?a:0);return e.id===r?n.createElement(n.Fragment,null,n.createElement(rt,{name:i?"pause":"play"}),o):o}}):e))})),[s,o,l,a,r,i])}(o.length),c=FE(),u=null==c?void 0:c.id,[d,m]=(0,n.useState)([]),h=nT(d),f=TA(),p=(0,n.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===u?"playing":""} ${e.unplayable||e.lookupStatus===qg.NotFound?"unplayable":""}`}),[u]),y=(0,n.useCallback)((e=>{m(e),null==t||t(e)}),[t]),v=(0,n.useCallback)((e=>{null==r||r(e)}),[r]),b=(0,n.useCallback)((e=>{1===e.length&&(null==r||r(e[0]))}),[r]),g=(0,n.useCallback)((e=>{1===e.length&&e[0].id===u?null==i||i():yw.remove(e)}),[i,u]),w=(0,n.useCallback)((([e])=>LA(this,void 0,void 0,(function*(){e&&(yield wS(e))}))),[]),E=(0,n.useCallback)(((e,t,i,s,l)=>LA(this,void 0,void 0,(function*(){if(0===o.length)return;const c=yield function(e,t,r,i,a,s="left"){return o=this,l=void 0,u=function*(){return rk((i=>n.createElement(zA,Object.assign({},i,{items:e,selectedItems:t,rowIndex:r}))),i,a,s)},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(r,n)}i((u=u.apply(o,l||[])).next())}));var o,l,c,u}(o,e,s,t,i,-1===l?"right":"left");switch(c){case"play":null==r||r(e[0]);break;case"remove":yw.remove(e);break;case"info":yield wS(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=o.findIndex((t=>t===e[0]));yw.reverseAt(t,e.length);break}default:yield DS(c,e)}}))),[r,o,a]),k=(0,n.useCallback)(((e,t)=>LA(this,void 0,void 0,(function*(){if(e instanceof DataTransferItem)switch(e.type){case"text/x-spotify-tracks":e.getAsString((e=>LA(this,void 0,void 0,(function*(){const r=e.split(/\s+/).map((e=>e.split(":")[2]));yield f.spotifyTracks(r,t)}))));break;case"text/uri-list":e.getAsString((e=>LA(this,void 0,void 0,(function*(){const r=e.split(/\s+/);yield f.urls(r,t)}))))}else e[0]instanceof File?yield f.files(e,t):yield f.items(e,t)}))),[f]);return n.createElement("div",{className:"playlist",onDragStart:h},n.createElement($p,Object.assign({},s,{title:"Playlist",className:"media-list",layout:l,items:o,itemKey:"id",itemClassName:p,selectedIndex:0===o.length?-1:0,draggable:!0,droppable:!0,droppableTypes:DA,multiple:!0,reorderable:!0,onContextMenu:E,onDelete:g,onDoubleClick:v,onDrop:k,onEnter:b,onInfo:w,onMove:yw.moveSelection,onSelect:y,listViewRef:a})),n.createElement(YS,{items:o,size:o.length,selectedCount:d.length}))}const FA=(0,n.memo)((function(){const e=(0,n.useRef)(null),t=FE(),r=null==t?void 0:t.id,i=XP(),a=(0,n.useCallback)((e=>{e.id===r?Dx.play():(Dx.load(null),Dx.autoplay=!0,yw.setCurrentItem(e))}),[r]);return n.createElement("div",{className:"media-playback "+(i?"paused":"")},n.createElement(aE,null),n.createElement(ir,{id:"media-playback-layout",arrange:"rows"},n.createElement("div",{className:"panel playback"},n.createElement($A,{listViewRef:e}),n.createElement(RA,{onPlay:a,onEject:Ox,listViewRef:e})),n.createElement(bA,null)))}));function _A(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function BA(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),VA());break;case"MediaPlayPause":e.preventDefault(),VA();break;case"MediaStop":e.preventDefault(),Dx.stop();break;case"MediaTrackPrevious":e.preventDefault(),Dx.prev();break;case"MediaTrackNext":e.preventDefault(),Dx.next()}}function VA(){Dx.paused?Dx.play():Dx.pause()}function UA(){return(0,n.useEffect)((()=>{document.body.classList.add(`browser-${j.name.replace(/\s+/g,"-")}`),document.body.classList.add("electron")}),[]),(0,n.useEffect)((()=>{const e=new le,t=AE();return Bf().forEach((r=>{const n=Rn([t,r.observeIsLoggedIn()]).subscribe((([e,t])=>{const n=r.internetRequired?e&&t:t;document.body.classList.toggle(`${r.id}-connected`,n),document.body.classList.toggle(`${r.id}-not-connected`,!n)}));e.add(n)})),()=>e.unsubscribe()}),[]),(0,n.useEffect)((()=>{let e=!1;const t=document.getElementById("app"),r=document.getElementById("system"),n=new le,i=e=>Hr(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return document.activeElement.classList.toggle("focus",!0),n.add(Hr(document,"keydown",{capture:!0}).subscribe((()=>{e=!0}))),n.add(Hr(document,"mousedown",{capture:!0}).subscribe((()=>{e=!1}))),n.add(Hr(document,"focusin").subscribe((()=>{document.body.classList.toggle("focus-visible",e)}))),n.add(Hr(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?r:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),n.add(Hr(document,"mouseup",{capture:!0}).subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),n.add(Hr(r,"mousedown").subscribe(w)),n.add(i(t)),n.add(i(r)),()=>n.unsubscribe()}),[]),(0,n.useEffect)((()=>{const e=Hr(document,"dragenter"),t=Hr(document,"dragover"),r=Hr(document,"drop"),n=nn(e,t).pipe(at(_A)),i=nn(n,r.pipe(at(g))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=cp(ww,void 0);(0,n.useEffect)((()=>function({currentItem:e,currentTime:t=0,duration:r=0,paused:n=!0}={}){var i,a;const s=navigator.mediaSession;s.playbackState=n?t?"paused":"none":"playing",s.setPositionState({duration:r,position:t,playbackRate:1}),s.metadata=new MediaMetadata({title:null==e?void 0:e.title,artist:null===(i=null==e?void 0:e.artists)||void 0===i?void 0:i.join(", "),album:null==e?void 0:e.album,artwork:null===(a=null==e?void 0:e.thumbnails)||void 0===a?void 0:a.map((e=>({src:qx(e),sizes:`${e.width}x${e.height}`})))}),s.setActionHandler("play",Tx),s.setActionHandler("pause",Px),s.setActionHandler("stop",Ix),s.setActionHandler("previoustrack",Cx),s.setActionHandler("nexttrack",Mx),s.setActionHandler("seekto",(e=>{null!=e.seekTime&&Ax(e.seekTime)}))}(e)),[e])}(),(0,n.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",w),document.getElementById("popup").addEventListener("keydown",w),document.body.addEventListener("keydown",BA)}),[]),n.createElement(ir,{id:"main-layout",arrange:"columns"},n.createElement(OP,null),n.createElement(FA,null))}function HA({onDismiss:e}){return n.createElement("div",{className:"desktop-warning"},n.createElement(nt,null),n.createElement("p",null,"This application is intended for a desktop browser."),n.createElement("p",null,n.createElement("button",{onClick:e},"Proceed")))}const YA=new J("desktopWarning");"https:"===location.protocol&&window.addEventListener("load",(()=>{var e;null===(e=navigator.serviceWorker)||void 0===e||e.register("/service-worker.js")})),(0,i.s)(document.getElementById("app")).render(n.createElement(n.StrictMode,null,n.createElement((function(){const[e,t]=(0,n.useState)((()=>j.desktop||YA.getBoolean("dismissed"))),r=(0,n.useCallback)((()=>{YA.setBoolean("dismissed",!0),t(!0)}),[]);return n.createElement(n.Fragment,null,n.createElement(tt,null),n.createElement("main",null,e?n.createElement(UA,null):n.createElement(HA,{onDismiss:r})))}),null)))}},e=>{e.O(0,[136,529,503],(()=>(6819,e(e.s=6819)))),e.O()}]);